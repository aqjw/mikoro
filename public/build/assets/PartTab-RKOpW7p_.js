import{D as g}from"./DateManager-CCeyG2dg.js";import{p as Q,r as c,k as P,a as l,q as W,o as r,c as i,g as S,w as d,d as t,b as u,v as X,F as V,n as q,x as Y,t as _,u as f,m as Z,f as ee,y as te}from"./app-Dxtfsv7s.js";import{_ as ae}from"./TitleRating-Cq9kWLOw.js";import{f as se,g as oe,h as F}from"./index-BEdA3Klw.js";import{u as re}from"./index-Dad5rGkx.js";const ne={key:0},le=["colspan"],ie={class:"flex justify-center items-center p-6"},ce={key:1},de=["colspan"],ue=["onClick"],pe={class:"break-anywhere py-2"},_e={class:"whitespace-nowrap"},ve={key:0,class:"whitespace-nowrap"},me={class:"text-xs ml-2"},ge={key:1},fe={class:"whitespace-nowrap"},he={class:"whitespace-nowrap"},Ce={__name:"PartTab",props:{bookmark:{type:String,required:!0},bookmarks:{type:Array,required:!0}},emits:["refresh"],setup(h,{emit:T}){const L=h,U=T,C=Q.useToast(),B=re(),m=c([]),$=c(0),D=c(1),I=c(0),p=c(!1),N=c(0),E=c([{key:"updated_at",order:"desc"}]),k=[{title:"Название",align:"start",key:"title"},{title:"Выпущено",align:"start",key:"released_at",nowrap:!0,value:e=>g.format(e.released_at,"y LLLL")},{title:"Рейтинг",align:"start",key:"rating",nowrap:!0},{title:"Кол-во серий",align:"start",key:"last_episode",value:e=>e.single_episode?"Фильм":`${e.last_episode} серий`},{title:"Добавлено",align:"start",key:"updated_at",nowrap:!0,value:e=>g.format(e.updated_at)},{title:"",sortable:!1,key:"actions"}],y=P(()=>!p.value&&!m.value.length),w=P(()=>p.value&&!m.value.length),z=({page:e,sortBy:a})=>{p.value||(p.value=!0,B.$loadItems(L.bookmark,{page:e,sortBy:a},{success:o=>{m.value=o.items,$.value=o.total,I.value=o.items_per_page},error:o=>{C.error(F(o))},finish:()=>{p.value=!1}}))},R=e=>{te.visit(route("title",e.slug))},j=(e,a)=>{const o=L.bookmark===e.name,b=o?null:e.id;a.loading=!0,B.$toggle(a.title_id,b,{success:()=>{N.value=+new Date,o||U("refresh",e.name)},error:x=>{C.error(F(x))},finish:()=>{a.loading=!1}})};return(e,a)=>{const o=l("v-progress-circular"),b=l("v-btn"),x=l("v-icon"),A=l("v-list-item-title"),K=l("v-list-item"),M=l("v-list"),G=l("v-menu"),H=l("v-data-table-server"),J=W("ripple");return r(),i("div",null,[(r(),S(H,{key:N.value,"fixed-header":"",hover:"",density:"compact",class:"max-h-[calc(100vh-220px)]","item-value":"title",page:D.value,"onUpdate:page":a[0]||(a[0]=v=>D.value=v),"items-per-page":I.value,headers:k,items:m.value,"items-length":$.value,loading:p.value,"hide-default-footer":y.value||w.value,"hide-default-header":y.value||w.value,"sort-by":E.value,"onUpdate:sortBy":a[1]||(a[1]=v=>E.value=v),"onUpdate:options":z},{body:d(({items:v})=>[w.value?(r(),i("tr",ne,[t("td",{colspan:k.length},[t("div",ie,[u(o,{color:"primary",indeterminate:"",size:25,width:2})])],8,le)])):X("",!0),y.value?(r(),i("tr",ce,[t("td",{colspan:k.length},a[2]||(a[2]=[t("div",{class:"text-center p-6"},"Ничего не найдено",-1)]),8,de)])):(r(!0),i(V,{key:2},q(v,s=>Y((r(),i("tr",{key:s.id,class:"cursor-pointer",onClick:n=>R(s)},[t("td",null,[t("div",pe,_(s.title),1)]),t("td",_e,_(f(g).format(s.released_at,"y LLLL")),1),t("td",null,[s.shikimori_rating?(r(),i("div",ve,[u(ae,{value:s.shikimori_rating},null,8,["value"]),t("span",me," ("+_(f(se)(s.shikimori_votes))+") ",1)])):(r(),i("div",ge,"–"))]),t("td",fe,[t("div",null,_(s.single_episode?"Фильм":`${s.last_episode} серий`),1)]),t("td",he,_(f(g).format(s.updated_at)),1),t("td",null,[u(G,{location:"bottom end"},{activator:d(({props:n})=>[u(b,Z({icon:"mdi-dots-vertical",variant:"text",density:"comfortable",size:"small",loading:s.loading,ref_for:!0},n),null,16,["loading"])]),default:d(()=>[u(M,{density:"compact",class:"spacerless"},{default:d(()=>[(r(!0),i(V,null,q(h.bookmarks,(n,O)=>(r(),S(K,{key:O,value:n.name,active:n.name===h.bookmark,color:"primary",onClick:ke=>j(n,s)},{prepend:d(()=>[u(x,{icon:f(oe)(n.name)},null,8,["icon"])]),default:d(()=>[u(A,null,{default:d(()=>[ee(_(n.name),1)]),_:2},1024)]),_:2},1032,["value","active","onClick"]))),128))]),_:2},1024)]),_:2},1024)])],8,ue)),[[J]])),128))]),_:1},8,["page","items-per-page","items","items-length","loading","hide-default-footer","hide-default-header","sort-by"]))])}}};export{Ce as default};
