import{D as $,n as y,l as j,r as a,y as q,z,a as p,o as n,c as g,d as r,b as _,w as l,F,k as H,g as x,t as i,u as c,f as b,q as B,A as L}from"./app-Ys3vaVSC.js";import{g as A,a as P,h as R}from"./index-BEdA3Klw.js";import{D as G}from"./DateManager-COeytZvZ.js";import{_ as J}from"./InfiniteScroll-qg4Gak8H.js";const K={key:0},O={class:"text-sm flex justify-between mb-1"},Q={class:"text-gray-600 dark:text-gray-400 italic"},Z={__name:"PartHistory",props:{userId:{type:Number,required:!0}},setup(D){const E=D,N=$(),w=y(()=>N.global.name.value==="dark"),C=j.useToast(),f=a(null),u=a(!0),v=a(0),k=a(1),m=a([]),h=a(!0),I=y(()=>!u.value&&v.value==0);q(()=>{z(()=>{var o;(o=f.value)==null||o.load()})});const T=o=>{u.value=!0,axios.get(route("upi.profile.activity_histories",{user:E.userId}),{params:{page:k.value}}).then(({data:e})=>{V(e.items),v.value=e.total,h.value=e.has_more,k.value+=1}).catch(({response:e})=>{C.error(R(e))}).finally(()=>{u.value=!1,o()})},V=o=>{m.value.push(...o.map(e=>{const s=e.type==="episode",d=s?e.context?`Серия ${e.context}`:"Фильм":"Закладка";return{icon:s?"mdi-check-all":"mdi-bookmark",title:d,body:e.title.title,bookmark:s?null:e.context,url:route("title",e.title.slug),timestamp:e.created_at}}))};return(o,e)=>{const s=p("v-chip"),d=p("v-timeline-item"),M=p("v-timeline");return I.value?B("",!0):(n(),g("div",K,[e[0]||(e[0]=r("div",{class:"text-lg mb-2 font-semibold justify-start flex"},"История",-1)),_(J,{ref_key:"infiniteScroll",ref:f,items:m.value,"has-more":h.value,"on-load":T,class:"max-h-[500px] overflow-y-auto"},{default:l(()=>[_(M,{align:"start",density:"compact","fill-dot":"","dot-color":"indigo-lighten-2",size:"x-small"},{default:l(()=>[(n(!0),g(F,null,H(m.value,(t,S)=>(n(),x(d,{key:S,icon:t.icon},{default:l(()=>[r("div",O,[r("div",null,i(t.title),1),r("div",Q,i(c(G).toHuman(t.timestamp,{parts:1}))+" ago",1)]),t.bookmark?(n(),x(s,{key:0,"prepend-icon":c(A)(t.bookmark),color:c(P)(t.bookmark,w.value),density:"compact",label:""},{default:l(()=>[b(i(t.bookmark),1)]),_:2},1032,["prepend-icon","color"])):B("",!0),r("div",null,[_(c(L),{href:t.url,class:"link"},{default:l(()=>[b(i(t.body),1)]),_:2},1032,["href"])])]),_:2},1032,["icon"]))),128))]),_:1})]),_:1},8,["items","has-more"])]))}}};export{Z as default};
