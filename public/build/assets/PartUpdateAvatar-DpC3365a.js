import{C as T,p as E,r as p,a as b,o as i,c as f,b as w,v as m,w as F,t as N,u as O,d as R,g as V,D as A}from"./app-Dxtfsv7s.js";import{i as $}from"./index-BEdA3Klw.js";const L={key:0,class:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2"},j={key:0,class:"text-4xl font-semibold text-white absolute-center"},X={key:1,class:A(["absolute left-1/2 bottom-4 -translate-x-1/2","flex rounded-[1rem] overflow-hidden bg-white"])},G={__name:"PartUpdateAvatar",props:{user:Object},setup(_){const S=_,y=T(),l=E.useToast(),n=p(S.user.avatar),g=p(null),h=p(!1),r=p(!1),U=(t,a=230,s=230)=>new Promise((o,c)=>{const u=new FileReader;u.onload=z=>{const e=new Image;e.onload=()=>{const d=document.createElement("canvas"),D=d.getContext("2d");let v,x=0,C=0;e.width>e.height?(v=e.height,x=(e.width-e.height)/2):(v=e.width,C=(e.height-e.width)/2),d.width=a,d.height=s,D.drawImage(e,x,C,v,v,0,0,a,s);const P=d.toDataURL("image/jpeg",.7);o(P)},e.onerror=c,e.src=z.target.result},u.onerror=c,u.readAsDataURL(t)}),B=async t=>{const a=t.target.files[0]??null;if(g.value.value=null,!a)return;if(!a.type.startsWith("image/")){l.error("Please select a valid image file");return}const s=await U(a);k(()=>{n.value=s}),r.value=!0,axios.post(route("upi.profile.update_avatar"),{base64:s}).then(({data:o})=>{y.setUser(o.user),l.success("Avatar uploaded successfully")}).catch(({response:o})=>{l.error("Failed to upload avatar")}).finally(()=>{r.value=!1})},I=async()=>{r.value=!0,axios.delete(route("upi.profile.delete_avatar")).then(({data:t})=>{l.success("Avatar deleted successfully"),k(()=>{y.setUser(t.user),n.value=null})}).catch(({response:t})=>{l.error("Failed to delete avatar")}).finally(()=>{r.value=!1})},k=t=>{h.value=!0,setTimeout(t,250),setTimeout(()=>h.value=!1,500)};return(t,a)=>{const s=b("v-progress-circular"),o=b("v-btn"),c=b("v-img");return i(),f("div",{class:A(["bg-second shadow-lg p-4 rounded-full overflow-hidden relative",{"bounce-once":h.value}])},[r.value?(i(),f("div",L,[w(s,{indeterminate:"",color:"primary",class:"!h-[15rem] !w-[15rem]",width:2})])):m("",!0),w(c,{class:"h-56 w-56 bg-zinc-400 dark:bg-zinc-500 rounded-full overflow-hidden relative",src:t.$media.image(n.value)},{default:F(()=>[n.value?m("",!0):(i(),f("span",j,N(O($)(_.user.name)),1)),r.value?m("",!0):(i(),f("div",X,[w(o,{density:"comfortable",color:"primary",variant:"plain",icon:"mdi-upload",rounded:!1,onClick:a[0]||(a[0]=u=>g.value.click())}),R("input",{type:"file",ref_key:"fileInput",ref:g,class:"hidden",accept:"image/*",onChange:B},null,544),n.value?(i(),V(o,{key:0,density:"comfortable",color:"red",variant:"plain",icon:"mdi-delete-outline",rounded:!1,onClick:I})):m("",!0)]))]),_:1},8,["src"])],2)}}};export{G as default};
