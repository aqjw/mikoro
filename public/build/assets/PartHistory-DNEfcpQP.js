import{j as S,k as g,p as $,r as a,z,A as F,a as p,o as n,c as y,d as r,b as v,w as l,F as H,n as L,g as x,t as i,u as c,f as b,v as B,B as q}from"./app-Dxtfsv7s.js";import{g as A,a as P,h as R}from"./index-BEdA3Klw.js";import{D as G}from"./DateManager-CCeyG2dg.js";import{_ as J}from"./InfiniteScroll-D2XMK2I2.js";const K={key:0},O={class:"text-sm flex justify-between mb-1"},Q={class:"text-gray-600 dark:text-gray-400 italic"},Z={__name:"PartHistory",props:{userId:{type:Number,required:!0}},setup(E){const N=E,w=S(),C=g(()=>w.global.name.value==="dark"),D=$.useToast(),_=a(null),u=a(!0),f=a(0),k=a(1),m=a([]),h=a(!0),I=g(()=>!u.value&&f.value==0);z(()=>{F(()=>{var o;(o=_.value)==null||o.load()})});const T=o=>{u.value=!0,axios.get(route("upi.profile.activity_histories",{user:N.userId}),{params:{page:k.value}}).then(({data:e})=>{V(e.items),f.value=e.total,h.value=e.has_more,k.value+=1}).catch(({response:e})=>{D.error(R(e))}).finally(()=>{u.value=!1,o()})},V=o=>{m.value.push(...o.map(e=>{const s=e.type==="episode",d=s?e.context?`Серия ${e.context}`:"Фильм":"Закладка";return{icon:s?"mdi-check-all":"mdi-bookmark",title:d,body:e.title.title,bookmark:s?null:e.context,url:route("title",e.title.slug),timestamp:e.created_at}}))};return(o,e)=>{const s=p("v-chip"),d=p("v-timeline-item"),j=p("v-timeline");return I.value?B("",!0):(n(),y("div",K,[e[0]||(e[0]=r("div",{class:"text-lg mb-2 font-semibold justify-start flex"},"История",-1)),v(J,{ref_key:"infiniteScroll",ref:_,items:m.value,"has-more":h.value,"on-load":T,class:"max-h-[500px] overflow-y-auto"},{default:l(()=>[v(j,{align:"start",density:"compact","fill-dot":"","dot-color":"indigo-lighten-2",size:"x-small"},{default:l(()=>[(n(!0),y(H,null,L(m.value,(t,M)=>(n(),x(d,{key:M,icon:t.icon},{default:l(()=>[r("div",O,[r("div",null,i(t.title),1),r("div",Q,i(c(G).toHuman(t.timestamp,{parts:1}))+" ago",1)]),t.bookmark?(n(),x(s,{key:0,"prepend-icon":c(A)(t.bookmark),color:c(P)(t.bookmark,C.value),density:"compact",label:""},{default:l(()=>[b(i(t.bookmark),1)]),_:2},1032,["prepend-icon","color"])):B("",!0),r("div",null,[v(c(q),{href:t.url,class:"link"},{default:l(()=>[b(i(t.body),1)]),_:2},1032,["href"])])]),_:2},1032,["icon"]))),128))]),_:1})]),_:1},8,["items","has-more"])]))}}};export{Z as default};
