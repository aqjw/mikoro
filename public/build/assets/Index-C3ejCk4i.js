var Io=Object.defineProperty;var Oo=(s,a,i)=>a in s?Io(s,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[a]=i;var st=(s,a,i)=>Oo(s,typeof a!="symbol"?a+"":a,i);import{D as Sa}from"./DateManager-CCeyG2dg.js";import{K as Ea,C as Si,r as _e,a as Se,o as X,g as Me,w as ye,b as te,m as dn,f as wt,s as qe,c as he,F as tt,n as Jt,d as H,D as Et,t as we,v as De,E as Ro,L as Mo,A as Hi,u as V,I as Vi,M as No,N as Bo,z as $i,O as Fo,P as Uo,Q as Ho,l as yi,h as Vo,G as xn,p as Gi,k as He,R as us,S as Br,U as $o,Z as Go}from"./app-Dxtfsv7s.js";import{b as ka,c as Fr,i as Ur,h as qt,s as jo}from"./index-BEdA3Klw.js";import{u as ti}from"./AppStore-SyBTyPr5.js";import{E as zo,D as Wo,P as Ko,T as Yo,B as Xo,I as qo,U as Qo,S as Jo,a as Zo,b as eu,c as tu}from"./index-Bscdw9CF.js";import{_ as Ta}from"./DialogLoginRequires-BsW_kR0J.js";import{_ as iu}from"./InfiniteScroll-D2XMK2I2.js";import{_ as nu}from"./AppLayout-DZNOa1b7.js";import ru from"./PartBookmark-CVG6i12a.js";import su from"./PartDetails-BmE3ZFFa.js";import au from"./PartEpisodeNotify-5Oanks7F.js";import ou from"./PartRating-ClE3ABaI.js";import uu from"./PartRecommendations-DwiGW0jY.js";import lu from"./PartRelated-BGsjeF2I.js";import cu from"./PartScreenshots-Be6QN7eq.js";import"./Navbar-N91oy_VA.js";import"./TitleRating-Cq9kWLOw.js";import"./Footer-BfW0S3g6.js";import"./index-Dad5rGkx.js";import"./CardTitle-ilGdD2m7.js";const hu=()=>({draft:{text:"",html:""},edit:null,replyTo:null,titleId:null,page:1,total:0,items:[],has_more:!0,sorting:"latest",sorting_options:[{value:"latest",title:"Новые"},{value:"oldest",title:"Старые"},{value:"reactions",title:"Популярные"}]}),fu={params(){return{page:this.page,sorting:this.sorting}},draftTextLength(){return this.draft.text.length},editTextLength(){return this.edit?this.edit.draft.text.length:0},replyToTextLength(){return this.replyTo?this.replyTo.draft.text.length:0}},du={$setTitleId(s){this.titleId=s},$resetAll(){this.$resetItems(),this.$resetPage(),this.titleId=null},$resetPage(){this.page=1},$resetItems(){this.items=[],this.has_more=!0},$resetDraft(){this.draft.text="",this.draft.html=""},$setEdit(s){var a;s!==null&&((a=this.edit)==null?void 0:a.id)==s.id&&(s=null),s&&(this.$setReplyTo(null),s.draft={text:"",html:ka(s.body)}),this.edit=s},$setReplyTo(s){var a;if(s!==null&&((a=this.replyTo)==null?void 0:a.real_id)==s.id&&(s=null),s){this.$setEdit(null);const t=ti().getConfig.comments.maxDepth,e=this._findValidParentId(this.items,s.id,t);s.real_id=e||s.id,s.draft={text:"",html:""}}this.replyTo=s},$loadComments(s){axios.get(route("upi.title.comments.get",this.titleId),{params:this.params}).then(({data:a})=>{this.page===1&&this.$resetItems(),this.page++,this.items.push(...a.items),this.total=a.total,this.has_more=a.has_more,s.success()}).catch(({response:a})=>{s.error(a)}).finally(()=>{s.finish()})},$loadReplies(s,a){const i=this._findCommentById(this.items,s),t=(i==null?void 0:i.replies)||[];if(t.length===0){a.finish();return}const e=[...t].reverse().find(r=>!r.is_new);if(!e){a.error(new Error("No valid lastId found (all replies are marked as new).")),a.finish();return}const n=e.id;axios.get(route("upi.title.comments.replies",{comment:s,last:n})).then(({data:r})=>{const o=r.items.filter(u=>!t.some(l=>l.id===u.id));i.replies.push(...o),a.success()}).catch(({response:r})=>{a.error(r)}).finally(()=>{a.finish()})},$storeComment(s,a){axios.post(route("upi.title.comments.store",this.titleId),s).then(({data:i})=>{const t=i.comment,e=t.parent_id;if(t.is_new=!0,e){const n=(r,o,u)=>r.map(l=>(l.id===o?l.replies.push(u):l.replies&&(l.replies=n(l.replies,o,u)),l));this.items=n(this.items,e,t)}else this.items.unshift(t);a.success()}).catch(({response:i})=>{a.error(i)}).finally(()=>{a.finish()})},$updateComment(s){const a=Fr(this.edit.draft.html);axios.patch(route("upi.title.comments.update",this.edit.id),{body:a}).then(({data:i})=>{const t=e=>e.map(n=>(n.id===this.edit.id?(n.body=a,n.updated_at=new Date):n.replies&&(n.replies=t(n.replies)),n));this.items=t(this.items),s.success(),this.$setEdit(null)}).catch(({response:i})=>{s.error(i)}).finally(()=>{s.finish()})},$deleteComment(s,a){axios.delete(route("upi.title.comments.delete",s)).then(()=>{const i=(t,e)=>t.filter(n=>n.id===e?!1:(n.replies&&(n.replies=i(n.replies,e)),!0));this.items=i(this.items,s),a.success()}).catch(({response:i})=>{a.error(i)}).finally(()=>{a.finish()})},$toggleReaction(s,a,i){const t=route("upi.title.comments.toggle_reaction",{comment:s,reaction:a});axios.post(t).then(({data:e})=>{const n=r=>r.map(o=>(o.id===s&&(o.userReactions.includes(a)?o.userReactions=o.userReactions.filter(l=>l!==a):o.userReactions.push(a),o.reactions=e.reactions),o.replies&&(o.replies=n(o.replies)),o));this.items=n(this.items),i.success()}).catch(({response:e})=>{i.error(e)}).finally(()=>{i.finish()})},$report(s,a,i){axios.post(route("upi.title.comments.report",{comment:s,reason:a})).then(()=>{i.success()}).catch(({response:t})=>{i.error(t)}).finally(()=>{i.finish()})},_findCommentById(s,a){for(const i of s){if(i.id===a)return i;if(i.replies&&i.replies.length>0){const t=this._findCommentById(i.replies,a);if(t)return t}}return null},_findValidParentId(s,a,i,t=1){for(const e of s){if(e.id===a)return t>=i?e.parent_id:e.id;if(e.replies&&e.replies.length>0){const n=this._findValidParentId(e.replies,a,i,t+1);if(n)return n}}return null}},ji=Ea("commentStore",{state:hu,getters:fu,actions:du}),ls=60*24*365,xi={set(s,a,i=ls){const e=new Date().getTime()+i*60*1e3,n={value:a,expirationTime:e};localStorage.setItem(s,JSON.stringify(n))},get(s,a=null){const i=localStorage.getItem(s);if(i){const t=JSON.parse(i),e=new Date().getTime();return t.expirationTime&&t.expirationTime<e?(xi.remove(s),a):t.value}return a},getOrSet(s,a,i=ls){const t=xi.get(s);return t!==null?t:(xi.set(s,a,i),a)},remove(s){localStorage.removeItem(s)}},vu={async $fetchPlaybackState(s){if(Si().isLogged){const i=await axios.get(route("upi.title.playback_state",s));this.playbackState[s]=i.data}else{const i=xi.get(`playback-${s}`);i&&(this.playbackState[s]=i)}},async $fetchLinks(s,a){var i,t;try{const e=await axios.get(route("upi.title.video_links",{title:s,episode:this.getPlaybackStateEpisodeId(s)}));this.videoLinks[s]=e.data.links,(i=a.success)==null||i.call(a)}catch(e){console.error("Error fetching links:",e),(t=a.error)==null||t.call(a,e)}},async $fetchEpisodes(s,a){var i,t;try{const e=await axios.get(route("upi.title.episodes",{title:s}));this.episodes[s]=e.data,(i=a.success)==null||i.call(a)}catch(e){console.error("Error fetching episodes:",e),(t=a.error)==null||t.call(a,e)}},async $setPlaybackState(s,a){this.playbackState[s]=a},async $savePlaybackState(s){const a=this.playbackState[s];Si().isLogged?await axios.post(route("upi.title.playback_state",s),a):xi.set(`playback-${s}`,a)}},pu={getPlaybackState:s=>a=>s.playbackState[a],getPlaybackStateEpisodeId:s=>a=>{var i;return(i=s.playbackState[a])==null?void 0:i.episode_id},getLinks:s=>a=>s.videoLinks[a],hasLinks:s=>a=>!!s.videoLinks[a],getEpisodes:s=>a=>s.episodes[a],hasEpisodes:s=>a=>!!s.episodes[a]},gu=()=>({playbackState:{},videoLinks:{},episodes:{}}),mu=Ea("videoProgressStore",{state:gu,getters:pu,actions:vu}),yu={__name:"DialogConfirm",setup(s,{expose:a}){const i=_e(!1),t=_e(null),e=_e(null),n=_e(null),r=_e({}),o=_e(()=>{}),u=(h,f)=>{({title:t.value,text:e.value,icon:n.value,buttons:r.value}=h),o.value=f,i.value=!0},l=h=>{o.value(h),c()},c=()=>{i.value=!1};return a({open:u,close:c}),(h,f)=>{const d=Se("v-spacer"),v=Se("v-btn"),m=Se("v-card"),g=Se("v-dialog");return X(),Me(g,{modelValue:i.value,"onUpdate:modelValue":f[2]||(f[2]=b=>i.value=b),"max-width":"300",opacity:.6},{default:ye(()=>[te(m,{"prepend-icon":n.value,title:t.value,text:e.value},{actions:ye(()=>[te(d),te(v,dn({onClick:f[0]||(f[0]=()=>l(!1)),class:"text-none"},r.value.cancel),{default:ye(()=>f[3]||(f[3]=[wt(" Cancel ")])),_:1},16),te(v,dn({onClick:f[1]||(f[1]=()=>l(!0)),class:"text-none"},r.value.confirm),{default:ye(()=>f[4]||(f[4]=[wt(" Confirm ")])),_:1},16)]),_:1},8,["prepend-icon","title","text"])]),_:1},8,["modelValue"])}}},_u={class:"text-sm"},bu={class:"text-sm"},Su={class:"flex items-center gap-4 pr-2 text-gray-500 dark:text-gray-400"},Eu={class:"text-sm"},ku={__name:"MenuCommentActions",props:{comment:Object},emits:["reply","report","edit","delete"],setup(s,{emit:a}){const i=ti(),t=Si(),{getConfig:e}=qe(i),{isLogged:n,user:r}=qe(t),o=a,u=s,l=_e(null),c=_e([{label:"Report",icon:"mdi-shield-alert-outline",color:"",subitems:e.value.comments.reportReasons,can:()=>!0,action:f=>o("report",f)},{label:"Edit",icon:"mdi-pencil-outline",color:"",can:()=>u.comment.author.id==r.value.id,action:()=>o("edit")},{label:"Delete",icon:"mdi-delete-forever-outline",color:"text-red-600 dark:text-red-400",can:()=>u.comment.author.id==r.value.id,action:()=>{l.value.open(h(),f=>{f&&o("delete")})}}]),h=()=>({title:"Delete comment",text:"Your comment will be deleted permanently. Are you sure?",icon:"mdi-delete-forever-outline",buttons:{confirm:{color:"red",variant:"tonal"}}});return(f,d)=>{const v=Se("v-btn"),m=Se("v-icon"),g=Se("v-list-item"),b=Se("v-list-group"),k=Se("v-list"),E=Se("v-menu");return X(),he("div",null,[te(E,{rounded:""},{activator:ye(({props:w})=>[te(v,dn({icon:"mdi-dots-vertical",size:"small",variant:"text",density:"comfortable"},w),null,16)]),default:ye(()=>[te(k,{density:"compact",color:"primary"},{default:ye(()=>[(X(!0),he(tt,null,Jt(c.value,(w,C)=>(X(),he(tt,{key:C},[w.can()&&!w.subitems?(X(),Me(g,{key:0,color:"primary",onClick:w.action},{default:ye(()=>[H("div",{class:Et(["flex items-center gap-4 pr-2",w.color])},[te(m,{size:"small",icon:w.icon,variant:"tonal"},null,8,["icon"]),H("span",_u,we(w.label),1)],2)]),_:2},1032,["onClick"])):w.can()&&w.subitems?(X(),Me(b,{key:1},{activator:ye(({props:B})=>[te(g,dn({ref_for:!0},B,{color:"primary"}),{default:ye(()=>[H("div",{class:Et(["flex items-center gap-4 pr-2",w.color])},[te(m,{size:"small",icon:w.icon,variant:"tonal"},null,8,["icon"]),H("span",bu,we(w.label),1)],2)]),_:2},1040)]),default:ye(()=>[(X(!0),he(tt,null,Jt(w.subitems,(B,L)=>(X(),Me(g,{key:L,color:"primary",onClick:D=>w.action(B.id)},{default:ye(()=>[H("div",Su,[te(m,{size:"small",icon:B.icon,variant:"tonal"},null,8,["icon"]),H("span",Eu,we(B.name),1)])]),_:2},1032,["onClick"]))),128))]),_:2},1024)):De("",!0)],64))),128))]),_:1})]),_:1}),te(v,{size:"small",variant:"text",density:"comfortable",text:"Ответить",class:"text-none",color:"primary",onClick:d[0]||(d[0]=w=>o("reply"))}),te(yu,{ref_key:"deleteConfirm",ref:l},null,512)])}}};function cs(s){return Ho((a,i)=>({get(){return a(),s},set(t){s=t,requestAnimationFrame(()=>{requestAnimationFrame(()=>{i()})})}}))}class Tu extends zo{constructor(a={}){return super(a),this.contentComponent=null,this.appContext=null,this.reactiveState=cs(this.view.state),this.reactiveExtensionStorage=cs(this.extensionStorage),this.on("beforeTransaction",({nextState:i})=>{this.reactiveState.value=i,this.reactiveExtensionStorage.value=this.extensionStorage}),Fo(this)}get state(){return this.reactiveState?this.reactiveState.value:this.view.state}get storage(){return this.reactiveExtensionStorage?this.reactiveExtensionStorage.value:super.storage}registerPlugin(a,i){const t=super.registerPlugin(a,i);return this.reactiveState&&(this.reactiveState.value=t),t}unregisterPlugin(a){const i=super.unregisterPlugin(a);return this.reactiveState&&i&&(this.reactiveState.value=i),i}}const wu=Ro({name:"EditorContent",props:{editor:{default:null,type:Object}},setup(s){const a=_e(),i=Uo();return Mo(()=>{const t=s.editor;t&&t.options.element&&a.value&&Hi(()=>{if(!a.value||!t.options.element.firstChild)return;const e=V(a.value);a.value.append(...t.options.element.childNodes),t.contentComponent=i.ctx._,i&&(t.appContext={...i.appContext,provides:i.provides}),t.setOptions({element:e}),t.createNodeViews()})}),Vi(()=>{const t=s.editor;if(!t||(t.isDestroyed||t.view.setProps({nodeViews:{}}),t.contentComponent=null,t.appContext=null,!t.options.element.firstChild))return;const e=document.createElement("div");e.append(...t.options.element.childNodes),t.setOptions({element:e})}),{rootEl:a}},render(){return No("div",{ref:s=>{this.rootEl=s}})}}),Cu=(s={})=>{const a=Bo();return $i(()=>{a.value=new Tu(s)}),Vi(()=>{var i;(i=a.value)===null||i===void 0||i.destroy()}),a},Au={key:0,class:"actions-section"},Pu={class:"flex items-center"},xu={class:"flex gap-3"},Lu={key:0,class:"divider-vertical m-1"},Du={class:"text-sm"},Hr={__name:"TextEditor",props:{modelValue:{type:Object,default:{text:"",html:""}}},emits:["update:modelValue"],setup(s,{expose:a,emit:i}){const t=s,e=i,n=Cu({content:t.modelValue.html,extensions:[Wo,Ko,Yo,Xo,qo,Qo,Jo,Zo,eu,tu.configure({placeholder:"Add comment …"})],editorProps:{rows:10,attributes:{class:"prose prose-sm sm:prose-base lg:prose-lg xl:prose-2xl focus:outline-none"}},onUpdate({editor:l}){e("update:modelValue",{text:l.getText(),html:l.getHTML()})}});yi(()=>t.modelValue.html,l=>{n.value&&l!==n.value.getHTML()&&n.value.commands.setContent(l)});const r=[{name:"bold",icon:"mdi-format-bold",action:()=>n.value.chain().focus().toggleBold().run()},{name:"italic",icon:"mdi-format-italic",action:()=>n.value.chain().focus().toggleItalic().run()},{name:"underline",icon:"mdi-format-underline",action:()=>n.value.chain().focus().toggleUnderline().run()},{name:"strike",icon:"mdi-format-strikethrough-variant",action:()=>n.value.chain().focus().toggleStrike().run()},"divide",{name:"blockquote",icon:"mdi-format-quote-close-outline",action:()=>n.value.chain().focus().toggleBlockquote().run()},{name:"spoiler",icon:"mdi-creation-outline",action:()=>n.value.chain().focus().toggleSpoiler().run()}];return a({setEditable:l=>{n.value.setEditable(l)},focus:()=>{n.value.chain().focus()}}),Vi(()=>{var l;(l=n.value)==null||l.destroy()}),(l,c)=>{var v;const h=Se("v-icon"),f=Se("v-tooltip"),d=Se("v-btn");return X(),he("div",{class:Et({"text-editor":!0,"is-focused":(v=V(n))==null?void 0:v.isFocused}),onClick:c[0]||(c[0]=()=>V(n).chain().focus())},[te(V(wu),{editor:V(n)},null,8,["editor"]),V(n)?(X(),he("div",Au,[H("div",Pu,[H("div",xu,[(X(),he(tt,null,Jt(r,m=>(X(),he(tt,{key:m.name},[m==="divide"?(X(),he("div",Lu)):(X(),Me(d,{key:1,density:"comfortable",rounded:"sm",variant:V(n).isActive(m.name)?"tonal":"text",color:"grey-darken-1",icon:m.icon,onClick:m.action},{default:ye(()=>[te(h,{icon:m.icon},null,8,["icon"]),te(f,{activator:"parent",location:"bottom","open-delay":300},{default:ye(()=>[H("span",Du,we(m.name),1)]),_:2},1024)]),_:2},1032,["variant","icon","onClick"]))],64))),64))])]),H("div",null,[Vo(l.$slots,"actions")])])):De("",!0)],2)}}},Iu={key:0},Ou={key:0,class:"text-red-500"},Vr={__name:"CharacterLimit",props:{value:{type:Number,required:!0},min:{type:Number,required:!0},max:{type:Number,required:!0}},setup(s){const a=s,{value:i,min:t,max:e}=xn(a);return(n,r)=>V(i)>0?(X(),he("div",Iu,[V(i)<V(t)?(X(),he("span",Ou,we(V(t)-V(i)),1)):(X(),he("span",{key:1,class:Et({"text-gray-400":V(i)<V(e),"text-red-500":V(i)>V(e)})},we(V(i))+" / "+we(V(e)),3))])):De("",!0)}},Ru={key:0,class:"has-replies"},Mu={key:0,class:"text-lg font-semibold text-white absolute-center"},Nu={class:"mt-1 ml-2 flex-grow"},Bu={class:"flex gap-2 items-center"},Fu={class:"font-semibold"},Uu={class:"text-gray-500 text-sm italic"},Hu={class:"mt-2"},Vu={class:"flex gap-4"},$u={class:"flex gap-2"},Gu={key:0,class:"mt-8"},ju={class:"space-y-8"},yr={__name:"CardCommentEdit",props:{comment:Object},setup(s){const a=s,i=Gi.useToast(),t=ti(),e=ji(),{getConfig:n}=qe(t),{edit:r,editTextLength:o}=qe(e),u=He(()=>a.comment.parent_id!=null),l=He(()=>a.comment.replies.length>0),c=_e(!1),h=_e(!1);$i(()=>{Hi(()=>{var v;(v=c.value)==null||v.focus()})});const f=()=>{h.value=!0,c.value.setEditable(!1),e.$updateComment({success:()=>{},error:v=>{c.value.setEditable(!0),i.error(qt(v))},finish:()=>{h.value=!1}})},d=()=>{e.$setEdit(null)};return(v,m)=>{const g=Se("v-img"),b=Se("v-btn");return X(),he("div",{class:Et({"comment-card":!0,"is-reply":u.value})},[l.value?(X(),he("div",Ru)):De("",!0),H("div",null,[te(g,{class:"h-8 w-8 bg-zinc-400 dark:bg-zinc-500 rounded-full mx-auto",src:v.$media.image(s.comment.author.avatar)},{default:ye(()=>[s.comment.author.avatar?De("",!0):(X(),he("span",Mu,we(V(Ur)(s.comment.author.name)),1))]),_:1},8,["src"])]),H("div",Nu,[H("div",Bu,[H("div",Fu,we(s.comment.author.name),1),H("div",Uu,[H("span",null,we(V(Sa).toHuman(s.comment.created_at,{parts:1}))+" ago",1),m[1]||(m[1]=H("span",{class:"text-sm"}," (edited)",-1))])]),H("div",Hu,[te(Hr,{ref_key:"textEditor",ref:c,modelValue:V(r).draft,"onUpdate:modelValue":m[0]||(m[0]=k=>V(r).draft=k)},{actions:ye(()=>[H("div",Vu,[te(Vr,{value:V(o),min:V(n).comments.minCharacters,max:V(n).comments.maxCharacters},null,8,["value","min","max"]),H("div",$u,[te(b,{density:"comfortable",variant:"tonal",rounded:"xl",class:"text-none",onClick:d},{default:ye(()=>m[2]||(m[2]=[wt(" Cancel ")])),_:1}),te(b,{disabled:V(o)<V(n).comments.minCharacters||V(o)>V(n).comments.maxCharacters,loading:h.value,density:"comfortable",color:"primary",variant:"tonal",rounded:"xl",class:"text-none",onClick:f},{default:ye(()=>m[3]||(m[3]=[wt(" Save ")])),_:1},8,["disabled","loading"])])])]),_:1},8,["modelValue"]),l.value?(X(),he("div",Gu,[H("div",ju,[(X(!0),he(tt,null,Jt(s.comment.replies,(k,E)=>(X(),Me(vn,{key:E,comment:k},null,8,["comment"]))),128))])])):De("",!0)])])],2)}}},zu={class:"comment-card is-reply"},Wu={key:0,class:"text-lg font-semibold text-white absolute-center"},Ku={class:"mt-1 ml-2 flex-grow"},Yu={class:"flex gap-2 items-center"},Xu={class:"font-semibold"},qu={class:"mt-2"},Qu={class:"flex gap-4"},Ju={class:"flex gap-2"},Zu={__name:"CardCommentReply",setup(s){const a=Gi.useToast(),i=ti(),t=ji(),e=Si(),{getConfig:n}=qe(i),{items:r,params:o,replyTo:u,draft:l,replyToTextLength:c}=qe(t),{user:h}=qe(e),f=_e(!1),d=_e(!1);$i(()=>{Hi(()=>{const g=document.getElementById(`reply-text-editor-${u.value.id}`);jo(g,200),setTimeout(()=>{var b;return(b=f.value)==null?void 0:b.focus()},200)})});const v=()=>{d.value=!0,f.value.setEditable(!1);const g=Fr(u.value.draft.html),b=u.value.real_id;t.$storeComment({body:g,parent_id:b},{success:()=>{m()},error:k=>{f.value.setEditable(!0),a.error(qt(k))},finish:()=>{d.value=!1}})},m=()=>{t.$setReplyTo(null)};return(g,b)=>{const k=Se("v-img"),E=Se("v-btn");return X(),he("div",zu,[H("div",null,[te(k,{class:"h-8 w-8 bg-zinc-400 dark:bg-zinc-500 rounded-full mx-auto",src:g.$media.image(V(h).avatar)},{default:ye(()=>[V(h).avatar?De("",!0):(X(),he("span",Wu,we(V(Ur)(V(h).name)),1))]),_:1},8,["src"])]),H("div",Ku,[H("div",Yu,[H("div",Xu,we(V(h).name),1),b[1]||(b[1]=H("div",{class:"text-gray-500 text-sm italic"},"now",-1))]),H("div",qu,[te(Hr,{id:`reply-text-editor-${V(u).id}`,ref_key:"textEditor",ref:f,modelValue:V(u).draft,"onUpdate:modelValue":b[0]||(b[0]=w=>V(u).draft=w)},{actions:ye(()=>[H("div",Qu,[te(Vr,{value:V(c),min:V(n).comments.minCharacters,max:V(n).comments.maxCharacters},null,8,["value","min","max"]),H("div",Ju,[te(E,{density:"comfortable",variant:"tonal",rounded:"xl",class:"text-none",onClick:m},{default:ye(()=>b[2]||(b[2]=[wt(" Cancel ")])),_:1}),te(E,{disabled:V(c)<V(n).comments.minCharacters||V(c)>V(n).comments.maxCharacters,loading:d.value,density:"comfortable",color:"primary",variant:"tonal",rounded:"xl",class:"text-none",onClick:v},{default:ye(()=>b[3]||(b[3]=[wt(" Submit ")])),_:1},8,["disabled","loading"])])])]),_:1},8,["id","modelValue"])])])])}}},el={key:0,class:"comment-card is-reply"},tl={class:"text-sm mr-2"},il={__name:"CommentRepliesMore",props:{comment:Object},setup(s){const a=s,{comment:i}=xn(a),t=Gi.useToast(),e=ti(),n=ji(),{getConfig:r}=qe(e),o=r.value.comments.repliesPerPage,u=_e(!1),l=He(()=>i.value.replies_total),c=He(()=>i.value.replies.filter(d=>!d.is_new).length),h=He(()=>l.value>o&&c.value<l.value),f=()=>{u.value=!0,n.$loadReplies(i.value.id,{success:()=>{},error:d=>{t.error(qt(d))},finish:()=>{u.value=!1}})};return(d,v)=>{const m=Se("v-btn");return h.value?(X(),he("div",el,[H("div",null,[te(m,{variant:"tonal",class:"text-none",color:"primary",density:"comfortable",rounded:"xl",loading:u.value,onClick:f},{default:ye(()=>[H("span",tl,"+"+we(l.value-c.value),1),v[0]||(v[0]=H("span",null,"More",-1))]),_:1},8,["loading"])])])):De("",!0)}}},nl={key:0,class:"has-replies"},rl={key:0,class:"text-lg font-semibold text-white absolute-center"},sl={class:"mt-1 ml-2 flex-grow"},al={class:"flex gap-2 items-center"},ol={class:"font-semibold"},ul={class:"text-gray-500 text-sm italic"},ll={key:0,class:"text-sm"},cl=["innerHTML"],hl={class:"flex items-center gap-2 mt-3"},fl={class:"comment-reactions"},dl={key:0,class:"mt-8"},vl={class:"space-y-8"},vn={__name:"CardComment",props:{comment:Object},setup(s){const a=s,i=Gi.useToast(),t=ti(),e=ji(),n=Si(),{getConfig:r}=qe(t),{replyTo:o,edit:u}=qe(e),{isLogged:l}=qe(n),c=_e(null),h=_e(r.value.comments.reactions.reduce((D,{name:O})=>(D[O]=!1,D),{})),f=He(()=>a.comment.parent_id!=null),d=He(()=>{var D;return((D=o.value)==null?void 0:D.real_id)==a.comment.id}),v=He(()=>a.comment.replies.length>0),m=He(()=>a.comment.replies.filter(D=>!D.is_new)),g=He(()=>a.comment.replies.filter(D=>D.is_new)),b=D=>{if(!l.value){c.value.open();return}const O=r.value.comments.reactions.find(j=>j.name===D);let R;R=setTimeout(()=>{h.value[D]=!0},200),e.$toggleReaction(a.comment.id,O.id,{success:()=>{console.log("success")},error:j=>{i.error(qt(j))},finish:()=>{console.log("finish"),clearTimeout(R),h.value[D]=!1}})},k=D=>{const O=r.value.comments.reactions.find(R=>R.name===D);return a.comment.userReactions.includes(O.id)},E=()=>{e.$setReplyTo(a.comment)},w=D=>{e.$report(a.comment.id,D,{success:()=>{i.success("Reported successfully.")},error:O=>{i.error(qt(O))},finish:()=>{console.log("finish")}})},C=()=>{e.$setEdit(a.comment)},B=()=>{e.$deleteComment(a.comment.id,{success:()=>{i.success("Deleted successfully.")},error:D=>{i.error(qt(D))},finish:()=>{console.log("finish")}})},L=D=>{const O=D.target.closest("spoiler");O&&O.classList.toggle("un-spoiler")};return(D,O)=>{const R=Se("v-img"),j=Se("v-btn");return X(),he("div",{class:Et({"comment-card":!0,"is-reply":f.value})},[v.value||d.value?(X(),he("div",nl)):De("",!0),H("div",null,[te(R,{class:"h-8 w-8 bg-zinc-400 dark:bg-zinc-500 rounded-full mx-auto",src:D.$media.image(s.comment.author.avatar)},{default:ye(()=>[s.comment.author.avatar?De("",!0):(X(),he("span",rl,we(V(Ur)(s.comment.author.name)),1))]),_:1},8,["src"])]),H("div",sl,[H("div",al,[H("div",ol,we(s.comment.author.name),1),H("div",ul,[H("span",null,we(V(Sa).toHuman(s.comment.created_at,{parts:1}))+" ago",1),s.comment.created_at!=s.comment.updated_at?(X(),he("span",ll," (edited) ")):De("",!0)])]),H("div",null,[H("div",{class:"mt-2",onClick:L},[H("p",{class:"comment-body",innerHTML:V(ka)(s.comment.body)},null,8,cl)]),H("div",hl,[H("div",fl,[te(j,{rounded:!1,size:"small","prepend-icon":"mdi-thumb-up",variant:"tonal",loading:h.value.like,color:k("like")?"green":"grey",class:Et(s.comment.reactions.like?"":"no-reactions"),onClick:O[0]||(O[0]=()=>b("like"))},{default:ye(()=>[wt(we(s.comment.reactions.like),1)]),_:1},8,["loading","color","class"]),te(j,{rounded:!1,size:"small","prepend-icon":"mdi-thumb-down",variant:"tonal",loading:h.value.dislike,color:k("dislike")?"red":"grey",class:Et(s.comment.reactions.dislike?"":"no-reactions"),onClick:O[1]||(O[1]=()=>b("dislike"))},{default:ye(()=>[wt(we(s.comment.reactions.dislike),1)]),_:1},8,["loading","color","class"])]),V(l)?(X(),Me(ku,{key:0,comment:s.comment,onReply:E,onReport:w,onEdit:C,onDelete:B},null,8,["comment"])):De("",!0)]),v.value||d.value?(X(),he("div",dl,[H("div",vl,[(X(!0),he(tt,null,Jt(m.value,(y,_)=>(X(),he(tt,{key:_},[V(u)&&y.id==V(u).id?(X(),Me(yr,{key:0,comment:y},null,8,["comment"])):(X(),Me(vn,{key:1,comment:y},null,8,["comment"]))],64))),128)),te(il,{comment:s.comment},null,8,["comment"]),(X(!0),he(tt,null,Jt(g.value,(y,_)=>(X(),he(tt,{key:_},[V(u)&&y.id==V(u).id?(X(),Me(yr,{key:0,comment:y},null,8,["comment"])):(X(),Me(vn,{key:1,comment:y},null,8,["comment"]))],64))),128)),d.value?(X(),Me(Zu,{key:0})):De("",!0)])])):De("",!0)])]),te(Ta,{ref_key:"loginRequires",ref:c},null,512)],2)}}},pl={class:"comments-section"},gl={class:"p-4"},ml={class:"flex gap-4"},yl={class:"p-6"},_l={class:"flex justify-between items-center mb-4"},bl={class:"space-y-8"},Sl={__name:"SectionComments",props:{title:{type:Object,required:!0}},setup(s){const a=s,i=Gi.useToast(),t=ti(),e=Si(),n=ji(),{getConfig:r}=qe(t),{isLogged:o}=qe(e),{items:u,params:l,has_more:c,total:h,edit:f,draft:d,draftTextLength:v,sorting_options:m,sorting:g}=qe(n);n.$setTitleId(a.title.id);const b=_e(null),k=_e(null),E=_e(!1),w=_e(!1),C=_e(!1);yi(g,()=>{setTimeout(()=>{var D;n.$resetPage(),(D=k.value)==null||D.reload()},200)}),$i(()=>{Hi(()=>{var D;(D=k.value)==null||D.load()})});const B=D=>{E.value=!0,n.$loadComments({success:()=>{},error:()=>{},finish:()=>{E.value=!1,D()}})},L=()=>{if(!o.value){b.value.open();return}C.value=!0,w.value.setEditable(!1),n.$storeComment({body:Fr(d.value.html),parent_id:null},{success:()=>{n.$resetDraft()},error:D=>{i.error(qt(D))},finish:()=>{C.value=!1,w.value.setEditable(!0)}})};return Vi(()=>{n.$resetAll()}),(D,O)=>{const R=Se("v-btn"),j=Se("v-progress-circular"),y=Se("v-icon"),_=Se("v-select");return X(),he("div",pl,[H("div",gl,[te(Hr,{ref_key:"textEditor",ref:w,modelValue:V(d),"onUpdate:modelValue":O[0]||(O[0]=S=>us(d)?d.value=S:null)},{actions:ye(()=>[H("div",ml,[te(Vr,{value:V(v),min:V(r).comments.minCharacters,max:V(r).comments.maxCharacters},null,8,["value","min","max"]),te(R,{disabled:V(v)<V(r).comments.minCharacters||V(v)>V(r).comments.maxCharacters,loading:C.value,density:"comfortable",color:"primary",variant:"tonal",rounded:"xl",class:"text-none",onClick:L},{default:ye(()=>O[2]||(O[2]=[wt(" Submit ")])),_:1},8,["disabled","loading"])])]),_:1},8,["modelValue"])]),H("div",yl,[H("div",_l,[O[3]||(O[3]=H("div",{class:"text-xl font-medium"},"Комментарии:",-1)),H("div",null,[te(_,{items:V(m),modelValue:V(g),"onUpdate:modelValue":O[1]||(O[1]=S=>us(g)?g.value=S:null),variant:"underlined",elevation:0,color:"primary",density:"compact",rounded:"lg","hide-details":""},{prepend:ye(()=>[E.value?(X(),Me(j,{key:0,color:"primary",indeterminate:"",size:20,width:2})):(X(),Me(y,{key:1,icon:"mdi-sort"}))]),_:1},8,["items","modelValue"])])]),H("div",null,[te(iu,{ref_key:"infiniteScroll",ref:k,items:V(u),"has-more":V(c),"on-load":B},{default:ye(()=>[H("div",bl,[(X(!0),he(tt,null,Jt(V(u),(S,P)=>(X(),he(tt,{key:P},[V(f)&&S.id==V(f).id?(X(),Me(yr,{key:0,comment:S},null,8,["comment"])):(X(),Me(vn,{key:1,comment:S},null,8,["comment"]))],64))),128))])]),_:1},8,["items","has-more"])])]),te(Ta,{ref_key:"loginRequires",ref:b},null,512)])}}},El=async s=>{const a=mu();await a.$fetchPlaybackState(s);const i=(u=!1)=>new Promise((l,c)=>{if(!u&&a.hasLinks(s)){l();return}a.$fetchLinks(s,{success:l,error:c})}),t=()=>i(!0),e=()=>new Promise((u,l)=>{if(a.hasEpisodes(s)){u();return}a.$fetchEpisodes(s,{success:u,error:l})}),n=u=>{a.$setPlaybackState(s,u)},r=()=>{a.$savePlaybackState(s)},o=([u,l])=>({definition:u,url:l,text:u});return{links:He(()=>{const u=a.getLinks(s);return Object.entries(u).map(o).reverse()}),episodes:He(()=>a.getEpisodes(s)),playbackState:He(()=>a.getPlaybackState(s)),loadLinks:i,reloadLinks:t,loadEpisodes:e,setPlaybackState:n,savePlaybackState:r}};function hs(s,a){var i=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);a&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(s,e).enumerable})),i.push.apply(i,t)}return i}function Le(s){for(var a=1;a<arguments.length;a++){var i=arguments[a]!=null?arguments[a]:{};a%2?hs(Object(i),!0).forEach(function(t){I(s,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(i)):hs(Object(i)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(i,t))})}return s}function Ge(s){"@babel/helpers - typeof";return Ge=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Ge(s)}function q(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")}function fs(s,a){for(var i=0;i<a.length;i++){var t=a[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(s,wa(t.key),t)}}function Q(s,a,i){return a&&fs(s.prototype,a),i&&fs(s,i),Object.defineProperty(s,"prototype",{writable:!1}),s}function I(s,a,i){return a=wa(a),a in s?Object.defineProperty(s,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):s[a]=i,s}function ie(s,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(a&&a.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),a&&_r(s,a)}function se(s){return se=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},se(s)}function _r(s,a){return _r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_r(s,a)}function kl(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function x(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function $r(s,a){if(a&&(typeof a=="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return x(s)}function ne(s){var a=kl();return function(){var t=se(s),e;if(a){var n=se(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return $r(this,e)}}function Tl(s,a){for(;!Object.prototype.hasOwnProperty.call(s,a)&&(s=se(s),s!==null););return s}function ue(){return typeof Reflect<"u"&&Reflect.get?ue=Reflect.get.bind():ue=function(a,i,t){var e=Tl(a,i);if(e){var n=Object.getOwnPropertyDescriptor(e,i);return n.get?n.get.call(arguments.length<3?a:t):n.value}},ue.apply(this,arguments)}function ot(s){return wl(s)||Cl(s)||Al(s)||Pl()}function wl(s){if(Array.isArray(s))return br(s)}function Cl(s){if(typeof Symbol<"u"&&s[Symbol.iterator]!=null||s["@@iterator"]!=null)return Array.from(s)}function Al(s,a){if(s){if(typeof s=="string")return br(s,a);var i=Object.prototype.toString.call(s).slice(8,-1);if(i==="Object"&&s.constructor&&(i=s.constructor.name),i==="Map"||i==="Set")return Array.from(s);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return br(s,a)}}function br(s,a){(a==null||a>s.length)&&(a=s.length);for(var i=0,t=new Array(a);i<a;i++)t[i]=s[i];return t}function Pl(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xl(s,a){if(typeof s!="object"||s===null)return s;var i=s[Symbol.toPrimitive];if(i!==void 0){var t=i.call(s,a||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}function wa(s){var a=xl(s,"string");return typeof a=="symbol"?a:String(a)}var Ca={exports:{}};(function(s){var a=Object.prototype.hasOwnProperty,i="~";function t(){}Object.create&&(t.prototype=Object.create(null),new t().__proto__||(i=!1));function e(u,l,c){this.fn=u,this.context=l,this.once=c||!1}function n(u,l,c,h,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var d=new e(c,h||u,f),v=i?i+l:l;return u._events[v]?u._events[v].fn?u._events[v]=[u._events[v],d]:u._events[v].push(d):(u._events[v]=d,u._eventsCount++),u}function r(u,l){--u._eventsCount===0?u._events=new t:delete u._events[l]}function o(){this._events=new t,this._eventsCount=0}o.prototype.eventNames=function(){var l=[],c,h;if(this._eventsCount===0)return l;for(h in c=this._events)a.call(c,h)&&l.push(i?h.slice(1):h);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},o.prototype.listeners=function(l){var c=i?i+l:l,h=this._events[c];if(!h)return[];if(h.fn)return[h.fn];for(var f=0,d=h.length,v=new Array(d);f<d;f++)v[f]=h[f].fn;return v},o.prototype.listenerCount=function(l){var c=i?i+l:l,h=this._events[c];return h?h.fn?1:h.length:0},o.prototype.emit=function(l,c,h,f,d,v){var m=i?i+l:l;if(!this._events[m])return!1;var g=this._events[m],b=arguments.length,k,E;if(g.fn){switch(g.once&&this.removeListener(l,g.fn,void 0,!0),b){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,c),!0;case 3:return g.fn.call(g.context,c,h),!0;case 4:return g.fn.call(g.context,c,h,f),!0;case 5:return g.fn.call(g.context,c,h,f,d),!0;case 6:return g.fn.call(g.context,c,h,f,d,v),!0}for(E=1,k=new Array(b-1);E<b;E++)k[E-1]=arguments[E];g.fn.apply(g.context,k)}else{var w=g.length,C;for(E=0;E<w;E++)switch(g[E].once&&this.removeListener(l,g[E].fn,void 0,!0),b){case 1:g[E].fn.call(g[E].context);break;case 2:g[E].fn.call(g[E].context,c);break;case 3:g[E].fn.call(g[E].context,c,h);break;case 4:g[E].fn.call(g[E].context,c,h,f);break;default:if(!k)for(C=1,k=new Array(b-1);C<b;C++)k[C-1]=arguments[C];g[E].fn.apply(g[E].context,k)}}return!0},o.prototype.on=function(l,c,h){return n(this,l,c,h,!1)},o.prototype.once=function(l,c,h){return n(this,l,c,h,!0)},o.prototype.removeListener=function(l,c,h,f){var d=i?i+l:l;if(!this._events[d])return this;if(!c)return r(this,d),this;var v=this._events[d];if(v.fn)v.fn===c&&(!f||v.once)&&(!h||v.context===h)&&r(this,d);else{for(var m=0,g=[],b=v.length;m<b;m++)(v[m].fn!==c||f&&!v[m].once||h&&v[m].context!==h)&&g.push(v[m]);g.length?this._events[d]=g.length===1?g[0]:g:r(this,d)}return this},o.prototype.removeAllListeners=function(l){var c;return l?(c=i?i+l:l,this._events[c]&&r(this,c)):(this._events=new t,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,s.exports=o})(Ca);var Gr=Ca.exports;const ki=Br(Gr);var Ll=typeof window<"u"&&window.location&&window.location.href.indexOf("xgplayerdebugger=1")>-1,jn={info:"color: #525252; background-color: #90ee90;",error:"color: #525252; background-color: red;",warn:"color: #525252; background-color: yellow; "},zn="%c[xgplayer]",pe={config:{debug:Ll?3:0},logInfo:function(a){for(var i,t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];this.config.debug>=3&&(i=console).log.apply(i,[zn,jn.info,a].concat(e))},logWarn:function(a){for(var i,t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];this.config.debug>=1&&(i=console).warn.apply(i,[zn,jn.warn,a].concat(e))},logError:function(a){var i;if(!(this.config.debug<1)){for(var t=this.config.debug>=2?"trace":"error",e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];(i=console)[t].apply(i,[zn,jn.error,a].concat(n))}}};function Dl(s){s.logInfo=pe.logInfo.bind(s),s.logWarn=pe.logWarn.bind(s),s.logError=pe.logError.bind(s)}var Il=function(){function s(a){q(this,s),this.bufferedList=a}return Q(s,[{key:"start",value:function(i){return this.bufferedList[i].start}},{key:"end",value:function(i){return this.bufferedList[i].end}},{key:"length",get:function(){return this.bufferedList.length}}]),s}(),p={};p.createDom=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"div",a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"",e=document.createElement(s);return e.className=t,e.innerHTML=a,Object.keys(i).forEach(function(n){var r=n,o=i[n];s==="video"||s==="audio"||s==="live-video"?o&&e.setAttribute(r,o):e.setAttribute(r,o)}),e};p.createDomFromHtml=function(s){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";try{var t=document.createElement("div");t.innerHTML=s;var e=t.children;return t=null,e.length>0?(e=e[0],i&&p.addClass(e,i),a&&Object.keys(a).forEach(function(n){e.setAttribute(n,a[n])}),e):null}catch(n){return pe.logError("util.createDomFromHtml",n),null}};p.hasClass=function(s,a){if(!s||!a)return!1;try{return Array.prototype.some.call(s.classList,function(t){return t===a})}catch{var i=s.className&&Ge(s.className)==="object"?s.getAttribute("class"):s.className;return i&&!!i.match(new RegExp("(\\s|^)"+a+"(\\s|$)"))}};p.addClass=function(s,a){if(!(!s||!a))try{a.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach(function(i){i&&s.classList.add(i)})}catch{p.hasClass(s,a)||(s.className&&Ge(s.className)==="object"?s.setAttribute("class",s.getAttribute("class")+" "+a):s.className+=" "+a)}};p.removeClass=function(s,a){if(!(!s||!a))try{a.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach(function(i){i&&s.classList.remove(i)})}catch{p.hasClass(s,a)&&a.split(/\s+/g).forEach(function(t){var e=new RegExp("(\\s|^)"+t+"(\\s|$)");s.className&&Ge(s.className)==="object"?s.setAttribute("class",s.getAttribute("class").replace(e," ")):s.className=s.className.replace(e," ")})}};p.toggleClass=function(s,a){s&&a.split(/\s+/g).forEach(function(i){p.hasClass(s,i)?p.removeClass(s,i):p.addClass(s,i)})};p.classNames=function(){for(var s=arguments,a=[],i=function(n){p.typeOf(s[n])==="String"?a.push(s[n]):p.typeOf(s[n])==="Object"&&Object.keys(s[n]).map(function(r){s[n][r]&&a.push(r)})},t=0;t<arguments.length;t++)i(t);return a.join(" ")};p.findDom=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document,a=arguments.length>1?arguments[1]:void 0,i;try{i=s.querySelector(a)}catch(t){pe.logError("util.findDom",t),a.indexOf("#")===0&&(i=s.getElementById(a.slice(1)))}return i};p.getCss=function(s,a){return s.currentStyle?s.currentStyle[a]:document.defaultView.getComputedStyle(s,!1)[a]};p.padStart=function(s,a,i){for(var t=String(i),e=a>>0,n=Math.ceil(e/t.length),r=[],o=String(s);n--;)r.push(t);return r.join("").substring(0,e-o.length)+o};p.format=function(s){if(window.isNaN(s))return"";s=Math.round(s);var a=p.padStart(Math.floor(s/3600),2,0),i=p.padStart(Math.floor((s-a*3600)/60),2,0),t=p.padStart(Math.floor(s-a*3600-i*60),2,0);return(a==="00"?[i,t]:[a,i,t]).join(":")};p.event=function(s){if(s.touches){var a=s.touches[0]||s.changedTouches[0];s.clientX=a.clientX||0,s.clientY=a.clientY||0,s.offsetX=a.pageX-a.target.offsetLeft,s.offsetY=a.pageY-a.target.offsetTop}s._target=s.target||s.srcElement};p.typeOf=function(s){return Object.prototype.toString.call(s).match(/([^\s.*]+)(?=]$)/g)[0]};p.deepCopy=function(s,a){if(p.typeOf(a)==="Object"&&p.typeOf(s)==="Object")return Object.keys(a).forEach(function(i){p.typeOf(a[i])==="Object"&&!(a[i]instanceof Node)?s[i]===void 0||s[i]===void 0?s[i]=a[i]:p.deepCopy(s[i],a[i]):p.typeOf(a[i])==="Array"?s[i]=p.typeOf(s[i])==="Array"?s[i].concat(a[i]):a[i]:s[i]=a[i]}),s};p.deepMerge=function(s,a){return Object.keys(a).map(function(i){if(p.typeOf(a[i])==="Array"&&p.typeOf(s[i])==="Array"){if(p.typeOf(s[i])==="Array"){var t;(t=s[i]).push.apply(t,ot(a[i]))}}else p.typeOf(s[i])===p.typeOf(a[i])&&s[i]!==null&&p.typeOf(s[i])==="Object"&&!(a[i]instanceof window.Node)?p.deepMerge(s[i],a[i]):a[i]!==null&&(s[i]=a[i])}),s};p.getBgImage=function(s){var a=(s.currentStyle||window.getComputedStyle(s,null)).backgroundImage;if(!a||a==="none")return"";var i=document.createElement("a");return i.href=a.replace(/url\("|"\)/g,""),i.href};p.copyDom=function(s){if(s&&s.nodeType===1){var a=document.createElement(s.tagName);return Array.prototype.forEach.call(s.attributes,function(i){a.setAttribute(i.name,i.value)}),s.innerHTML&&(a.innerHTML=s.innerHTML),a}else return""};p.setInterval=function(s,a,i,t){s._interval[a]||(s._interval[a]=window.setInterval(i.bind(s),t))};p.clearInterval=function(s,a){clearInterval(s._interval[a]),s._interval[a]=null};p.setTimeout=function(s,a,i){s._timers||(s._timers=[]);var t=setTimeout(function(){a(),p.clearTimeout(s,t)},i);return s._timers.push(t),t};p.clearTimeout=function(s,a){var i=s._timers;if(p.typeOf(i)==="Array"){for(var t=0;t<i.length;t++)if(i[t]===a){i.splice(t,1),clearTimeout(a);break}}else clearTimeout(a)};p.clearAllTimers=function(s){var a=s._timers;p.typeOf(a)==="Array"&&(a.map(function(i){clearTimeout(i)}),s._timerIds=[])};p.createImgBtn=function(s,a,i,t){var e=p.createDom("xg-".concat(s),"",{},"xgplayer-".concat(s,"-img"));if(e.style.backgroundImage='url("'.concat(a,'")'),i&&t){var n,r,o;["px","rem","em","pt","dp","vw","vh","vm","%"].every(function(u){return i.indexOf(u)>-1&&t.indexOf(u)>-1?(n=parseFloat(i.slice(0,i.indexOf(u)).trim()),r=parseFloat(t.slice(0,t.indexOf(u)).trim()),o=u,!1):!0}),e.style.width="".concat(n).concat(o),e.style.height="".concat(r).concat(o),e.style.backgroundSize="".concat(n).concat(o," ").concat(r).concat(o),s==="start"?e.style.margin="-".concat(r/2).concat(o," auto auto -").concat(n/2).concat(o):e.style.margin="auto 5px auto 5px"}return e};p.Hex2RGBA=function(s,a){var i=[];if(/^\#[0-9A-F]{3}$/i.test(s)){var t="#";s.replace(/[0-9A-F]/ig,function(e){t+=e+e}),s=t}return/^#[0-9A-F]{6}$/i.test(s)?(s.replace(/[0-9A-F]{2}/ig,function(e){i.push(parseInt(e,16))}),"rgba(".concat(i.join(","),", ").concat(a,")")):"rgba(255, 255, 255, 0.1)"};p.getFullScreenEl=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement};p.checkIsFunction=function(s){return s&&typeof s=="function"};p.checkIsObject=function(s){return s!==null&&Ge(s)==="object"};p.hide=function(s){s.style.display="none"};p.show=function(s,a){s.style.display=a||"block"};p.isUndefined=function(s){if(typeof s>"u"||s===null)return!0};p.isNotNull=function(s){return s!=null};p.setStyleFromCsstext=function(s,a){if(a)if(p.typeOf(a)==="String"){var i=a.replace(/\s+/g,"").split(";");i.map(function(t){if(t){var e=t.split(":");e.length>1&&(s.style[e[0]]=e[1])}})}else Object.keys(a).map(function(t){s.style[t]=a[t]})};function Ol(s,a){for(var i=0,t=a.length;i<t;i++)if(s.indexOf(a[i])>-1)return!0;return!1}p.filterStyleFromText=function(s){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["width","height","top","left","bottom","right","position","z-index","padding","margin","transform"],i=s.style.cssText;if(!i)return{};var t=i.replace(/\s+/g,"").split(";"),e={},n={};return t.map(function(r){if(r){var o=r.split(":");o.length>1&&(Ol(o[0],a)?e[o[0]]=o[1]:n[o[0]]=o[1])}}),s.setAttribute("style",""),Object.keys(n).map(function(r){s.style[r]=n[r]}),e};p.getStyleFromCsstext=function(s){var a=s.style.cssText;if(!a)return{};var i=a.replace(/\s+/g,"").split(";"),t={};return i.map(function(e){if(e){var n=e.split(":");n.length>1&&(t[n[0]]=n[1])}}),t};p.preloadImg=function(s){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){};if(s){var t=new window.Image;t.onload=function(e){t=null,a&&a(e)},t.onerror=function(e){t=null,i&&i(e)},t.src=s}};p.stopPropagation=function(s){s&&s.stopPropagation()};p.scrollTop=function(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0};p.scrollLeft=function(){return window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0};p.checkTouchSupport=function(){return"ontouchstart"in window};p.getBuffered2=function(s){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5,i=[],t=0;t<s.length;t++)i.push({start:s.start(t)<.5?0:s.start(t),end:s.end(t)});i.sort(function(u,l){var c=u.start-l.start;return c||l.end-u.end});var e=[];if(a)for(var n=0;n<i.length;n++){var r=e.length;if(r){var o=e[r-1].end;i[n].start-o<a?i[n].end>o&&(e[r-1].end=i[n].end):e.push(i[n])}else e.push(i[n])}else e=i;return new Il(e)};p.getEventPos=function(s){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return s.touches&&s.touches.length>0&&(s=s.touches[0]),{x:s.x/a,y:s.y/a,clientX:s.clientX/a,clientY:s.clientY/a,offsetX:s.offsetX/a,offsetY:s.offsetY/a,pageX:s.pageX/a,pageY:s.pageY/a}};p.requestAnimationFrame=function(s){var a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(a)return a(s)};p.getHostFromUrl=function(s){if(p.typeOf(s)!=="String")return"";var a=s.split("/"),i="";return a.length>3&&a[2]&&(i=a[2]),i};p.cancelAnimationFrame=function(s){var a=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.cancelRequestAnimationFrame;a&&a(s)};p.isMSE=function(s){return s.media&&(s=s.media),!s||!(s instanceof HTMLMediaElement)?!1:/^blob/.test(s.currentSrc)||/^blob/.test(s.src)};p.isBlob=function(s){return typeof s=="string"&&/^blob/.test(s)};p.generateSessionId=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=new Date().getTime();try{s=parseInt(s)}catch{s=0}a+=s,window.performance&&typeof window.performance.now=="function"&&(a+=parseInt(window.performance.now()));var i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=(a+Math.random()*16)%16|0;return a=Math.floor(a/16),(t==="x"?e:e&3|8).toString(16)});return i};p.createEvent=function(s){var a;return typeof window.Event=="function"?a=new Event(s):(a=document.createEvent("Event"),a.initEvent(s,!0,!0)),a};p.adjustTimeByDuration=function(s,a,i){return!a||!s?s:s>a||i&&s<a?a:s};p.createPositionBar=function(s,a){var i=p.createDom("xg-bar","",{"data-index":-1},s);return a.appendChild(i),i};p.getTransformStyle=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{x:0,y:0,scale:1,rotate:0},a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i={scale:"".concat(s.scale||1),translate:"".concat(s.x||0,"%, ").concat(s.y||0,"%"),rotate:"".concat(s.rotate||0,"deg")},t=Object.keys(i);return t.forEach(function(e){var n=new RegExp("".concat(e,"\\([^\\(]+\\)"),"g"),r="".concat(e,"(").concat(i[e],")");n.test(a)?(n.lastIndex=-1,a=a.replace(n,r)):a+="".concat(r," ")}),a};p.convertDeg=function(s){return Math.abs(s)<=1?s*360:s%360};p.getIndexByTime=function(s,a){var i=a.length,t=-1;if(i<1)return t;if(s<=a[0].end||i<2)t=0;else if(s>a[i-1].end)t=i-1;else for(var e=1;e<i;e++)if(s>a[e-1].end&&s<=a[e].end){t=e;break}return t};p.getOffsetCurrentTime=function(s,a){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,t=-1;if(i>=0&&i<a.length?t=i:t=p.getIndexByTime(s,a),t<0)return-1;var e=a.length,n=a[t],r=n.start,o=n.end,u=n.cTime,l=n.offset;return s<r?u:s>=r&&s<=o?s-l:s>o&&t>=e-1?o:-1};p.getCurrentTimeByOffset=function(s,a){var i=-1;if(!a||a.length<0)return s;for(var t=0;t<a.length;t++)if(s<=a[t].duration){i=t;break}if(i!==-1){var e=a[i].start;return i-1<0?e+s:e+(s-a[i-1].duration)}return s};function Aa(s){var a=Ge(s);return s!==null&&(a==="object"||a==="function")}function Rl(s,a,i){var t,e,n,r,o,u,l=0,c=!1,h=!1,f=!0,d=!a&&a!==0&&typeof window.requestAnimationFrame=="function";if(typeof s!="function")throw new TypeError("Expected a function");a=+a||0,Aa(i)&&(c=!!i.leading,h="maxWait"in i,n=h?Math.max(+i.maxWait||0,a):n,f="trailing"in i?!!i.trailing:f);function v(R){var j=t,y=e;return t=e=void 0,l=R,r=s.apply(y,j),r}function m(R,j){return d?(window.cancelAnimationFrame(o),window.requestAnimationFrame(R)):setTimeout(R,j)}function g(R){if(d)return window.cancelAnimationFrame(R);clearTimeout(R)}function b(R){return l=R,o=m(w,a),c?v(R):r}function k(R){var j=R-u,y=R-l,_=a-j;return h?Math.min(_,n-y):_}function E(R){var j=R-u,y=R-l;return u===void 0||j>=a||j<0||h&&y>=n}function w(){var R=Date.now();if(E(R))return C(R);o=m(w,k(R))}function C(R){return o=void 0,f&&t?v(R):(t=e=void 0,r)}function B(){o!==void 0&&g(o),l=0,t=u=e=o=void 0}function L(){return o===void 0?r:C(Date.now())}function D(){return o!==void 0}function O(){for(var R=Date.now(),j=E(R),y=arguments.length,_=new Array(y),S=0;S<y;S++)_[S]=arguments[S];if(t=_,e=this,u=R,j){if(o===void 0)return b(u);if(h)return o=m(w,a),v(u)}return o===void 0&&(o=m(w,a)),r}return O.cancel=B,O.flush=L,O.pending=D,O}function Ml(s,a,i){var t=!0,e=!0;if(typeof s!="function")throw new TypeError("Expected a function");return Aa(i)&&(t="leading"in i?!!i.leading:t,e="trailing"in i?!!i.trailing:e),Rl(s,a,{leading:t,trailing:e,maxWait:a})}function Nl(){var s=(document.documentElement.getAttribute("lang")||navigator.language||"zh-cn").toLocaleLowerCase();return s==="zh-cn"&&(s="zh"),s}function Bl(s,a,i){if(s){var t=s.getAttribute(i);return!!(t&&t===a&&(s.tagName==="VIDEO"||s.tagName==="AUDIO"))}}var ds={android:/(Android)\s([\d.]+)/,ios:/(Version)\/([\d.]+)/},Fl=["avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","avc1.42E01E","mp4v.20.8","mp4v.20.8, mp4a.40.2","mp4v.20.240, mp4a.40.2"],oe={get device(){var s=oe.os;return s.isPc?"pc":"mobile"},get browser(){if(typeof navigator>"u")return"";var s=navigator.userAgent.toLowerCase(),a={ie:/rv:([\d.]+)\) like gecko/,firefox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(a).filter(function(i){return a[i].test(s)}))[0]},get os(){if(typeof navigator>"u")return{};var s=navigator.userAgent,a=/(?:Windows Phone)/.test(s),i=/(?:SymbianOS)/.test(s)||a,t=/(?:Android)/.test(s),e=/(?:Firefox)/.test(s),n=/(?:iPad|PlayBook)/.test(s)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,r=n||t&&!/(?:Mobile)/.test(s)||e&&/(?:Tablet)/.test(s),o=/(?:iPhone)/.test(s)&&!r,u=!o&&!t&&!i&&!r;return{isTablet:r,isPhone:o,isIpad:n,isIos:o||n,isAndroid:t,isPc:u,isSymbian:i,isWindowsPhone:a,isFireFox:e}},get osVersion(){if(typeof navigator>"u")return 0;var s=navigator.userAgent,a="";/(?:iPhone)|(?:iPad|PlayBook)/.test(s)?a=ds.ios:a=ds.android;var i=a?a.exec(s):[];if(i&&i.length>=3){var t=i[2].split(".");return t.length>0?parseInt(t[0]):0}return 0},get isWeixin(){if(typeof navigator>"u")return!1;var s=/(micromessenger)\/([\d.]+)/,a=s.exec(navigator.userAgent.toLocaleLowerCase());return!!a},isSupportMP4:function(){var a={isSupport:!1,mime:""};if(typeof document>"u")return a;if(this.supportResult)return this.supportResult;var i=document.createElement("video");return typeof i.canPlayType=="function"&&Fl.map(function(t){i.canPlayType('video/mp4; codecs="'.concat(t,'"'))==="probably"&&(a.isSupport=!0,a.mime+="||".concat(t))}),this.supportResult=a,i=null,a},isMSESupport:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"';if(typeof MediaSource>"u"||!MediaSource)return!1;try{return MediaSource.isTypeSupported(a)}catch(i){return this._logger.error(a,i),!1}},isHevcSupported:function(){return typeof MediaSource>"u"||!MediaSource.isTypeSupported?!1:MediaSource.isTypeSupported('video/mp4;codecs="hev1.1.6.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.2.4.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.3.E.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.4.10.L120.90"')},probeConfigSupported:function(a){var i={supported:!1,smooth:!1,powerEfficient:!1};if(!a||typeof navigator>"u")return Promise.resolve(i);if(navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo)return navigator.mediaCapabilities.decodingInfo(a);var t=a.video||{},e=a.audio||{};try{var n=MediaSource.isTypeSupported(t.contentType),r=MediaSource.isTypeSupported(e.contentType);return Promise.resolve({supported:n&&r,smooth:!1,powerEfficient:!1})}catch{return Promise.resolve(i)}}},Sr="3.0.20",vs={1:"media",2:"media",3:"media",4:"media",5:"media",6:"media"},ps={1:5101,2:5102,3:5103,4:5104,5:5105,6:5106},Di=Q(function s(a){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{errorType:"",errorCode:0,errorMessage:"",originError:"",ext:{},mediaError:null};q(this,s);var t=a&&a.i18n?a.i18n.ERROR_TYPES:null;if(a.media){var e=i.mediaError?i.mediaError:a.media.error||{},n=a.duration,r=a.currentTime,o=a.ended,u=a.src,l=a.currentSrc,c=a.media,h=c.readyState,f=c.networkState,d=i.errorCode||e.code;ps[d]&&(d=ps[d]);var v={playerVersion:Sr,currentTime:r,duration:n,ended:o,readyState:h,networkState:f,src:u||l,errorType:i.errorType,errorCode:d,message:i.errorMessage||e.message,mediaError:e,originError:i.originError?i.originError.stack:"",host:p.getHostFromUrl(u||l)};return i.ext&&Object.keys(i.ext).map(function(k){v[k]=i.ext[k]}),v}else if(arguments.length>1){for(var m={playerVersion:Sr,domain:document.domain},g=["errorType","currentTime","duration","networkState","readyState","src","currentSrc","ended","errd","errorCode","mediaError"],b=0;b<arguments.length;b++)m[g[b]]=arguments[b];return m.ex=t?(t[arguments[0]]||{}).msg:"",m}}),je="play",jr="playing",Ct="ended",dt="pause",Ti="error",Ln="seeking",kt="seeked",$e="timeupdate",zi="waiting",bt="canplay",Ul="canplaythrough",Pt="durationchange",Ii="volumechange",vt="loadeddata",Hl="loadedmetadata",Pa="ratechange",xa="progress",zr="loadstart",ii="emptied",Vl="stalled",$l="suspend",Gl="abort",jl="bufferedChange",Wr="focus",La="blur",Kr="ready",Da="urlNull",Qt="autoplay_started",Yr="autoplay_was_prevented",Dn="complete",pn="replay",In="destroy",Wi="urlchange",Er="download_speed_change",Ia="leaveplayer",Oa="enterplayer",Ra="loading",_t="fullscreen_change",gn="cssFullscreen_change",mn="mini_state_change",Xr="definition_change",zl="before_definition_change",Oi="after_definition_change",Wl="SEI_PARSED",Kl="retry",pt="video_resize",kr="pip_change",Ma="rotate",Na="screenShot",yn="playnext",Ba="shortcut",Fa="xglog",_n="user_action",On="reset",Ua="source_error",Ha="source_success",Va="switch_subtitle",$a=["play","playing","ended","pause","error","seeking","seeked","timeupdate","waiting","canplay","canplaythrough","durationchange","volumechange","loadeddata","loadedmetadata","ratechange","progress","loadstart","emptied","stalled","suspend","abort","lowdecode"],Ga={STATS_INFO:"stats_info",STATS_DOWNLOAD:"stats_download",STATS_RESET:"stats_reset"},ja="fps_stuck";const Yl=Object.freeze(Object.defineProperty({__proto__:null,ABORT:Gl,AFTER_DEFINITION_CHANGE:Oi,AUTOPLAY_PREVENTED:Yr,AUTOPLAY_STARTED:Qt,BEFORE_DEFINITION_CHANGE:zl,BUFFER_CHANGE:jl,CANPLAY:bt,CANPLAY_THROUGH:Ul,COMPLETE:Dn,CSS_FULLSCREEN_CHANGE:gn,DEFINITION_CHANGE:Xr,DESTROY:In,DOWNLOAD_SPEED_CHANGE:Er,DURATION_CHANGE:Pt,EMPTIED:ii,ENDED:Ct,ENTER_PLAYER:Oa,ERROR:Ti,FPS_STUCK:ja,FULLSCREEN_CHANGE:_t,LEAVE_PLAYER:Ia,LOADED_DATA:vt,LOADED_METADATA:Hl,LOADING:Ra,LOAD_START:zr,MINI_STATE_CHANGE:mn,PAUSE:dt,PIP_CHANGE:kr,PLAY:je,PLAYER_BLUR:La,PLAYER_FOCUS:Wr,PLAYING:jr,PLAYNEXT:yn,PROGRESS:xa,RATE_CHANGE:Pa,READY:Kr,REPLAY:pn,RESET:On,RETRY:Kl,ROTATE:Ma,SCREEN_SHOT:Na,SEEKED:kt,SEEKING:Ln,SEI_PARSED:Wl,SHORTCUT:Ba,SOURCE_ERROR:Ua,SOURCE_SUCCESS:Ha,STALLED:Vl,STATS_EVENTS:Ga,SUSPEND:$l,SWITCH_SUBTITLE:Va,TIME_UPDATE:$e,URL_CHANGE:Wi,URL_NULL:Da,USER_ACTION:_n,VIDEO_EVENTS:$a,VIDEO_RESIZE:pt,VOLUME_CHANGE:Ii,WAITING:zi,XGLOG:Fa},Symbol.toStringTag,{value:"Module"}));function Wn(s,a){!this||!this.emit||(s==="error"?this.errorHandler(s,a.error):this.emit(s,a))}function Xl(s,a){return function(i,t){var e={player:a,eventName:s,originalEvent:i,detail:i.detail||{},timeStamp:i.timeStamp,currentTime:a.currentTime,duration:a.duration,paused:a.paused,ended:a.ended,isInternalOp:!!a._internalOp[i.type],muted:a.muted,volume:a.volume,host:p.getHostFromUrl(a.currentSrc),vtype:a.vtype};if(a.removeInnerOP(i.type),s==="timeupdate"&&(a._currentTime=a.media&&a.media.currentTime),s==="ratechange"){var n=a.media?a.media.playbackRate:0;if(n&&a._rate===n)return;a._rate=a.media&&a.media.playbackRate}if(s==="durationchange"&&(a._duration=a.media.duration),s==="volumechange"&&(e.isMutedChange=a._lastMuted!==a.muted,a._lastMuted=a.muted),s==="error"&&(e.error=t||a.video.error),a.mediaEventMiddleware[s]){var r=Wn.bind(a,s,e);try{a.mediaEventMiddleware[s].call(a,e,r)}catch(o){throw Wn.call(a,s,e),o}}else Wn.call(a,s,e)}}var ql=function(s){ie(i,s);var a=ne(i);function i(t){var e;q(this,i),e=a.call(this,t),e._hasStart=!1,e._currentTime=0,e._duration=0,e._internalOp={},e._lastMuted=!1,e.vtype="MP4",e._rate=-1,e.mediaConfig=Object.assign({},{controls:!1,autoplay:t.autoplay,playsinline:t.playsinline,"x5-playsinline":t.playsinline,"webkit-playsinline":t.playsinline,"x5-video-player-fullscreen":t["x5-video-player-fullscreen"]||t.x5VideoPlayerFullscreen,"x5-video-orientation":t["x5-video-orientation"]||t.x5VideoOrientation,airplay:t.airplay,"webkit-airplay":t.airplay,tabindex:t.tabindex|0,mediaType:t.mediaType||"video","data-index":-1},t.videoConfig,t.videoAttributes);var n=t["x5-video-player-type"]||t.x5VideoPlayerType;return oe.isWeixin&&oe.os.isAndroid&&n&&(e.mediaConfig["x5-video-player-type"]=n,delete e.mediaConfig.playsinline,delete e.mediaConfig["webkit-playsinline"],delete e.mediaConfig["x5-playsinline"]),t.loop&&(e.mediaConfig.loop="loop"),t.autoplayMuted&&!Object.prototype.hasOwnProperty.call(e.mediaConfig,"muted")&&(e.mediaConfig.muted=!0),e.media=p.createDom(e.mediaConfig.mediaType,"",e.mediaConfig,""),t.defaultPlaybackRate&&(e.media.defaultPlaybackRate=e.media.playbackRate=t.defaultPlaybackRate),p.typeOf(t.volume)==="Number"&&(e.volume=t.volume),t.autoplayMuted&&(e.media.muted=!0,e._lastMuted=!0),t.autoplay&&(e.media.autoplay=!0),e._interval={},e.mediaEventMiddleware={},e.attachVideoEvents(),e}return Q(i,[{key:"setEventsMiddleware",value:function(e){var n=this;Object.keys(e).map(function(r){n.mediaEventMiddleware[r]=e[r]})}},{key:"removeEventsMiddleware",value:function(e){var n=this;Object.keys(e).map(function(r){delete n.mediaEventMiddleware[r]})}},{key:"attachVideoEvents",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.media;this._evHandlers||(this._evHandlers=$a.map(function(r){var o="on".concat(r.charAt(0).toUpperCase()).concat(r.slice(1));return typeof e[o]=="function"&&e.on(r,e[o]),I({},r,Xl(r,e))})),this._evHandlers.forEach(function(r){var o=Object.keys(r)[0];n.addEventListener(o,r[o],!1)})}},{key:"detachVideoEvents",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.media;this._evHandlers.forEach(function(r){var o=Object.keys(r)[0];n.removeEventListener(o,r[o],!1)}),this._evHandlers.forEach(function(r){var o=Object.keys(r)[0],u="on".concat(o.charAt(0).toUpperCase()).concat(o.slice(1));typeof e[u]=="function"&&e.off(o,e[u])}),this._evHandlers=null}},{key:"_attachSourceEvents",value:function(e,n){var r=this;e.removeAttribute("src"),e.load(),n.forEach(function(h,f){r.media.appendChild(p.createDom("source","",{src:"".concat(h.src),type:"".concat(h.type||""),"data-index":f+1}))});var o=e.children;if(o){this._videoSourceCount=o.length,this._videoSourceIndex=o.length,this._vLoadeddata=function(h){r.emit(Ha,{src:h.target.currentSrc,host:p.getHostFromUrl(h.target.currentSrc)})};for(var u=null,l=0;l<this._evHandlers.length;l++)if(Object.keys(this._evHandlers[l])[0]==="error"){u=this._evHandlers[l];break}!this._sourceError&&(this._sourceError=function(h){var f=parseInt(h.target.getAttribute("data-index"),10);if(r._videoSourceIndex--,r._videoSourceIndex===0||f>=r._videoSourceCount){var d={code:4,message:"sources_load_error"};u?u.error(h,d):r.errorHandler("error",d)}var v=vs[4];r.emit(Ua,new Di(r,{errorType:v,errorCode:4,errorMessage:"sources_load_error",mediaError:{code:4,message:"sources_load_error"},src:h.target.src}))});for(var c=0;c<o.length;c++)o[c].addEventListener("error",this._sourceError);e.addEventListener("loadeddata",this._vLoadeddata)}}},{key:"_detachSourceEvents",value:function(e){var n=e.children;if(!(!n||n.length===0||!this._sourceError)){for(var r=0;r<n.length;r++)n[r].removeEventListener("error",this._sourceError);for(;n.length>0;)e.removeChild(n[0]);this._vLoadeddata&&e.removeEventListener("loadeddata",this._vLoadeddata)}}},{key:"errorHandler",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(this.media&&(this.media.error||n)){var r=this.media.error||n,o=r.code?vs[r.code]:"other",u=r.message;this.media.currentSrc||(u="empty_src",r={code:6,message:u}),this.emit(e,new Di(this,{errorType:o,errorCode:r.code,errorMessage:r.message||"",mediaError:r}))}}},{key:"destroy",value:function(){this.media&&(this.media.pause&&(this.media.pause(),this.media.muted=!0),this.media.removeAttribute("src"),this.media.load()),this._currentTime=0,this._duration=0,this.mediaConfig=null;for(var e in this._interval)Object.prototype.hasOwnProperty.call(this._interval,e)&&(clearInterval(this._interval[e]),this._interval[e]=null);this.detachVideoEvents(),this.media=null,this.mediaEventMiddleware={},this.removeAllListeners()}},{key:"video",get:function(){return this.media},set:function(e){this.media=e}},{key:"play",value:function(){var e=this.media?this.media.play():null;return e}},{key:"pause",value:function(){this.media&&this.media.pause()}},{key:"load",value:function(){this.media&&this.media.load()}},{key:"canPlayType",value:function(e){return this.media?this.media.canPlayType(e):!1}},{key:"getBufferedRange",value:function(e){var n=[0,0];if(!this.media)return n;e||(e=this.media.buffered);var r=this.media.currentTime;if(e)for(var o=0,u=e.length;o<u&&(n[0]=e.start(o),n[1]=e.end(o),!(n[0]<=r&&r<=n[1]));o++);return n[0]-r<=0&&r-n[1]<=0?n:[0,0]}},{key:"autoplay",get:function(){return this.media?this.media.autoplay:!1},set:function(e){this.media&&(this.media.autoplay=e)}},{key:"buffered",get:function(){return this.media?this.media.buffered:null}},{key:"buffered2",get:function(){return this.media&&this.media.buffered?p.getBuffered2(this.media.buffered):null}},{key:"bufferedPoint",get:function(){var e={start:0,end:0};if(!this.media)return e;var n=this.media.buffered;if(!n||n.length===0)return e;for(var r=0;r<n.length;r++)if((n.start(r)<=this.currentTime||n.start(r)<.1)&&n.end(r)>=this.currentTime)return{start:n.start(r),end:n.end(r)};return e}},{key:"crossOrigin",get:function(){return this.media?this.media.crossOrigin:""},set:function(e){this.media&&(this.media.crossOrigin=e)}},{key:"currentSrc",get:function(){return this.media?this.media.currentSrc:""},set:function(e){this.media&&(this.media.currentSrc=e)}},{key:"currentTime",get:function(){return this.media?this.media.currentTime!==void 0?this.media.currentTime:this._currentTime:0},set:function(e){this.media&&(this.media.currentTime=e)}},{key:"defaultMuted",get:function(){return this.media?this.media.defaultMuted:!1},set:function(e){this.media&&(this.media.defaultMuted=e)}},{key:"duration",get:function(){return this._duration}},{key:"ended",get:function(){return this.media?this.media.ended:!1}},{key:"error",get:function(){return this.media.error}},{key:"errorNote",get:function(){var e=this.media.error;if(!e)return"";var n=["MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED"];return n[this.media.error.code-1]}},{key:"loop",get:function(){return this.media?this.media.loop:!1},set:function(e){this.media&&(this.media.loop=e)}},{key:"muted",get:function(){return this.media?this.media.muted:!1},set:function(e){!this.media||this.media.muted===e||(this._lastMuted=this.media.muted,this.media.muted=e)}},{key:"networkState",get:function(){return this.media.networkState}},{key:"paused",get:function(){return this.media?this.media.paused:!0}},{key:"playbackRate",get:function(){return this.media?this.media.playbackRate:0},set:function(e){!this.media||e===1/0||(this.media.defaultPlaybackRate=e,this.media.playbackRate=e)}},{key:"played",get:function(){return this.media?this.media.played:null}},{key:"preload",get:function(){return this.media?this.media.preload:!1},set:function(e){this.media&&(this.media.preload=e)}},{key:"readyState",get:function(){return this.media.readyState}},{key:"seekable",get:function(){return this.media?this.media.seekable:!1}},{key:"seeking",get:function(){return this.media?this.media.seeking:!1}},{key:"src",get:function(){return this.media?this.media.src:""},set:function(e){if(this.media){if(this.emit(Wi,e),this.emit(zi),this._currentTime=0,this._duration=0,p.isMSE(this.media)){this.onWaiting();return}this._detachSourceEvents(this.media),p.typeOf(e)==="Array"?this._attachSourceEvents(this.media,e):e?this.media.src=e:this.media.removeAttribute("src"),this.load()}}},{key:"volume",get:function(){return this.media?this.media.volume:0},set:function(e){e===1/0||!this.media||(this.media.volume=e)}},{key:"aspectRatio",get:function(){return this.media?this.media.videoWidth/this.media.videoHeight:0}},{key:"addInnerOP",value:function(e){this._internalOp[e]=!0}},{key:"removeInnerOP",value:function(e){delete this._internalOp[e]}},{key:"emit",value:function(e,n){for(var r,o=arguments.length,u=new Array(o>2?o-2:0),l=2;l<o;l++)u[l-2]=arguments[l];(r=ue(se(i.prototype),"emit",this)).call.apply(r,[this,e,n].concat(u))}},{key:"on",value:function(e,n){for(var r,o=arguments.length,u=new Array(o>2?o-2:0),l=2;l<o;l++)u[l-2]=arguments[l];(r=ue(se(i.prototype),"on",this)).call.apply(r,[this,e,n].concat(u))}},{key:"once",value:function(e,n){for(var r,o=arguments.length,u=new Array(o>2?o-2:0),l=2;l<o;l++)u[l-2]=arguments[l];(r=ue(se(i.prototype),"once",this)).call.apply(r,[this,e,n].concat(u))}},{key:"off",value:function(e,n){for(var r,o=arguments.length,u=new Array(o>2?o-2:0),l=2;l<o;l++)u[l-2]=arguments[l];(r=ue(se(i.prototype),"off",this)).call.apply(r,[this,e,n].concat(u))}},{key:"offAll",value:function(){ue(se(i.prototype),"removeAllListeners",this).call(this)}}]),i}(ki),Ql=function(){function s(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{name:"xgplayer",version:1,db:null,ojstore:{name:"xg-m4a",keypath:"vid"}};q(this,s),this.indexedDB=window.indexedDB||window.webkitindexedDB,this.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange,this.myDB=a}return Q(s,[{key:"openDB",value:function(i){var t=this,e=this,n=this.myDB.version||1,r=e.indexedDB.open(e.myDB.name,n);r.onerror=function(o){},r.onsuccess=function(o){t.myDB.db=o.target.result,i.call(e)},r.onupgradeneeded=function(o){var u=o.target.result;o.target.transaction,u.objectStoreNames.contains(e.myDB.ojstore.name)||u.createObjectStore(e.myDB.ojstore.name,{keyPath:e.myDB.ojstore.keypath})}}},{key:"deletedb",value:function(){var i=this;i.indexedDB.deleteDatabase(this.myDB.name)}},{key:"closeDB",value:function(){this.myDB.db.close()}},{key:"addData",value:function(i,t){for(var e=this.myDB.db.transaction(i,"readwrite").objectStore(i),n,r=0;r<t.length;r++)n=e.add(t[r]),n.onerror=function(){},n.onsuccess=function(){}}},{key:"putData",value:function(i,t){for(var e=this.myDB.db.transaction(i,"readwrite").objectStore(i),n,r=0;r<t.length;r++)n=e.put(t[r]),n.onerror=function(){},n.onsuccess=function(){}}},{key:"getDataByKey",value:function(i,t,e){var n=this,r=this.myDB.db.transaction(i,"readwrite").objectStore(i),o=r.get(t);o.onerror=function(){e.call(n,null)},o.onsuccess=function(u){var l=u.target.result;e.call(n,l)}}},{key:"deleteData",value:function(i,t){var e=this.myDB.db.transaction(i,"readwrite").objectStore(i);e.delete(t)}},{key:"clearData",value:function(i){var t=this.myDB.db.transaction(i,"readwrite").objectStore(i);t.clear()}}]),s}(),gs=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],ms=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"],ys=["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"],Kt="data-xgplayerid";function qi(s,a,i){for(var t=arguments.length,e=new Array(t>3?t-3:0),n=3;n<t;n++)e[n-3]=arguments[n];var r=a.call.apply(a,[s].concat(e));!i||typeof i!="function"||(r&&r.then?r.then(function(){for(var o=arguments.length,u=new Array(o),l=0;l<o;l++)u[l]=arguments[l];i.call.apply(i,[s].concat(u))}):i.call.apply(i,[s].concat(e)))}function bn(s,a){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{pre:null,next:null};return this.__hooks||(this.__hooks={}),!this.__hooks[s]&&(this.__hooks[s]=null),(function(){var t=arguments,e=this;if(i.pre)try{var n;(n=i.pre).call.apply(n,[this].concat(Array.prototype.slice.call(arguments)))}catch(o){throw o.message="[pluginName: ".concat(this.pluginName,":").concat(s,":pre error] >> ").concat(o.message),o}if(this.__hooks&&this.__hooks[s])try{var r=ht(this,s,a);r?r.then?r.then(function(o){o!==!1&&qi.apply(void 0,[e,a,i.next].concat(ot(t)))}).catch(function(o){throw o}):qi.apply(void 0,[this,a,i.next].concat(Array.prototype.slice.call(arguments))):r===void 0&&qi.apply(void 0,[this,a,i.next].concat(Array.prototype.slice.call(arguments)))}catch(o){throw o.message="[pluginName: ".concat(this.pluginName,":").concat(s,"] >> ").concat(o.message),o}else qi.apply(void 0,[this,a,i.next].concat(Array.prototype.slice.call(arguments)))}).bind(this)}function za(s,a){var i=this.__hooks;if(!i||!Array.isArray(i[s]))return-1;for(var t=i[s],e=0;e<t.length;e++)if(t[e]===a)return e;return-1}function Sn(s,a){var i=this.__hooks;if(i)return i.hasOwnProperty(s)?(Array.isArray(i[s])||(i[s]=[]),za.call(this,s,a)===-1&&i[s].push(a),!0):(console.warn("has no supported hook which name [".concat(s,"]")),!1)}function En(s,a){var i=this.__hooks;if(i){if(Array.isArray(i[s])){var t=i[s],e=za.call(this,s,a);e!==-1&&t.splice(e,1)}delete i[s]}}function _s(s){if(!(!this.plugins||!this.plugins[s.toLowerCase()])){for(var a=this.plugins[s.toLowerCase()],i=arguments.length,t=new Array(i>1?i-1:0),e=1;e<i;e++)t[e-1]=arguments[e];return a.useHooks&&a.useHooks.apply(a,t)}}function bs(s){if(!(!this.plugins||!this.plugins[s.toLowerCase()])){var a=this.plugins[s.toLowerCase()];if(a){for(var i=arguments.length,t=new Array(i>1?i-1:0),e=1;e<i;e++)t[e-1]=arguments[e];return a.removeHooks&&a.removeHooks.apply(a,t)}}}function Wa(s){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];s.__hooks={},a&&a.map(function(i){s.__hooks[i]=null}),Object.defineProperty(s,"hooks",{get:function(){return s.__hooks&&Object.keys(s.__hooks).map(function(t){if(s.__hooks[t])return t})}})}function Ka(s){s.__hooks=null}function ht(s,a,i){for(var t=arguments.length,e=new Array(t>3?t-3:0),n=3;n<t;n++)e[n-3]=arguments[n];if(s.__hooks&&Array.isArray(s.__hooks[a])){var r=s.__hooks[a],o=-1,u=function l(c,h,f){for(var d=arguments.length,v=new Array(d>3?d-3:0),m=3;m<d;m++)v[m-3]=arguments[m];if(o++,r.length===0||o===r.length)return f.call.apply(f,[c,c].concat(v));var g=r[o],b=g.call.apply(g,[c,c].concat(v));if(b&&b.then)return b.then(function(k){return k===!1?null:l.apply(void 0,[c,h,f].concat(v))}).catch(function(k){console.warn("[runHooks]".concat(h," reject"),k.message)});if(b!==!1)return l.apply(void 0,[c,h,f].concat(v))};return u.apply(void 0,[s,a,i].concat(e))}else return i.call.apply(i,[s,s].concat(e))}function Kn(s,a){pe.logError("[".concat(s,"] event or callback cant be undefined or null when call ").concat(a))}var gt=function(){function s(a){q(this,s),p.checkIsFunction(this.beforeCreate)&&this.beforeCreate(a),Wa(this),this.__args=a,this.__events={},this.__onceEvents={},this.config=a.config||{},this.player=null,this.playerConfig={},this.pluginName="",this.__init(a)}return Q(s,[{key:"beforeCreate",value:function(i){}},{key:"afterCreate",value:function(){}},{key:"beforePlayerInit",value:function(){}},{key:"onPluginsReady",value:function(){}},{key:"afterPlayerInit",value:function(){}},{key:"destroy",value:function(){}},{key:"__init",value:function(i){this.player=i.player,this.playerConfig=i.player&&i.player.config,this.pluginName=i.pluginName?i.pluginName.toLowerCase():this.constructor.pluginName.toLowerCase(),this.logger=i.player&&i.player.logger}},{key:"updateLang",value:function(i){i||(i=this.lang)}},{key:"lang",get:function(){return this.player.lang}},{key:"i18n",get:function(){return this.player.i18n}},{key:"i18nKeys",get:function(){return this.player.i18nKeys}},{key:"domEventType",get:function(){var i=p.checkTouchSupport()?"touch":"mouse";return this.playerConfig&&(this.playerConfig.domEventType==="touch"||this.playerConfig.domEventType==="mouse")&&(i=this.playerConfig.domEventType),i}},{key:"on",value:function(i,t){var e=this;if(!i||!t||!this.player){Kn(this.pluginName,"plugin.on(event, callback)");return}typeof i=="string"?(this.__events[i]=t,this.player.on(i,t)):Array.isArray(i)&&i.forEach(function(n){e.__events[n]=t,e.player.on(n,t)})}},{key:"once",value:function(i,t){var e=this;if(!i||!t||!this.player){Kn(this.pluginName,"plugin.once(event, callback)");return}typeof i=="string"?(this.__onceEvents[i]=t,this.player.once(i,t)):Array.isArray(i)&&i.forEach(function(n){e.__onceEvents[n]=t,e.player.once(i,t)})}},{key:"off",value:function(i,t){var e=this;if(!i||!t||!this.player){Kn(this.pluginName,"plugin.off(event, callback)");return}typeof i=="string"?(delete this.__events[i],this.player.off(i,t)):Array.isArray(i)&&i.forEach(function(n){delete e.__events[i],e.player.off(n,t)})}},{key:"offAll",value:function(){var i=this;["__events","__onceEvents"].forEach(function(t){Object.keys(i[t]).forEach(function(e){i[t][e]&&i.off(e,i[t][e]),e&&delete i[t][e]})}),this.__events={},this.__onceEvents={}}},{key:"emit",value:function(i){var t;if(this.player){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];(t=this.player).emit.apply(t,[i].concat(n))}}},{key:"emitUserAction",value:function(i,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.player){var n=Le(Le({},e),{},{pluginName:this.pluginName});this.player.emitUserAction(i,t,n)}}},{key:"hook",value:function(i,t){return bn.call.apply(bn,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(i,t){for(var e=arguments.length,n=new Array(e>2?e-2:0),r=2;r<e;r++)n[r-2]=arguments[r];return Sn.call.apply(Sn,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removeHooks",value:function(i,t){for(var e=arguments.length,n=new Array(e>2?e-2:0),r=2;r<e;r++)n[r-2]=arguments[r];return En.call.apply(En,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"registerPlugin",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(this.player)return e&&(t.pluginName=e),this.player.registerPlugin({plugin:i,options:t})}},{key:"getPlugin",value:function(i){return this.player?this.player.getPlugin(i):null}},{key:"__destroy",value:function(){var i=this,t=this.player,e=this.pluginName;this.offAll(),p.clearAllTimers(this),p.checkIsFunction(this.destroy)&&this.destroy(),["player","playerConfig","pluginName","logger","__args","__hooks"].map(function(n){i[n]=null}),t.unRegisterPlugin(e),Ka(this)}}],[{key:"defineGetterOrSetter",value:function(i,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&Object.defineProperty(i,e,t[e])}},{key:"defineMethod",value:function(i,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&typeof t[e]=="function"&&Object.defineProperty(i,e,{configurable:!0,value:t[e]})}},{key:"defaultConfig",get:function(){return{}}},{key:"pluginName",get:function(){return"pluginName"}}]),s}(),Jl=9;if(typeof Element<"u"&&!Element.prototype.matches){var oi=Element.prototype;oi.matches=oi.matchesSelector||oi.mozMatchesSelector||oi.msMatchesSelector||oi.oMatchesSelector||oi.webkitMatchesSelector}function Zl(s,a){for(;s&&s.nodeType!==Jl;){if(typeof s.matches=="function"&&s.matches(a))return s;s=s.parentNode}}var ec=Zl,tc=ec;function Yn(s,a,i,t,e){var n=nc.apply(this,arguments);return s.addEventListener(i,n,e),{destroy:function(){s.removeEventListener(i,n,e)}}}function ic(s,a,i,t,e){return typeof s.addEventListener=="function"?Yn.apply(null,arguments):typeof i=="function"?Yn.bind(null,document).apply(null,arguments):(typeof s=="string"&&(s=document.querySelectorAll(s)),Array.prototype.map.call(s,function(n){return Yn(n,a,i,t,e)}))}function nc(s,a,i,t){return function(e){e.delegateTarget=tc(e.target,a),e.delegateTarget&&t.call(s,e)}}var rc=ic;const Ss=Br(rc);var sc={CONTROLS:"controls",ROOT:"root"},Te={ROOT:"root",ROOT_LEFT:"rootLeft",ROOT_RIGHT:"rootRight",ROOT_TOP:"rootTop",CONTROLS_LEFT:"controlsLeft",CONTROLS_RIGTH:"controlsRight",CONTROLS_RIGHT:"controlsRight",CONTROLS_CENTER:"controlsCenter",CONTROLS:"controls"},Es={ICON_DISABLE:"xg-icon-disable",ICON_HIDE:"xg-icon-hide"};function Xn(s){return s?s.indexOf&&/^(?:http|data:|\/)/.test(s):!1}function ac(s,a){return Ge(s)==="object"&&s.class&&typeof s.class=="string"?"".concat(a," ").concat(s.class):a}function oc(s,a){return Ge(s)==="object"&&s.attr&&Ge(s.attr)==="object"&&Object.keys(s.attr).map(function(i){a[i]=s.attr[i]}),a}function ks(s,a){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"",t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},e=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"",n=null;if(s instanceof window.Element)return p.addClass(s,i),Object.keys(t).map(function(r){s.setAttribute(r,t[r])}),s;if(Xn(s)||Xn(s.url))return t.src=Xn(s)?s:s.url||"",n=p.createDom(s.tag||"img","",t,"xg-img ".concat(i)),n;if(typeof s=="function")try{return n=s(),n instanceof window.Element?(p.addClass(n,i),Object.keys(t).map(function(r){n.setAttribute(r,t[r])}),n):(pe.logWarn("warn>>icons.".concat(a," in config of plugin named [").concat(e,"] is a function mast return an Element Object")),null)}catch(r){return pe.logError("Plugin named [".concat(e,"]:createIcon"),r),null}return typeof s=="string"?p.createDomFromHtml(s,t,i):(pe.logWarn("warn>>icons.".concat(a," in config of plugin named [").concat(e,"] is invalid")),null)}function uc(s,a){var i=a.config.icons||a.playerConfig.icons;Object.keys(s).map(function(t){var e=s[t],n=e&&e.class?e.class:"",r=e&&e.attr?e.attr:{},o=null;i&&i[t]&&(n=ac(i[t],n),r=oc(i[t],r),o=ks(i[t],t,n,r,a.pluginName)),!o&&e&&(o=ks(e.icon?e.icon:e,r,n,{},a.pluginName)),a.icons[t]=o})}function lc(s,a){Object.keys(s).map(function(i){Object.defineProperty(a.langText,i,{get:function(){var e=a.lang,n=a.i18n;return n[i]?n[i]:s[i]&&s[i][e]||""}})})}var fe=function(s){ie(i,s);var a=ne(i);function i(){var t,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return q(this,i),t=a.call(this,e),t.__delegates=[],t}return Q(i,[{key:"__init",value:function(e){if(ue(se(i.prototype),"__init",this).call(this,e),!!e.root){var n=e.root,r=null;this.icons={},this.root=null,this.parent=null;var o=this.registerIcons()||{};uc(o,this),this.langText={};var u=this.registerLanguageTexts()||{};lc(u,this);var l="";try{l=this.render()}catch(f){throw pe.logError("Plugin:".concat(this.pluginName,":render"),f),new Error("Plugin:".concat(this.pluginName,":render:").concat(f.message))}if(l)r=i.insert(l,n,e.index),r.setAttribute("data-index",e.index);else if(e.tag)r=p.createDom(e.tag,"",e.attr,e.name),r.setAttribute("data-index",e.index),n.appendChild(r);else return;this.root=r,this.parent=n;var c=this.config.attr||{},h=this.config.style||{};this.setAttr(c),this.setStyle(h),this.config.index&&this.root.setAttribute("data-index",this.config.index),this.__registerChildren()}}},{key:"__registerChildren",value:function(){var e=this;if(this.root){this._children=[];var n=this.children();n&&Ge(n)==="object"&&Object.keys(n).length>0&&Object.keys(n).map(function(r){var o=r,u=n[o],l={root:e.root},c,h;typeof u=="function"?(c=e.config[o]||{},h=u):Ge(u)==="object"&&typeof u.plugin=="function"&&(c=u.options?p.deepCopy(e.config[o]||{},u.options):e.config[o]||{},h=u.plugin),l.config=c,c.index!==void 0&&(l.index=c.index),c.root&&(l.root=c.root),e.registerPlugin(h,l,o)})}}},{key:"updateLang",value:function(e){e||(e=this.lang);function n(l,c){for(var h=0;h<l.children.length;h++)l.children[h].children.length>0?n(l.children[h],c):c(l.children[h])}var r=this.root,o=this.i18n,u=this.langText;r&&n(r,function(l){var c=l.getAttribute&&l.getAttribute("lang-key");if(c){var h=o[c.toUpperCase()]||u[c];h&&(l.innerHTML=typeof h=="function"?h(e):h)}})}},{key:"lang",get:function(){return this.player.lang}},{key:"changeLangTextKey",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=this.i18n||{},o=this.langText;e.setAttribute&&e.setAttribute("lang-key",n);var u=r[n]||o[n]||"";u&&(e.innerHTML=u)}},{key:"plugins",value:function(){return this._children}},{key:"disable",value:function(){this.config.disable=!0,p.addClass(this.find(".xgplayer-icon"),Es.ICON_DISABLE)}},{key:"enable",value:function(){this.config.disable=!1,p.removeClass(this.find(".xgplayer-icon"),Es.ICON_DISABLE)}},{key:"children",value:function(){return{}}},{key:"registerPlugin",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";n.root=n.root||this.root;var o=ue(se(i.prototype),"registerPlugin",this).call(this,e,n,r);return this._children.push(o),o}},{key:"registerIcons",value:function(){return{}}},{key:"registerLanguageTexts",value:function(){return{}}},{key:"find",value:function(e){if(this.root)return this.root.querySelector(e)}},{key:"bind",value:function(e,n,r){var o=this;if(arguments.length<3&&typeof n=="function")Array.isArray(e)?e.forEach(function(l){o.bindEL(l,n)}):this.bindEL(e,n);else{var u=i.delegate.call(this,this.root,e,n,r);this.__delegates=this.__delegates.concat(u)}}},{key:"unbind",value:function(e,n){var r=this;if(arguments.length<3&&typeof n=="function")Array.isArray(e)?e.forEach(function(l){r.unbindEL(l,n)}):this.unbindEL(e,n);else for(var o="".concat(e,"_").concat(n),u=0;u<this.__delegates.length;u++)if(this.__delegates[u].key===o){this.__delegates[u].destroy(),this.__delegates.splice(u,1);break}}},{key:"setStyle",value:function(e,n){var r=this;if(this.root){if(p.typeOf(e)==="String")return this.root.style[e]=n;p.typeOf(e)==="Object"&&Object.keys(e).map(function(o){r.root.style[o]=e[o]})}}},{key:"setAttr",value:function(e,n){var r=this;if(this.root){if(p.typeOf(e)==="String")return this.root.setAttribute(e,n);p.typeOf(e)==="Object"&&Object.keys(e).map(function(o){r.root.setAttribute(o,e[o])})}}},{key:"setHtml",value:function(e,n){this.root&&(this.root.innerHTML=e,typeof n=="function"&&n())}},{key:"bindEL",value:function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.root&&"on".concat(e)in this.root&&typeof n=="function"&&this.root.addEventListener(e,n,r)}},{key:"unbindEL",value:function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.root&&"on".concat(e)in this.root&&typeof n=="function"&&this.root.removeEventListener(e,n,r)}},{key:"show",value:function(e){if(this.root){this.root.style.display=e!==void 0?e:"block";var n=window.getComputedStyle(this.root,null),r=n.getPropertyValue("display");if(r==="none")return this.root.style.display="block"}}},{key:"hide",value:function(){this.root&&(this.root.style.display="none")}},{key:"appendChild",value:function(e,n){if(!this.root)return null;if(arguments.length<2&&arguments[0]instanceof window.Element)return this.root.appendChild(arguments[0]);if(!n||!(n instanceof window.Element))return null;try{return typeof e=="string"?this.find(e).appendChild(n):e.appendChild(n)}catch(r){return pe.logError("Plugin:appendChild",r),null}}},{key:"render",value:function(){return""}},{key:"destroy",value:function(){}},{key:"__destroy",value:function(){var e=this,n=this.player;this.__delegates.map(function(r){r.destroy()}),this.__delegates=[],this._children instanceof Array&&(this._children.map(function(r){n.unRegisterPlugin(r.pluginName)}),this._children=null),this.root&&(this.root.hasOwnProperty("remove")?this.root.remove():this.root.parentNode&&this.root.parentNode.removeChild(this.root)),ue(se(i.prototype),"__destroy",this).call(this),this.icons={},["root","parent"].map(function(r){e[r]=null})}}],[{key:"insert",value:function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=n.children.length,u=Number(r),l=e instanceof window.Node;if(o){for(var c=0,h=null,f="";c<o;c++){h=n.children[c];var d=Number(h.getAttribute("data-index"));if(d>=u){f="beforebegin";break}else d<u&&(f="afterend")}return l?f==="afterend"?n.appendChild(e):n.insertBefore(e,h):h.insertAdjacentHTML(f,e),f==="afterend"?n.children[n.children.length-1]:n.children[c]}else return l?n.appendChild(e):n.insertAdjacentHTML("beforeend",e),n.children[n.children.length-1]}},{key:"defaultConfig",get:function(){return{}}},{key:"delegate",value:function(e,n,r,o){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,l=[];if(e instanceof window.Node&&typeof o=="function")if(Array.isArray(r))r.forEach(function(h){var f=Ss(e,n,h,o,u);f.key="".concat(n,"_").concat(h),l.push(f)});else{var c=Ss(e,n,r,o,u);c.key="".concat(n,"_").concat(r),l.push(c)}return l}},{key:"ROOT_TYPES",get:function(){return sc}},{key:"POSITIONS",get:function(){return Te}}]),i}(gt),cc=function(){function s(){var a=this;if(q(this,s),I(this,"__trigger",function(i){var t=new Date().getTime();a.timeStamp=t;for(var e=0;e<i.length;e++)a.__runHandler(i[e].target)}),this.__handlers=[],this.timeStamp=0,this.observer=null,!!window.ResizeObserver)try{this.observer=new window.ResizeObserver(Ml(this.__trigger,100,{trailing:!0})),this.timeStamp=new Date().getTime()}catch(i){console.error(i)}}return Q(s,[{key:"addObserver",value:function(i,t){if(this.observer){this.observer.observe(i);for(var e=i.getAttribute(Kt),n=this.__handlers,r=-1,o=0;o<n.length;o++)n[o]&&i===n[o].target&&(r=o);r>-1?this.__handlers[r].handler=t:this.__handlers.push({target:i,handler:t,playerId:e})}}},{key:"unObserver",value:function(i){var t=-1;this.__handlers.map(function(n,r){i===n.target&&(t=r)});try{var e;(e=this.observer)===null||e===void 0||e.unobserve(i)}catch{}t>-1&&this.__handlers.splice(t,1)}},{key:"destroyObserver",value:function(){var i;(i=this.observer)===null||i===void 0||i.disconnect(),this.observer=null,this.__handlers=null}},{key:"__runHandler",value:function(i){for(var t=this.__handlers,e=0;e<t.length;e++)if(t[e]&&i===t[e].target){try{t[e].handler(i)}catch(n){console.error(n)}return!0}return!1}}]),s}(),Pi=null;function hc(s,a){return Pi||(Pi=new cc),Pi.addObserver(s,a),Pi}function fc(s,a){var i;(i=Pi)===null||i===void 0||i.unObserver(s,a)}var Ne={pluginGroup:{},init:function(a){var i=a._pluginInfoId;i||(i=new Date().getTime(),a._pluginInfoId=i),!a.config.closeResizeObserver&&hc(a.root,function(){a.resize()}),this.pluginGroup[i]={_originalOptions:a.config||{},_plugins:{}}},formatPluginInfo:function(a,i){var t=null,e=null;return a.plugin&&typeof a.plugin=="function"?(t=a.plugin,e=a.options):(t=a,e={}),i&&(e.config=i||{}),{PLUFGIN:t,options:e}},checkPluginIfExits:function(a,i){for(var t=0;t<i.length;t++)if(a.toLowerCase()===i[t].pluginName.toLowerCase())return!0;return!1},getRootByConfig:function(a,i){for(var t=Object.keys(i),e=null,n=0;n<t.length;n++)if(a.toLowerCase()===t[n].toLowerCase()){e=i[t[n]];break}return p.typeOf(e)==="Object"?{root:e.root,position:e.position}:{}},lazyRegister:function(a,i){var t=this,e=i.timeout||1500;return Promise.race([i.loader().then(function(n){var r;n&&n.__esModule?r=n.default:r=n,t.register(a,r,n.options)}),new Promise(function(n,r){setTimeout(function(){r(new Error("timeout"))},e)})])},register:function(a,i){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!(!a||!i||typeof i!="function"||i.prototype===void 0)){var e=a._pluginInfoId;if(!(!e||!this.pluginGroup[e])){this.pluginGroup[e]._plugins||(this.pluginGroup[e]._plugins={});var n=this.pluginGroup[e]._plugins,r=this.pluginGroup[e]._originalOptions;t.player=a;var o=t.pluginName||i.pluginName;if(!o)throw new Error("The property pluginName is necessary");if(i.isSupported&&!i.isSupported(a.config.mediaType,a.config.codecType)){console.warn("not supported plugin [".concat(o,"]"));return}t.config||(t.config={});for(var u=Object.keys(r),l=0;l<u.length;l++)if(o.toLowerCase()===u[l].toLowerCase()){var c=r[u[l]];p.typeOf(c)==="Object"?t.config=Object.assign({},t.config,r[u[l]]):p.typeOf(c)==="Boolean"&&(t.config.disable=!c);break}i.defaultConfig&&Object.keys(i.defaultConfig).forEach(function(f){typeof t.config[f]>"u"&&(t.config[f]=i.defaultConfig[f])}),t.root?typeof t.root=="string"&&(t.root=a[t.root]):t.root=a.root,t.index=t.config.index||0;try{n[o.toLowerCase()]&&(this.unRegister(e,o.toLowerCase()),console.warn("the is one plugin with same pluginName [".concat(o,"] exist, destroy the old instance")));var h=new i(t);return n[o.toLowerCase()]=h,n[o.toLowerCase()].func=i,h&&typeof h.afterCreate=="function"&&h.afterCreate(),h}catch(f){throw console.error(f),f}}}},unRegister:function(a,i){a._pluginInfoId&&(a=a._pluginInfoId),i=i.toLowerCase();try{var t=this.pluginGroup[a]._plugins[i];t&&(t.pluginName&&t.__destroy(),delete this.pluginGroup[a]._plugins[i])}catch(e){console.error("[unRegister:".concat(i,"] cgid:[").concat(a,"] error"),e)}},deletePlugin:function(a,i){var t=a._pluginInfoId;t&&this.pluginGroup[t]&&this.pluginGroup[t]._plugins&&delete this.pluginGroup[t]._plugins[i]},getPlugins:function(a){var i=a._pluginInfoId;return i&&this.pluginGroup[i]?this.pluginGroup[i]._plugins:{}},findPlugin:function(a,i){var t=a._pluginInfoId;if(!t||!this.pluginGroup[t])return null;var e=i.toLowerCase();return this.pluginGroup[t]._plugins[e]},beforeInit:function(a){var i=this;function t(e){return!e||!e.then?new Promise(function(n){n()}):e}return new Promise(function(e){if(i.pluginGroup){var n;return a._loadingPlugins&&a._loadingPlugins.length?n=Promise.all(a._loadingPlugins):n=Promise.resolve(),n.then(function(){var r=a._pluginInfoId;if(!i.pluginGroup[r]){e();return}var o=i.pluginGroup[r]._plugins,u=[];Object.keys(o).forEach(function(l){if(o[l]&&o[l].beforePlayerInit)try{var c=o[l].beforePlayerInit();u.push(t(c))}catch(h){throw u.push(t(null)),h}}),Promise.all([].concat(u)).then(function(){e()}).catch(function(l){console.error(l),e()})})}})},afterInit:function(a){var i=a._pluginInfoId;if(!(!i||!this.pluginGroup[i])){var t=this.pluginGroup[i]._plugins;Object.keys(t).forEach(function(e){t[e]&&t[e].afterPlayerInit&&t[e].afterPlayerInit()})}},setLang:function(a,i){var t=i._pluginInfoId;if(!(!t||!this.pluginGroup[t])){var e=this.pluginGroup[t]._plugins;Object.keys(e).forEach(function(n){if(e[n].updateLang)e[n].updateLang(a);else try{e[n].lang=a}catch{console.warn("".concat(n," setLang"))}})}},reRender:function(a){var i=this,t=a._pluginInfoId;if(!(!t||!this.pluginGroup[t])){var e=[],n=this.pluginGroup[t]._plugins;Object.keys(n).forEach(function(r){r!=="controls"&&n[r]&&(e.push({plugin:n[r].func,options:n[r].__args}),i.unRegister(t,r))}),e.forEach(function(r){i.register(a,r.plugin,r.options)})}},onPluginsReady:function(a){var i=a._pluginInfoId;if(!(!i||!this.pluginGroup[i])){var t=this.pluginGroup[i]._plugins||{};Object.keys(t).forEach(function(e){t[e].onPluginsReady&&typeof t[e].onPluginsReady=="function"&&t[e].onPluginsReady()})}},destroy:function(a){var i=a._pluginInfoId;if(this.pluginGroup[i]){fc(a.root);for(var t=this.pluginGroup[i]._plugins,e=0,n=Object.keys(t);e<n.length;e++){var r=n[e];this.unRegister(i,r)}delete this.pluginGroup[i],delete a._pluginInfoId}}},U={DEFAULT:"xgplayer",DEFAULT_SKIN:"xgplayer-skin-default",ENTER:"xgplayer-is-enter",PAUSED:"xgplayer-pause",PLAYING:"xgplayer-playing",ENDED:"xgplayer-ended",CANPLAY:"xgplayer-canplay",LOADING:"xgplayer-isloading",ERROR:"xgplayer-is-error",REPLAY:"xgplayer-replay",NO_START:"xgplayer-nostart",ACTIVE:"xgplayer-active",INACTIVE:"xgplayer-inactive",FULLSCREEN:"xgplayer-is-fullscreen",CSS_FULLSCREEN:"xgplayer-is-cssfullscreen",ROTATE_FULLSCREEN:"xgplayer-rotate-fullscreen",PARENT_ROTATE_FULLSCREEN:"xgplayer-rotate-parent",PARENT_FULLSCREEN:"xgplayer-fullscreen-parent",INNER_FULLSCREEN:"xgplayer-fullscreen-inner",NO_CONTROLS:"no-controls",FLEX_CONTROLS:"flex-controls",CONTROLS_FOLLOW:"controls-follow",CONTROLS_AUTOHIDE:"controls-autohide",TOP_BAR_AUTOHIDE:"top-bar-autohide",NOT_ALLOW_AUTOPLAY:"not-allow-autoplay",SEEKING:"seeking",PC:"xgplayer-pc",MOBILE:"xgplayer-mobile",MINI:"xgplayer-mini"};function Ts(){return{id:"",el:null,url:"",domEventType:"default",nullUrlStart:!1,width:600,height:337.5,fluid:!1,fitVideoSize:"fixed",videoFillMode:"auto",volume:.6,autoplay:!1,autoplayMuted:!1,loop:!1,isLive:!1,zoom:1,videoInit:!0,poster:"",isMobileSimulateMode:!1,defaultPlaybackRate:1,execBeforePluginsCall:null,allowSeekAfterEnded:!0,enableContextmenu:!0,closeVideoClick:!1,closeVideoDblclick:!1,closePlayerBlur:!1,closeDelayBlur:!1,leavePlayerTime:3e3,closePlayVideoFocus:!1,closePauseVideoFocus:!1,closeFocusVideoFocus:!0,closeControlsBlur:!0,topBarAutoHide:!0,videoAttributes:{},startTime:0,seekedStatus:"play",miniprogress:!1,disableSwipeHandler:function(){},enableSwipeHandler:function(){},preProcessUrl:null,ignores:[],whitelist:[],inactive:3e3,lang:Nl(),controls:!0,marginControls:!1,fullscreenTarget:null,screenShot:!1,rotate:!1,pip:!1,download:!1,mini:!1,cssFullscreen:!0,keyShortcut:!0,presets:[],plugins:[],playbackRate:1,definition:{list:[]},playsinline:!0,customDuration:0,timeOffset:0,icons:{},i18n:[],tabindex:0,thumbnail:null,videoConfig:{},isHideTips:!1,minWaitDelay:200,commonStyle:{progressColor:"",playedColor:"",cachedColor:"",sliderBtnStyle:{},volumeColor:""}}}var dc=function(a,i){var t,e,n;i.preset&&i.options?n=new i.preset(i.options,a.config):n=new i({},a.config);var r=n,o=r.plugins,u=o===void 0?[]:o,l=r.ignores,c=l===void 0?[]:l,h=r.icons,f=h===void 0?{}:h,d=r.i18n,v=d===void 0?[]:d;a.config.plugins||(a.config.plugins=[]),a.config.ignores||(a.config.ignores=[]),(t=a.config.plugins).push.apply(t,ot(u)),(e=a.config.ignores).push.apply(e,ot(c)),Object.keys(f).map(function(g){a.config.icons[g]||(a.config.icons[g]=f[g])});var m=a.config.i18n||[];v.push.apply(v,ot(m)),a.config.i18n=v},vc=function(s){ie(i,s);var a=ne(i);function i(){var t;q(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=a.call.apply(a,[this].concat(n)),I(x(t),"onMouseEnter",function(o){var u=x(t),l=u.player,c=u.playerConfig;c.closeControlsBlur&&l.focus({autoHide:!1})}),I(x(t),"onMouseLeave",function(o){var u=x(t),l=u.player;l.focus()}),t}return Q(i,[{key:"beforeCreate",value:function(e){!e.config.mode&&oe.device==="mobile"&&(e.config.mode="flex"),e.player.config.marginControls&&(e.config.autoHide=!1)}},{key:"afterCreate",value:function(){var e=this,n=this.config,r=n.disable,o=n.height,u=n.mode;if(!r){u==="flex"&&this.player.addClass(U.FLEX_CONTROLS);var l={height:"".concat(o,"px")};Object.keys(l).map(function(h){e.root.style[h]=l[h]}),this.left=this.find("xg-left-grid"),this.center=this.find("xg-center-grid"),this.right=this.find("xg-right-grid"),this.innerRoot=this.find("xg-inner-controls"),this.on(mn,function(h){h?p.addClass(e.root,"mini-controls"):p.removeClass(e.root,"mini-controls")});var c=this.playerConfig.isMobileSimulateMode;oe.device!=="mobile"&&c!=="mobile"&&(this.bind("mouseenter",this.onMouseEnter),this.bind("mouseleave",this.onMouseLeave))}}},{key:"focus",value:function(){this.player.focus({autoHide:!1})}},{key:"focusAwhile",value:function(){this.player.focus({autoHide:!0})}},{key:"blur",value:function(){this.player.blur({ignorePaused:!0})}},{key:"recoverAutoHide",value:function(){this.config.autoHide&&p.addClass(this.root,U.CONTROLS_AUTOHIDE)}},{key:"pauseAutoHide",value:function(){p.removeClass(this.root,U.CONTROLS_AUTOHIDE)}},{key:"show",value:function(e){this.root.style.display="",this.player.focus()}},{key:"hide",value:function(){this.root.style.display="none"}},{key:"mode",get:function(){return this.config.mode}},{key:"registerPlugin",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;if(this.root){var o=e.defaultConfig||{};if(!n.root){var u=n.position?n.position:n.config&&n.config.position?n.config.position:o.position;switch(u){case Te.CONTROLS_LEFT:n.root=this.left;break;case Te.CONTROLS_RIGHT:n.root=this.right;break;case Te.CONTROLS_CENTER:n.root=this.center;break;case Te.CONTROLS:n.root=this.root;break;default:n.root=this.left}return ue(se(i.prototype),"registerPlugin",this).call(this,e,n,r)}}}},{key:"destroy",value:function(){oe.device!=="mobile"&&(this.unbind("mouseenter",this.onMouseEnter),this.unbind("mouseleave",this.onMouseLeave))}},{key:"render",value:function(){var e=this.config,n=e.mode,r=e.autoHide,o=e.initShow,u=e.disable;if(!u){var l=p.classNames({"xgplayer-controls":!0},{"flex-controls":n==="flex"},{"bottom-controls":n==="bottom"},I({},U.CONTROLS_AUTOHIDE,r),{"xgplayer-controls-initshow":o||!r});return'<xg-controls class="'.concat(l,`" unselectable="on">
    <xg-inner-controls class="xg-inner-controls xg-pos">
      <xg-left-grid class="xg-left-grid">
      </xg-left-grid>
      <xg-center-grid class="xg-center-grid"></xg-center-grid>
      <xg-right-grid class="xg-right-grid">
      </xg-right-grid>
    </xg-inner-controls>
    </xg-controls>`)}}}],[{key:"pluginName",get:function(){return"controls"}},{key:"defaultConfig",get:function(){return{disable:!1,autoHide:!0,mode:"",initShow:!1}}}]),i}(fe),pc={LANG:"en",TEXT:{ERROR_TYPES:{network:{code:1,msg:"video download error"},mse:{code:2,msg:"stream append error"},parse:{code:3,msg:"parsing error"},format:{code:4,msg:"wrong format"},decoder:{code:5,msg:"decoding error"},runtime:{code:6,msg:"grammatical errors"},timeout:{code:7,msg:"play timeout"},other:{code:8,msg:"other errors"}},HAVE_NOTHING:"There is no information on whether audio/video is ready",HAVE_METADATA:"Audio/video metadata is ready ",HAVE_CURRENT_DATA:"Data about the current play location is available, but there is not enough data to play the next frame/millisecond",HAVE_FUTURE_DATA:"Current and at least one frame of data is available",HAVE_ENOUGH_DATA:"The available data is sufficient to start playing",NETWORK_EMPTY:"Audio/video has not been initialized",NETWORK_IDLE:"Audio/video is active and has been selected for resources, but no network is used",NETWORK_LOADING:"The browser is downloading the data",NETWORK_NO_SOURCE:"No audio/video source was found",MEDIA_ERR_ABORTED:"The fetch process is aborted by the user",MEDIA_ERR_NETWORK:"An error occurred while downloading",MEDIA_ERR_DECODE:"An error occurred while decoding",MEDIA_ERR_SRC_NOT_SUPPORTED:"Audio/video is not supported",REPLAY:"Replay",ERROR:"Network is offline",PLAY_TIPS:"Play",PAUSE_TIPS:"Pause",PLAYNEXT_TIPS:"Play next",DOWNLOAD_TIPS:"Download",ROTATE_TIPS:"Rotate",RELOAD_TIPS:"Reload",FULLSCREEN_TIPS:"Fullscreen",EXITFULLSCREEN_TIPS:"Exit fullscreen",CSSFULLSCREEN_TIPS:"Cssfullscreen",EXITCSSFULLSCREEN_TIPS:"Exit cssfullscreen",TEXTTRACK:"Caption",PIP:"PIP",SCREENSHOT:"Screenshot",LIVE:"LIVE",OFF:"Off",OPEN:"Open",MINI_DRAG:"Click and hold to drag",MINISCREEN:"Miniscreen",REFRESH_TIPS:"Please Try",REFRESH:"Refresh",FORWARD:"forward",LIVE_TIP:"Live"}},et={lang:{},langKeys:[],textKeys:[]};function Ri(s,a){return Object.keys(a).forEach(function(i){var t=p.typeOf(a[i]),e=p.typeOf(s[i]);if(t==="Array"){var n;e!=="Array"&&(s[i]=[]),(n=s[i]).push.apply(n,ot(a[i]))}else t==="Object"?(e!=="Object"&&(s[i]={}),Ri(s[i],a[i])):s[i]=a[i]}),s}function Ya(){Object.keys(et.lang.en).map(function(s){et.textKeys[s]=s})}function gc(s,a){var i=[];if(a||(a=et),!!a.lang){p.typeOf(s)!=="Array"?i=Object.keys(s).map(function(n){var r=n==="zh"?"zh-cn":n;return{LANG:r,TEXT:s[n]}}):i=s;var t=a,e=t.lang;i.map(function(n){n.LANG==="zh"&&(n.LANG="zh-cn"),e[n.LANG]?Ri(e[n.LANG]||{},n.TEXT||{}):qr(n,a)}),Ya()}}function qr(s,a){var i=s.LANG;if(a||(a=et),!!a.lang){var t=s.TEXT||{};i==="zh"&&(i="zh-cn"),a.lang[i]?Ri(a.lang[i],t):(a.langKeys.push(i),a.lang[i]=t),Ya()}}function mc(s){var a,i={lang:{},langKeys:[],textKeys:{},pId:s};return Ri(i.lang,et.lang),(a=i.langKeys).push.apply(a,ot(et.langKeys)),Ri(i.textKeys,et.textKeys),i}qr(pc);var gi={get textKeys(){return et.textKeys},get langKeys(){return et.langKeys},get lang(){var s={};return et.langKeys.map(function(a){s[a]=et.lang[a]}),et.lang["zh-cn"]&&(s.zh=et.lang["zh-cn"]||{}),s},extend:gc,use:qr,init:mc},me={INITIAL:1,READY:2,ATTACHING:3,ATTACHED:4,NOTALLOW:5,RUNNING:6,ENDED:7,DESTROYED:8},ws=["ERROR","INITIAL","READY","ATTACHING","ATTACHED","NOTALLOW","RUNNING","ENDED","DESTROYED"],We={},qn=null,Xa=function(s){ie(i,s);var a=ne(i);function i(){return q(this,i),a.apply(this,arguments)}return Q(i,[{key:"add",value:function(e){e&&(We[e.playerId]=e,Object.keys(We).length===1&&this.setActive(e.playerId,!0))}},{key:"remove",value:function(e){e&&(e.isUserActive,delete We[e.playerId])}},{key:"_iterate",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(var r in We)if(Object.prototype.hasOwnProperty.call(We,r)){var o=We[r];if(n){if(e(o))break}else e(o)}}},{key:"forEach",value:function(e){this._iterate(e)}},{key:"find",value:function(e){var n=null;return this._iterate(function(r){var o=e(r);return o&&(n=r),o},!0),n}},{key:"findAll",value:function(e){var n=[];return this._iterate(function(r){e(r)&&n.push(r)}),n}},{key:"setActive",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(We[e])return n?this.forEach(function(r){e===r.playerId?(r.isUserActive=!0,r.isInstNext=!1):r.isUserActive=!1}):We[e].isUserActive=n,e}},{key:"getActiveId",value:function(){for(var e=Object.keys(We),n=0;n<e.length;n++){var r=We[e[n]];if(r&&r.isUserActive)return e[n]}return null}},{key:"setNext",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(We[e])return n?this.forEach(function(r){e===r.playerId?(r.isUserActive=!1,r.isInstNext=!0):r.isInstNext=!1}):We[e].isInstNext=n,e}}],[{key:"getInstance",value:function(){return qn||(qn=new i),qn}}]),i}(Gr.EventEmitter);function yc(s){for(var a=Object.keys(We),i=0;i<a.length;i++){var t=We[a[i]];if(t.root===s)return t}return null}var _c=["play","pause","replay","retry"],Cs=0,As=0,xt=null,Rn=function(s){ie(i,s);var a=ne(i);function i(t){var e;q(this,i);var n=p.deepMerge(Ts(),t);e=a.call(this,n),I(x(e),"canPlayFunc",function(){if(e.config){var v=e.config,m=v.autoplay,g=v.defaultPlaybackRate;pe.logInfo("player","canPlayFunc, startTime",e.__startTime),e._seekToStartTime(),e.playbackRate=g,(m||e._useAutoplay)&&e.mediaPlay(),e.off(bt,e.canPlayFunc),e.removeClass(U.ENTER)}}),I(x(e),"onFullscreenChange",function(v,m){var g=function(){p.setTimeout(x(e),function(){e.resize()},100)},b=p.getFullScreenEl();e._fullActionFrom?e._fullActionFrom="":e.emit(_n,{eventType:"system",action:"switch_fullscreen",pluginName:"player",currentTime:e.currentTime,duration:e.duration,props:[{prop:"fullscreen",from:!0,to:!1}]});var k=Bl(b,e.playerId,Kt);if(m||b&&(b===e._fullscreenEl||k))g(),!e.config.closeFocusVideoFocus&&e.media.focus(),e.fullscreen=!0,e.changeFullStyle(e.root,b,U.FULLSCREEN),e.emit(_t,!0,e._fullScreenOffset),e.cssfullscreen&&e.exitCssFullscreen();else if(e.fullscreen){g();var E=x(e),w=E._fullScreenOffset,C=E.config;if(C.needFullscreenScroll?(window.scrollTo(w.left,w.top),p.setTimeout(x(e),function(){e.fullscreen=!1,e._fullScreenOffset=null},100)):(!e.config.closeFocusVideoFocus&&e.media.focus(),e.fullscreen=!1,e._fullScreenOffset=null),e.cssfullscreen)e.removeClass(U.FULLSCREEN);else{var B=e._fullscreenEl;!B&&(e.root.contains(v.target)||v.target===e.root)&&(B=v.target),e.recoverFullStyle(e.root,B,U.FULLSCREEN)}e._fullscreenEl=null,e.emit(_t,!1)}}),I(x(e),"_onWebkitbeginfullscreen",function(v){e._fullscreenEl=e.media,e.onFullscreenChange(v,!0)}),I(x(e),"_onWebkitendfullscreen",function(v){e.onFullscreenChange(v,!1)}),Wa(x(e),_c),e.config=n,e._pluginInfoId=p.generateSessionId(),Dl(x(e));var r=e.constructor.defaultPreset;if(e.config.presets.length){var o=e.config.presets.indexOf("default");o>=0&&r&&(e.config.presets[o]=r)}else r&&e.config.presets.push(r);e.userTimer=null,e.waitTimer=null,e.handleSource=!0,e._state=me.INITIAL,e.isAd=!1,e.isError=!1,e._hasStart=!1,e.isSeeking=!1,e.isCanplay=!1,e._useAutoplay=!1,e.__startTime=-1,e.rotateDeg=0,e.isActive=!1,e.fullscreen=!1,e.cssfullscreen=!1,e.isRotateFullscreen=!1,e._fullscreenEl=null,e.timeSegments=[],e._cssfullscreenEl=null,e.curDefinition=null,e._orgCss="",e._fullScreenOffset=null,e._videoHeight=0,e._videoWidth=0,e.videoPos={pi:1,scale:0,rotate:-1,x:0,y:0,h:-1,w:-1,vy:0,vx:0},e.sizeInfo={width:0,height:0,left:0,top:0},e._accPlayed={t:0,acc:0,loopAcc:0},e._offsetInfo={currentTime:-1,duration:0},e.innerContainer=null,e.controls=null,e.topBar=null,e.root=null,e.__i18n=gi.init(e._pluginInfoId),oe.os.isAndroid&&oe.osVersion>0&&oe.osVersion<6&&(e.config.autoplay=!1),e.database=new Ql,e.isUserActive=!1,e._onceSeekCanplay=null,e._isPauseBeforeSeek=0,e.innerStates={isActiveLocked:!1},e.instManager=xt;var u=e._initDOM();if(!u)return console.error(new Error("can't find the dom which id is ".concat(e.config.id," or this.config.el does not exist"))),$r(e);var l=e.config,c=l.definition,h=c===void 0?{}:c,f=l.url;if(!f&&h.list&&h.list.length>0){var d=h.list.find(function(v){return v.definition&&v.definition===h.defaultDefinition});d||(h.defaultDefinition=h.list[0].definition,d=h.list[0]),e.config.url=d.url,e.curDefinition=d}return e._bindEvents(),e._registerPresets(),e._registerPlugins(),Ne.onPluginsReady(x(e)),e.getInitDefinition(),e.setState(me.READY),p.setTimeout(x(e),function(){e.emit(Kr)},0),e.onReady&&e.onReady(),(e.config.videoInit||e.config.autoplay)&&(!e.hasStart||e.state<me.ATTACHED)&&e.start(),e}return Q(i,[{key:"_initDOM",value:function(){var e,n=this;if(this.root=this.config.id?document.getElementById(this.config.id):null,!this.root){var r=this.config.el;if(r&&r.nodeType===1)this.root=r;else return this.emit(Ti,new Di("use",this.config.vid,{line:32,handle:"Constructor",msg:"container id can't be empty"})),console.error("this.confg.id or this.config.el can't be empty"),!1}var o=yc(this.root);o&&(pe.logWarn("The is an Player instance already exists in this.root, destroy it and reinitialize"),o.destroy()),this.root.setAttribute(Kt,this.playerId),(e=xt)===null||e===void 0||e.add(this),Ne.init(this),this._initBaseDoms();var u=this.constructor.XgVideoProxy;if(u&&this.mediaConfig.mediaType===u.mediaType){var l=this.innerContainer||this.root;this.detachVideoEvents(this.media);var c=new u(l,this.config,this.mediaConfig);this.attachVideoEvents(c),this.media=c}if(this.media.setAttribute(Kt,this.playerId),this.config.controls){var h=this.config.controls.root||null,f=Ne.register(this,vc,{root:h});this.controls=f}var d=this.config.isMobileSimulateMode==="mobile"?"mobile":oe.device;if(this.addClass("".concat(U.DEFAULT," ").concat(U.INACTIVE," xgplayer-").concat(d," ").concat(this.config.controls?"":U.NO_CONTROLS)),this.config.autoplay?this.addClass(U.ENTER):this.addClass(U.NO_START),this.config.fluid){var v=this.config,m=v.width,g=v.height;(typeof m!="number"||typeof g!="number")&&(m=600,g=337.5);var b={width:"100%",height:"0","max-width":"100%","padding-top":"".concat(g*100/m,"%")};Object.keys(b).forEach(function(L){n.root.style[L]=b[L]})}else["width","height"].forEach(function(L){n.config[L]&&(typeof n.config[L]!="number"?n.root.style[L]=n.config[L]:n.root.style[L]="".concat(n.config[L],"px"))});var k=this.root.getBoundingClientRect(),E=k.width,w=k.height,C=k.left,B=k.top;return this.sizeInfo.width=E,this.sizeInfo.height=w,this.sizeInfo.left=C,this.sizeInfo.top=B,!0}},{key:"_initBaseDoms",value:function(){this.topBar=null,this.leftBar=null,this.rightBar=null,this.config.marginControls&&(this.innerContainer=p.createDom("xg-video-container","",{"data-index":-1},"xg-video-container"),this.root.appendChild(this.innerContainer))}},{key:"_bindEvents",value:function(){var e=this;["focus","blur"].forEach(function(n){e.on(n,e["on"+n.charAt(0).toUpperCase()+n.slice(1)])}),gs.forEach(function(n){document&&document.addEventListener(n,e.onFullscreenChange)}),oe.os.isIos&&(this.media.addEventListener("webkitbeginfullscreen",this._onWebkitbeginfullscreen),this.media.addEventListener("webkitendfullscreen",this._onWebkitendfullscreen)),this.once(vt,this.resize),this.playFunc=function(){e.config.closeFocusVideoFocus||e.media.focus()},this.once(je,this.playFunc)}},{key:"_unbindEvents",value:function(){var e=this;this.root.removeEventListener("mousemove",this.mousemoveFunc),gs.forEach(function(n){document.removeEventListener(n,e.onFullscreenChange)}),this.playFunc&&this.off(je,this.playFunc),this.off(bt,this.canPlayFunc),this.media.removeEventListener("webkitbeginfullscreen",this._onWebkitbeginfullscreen),this.media.removeEventListener("webkitendfullscreen",this._onWebkitendfullscreen)}},{key:"_clearUserTimer",value:function(){this.userTimer&&(p.clearTimeout(this,this.userTimer),this.userTimer=null)}},{key:"_startInit",value:function(e){var n=this;if(this.media&&!((!e||e===""||p.typeOf(e)==="Array"&&e.length===0)&&(e="",this.emit(Da),pe.logWarn("config.url is null, please get url and run player._startInit(url)"),this.config.nullUrlStart))){this.handleSource&&(this._detachSourceEvents(this.media),p.typeOf(e)==="Array"&&e.length>0?this._attachSourceEvents(this.media,e):!this.media.src||this.media.src!==e?this.media.src=e:e||this.media.removeAttribute("src")),p.typeOf(this.config.volume)==="Number"&&(this.volume=this.config.volume);var r=this.innerContainer?this.innerContainer:this.root;this.media instanceof window.Element&&!r.contains(this.media)&&r.insertBefore(this.media,r.firstChild);var o=this.media.readyState;pe.logInfo("_startInit readyState",o),this.config.autoplay&&(!p.isMSE(this.media)&&this.load(),(oe.os.isIpad||oe.os.isPhone)&&this.mediaPlay());var u=this.config.startTime;this.__startTime=u>0?u:-1,this.config.startTime=0,o>=2&&this.duration>0?this.canPlayFunc():this.on(bt,this.canPlayFunc),(!this.hasStart||this.state<me.ATTACHED)&&Ne.afterInit(this),this.hasStart=!0,this.setState(me.ATTACHED),p.setTimeout(this,function(){n.emit(Dn)},0)}}},{key:"_registerPlugins",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._loadingPlugins=[];var r=this.config.ignores||[],o=this.config.plugins||[],u=this.config.i18n||[];n&&gi.extend(u,this.__i18n);var l=r.join("||").toLowerCase().split("||"),c=this.plugins;o.forEach(function(h){try{var f=h.plugin?h.plugin.pluginName:h.pluginName;if(f&&l.indexOf(f.toLowerCase())>-1)return null;if(!n&&c[f.toLowerCase()])return;if(h.lazy&&h.loader){var d=Ne.lazyRegister(e,h);h.forceBeforeInit&&(d.then(function(){e._loadingPlugins.splice(e._loadingPlugins.indexOf(d),1)}).catch(function(v){pe.logError("_registerPlugins:loadingPlugin",v),e._loadingPlugins.splice(e._loadingPlugins.indexOf(d),1)}),e._loadingPlugins.push(d));return}return e.registerPlugin(h)}catch(v){pe.logError("_registerPlugins:",v)}})}},{key:"_registerPresets",value:function(){var e=this;this.config.presets.forEach(function(n){dc(e,n)})}},{key:"_getRootByPosition",value:function(e){var n=null;switch(e){case Te.ROOT_RIGHT:this.rightBar||(this.rightBar=p.createPositionBar("xg-right-bar",this.root)),n=this.rightBar;break;case Te.ROOT_LEFT:this.leftBar||(this.leftBar=p.createPositionBar("xg-left-bar",this.root)),n=this.leftBar;break;case Te.ROOT_TOP:this.topBar||(this.topBar=p.createPositionBar("xg-top-bar",this.root),this.config.topBarAutoHide&&p.addClass(this.topBar,U.TOP_BAR_AUTOHIDE)),n=this.topBar;break;default:n=this.innerContainer||this.root;break}return n}},{key:"registerPlugin",value:function(e,n){var r=Ne.formatPluginInfo(e,n),o=r.PLUFGIN,u=r.options,l=this.config.plugins,c=Ne.checkPluginIfExits(o.pluginName,l);!c&&l.push(o);var h=Ne.getRootByConfig(o.pluginName,this.config);h.root&&(u.root=h.root),h.position&&(u.position=h.position);var f=u.position?u.position:u.config&&u.config.position||o.defaultConfig&&o.defaultConfig.position;if(!u.root&&typeof f=="string"&&f.indexOf("controls")>-1){var d;return(d=this.controls)===null||d===void 0?void 0:d.registerPlugin(o,u,o.pluginName)}return u.root||(u.root=this._getRootByPosition(f)),Ne.register(this,o,u)}},{key:"deregister",value:function(e){typeof e=="string"?Ne.unRegister(this,e):e instanceof gt&&Ne.unRegister(this,e.pluginName)}},{key:"unRegisterPlugin",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;this.deregister(e),n&&this.removePluginFromConfig(e)}},{key:"removePluginFromConfig",value:function(e){var n;if(typeof e=="string"?n=e:e instanceof gt&&(n=e.pluginName),!!n)for(var r=this.config.plugins.length-1;r>-1;r--){var o=this.config.plugins[r];if(o.pluginName.toLowerCase()===n.toLowerCase()){this.config.plugins.splice(r,1);break}}}},{key:"plugins",get:function(){return Ne.getPlugins(this)}},{key:"getPlugin",value:function(e){var n=Ne.findPlugin(this,e);return n&&n.pluginName?n:null}},{key:"addClass",value:function(e){this.root&&(p.hasClass(this.root,e)||p.addClass(this.root,e))}},{key:"removeClass",value:function(e){this.root&&p.removeClass(this.root,e)}},{key:"hasClass",value:function(e){if(this.root)return p.hasClass(this.root,e)}},{key:"setAttribute",value:function(e,n){this.root&&this.root.setAttribute(e,n)}},{key:"removeAttribute",value:function(e,n){this.root&&this.root.removeAttribute(e,n)}},{key:"start",value:function(e){var n=this;if(!(this.state>me.ATTACHING))return!e&&!this.config.url&&this.getInitDefinition(),this.hasStart=!0,this.setState(me.ATTACHING),this._registerPlugins(!1),Ne.beforeInit(this).then(function(){if(n.config){e||(e=n.url||n.config.url);var r=n._preProcessUrl(e),o=n._startInit(r.url);return o}}).catch(function(r){throw r.fileName="player",r.lineNumber="236",pe.logError("start:beforeInit:",r),r})}},{key:"switchURL",value:function(e,n){var r=this,o=e;p.typeOf(e)==="Object"&&(o=e.url),o=this._preProcessUrl(o).url;var u=this.currentTime;this.__startTime=u;var l=this.paused&&!this.isError;return this.src=o,new Promise(function(c,h){var f=function(m){r.off("timeupdate",d),r.off("canplay",d),h(m)},d=function(){r._seekToStartTime(),l&&r.pause(),r.off("error",f),c(!0)};if(r.once("error",f),!o){r.errorHandler("error",{code:6,message:"empty_src"});return}oe.os.isAndroid?r.once("timeupdate",d):r.once("canplay",d),r.play()})}},{key:"videoPlay",value:function(){this.mediaPlay()}},{key:"mediaPlay",value:function(){var e=this;if(!this.hasStart&&this.state<me.ATTACHED){this.removeClass(U.NO_START),this.addClass(U.ENTER),this.start(),this._useAutoplay=!0;return}this.state<me.RUNNING&&(this.removeClass(U.NO_START),!this.isCanplay&&this.addClass(U.ENTER));var n=ue(se(i.prototype),"play",this).call(this);return n!==void 0&&n&&n.then?n.then(function(){e.removeClass(U.NOT_ALLOW_AUTOPLAY),e.addClass(U.PLAYING),e.state<me.RUNNING&&(pe.logInfo(">>>>playPromise.then"),e.setState(me.RUNNING),e.emit(Qt))}).catch(function(r){if(pe.logWarn(">>>>playPromise.catch",r.name),e.media&&e.media.error){e.onError(),e.removeClass(U.ENTER);return}r.name==="NotAllowedError"&&(e._errorTimer=p.setTimeout(e,function(){e._errorTimer=null,e.emit(Yr),e.addClass(U.NOT_ALLOW_AUTOPLAY),e.removeClass(U.ENTER),e.pause(),e.setState(me.NOTALLOW)},0))}):(pe.logWarn("video.play not return promise"),this.state<me.RUNNING&&(this.setState(me.RUNNING),this.removeClass(U.NOT_ALLOW_AUTOPLAY),this.removeClass(U.NO_START),this.removeClass(U.ENTER),this.addClass(U.PLAYING),this.emit(Qt))),n}},{key:"mediaPause",value:function(){ue(se(i.prototype),"pause",this).call(this)}},{key:"videoPause",value:function(){ue(se(i.prototype),"pause",this).call(this)}},{key:"play",value:function(){var e=this;return this.removeClass(U.PAUSED),ht(this,"play",function(){return e.mediaPlay()})}},{key:"pause",value:function(){var e=this;ht(this,"pause",function(){ue(se(i.prototype),"pause",e).call(e)})}},{key:"seek",value:function(e,n){var r=this;if(!(!this.media||Number.isNaN(Number(e))||!this.hasStart)){var o=this.config,u=o.isSeekedPlay,l=o.seekedStatus,c=n||(u?"play":l);e=e<0?0:e>this.duration?parseInt(this.duration,10):e,!this._isPauseBeforeSeek&&(this._isPauseBeforeSeek=this.paused?2:1),this._onceSeekCanplay&&this.off(kt,this._onceSeekCanplay),this._onceSeekCanplay=function(){switch(r.removeClass(U.ENTER),r.isSeeking=!1,c){case"play":r.play();break;case"pause":r.pause();break;default:r._isPauseBeforeSeek>1||r.paused?r.pause():r.play()}r._isPauseBeforeSeek=0,r._onceSeekCanplay=null},this.once(kt,this._onceSeekCanplay),this.state<me.RUNNING?(this.removeClass(U.NO_START),this.currentTime=e,this.play()):this.currentTime=e}}},{key:"getInitDefinition",value:function(){var e=this,n=this.config,r=n.definition,o=n.url;!o&&r&&r.list&&r.list.length>0&&r.defaultDefinition&&r.list.map(function(u){u.definition===r.defaultDefinition&&(e.config.url=u.url,e.curDefinition=u)})}},{key:"changeDefinition",value:function(e,n){var r=this,o=this.config.definition;if(Array.isArray(o==null?void 0:o.list)&&o.list.forEach(function(l){(e==null?void 0:e.definition)===l.definition&&(r.curDefinition=l)}),e!=null&&e.bitrate&&typeof e.bitrate!="number"&&(e.bitrate=parseInt(e.bitrate,10)||0),this.emit(Xr,{from:n,to:e}),!this.hasStart){this.config.url=e.url;return}var u=this.switchURL(e.url,Le({seamless:o.seamless!==!1&&typeof MediaSource<"u"&&typeof MediaSource.isTypeSupported=="function"},e));u&&u.then?u.then(function(){r.emit(Oi,{from:n,to:e})}):this.emit(Oi,{from:n,to:e})}},{key:"reload",value:function(){this.load(),this.reloadFunc=function(){this.play()},this.once(vt,this.reloadFunc)}},{key:"resetState",value:function(){var e=this,n=U.NOT_ALLOW_AUTOPLAY,r=U.PLAYING,o=U.NO_START,u=U.PAUSED,l=U.REPLAY,c=U.ENTER,h=U.ENDED,f=U.ERROR,d=U.LOADING,v=[n,r,o,u,l,c,h,f,d];this.hasStart=!1,this.isError=!1,this._useAutoplay=!1,this.mediaPause(),this._accPlayed.acc=0,this._accPlayed.t=0,this._accPlayed.loopAcc=0,v.forEach(function(m){e.removeClass(m)}),this.addClass(U.NO_START),this.emit(On)}},{key:"reset",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=arguments.length>1?arguments[1]:void 0;this.resetState();var o=this.plugins;if(o&&(n.map(function(l){e.deregister(l)}),r)){var u=Ts();Object.keys(this.config).keys(function(l){e.config[l]!=="undefined"&&(l==="plugins"||l==="presets"||l==="el"||l==="id")&&(e.config[l]=u[l])})}}},{key:"destroy",value:function(){var e,n=this,r=this.innerContainer,o=this.root,u=this.media;if(!(!o||!u)){if(this.hasStart=!1,this._useAutoplay=!1,o.removeAttribute(Kt),this.updateAcc("destroy"),this._unbindEvents(),this._detachSourceEvents(this.media),p.clearAllTimers(this),this.emit(In),(e=xt)===null||e===void 0||e.remove(this),Ne.destroy(this),Ka(this),ue(se(i.prototype),"destroy",this).call(this),this.fullscreen&&this._fullscreenEl===this.root&&this.exitFullscreen(),r)for(var l=r.children,c=0;c<l.length;c++)r.removeChild(l[c]);!r&&u instanceof window.Node&&o.contains(u)&&o.removeChild(u),["topBar","leftBar","rightBar","innerContainer"].map(function(f){n[f]&&o.removeChild(n[f]),n[f]=null});var h=o.className.split(" ");h.length>0?o.className=h.filter(function(f){return f.indexOf("xgplayer")<0}).join(" "):o.className="",this.removeAttribute("data-xgfill"),["isSeeking","isCanplay","isActive","cssfullscreen","fullscreen"].forEach(function(f){n[f]=!1})}}},{key:"replay",value:function(){var e=this;this.removeClass(U.ENDED),this.currentTime=0,this.isSeeking=!1,ht(this,"replay",function(){e.once(kt,function(){var n=e.mediaPlay();n&&n.catch&&n.catch(function(r){console.log(r)})}),e.emit(pn),e.onPlay()})}},{key:"retry",value:function(){var e=this;this.removeClass(U.ERROR),this.addClass(U.LOADING),ht(this,"retry",function(){var n=e.currentTime,r=e.config.url,o=p.isMSE(e.media)?{url:r}:e._preProcessUrl(r);e.src=o.url,!e.config.isLive&&(e.currentTime=n),e.once(bt,function(){e.mediaPlay()})})}},{key:"changeFullStyle",value:function(e,n,r,o){e&&(o||(o=U.PARENT_FULLSCREEN),this._orgCss||(this._orgCss=p.filterStyleFromText(e)),p.addClass(e,r),n&&n!==e&&!this._orgPCss&&(this._orgPCss=p.filterStyleFromText(n),p.addClass(n,o),n.setAttribute(Kt,this.playerId)))}},{key:"recoverFullStyle",value:function(e,n,r,o){o||(o=U.PARENT_FULLSCREEN),this._orgCss&&(p.setStyleFromCsstext(e,this._orgCss),this._orgCss=""),p.removeClass(e,r),n&&n!==e&&this._orgPCss&&(p.setStyleFromCsstext(n,this._orgPCss),this._orgPCss="",p.removeClass(n,o),n.removeAttribute(Kt))}},{key:"getFullscreen",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.config.fullscreenTarget,n=this.root,r=this.media;(e==="video"||e==="media")&&(e=this[e]),e||(e=n),this._fullScreenOffset={top:p.scrollTop(),left:p.scrollLeft()},this._fullscreenEl=e,this._fullActionFrom="get";var o=p.getFullScreenEl();if(o===this._fullscreenEl)return this.onFullscreenChange(),Promise.resolve();try{for(var u=0;u<ms.length;u++){var l=ms[u];if(e[l]){var c=l==="webkitRequestFullscreen"?e.webkitRequestFullscreen(window.Element.ALLOW_KEYBOARD_INPUT):e[l]();return c&&c.then?c:Promise.resolve()}}return r.fullscreenEnabled||r.webkitSupportsFullscreen?(r.webkitEnterFullscreen(),Promise.resolve()):Promise.reject(new Error("call getFullscreen fail"))}catch{return Promise.reject(new Error("call getFullscreen fail"))}}},{key:"exitFullscreen",value:function(e){if(this.isRotateFullscreen&&this.exitRotateFullscreen(),!(!this._fullscreenEl&&!p.getFullScreenEl())){this.root;var n=this.media;this._fullActionFrom="exit";try{for(var r=0;r<ys.length;r++){var o=ys[r];if(document[o]){var u=document[o]();return u&&u.then?u:Promise.resolve()}}return n&&n.webkitSupportsFullscreen?(n.webkitExitFullScreen(),Promise.resolve()):Promise.reject(new Error("call exitFullscreen fail"))}catch{return Promise.reject(new Error("call exitFullscreen fail"))}}}},{key:"getCssFullscreen",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.config.fullscreenTarget;this.isRotateFullscreen?this.exitRotateFullscreen():this.fullscreen&&this.exitFullscreen();var n=e?"".concat(U.INNER_FULLSCREEN," ").concat(U.CSS_FULLSCREEN):U.CSS_FULLSCREEN;this.changeFullStyle(this.root,e,n);var r=this.config.fullscreen,o=r===void 0?{}:r,u=o.useCssFullscreen===!0||typeof o.useCssFullscreen=="function"&&o.useCssFullscreen();u&&(this.fullscreen=!0,this.emit(_t,!0)),this._cssfullscreenEl=e,this.cssfullscreen=!0,this.emit(gn,!0)}},{key:"exitCssFullscreen",value:function(){var e=this._cssfullscreenEl?"".concat(U.INNER_FULLSCREEN," ").concat(U.CSS_FULLSCREEN):U.CSS_FULLSCREEN;if(!this.fullscreen)this.recoverFullStyle(this.root,this._cssfullscreenEl,e);else{var n=this.config.fullscreen,r=n===void 0?{}:n,o=r.useCssFullscreen===!0||typeof r.useCssFullscreen=="function"&&r.useCssFullscreen();o?(this.recoverFullStyle(this.root,this._cssfullscreenEl,e),this.fullscreen=!1,this.emit(_t,!1)):this.removeClass(e)}this._cssfullscreenEl=null,this.cssfullscreen=!1,this.emit(gn,!1)}},{key:"getRotateFullscreen",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.config.fullscreenTarget;this.cssfullscreen&&this.exitCssFullscreen(e);var n=e?"".concat(U.INNER_FULLSCREEN," ").concat(U.ROTATE_FULLSCREEN):U.ROTATE_FULLSCREEN;this._fullscreenEl=e||this.root,this.changeFullStyle(this.root,e,n,U.PARENT_ROTATE_FULLSCREEN),this.isRotateFullscreen=!0,this.fullscreen=!0,this.setRotateDeg(90),this._rootStyle=this.root.getAttribute("style"),this.root.style.width="".concat(window.innerHeight,"px"),this.emit(_t,!0)}},{key:"exitRotateFullscreen",value:function(e){var n=this._fullscreenEl!==this.root?"".concat(U.INNER_FULLSCREEN," ").concat(U.ROTATE_FULLSCREEN):U.ROTATE_FULLSCREEN;this.recoverFullStyle(this.root,this._fullscreenEl,n,U.PARENT_ROTATE_FULLSCREEN),this.isRotateFullscreen=!1,this.fullscreen=!1,this.setRotateDeg(0),this.emit(_t,!1),this._rootStyle&&(this.root.style.style=this._rootStyle,this._rootStyle=!1)}},{key:"setRotateDeg",value:function(e){window.orientation===90||window.orientation===-90?this.rotateDeg=0:this.rotateDeg=e}},{key:"focus",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{autoHide:!this.config.closeDelayBlur,delay:this.config.inactive};if(this.isActive){this.onFocus(e);return}this.emit(Wr,Le({paused:this.paused,ended:this.ended},e))}},{key:"blur",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{ignorePaused:!1};if(!this.isActive){this.onBlur(e);return}this._clearUserTimer(),this.emit(La,Le({paused:this.paused,ended:this.ended},e))}},{key:"onFocus",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{autoHide:!0,delay:3e3},r=this.innerStates;if(this.isActive=!0,this.removeClass(U.INACTIVE),this._clearUserTimer(),n.isLock!==void 0&&(r.isActiveLocked=n.isLock),n.autoHide===!1||n.isLock===!0||r.isActiveLocked){this._clearUserTimer();return}var o=n&&n.delay?n.delay:this.config.inactive;this.userTimer=p.setTimeout(this,function(){e.userTimer=null,e.blur()},o)}},{key:"onBlur",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.ignorePaused,r=n===void 0?!1:n;if(!this.innerStates.isActiveLocked){var o=this.config.closePauseVideoFocus;this.isActive=!1,(r||o||!this.paused&&!this.ended)&&this.addClass(U.INACTIVE)}}},{key:"onEmptied",value:function(){this.updateAcc("emptied")}},{key:"onCanplay",value:function(){this.removeClass(U.ENTER),this.removeClass(U.ERROR),this.removeClass(U.LOADING),this.isCanplay=!0,this.waitTimer&&p.clearTimeout(this,this.waitTimer)}},{key:"onLoadeddata",value:function(){var e=this;this.isError=!1,this.isSeeking=!1,this.__startTime>0&&(this.duration>0?this._seekToStartTime():this.once(Pt,function(){e._seekToStartTime()}))}},{key:"onLoadstart",value:function(){this.removeClass(U.ERROR),this.isCanplay=!1}},{key:"onPlay",value:function(){this.state===me.ENDED&&this.setState(me.RUNNING),this.removeClass(U.PAUSED),this.ended&&this.removeClass(U.ENDED),!this.config.closePlayVideoFocus&&this.focus()}},{key:"onPause",value:function(){this.addClass(U.PAUSED),this.updateAcc("pause"),this.config.closePauseVideoFocus||(this._clearUserTimer(),this.focus())}},{key:"onEnded",value:function(){this.updateAcc("ended"),this.addClass(U.ENDED),this.setState(me.ENDED)}},{key:"onError",value:function(){this.isError=!0,this.updateAcc("error"),this.removeClass(U.NOT_ALLOW_AUTOPLAY),this.removeClass(U.NO_START),this.removeClass(U.ENTER),this.removeClass(U.LOADING),this.addClass(U.ERROR)}},{key:"onSeeking",value:function(){this.isSeeking||this.updateAcc("seeking"),this.isSeeking=!0,this.addClass(U.SEEKING)}},{key:"onSeeked",value:function(){this.isSeeking=!1,this.waitTimer&&p.clearTimeout(this,this.waitTimer),this.removeClass(U.LOADING),this.removeClass(U.SEEKING)}},{key:"onWaiting",value:function(){var e=this;this.waitTimer&&p.clearTimeout(this,this.waitTimer),this.updateAcc("waiting"),this.waitTimer=p.setTimeout(this,function(){e.addClass(U.LOADING),e.emit(Ra),p.clearTimeout(e,e.waitTimer),e.waitTimer=null},this.config.minWaitDelay)}},{key:"onPlaying",value:function(){var e=this;this.isError=!1;var n=U.NO_START,r=U.PAUSED,o=U.ENDED,u=U.ERROR,l=U.REPLAY,c=U.LOADING,h=[n,r,o,u,l,c];h.forEach(function(f){e.removeClass(f)}),!this._accPlayed.t&&!this.paused&&!this.ended&&(this._accPlayed.t=new Date().getTime())}},{key:"onTimeupdate",value:function(){!this._videoHeight&&this.media.videoHeight&&this.resize(),(this.waitTimer||this.hasClass(U.LOADING))&&this.media.readyState>2&&(this.removeClass(U.LOADING),p.clearTimeout(this,this.waitTimer),this.waitTimer=null),!this.paused&&this.state===me.NOTALLOW&&this.duration&&(this.setState(me.RUNNING),this.emit(Qt)),!this._accPlayed.t&&!this.paused&&!this.ended&&(this._accPlayed.t=new Date().getTime())}},{key:"onVolumechange",value:function(){p.typeOf(this.config.volume)==="Number"&&(this.config.volume=this.volume)}},{key:"onRatechange",value:function(){this.config.defaultPlaybackRate=this.playbackRate}},{key:"emitUserAction",value:function(e,n,r){if(!(!this.media||!n||!e)){var o=p.typeOf(e)==="String"?e:e.type||"";r.props&&p.typeOf(r.props)!=="Array"&&(r.props=[r.props]),this.emit(_n,Le({eventType:o,action:n,currentTime:this.currentTime,duration:this.duration,ended:this.ended,event:e},r))}}},{key:"updateAcc",value:function(e){if(this._accPlayed.t){var n=new Date().getTime()-this._accPlayed.t;this._accPlayed.acc+=n,this._accPlayed.t=0,(e==="ended"||this.ended)&&(this._accPlayed.loopAcc=this._accPlayed.acc)}}},{key:"checkBuffer",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{startDiff:0,endDiff:0},r=n||{},o=r.startDiff,u=o===void 0?0:o,l=r.endDiff,c=l===void 0?0:l,h=this.media.buffered;if(!h||h.length===0||!this.duration)return!0;for(var f=e||this.media.currentTime||.2,d=h.length,v=0;v<d;v++)if(h.start(v)+u<=f&&h.end(v)-c>f)return!0;return!1}},{key:"resizePosition",value:function(){var e=this.videoPos,n=e.vy,r=e.vx,o=e.h,u=e.w,l=this.videoPos.rotate;if(!(l<0&&o<0&&u<0)){var c=this.videoPos._pi;if(!c&&this.media.videoHeight&&(c=this.media.videoWidth/this.media.videoHeight*100),!!c){this.videoPos.pi=c,l=l<0?0:l;var h={rotate:l},f=0,d=0,v=1,m=Math.abs(l/90),g=this.root,b=this.innerContainer,k=g.offsetWidth,E=b?b.offsetHeight:g.offsetHeight,w=E,C=k;if(m%2===0)v=o>0?100/o:u>0?100/u:1,h.scale=v,f=n>0?(100-o)/2-n:0,h.y=m===2?0-f:f,d=r>0?(100-u)/2-r:0,h.x=m===2?0-d:d,this.media.style.width="".concat(C,"px"),this.media.style.height="".concat(w,"px");else if(m%2===1){C=E,w=k;var B=E-k;d=-B/2/C*100,h.x=m===3?d+n/2:d-n/2,f=B/2/w*100,h.y=m===3?f+r/2:f-r/2,h.scale=v,this.media.style.width="".concat(C,"px"),this.media.style.height="".concat(w,"px")}var L=p.getTransformStyle(h,this.media.style.transform||this.media.style.webkitTransform);this.media.style.transform=L,this.media.style.webkitTransform=L}}}},{key:"position",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{h:0,y:0,x:0,w:0};if(!(!this.media||!e||!e.h)){var n=this.videoPos;n.h=e.h*100||0,n.w=e.w*100||0,n.vx=e.x*100||0,n.vy=e.y*100||0,this.resizePosition()}}},{key:"setConfig",value:function(e){var n=this;e&&Object.keys(e).map(function(r){if(r!=="plugins"){n.config[r]=e[r];var o=n.plugins[r.toLowerCase()];o&&p.typeOf(o.setConfig)==="Function"&&o.setConfig(e[r])}})}},{key:"playNext",value:function(e){var n=this;this.resetState(),this.setConfig(e),this._currentTime=0,this._duration=0,ht(this,"playnext",function(){n.start(),n.emit(yn,e)})}},{key:"resize",value:function(){var e=this;if(this.media){var n=this.root.getBoundingClientRect();this.sizeInfo.width=n.width,this.sizeInfo.height=n.height,this.sizeInfo.left=n.left,this.sizeInfo.top=n.top;var r=this.media,o=r.videoWidth,u=r.videoHeight,l=this.config,c=l.fitVideoSize,h=l.videoFillMode;if((h==="fill"||h==="cover"||h==="contain")&&this.setAttribute("data-xgfill",h),!(!u||!o)){this._videoHeight=u,this._videoWidth=o;var f=this.controls&&this.innerContainer?this.controls.root.getBoundingClientRect().height:0,d=n.width,v=n.height-f,m=parseInt(o/u*1e3,10),g=parseInt(d/v*1e3,10),b=d,k=v,E={};c==="auto"&&g>m||c==="fixWidth"?(k=d/m*1e3,this.config.fluid?E.paddingTop="".concat(k*100/b,"%"):E.height="".concat(k+f,"px")):(c==="auto"&&g<m||c==="fixHeight")&&(b=m*v/1e3,E.width="".concat(b,"px")),!this.fullscreen&&!this.cssfullscreen&&Object.keys(E).forEach(function(C){e.root.style[C]=E[C]}),(h==="fillHeight"&&g<m||h==="fillWidth"&&g>m)&&this.setAttribute("data-xgfill","cover");var w={videoScale:m,vWidth:b,vHeight:k,cWidth:b,cHeight:k+f};this.resizePosition(),this.emit(pt,w)}}}},{key:"updateObjectPosition",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(this.media.updateObjectPosition){this.media.updateObjectPosition(e,n);return}this.media.style.objectPosition="".concat(e*100,"% ").concat(n*100,"%")}},{key:"setState",value:function(e){pe.logInfo("setState","state from:".concat(ws[this.state]," to:").concat(ws[e])),this._state=e}},{key:"_preProcessUrl",value:function(e,n){var r=this.config,o=r.preProcessUrl,u=r.preProcessUrlOptions,l=Object.assign({},u,n);return!p.isBlob(e)&&typeof o=="function"?o(e,l):{url:e}}},{key:"_seekToStartTime",value:function(){this.__startTime>0&&this.duration>0&&(this.currentTime=this.__startTime>this.duration?this.duration:this.__startTime,this.__startTime=-1)}},{key:"state",get:function(){return this._state}},{key:"isFullscreen",get:function(){return this.fullscreen}},{key:"isCssfullScreen",get:function(){return this.cssfullscreen}},{key:"hasStart",get:function(){return this._hasStart},set:function(e){typeof e=="boolean"&&(this._hasStart=e,e===!1&&this.setState(me.READY),this.emit("hasstart"))}},{key:"isPlaying",get:function(){return this._state===me.RUNNING||this._state===me.ENDED},set:function(e){e?this.setState(me.RUNNING):this._state>=me.RUNNING&&this.setState(me.ATTACHED)}},{key:"definitionList",get:function(){return!this.config||!this.config.definition?[]:this.config.definition.list||[]},set:function(e){var n=this,r=this.config.definition,o=null,u=null;r.list=e,this.emit("resourceReady",e),e.forEach(function(l){var c;((c=n.curDefinition)===null||c===void 0?void 0:c.definition)===l.definition&&(o=l),r.defaultDefinition===l.definition&&(u=l)}),!u&&e.length>0&&(u=e[0]),o?this.changeDefinition(o):u&&this.changeDefinition(u)}},{key:"videoFrameInfo",get:function(){var e={total:0,dropped:0,corrupted:0,droppedRate:0,droppedDuration:0};if(!this.media||!this.media.getVideoPlaybackQuality)return e;var n=this.media.getVideoPlaybackQuality();return e.dropped=n.droppedVideoFrames||0,e.total=n.totalVideoFrames||0,e.corrupted=n.corruptedVideoFrames||0,e.total>0&&(e.droppedRate=e.dropped/e.total*100,e.droppedDuration=parseInt(this.cumulateTime/e.total*e.dropped,0)),e}},{key:"lang",get:function(){return this.config.lang},set:function(e){var n=gi.langKeys.filter(function(r){return r===e});if(n.length===0&&e!=="zh"){console.error("Sorry, set lang fail, because the language [".concat(e,"] is not supported now, list of all supported languages is [").concat(gi.langKeys.join(),"] "));return}this.config.lang=e,Ne.setLang(e,this)}},{key:"i18n",get:function(){var e=this.config.lang;return e==="zh"&&(e="zh-cn"),this.__i18n.lang[e]||this.__i18n.lang.en}},{key:"i18nKeys",get:function(){return this.__i18n.textKeys||{}}},{key:"version",get:function(){return Sr}},{key:"playerId",get:function(){return this._pluginInfoId}},{key:"url",get:function(){return this.__url||this.config.url},set:function(e){this.__url=e}},{key:"poster",get:function(){return this.plugins.poster?this.plugins.poster.config.poster:this.config.poster},set:function(e){this.plugins.poster&&this.plugins.poster.update(e)}},{key:"readyState",get:function(){return ue(se(i.prototype),"readyState",this)}},{key:"error",get:function(){var e=ue(se(i.prototype),"error",this);return this.i18n[e]||e}},{key:"networkState",get:function(){return ue(se(i.prototype),"networkState",this)}},{key:"fullscreenChanging",get:function(){return this._fullScreenOffset!==null}},{key:"cumulateTime",get:function(){var e=this._accPlayed,n=e.acc,r=e.t;return r?new Date().getTime()-r+n:n}},{key:"zoom",get:function(){return this.config.zoom},set:function(e){this.config.zoom=e}},{key:"videoRotateDeg",get:function(){return this.videoPos.rotate},set:function(e){e=p.convertDeg(e),!(e%90!==0||e===this.videoPos.rotate)&&(this.videoPos.rotate=e,this.resizePosition())}},{key:"avgSpeed",get:function(){return As},set:function(e){As=e}},{key:"realTimeSpeed",get:function(){return Cs},set:function(e){Cs=e}},{key:"offsetCurrentTime",get:function(){return this._offsetInfo.currentTime||0},set:function(e){this._offsetInfo.currentTime=e}},{key:"offsetDuration",get:function(){return this._offsetInfo.duration||0},set:function(e){this._offsetInfo.duration=e||0}},{key:"hook",value:function(e,n){return bn.call.apply(bn,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(e,n){return Sn.call.apply(Sn,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removeHooks",value:function(e,n){return En.call.apply(En,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"usePluginHooks",value:function(e,n,r){for(var o=arguments.length,u=new Array(o>3?o-3:0),l=3;l<o;l++)u[l-3]=arguments[l];return _s.call.apply(_s,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removePluginHooks",value:function(e,n,r){for(var o=arguments.length,u=new Array(o>3?o-3:0),l=3;l<o;l++)u[l-3]=arguments[l];return bs.call.apply(bs,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"setUserActive",value:function(e,n){var r;typeof n=="boolean"&&n!==this.muted&&(this.addInnerOP("volumechange"),p.typeOf(n)===Boolean&&(this.muted=n)),(r=xt)===null||r===void 0||r.setActive(this.playerId,e)}}],[{key:"debugger",get:function(){return pe.config.debug},set:function(e){pe.config.debug=e}},{key:"instManager",get:function(){return xt},set:function(e){xt=e}},{key:"getCurrentUserActivePlayerId",value:function(){var e;return(e=xt)===null||e===void 0?void 0:e.getActiveId()}},{key:"setCurrentUserActive",value:function(e,n){var r;(r=xt)===null||r===void 0||r.setActive(e,n)}},{key:"isHevcSupported",value:function(){return oe.isHevcSupported()}},{key:"probeConfigSupported",value:function(e){return oe.probeConfigSupported(e)}},{key:"install",value:function(e,n){i.plugins||(i.plugins={}),i.plugins[e]||(i.plugins[e]=n)}},{key:"use",value:function(e,n){i.plugins||(i.plugins={}),i.plugins[e]=n}}]),i}(ql);I(Rn,"defaultPreset",null);I(Rn,"XgVideoProxy",null);Rn.instManager=Xa.getInstance();function Ve(){return new Date().getTime()}var Lt={LOAD_START:"loadstart",LOADED_DATA:"loadeddata",FIRST_FRAME:"firstFrame",WAIT_START:"waitingStart",WAIT_END:"waitingEnd",SEEK_START:"seekStart",SEEK_END:"seekEnd"},bc=function(s){ie(i,s);var a=ne(i);function i(){var t;q(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=a.call.apply(a,[this].concat(n)),I(x(t),"_onTimeupdate",function(){t._state.isTimeUpdate=!0,t._state.autoplayStart&&(pe.logInfo("[xgLogger]".concat(t.player.playerId," _onTimeupdate")),t._sendFF("onTimeupdate"))}),I(x(t),"_onAutoplayStart",function(){pe.logInfo("[xgLogger]".concat(t.player.playerId," _onAutoplayStart")),t._state.autoplayStart=!0,t.vt&&t._sendFF("onAutoplayStart")}),I(x(t),"_onReset",function(){t._state={autoplayStart:!1,isFFLoading:!1,isTimeUpdate:!1,isFFSend:!1,isLs:!1},t.vt=0,t.pt=0,t.fvt=0,t.newPointTime=Ve(),t.loadedCostTime=0,t.startCostTime=0,t._isSeeking=!1,t.seekingStart=0,t.waitingStart=0,t.fixedWaitingStart=0,t._isWaiting=!1,t._waitTimer&&p.clearTimeout(x(t),t._waitTimer),t._waittTimer&&p.clearTimeout(x(t),t._waittTimer),t._waitTimer=null,t._waittTimer=null,t._waitType=0}),I(x(t),"_onSeeking",function(){t.seekingStart||(t.suspendWaitingStatus("seek"),t.seekingStart=Ve(),t.emitLog(Lt.SEEK_START,{start:Ve()}))}),I(x(t),"_onSeeked",function(){t.suspendSeekingStatus("seeked")}),I(x(t),"_onWaitingLoadStart",function(){t._isWaiting||t.vt||(t._isWaiting=!0,t.waitingStart=Ve(),t.fixedWaitingStart=Ve(),t._waitType=1,t.emitLog(Lt.WAIT_START,{fixedStart:t.fixedWaitingStart,start:t.waitingStart,type:1,endType:"loadstart"}))}),I(x(t),"_onWaiting",function(){t._isWaiting||!t.vt||(t._isWaiting=!0,t.vt?t.seekingStart?t._waitType=2:t._waitType=0:t._waitType=1,t.fixedWaitingStart=Ve(),t._waitTimer=p.setTimeout(x(t),function(){t._isWaiting&&(t.waitingStart=Ve(),p.clearTimeout(x(t),t._waitTimer),t._waitTimer=null,t._startWaitTimeout(),t.emitLog(Lt.WAIT_START,{fixedStart:t.fixedWaitingStart,start:t.waitingStart,type:t._waitType,endType:t._waitType===2?"seek":"playing"}))},200))}),I(x(t),"_onError",function(){t.suspendSeekingStatus("error"),t.suspendWaitingStatus("error")}),I(x(t),"_onPlaying",function(){t._isWaiting&&t.suspendWaitingStatus("playing")}),t}return Q(i,[{key:"afterCreate",value:function(){var e=this;this._onReset(),this._waitType="firstFrame",this._initOnceEvents(),this.newPointTime=Ve(),this.loadedCostTime=0,this.startCostTime=0,this.on(zr,function(){var n=e._state,r=n.autoplayStart,o=n.isFFSend;e.startCostTime=Ve()-e.newPointTime,pe.logInfo("[xgLogger]".concat(e.player.playerId," LOAD_START"),"autoplayStart:".concat(r," isFFSend:").concat(o," startCostTime:").concat(e.startCostTime," newPointTime").concat(e.newPointTime)),!o&&(!n.isLs&&e.emitLog(Lt.LOAD_START,{}),n.isLs=!0,n.isTimeUpdate=!1,n.isFFLoading=!0,e.pt=Ve(),e.vt=0,e.fvt=0,e._initOnceEvents(),e._onWaitingLoadStart())}),this.on(vt,function(){e.vt=Ve(),e.fvt=e.vt-e.pt,e.loadedCostTime=e.vt-e.newPointTime;var n=e._state,r=n.isTimeUpdate,o=n.isFFSend,u=n.autoplayStart;pe.logInfo("[xgLogger]".concat(e.player.playerId," LOADED_DATA"),"fvt:".concat(e.fvt," isTimeUpdate:").concat(e._state.isTimeUpdate," loadedCostTime:").concat(e.loadedCostTime)),(r||u)&&e._sendFF("loadedData"),o||e.emitLog(Lt.LOADED_DATA,{}),e.suspendWaitingStatus("loadeddata")}),this.on(Ln,this._onSeeking),this.on(kt,this._onSeeked),this.on(In,function(){e.endState("destroy")}),this.on(Wi,function(){e.endState("urlChange"),pe.logInfo("[xgLogger]".concat(e.player.playerId," URL_CHANGE")),e._state.isFFSend&&e._onReset()}),this.on([jr,bt],this._onPlaying),this.on(zi,this._onWaiting),this.on(Ti,this._onError),this.on(On,function(){pe.logInfo("[xgLogger]".concat(e.player.playerId," RESET")),e.endState("reset"),e._initOnceEvents(),e._onReset()})}},{key:"_initOnceEvents",value:function(){this.off(Qt,this._onAutoplayStart),this.off($e,this._onTimeupdate),this.once(Qt,this._onAutoplayStart),this.once($e,this._onTimeupdate)}},{key:"_sendFF",value:function(e){this.s=Ve();var n=this._state,r=n.isFFLoading,o=n.isFFSend;pe.logInfo("[xgLogger]".concat(this.player.playerId," _sendFF"),"".concat(e," fvt:").concat(this.fvt," isFFLoading:").concat(r," !isFFSend:").concat(!o)),this.vt>0&&r&&!o&&(pe.logInfo("[xgLogger]".concat(this.player.playerId," emitLog_firstFrame"),e),this._state.isFFLoading=!1,this._state.isFFSend=!0,this.emitLog(Lt.FIRST_FRAME,{fvt:this.fvt,costTime:this.fvt,vt:this.vt,startCostTime:this.startCostTime,loadedCostTime:this.loadedCostTime}))}},{key:"_startWaitTimeout",value:function(){var e=this;this._waittTimer&&p.clearTimeout(this,this._waittTimer),this._waittTimer=p.setTimeout(this,function(){e.suspendWaitingStatus("timeout"),p.clearTimeout(e,e._waittTimer),e._waittTimer=null},this.config.waitTimeout)}},{key:"endState",value:function(e){this.suspendWaitingStatus(e),this.suspendSeekingStatus(e)}},{key:"suspendSeekingStatus",value:function(e){if(this.seekingStart){var n=Ve(),r=n-this.seekingStart;this.seekingStart=0,this.emitLog(Lt.SEEK_END,{end:n,costTime:r,endType:e})}}},{key:"suspendWaitingStatus",value:function(e){if(this._waitTimer&&(p.clearTimeout(this,this._waitTimer),this._waitTimer=null),this._waittTimer&&(p.clearTimeout(this,this._waittTimer),this._waittTimer=null),this._isWaiting=!1,!!this.waitingStart){var n=Ve(),r=n-this.waitingStart,o=n-this.fixedWaitingStart,u=this.config.waitTimeout;this._isWaiting=!1,this.waitingStart=0,this.fixedWaitingStart=0,this.emitLog(Lt.WAIT_END,{fixedCostTime:o>u?u:o,costTime:r>u?u:r,type:e==="loadeddata"?1:this._waitType,endType:this._waitType===2?"seek":e})}}},{key:"emitLog",value:function(e,n){var r=this.player;this.emit(Fa,Le({t:Ve(),host:p.getHostFromUrl(r.currentSrc),vtype:r.vtype,eventType:e,currentTime:this.player.currentTime,readyState:r.video.readyState,networkState:r.video.networkState},n))}}],[{key:"pluginName",get:function(){return"xgLogger"}},{key:"defaultConfig",get:function(){return{waitTimeout:1e4}}}]),i}(fe);function Sc(){return new DOMParser().parseFromString(`<svg class="xgplayer-replay-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 78 78" width="78" height="78">
  <path fill="#fff" transform="translate(20, 20)" d="M8.22708362,13.8757234 L11.2677371,12.6472196 C11.7798067,12.4403301 12.3626381,12.6877273 12.5695276,13.1997969 L12.9441342,14.1269807 C13.1510237,14.6390502 12.9036264,15.2218816 12.3915569,15.4287712 L6.8284538,17.6764107 L5.90126995,18.0510173 C5.38920044,18.2579068 4.80636901,18.0105096 4.5994795,17.49844 L1.97723335,11.0081531 C1.77034384,10.4960836 2.0177411,9.91325213 2.52981061,9.70636262 L3.45699446,9.33175602 C3.96906396,9.12486652 4.5518954,9.37226378 4.75878491,9.88433329 L5.67885163,12.1615783 C7.99551726,6.6766934 13.3983951,3 19.5,3 C27.7842712,3 34.5,9.71572875 34.5,18 C34.5,26.2842712 27.7842712,33 19.5,33 C15.4573596,33 11.6658607,31.3912946 8.87004692,28.5831991 C8.28554571,27.9961303 8.28762719,27.0463851 8.87469603,26.4618839 C9.46176488,25.8773827 10.4115101,25.8794641 10.9960113,26.466533 C13.2344327,28.7147875 16.263503,30 19.5,30 C26.127417,30 31.5,24.627417 31.5,18 C31.5,11.372583 26.127417,6 19.5,6 C14.4183772,6 9.94214483,9.18783811 8.22708362,13.8757234 Z"></path>
</svg>
`,"image/svg+xml").firstChild}var Ec=function(s){ie(i,s);var a=ne(i);function i(){return q(this,i),a.apply(this,arguments)}return Q(i,[{key:"registerIcons",value:function(){return{replay:Sc}}},{key:"afterCreate",value:function(){var e=this;fe.insert(this.icons.replay,this.root,0),this.__handleReplay=this.hook("replayClick",function(){e.player.replay()},{pre:function(r){r.preventDefault(),r.stopPropagation()}}),this.bind(".xgplayer-replay",["click","touchend"],this.__handleReplay),this.on(Ct,function(){if(e.playerConfig.loop||p.addClass(e.player.root,"replay"),!e.config.disable){e.show();var n=e.root.querySelector("path");if(n){var r=window.getComputedStyle(n).getPropertyValue("transform");if(typeof r=="string"&&r.indexOf("none")>-1)return null;n.setAttribute("transform",r)}}}),this.on(je,function(){e.hide()})}},{key:"handleReplay",value:function(e){e.preventDefault(),e.stopPropagation(),this.player.replay(),p.removeClass(this.player.root,"replay")}},{key:"show",value:function(e){this.config.disable||(this.root.style.display="flex")}},{key:"enable",value:function(){this.config.disable=!1}},{key:"disable",value:function(){this.config.disable=!0,this.hide()}},{key:"destroy",value:function(){this.unbind(".xgplayer-replay",["click","touchend"],this.__handleReplay)}},{key:"render",value:function(){return`<xg-replay class="xgplayer-replay">
      <xg-replay-txt class="xgplayer-replay-txt" lang-key="`.concat(this.i18nKeys.REPLAY,'">').concat(this.i18n.REPLAY,`</xg-replay-txt>
    </xg-replay>`)}}],[{key:"pluginName",get:function(){return"replay"}},{key:"defaultConfig",get:function(){return{disable:!1}}}]),i}(fe),kc=function(s){ie(i,s);var a=ne(i);function i(){return q(this,i),a.apply(this,arguments)}return Q(i,[{key:"isEndedShow",get:function(){return this.config.isEndedShow},set:function(e){this.config.isEndedShow=e}},{key:"hide",value:function(){p.addClass(this.root,"hide")}},{key:"show",value:function(e){p.removeClass(this.root,"hide")}},{key:"beforeCreate",value:function(e){typeof e.player.config.poster=="string"&&(e.config.poster=e.player.config.poster)}},{key:"afterCreate",value:function(){var e=this;this.on(Ct,function(){e.isEndedShow&&p.removeClass(e.root,"hide")}),this.config.hideCanplay?(this.once($e,function(){e.onTimeUpdate()}),this.on(Wi,function(){p.removeClass(e.root,"hide"),p.addClass(e.root,"xg-showplay"),e.once($e,function(){e.onTimeUpdate()})})):this.on(je,function(){p.addClass(e.root,"hide")})}},{key:"setConfig",value:function(e){var n=this;Object.keys(e).forEach(function(o){n.config[o]=e[o]});var r=this.config.poster;this.update(r)}},{key:"onTimeUpdate",value:function(){var e=this;this.player.currentTime?p.removeClass(this.root,"xg-showplay"):this.once($e,function(){e.onTimeUpdate()})}},{key:"update",value:function(e){e&&(this.config.poster=e,this.root.style.backgroundImage="url(".concat(e,")"))}},{key:"getBgSize",value:function(e){var n="";switch(e){case"cover":n="cover";break;case"contain":n="contain";break;case"fixHeight":n="auto 100%";break;default:n=""}return n?"background-size: ".concat(n,";"):""}},{key:"render",value:function(){var e=this.config,n=e.poster,r=e.hideCanplay,o=e.fillMode,u=e.notHidden,l=this.getBgSize(o),c=n?"background-image:url(".concat(n,");").concat(l):l,h=u?"xg-not-hidden":r?"xg-showplay":"";return'<xg-poster class="xgplayer-poster '.concat(h,'" style="').concat(c,`">
    </xg-poster>`)}}],[{key:"pluginName",get:function(){return"poster"}},{key:"defaultConfig",get:function(){return{isEndedShow:!0,hideCanplay:!1,notHidden:!1,poster:"",fillMode:"fixWidth"}}}]),i}(fe);function Qr(){return new DOMParser().parseFromString(`<svg class="play" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40">
  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M576,363L810,512L576,661zM342,214L576,363L576,661L342,810z"></path>
</svg>
`,"image/svg+xml").firstChild}function Jr(){return new DOMParser().parseFromString(`<svg class="pause" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40">
  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M598,214h170v596h-170v-596zM256 810v-596h170v596h-170z"></path>
</svg>
`,"image/svg+xml").firstChild}var ct={};function Tc(s,a){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{start:null,end:null};return ct[s]&&window.clearTimeout(ct[s].id),ct[s]={},i.start&&i.start(),ct[s].id=window.setTimeout(function(){i.end&&i.end(),window.clearTimeout(ct[s].id),delete ct[s]},a),ct[s].id}function Ps(s){if(s){window.clearTimeout(s);return}Object.keys(ct).map(function(a){window.clearTimeout(ct[a].id),delete ct[a]})}var wc=function(s){ie(i,s);var a=ne(i);function i(t){var e;return q(this,i),e=a.call(this,t),I(x(e),"onPlayerReset",function(){e.autoPlayStart=!1;var n=e.config.mode==="auto"?"auto-hide":"hide";e.setAttr("data-state","play"),p.removeClass(e.root,n),e.show()}),I(x(e),"onAutoplayStart",function(){if(!e.autoPlayStart){var n=e.config.mode==="auto"?"auto-hide":"hide";p.addClass(e.root,n),e.autoPlayStart=!0,e.toggleTo("play")}}),e.autoPlayStart=!1,e}return Q(i,[{key:"afterCreate",value:function(){var e=this.playerConfig;this.initIcons(),this.listenEvents(),this.bindClickEvents(),e.autoplay||this.show()}},{key:"listenEvents",value:function(){var e=this,n=this.player,r=this.playerConfig;this.once(Kr,function(){r&&(r.lang&&r.lang==="en"?p.addClass(n.root,"lang-is-en"):r.lang==="jp"&&p.addClass(n.root,"lang-is-jp"))}),this.on(Qt,this.onAutoplayStart),this.on(Yr,function(){var o=e.config.mode==="auto"?"auto-hide":"hide";e.setAttr("data-state","play"),p.removeClass(e.root,o),e.show()}),this.on(je,function(){e.toggleTo("play")}),this.on(dt,function(){e.toggleTo("pause")}),this.on(On,function(){e.onPlayerReset()})}},{key:"bindClickEvents",value:function(){var e=this;this.clickHandler=this.hook("startClick",this.switchPausePlay,{pre:function(r){r.cancelable&&r.preventDefault(),r.stopPropagation();var o=e.player.paused;e.emitUserAction(r,"switch_play_pause",{props:"paused",from:o,to:!o})}}),this.bind(["click","touchend"],this.clickHandler)}},{key:"registerIcons",value:function(){return{startPlay:{icon:Qr,class:"xg-icon-play"},startPause:{icon:Jr,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild("xg-start-inner",e.startPlay),this.appendChild("xg-start-inner",e.startPause)}},{key:"hide",value:function(){p.addClass(this.root,"hide")}},{key:"show",value:function(e){p.removeClass(this.root,"hide")}},{key:"focusHide",value:function(){p.addClass(this.root,"focus-hide")}},{key:"recover",value:function(){p.removeClass(this.root,"focus-hide")}},{key:"switchStatus",value:function(e){e?this.setAttr("data-state",this.player.paused?"pause":"play"):this.setAttr("data-state",this.player.paused?"play":"pause")}},{key:"animate",value:function(e){var n=this;this._animateId=Tc("pauseplay",400,{start:function(){p.addClass(n.root,"interact"),n.show(),n.switchStatus(!0)},end:function(){p.removeClass(n.root,"interact"),!e&&n.hide(),n._animateId=null}})}},{key:"endAnimate",value:function(){p.removeClass(this.root,"interact"),Ps(this._animateId),this._animateId=null}},{key:"switchPausePlay",value:function(e){var n=this.player;if(e.cancelable&&e.preventDefault(),e.stopPropagation(),!(n.state<me.READY)){var r=this.player.paused;!r&&n.state===me.RUNNING?n.pause():n.play()}}},{key:"onPlayPause",value:function(e){this.toggleTo(e)}},{key:"toggleTo",value:function(e){var n=this.config,r=this.player;if(!(!r||r.state<me.RUNNING||!this.autoPlayStart)){if(n.mode==="show"){this.switchStatus(),this.show();return}if(n.mode==="auto"){this.switchStatus();return}if(n.isShowPause&&r.paused&&!r.ended||n.isShowEnd&&r.ended){this.switchStatus(),this.show(),this.endAnimate();return}if(n.disableAnimate){this.switchStatus(),this.hide();return}if(e==="play")this.autoPlayStart?this.animate():this.hide();else{if(!this.autoPlayStart||r.ended)return;this.animate()}}}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.clickHandler),Ps(this._animateId)}},{key:"render",value:function(){var e=this.playerConfig.autoplay?this.config.mode==="auto"?"auto-hide":"hide":"";return`
    <xg-start class="xgplayer-start `.concat(e,`">
    <xg-start-inner></xg-start-inner>
    </xg-start>`)}}],[{key:"pluginName",get:function(){return"start"}},{key:"defaultConfig",get:function(){return{isShowPause:!1,isShowEnd:!1,disableAnimate:!1,mode:"hide"}}}]),i}(fe),Cc=function(s){ie(i,s);var a=ne(i);function i(){return q(this,i),a.apply(this,arguments)}return Q(i,[{key:"render",value:function(){var e=this.config.innerHtml,n=p.createDom("xg-enter","",{},"xgplayer-enter");if(e&&e instanceof window.HTMLElement)n.appendChild(e);else if(e&&typeof e=="string")n.innerHTML=e;else{for(var r="",o=1;o<=12;o++)r+='<div class="xgplayer-enter-bar'.concat(o,'"></div>');n.innerHTML='<div class="xgplayer-enter-spinner">'.concat(r,"</div>")}return n}}],[{key:"pluginName",get:function(){return"enter"}},{key:"defaultConfig",get:function(){return{innerHtml:"",logo:""}}}]),i}(fe);function Bt(s,a,i){try{return' <div class="xg-tips '.concat(i?"hide":" ",'" lang-key="').concat(s.i18nKeys[a],`">
    `).concat(s.i18n[a],`
    </div>`)}catch{return'<div class="xg-tips hide"></div>'}}var xs=function(s){ie(i,s);var a=ne(i);function i(){return q(this,i),a.apply(this,arguments)}return Q(i,[{key:"afterCreate",value:function(){this.getMini=this.getMini.bind(this),this.exitMini=this.exitMini.bind(this),this.bind("click",this.getMini)}},{key:"getMini",value:function(){this.config.onClick&&this.config.onClick()}},{key:"exitMini",value:function(){this.config.onClick&&this.config.onClick()}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.getMini)}},{key:"render",value:function(){var e="MINISCREEN";return`
      <xg-icon class="xgplayer-miniicon">
      <div class="xgplayer-icon btn-text"><span class="icon-text" lang-key="`.concat(this.i18nKeys[e],'">').concat(this.i18n[e],`</span></div>
      </xg-icon>`)}}],[{key:"pluginName",get:function(){return"miniscreenIcon"}},{key:"defaultConfig",get:function(){return{position:Te.CONTROLS_RIGHT,index:10}}}]),i}(fe);function Ls(s){var a=parseFloat(s),i=s.indexOf("%")===-1&&!Number.isNaN(a);return i&&a}var Zr=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],qa=Zr.length;function Ac(){for(var s={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},a=0;a<qa;a++){var i=Zr[a];s[i]=0}return s}function Pc(s){var a=window.getComputedStyle(s);return a}function Ds(s){if(typeof s=="string"&&(s=document.querySelector(s)),!(!s||Ge(s)!=="object"||!s.nodeType)){var a=Pc(s);if(a.display==="none")return Ac();var i={};i.width=s.offsetWidth,i.height=s.offsetHeight;for(var t=i.isBorderBox=a.boxSizing==="border-box",e=0;e<qa;e++){var n=Zr[e],r=a[n],o=parseFloat(r);i[n]=Number.isNaN(o)?0:o}var u=i.paddingLeft+i.paddingRight,l=i.paddingTop+i.paddingBottom,c=i.marginLeft+i.marginRight,h=i.marginTop+i.marginBottom,f=i.borderLeftWidth+i.borderRightWidth,d=i.borderTopWidth+i.borderBottomWidth,v=t,m=Ls(a.width);m!==!1&&(i.width=m+(v?0:u+f));var g=Ls(a.height);return g!==!1&&(i.height=g+(v?0:l+d)),i.innerWidth=i.width-(u+f),i.innerHeight=i.height-(l+d),i.outerWidth=i.width+c,i.outerHeight=i.height+h,i}}function Qn(s,a){for(var i=0;i<s.length;i++){var t=s[i];if(t.identifier===a)return t}}var Jn={START:"dragStart",MOVE:"dragMove",ENDED:"dragEnded"},Is={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"]},xc=function(s){ie(i,s);var a=ne(i);function i(t){var e,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return q(this,i),e=a.call(this),e.isEnabled=!0,e.isDragging=!1,e.isDown=!1,e.position={},e.downPoint={},e.dragPoint={x:0,y:0},e.startPos={x:0,y:0},e._root=t instanceof Element?t:document.querySelector(t),e._handlerDom=n.handle instanceof Element?n.handle:document.querySelector(n.handle),!e._root||!e._handlerDom?$r(e):(e._bindStartEvent(),e)}return Q(i,[{key:"_bindStartEvent",value:function(){var e=this;"ontouchstart"in window?this._startKey="touchstart":this._startKey="mousedown",this["on".concat(this._startKey)]=this["on".concat(this._startKey)].bind(this),this._handlerDom.addEventListener(this._startKey,this["on".concat(this._startKey)]),Is[this._startKey].map(function(n){e["on".concat(n)]=e["on".concat(n)].bind(e)})}},{key:"_unbindStartEvent",value:function(){this._handlerDom.removeEventListener(this._startKey,this["on".concat(this._startKey)])}},{key:"_bindPostStartEvents",value:function(e){var n=this;if(e){var r=Is[this._startKey];r.map(function(o){window.addEventListener(o,n["on".concat(o)])}),this._boundPointerEvents=r}}},{key:"_unbindPostStartEvents",value:function(){var e=this;this._boundPointerEvents&&(this._boundPointerEvents.map(function(n){window.removeEventListener(n,e["on".concat(n)])}),delete this._boundPointerEvents)}},{key:"enable",value:function(){this.isEnabled=!0}},{key:"disable",value:function(){this.isEnabled=!1,this.isDragging&&this.onUp()}},{key:"onDocUp",value:function(e){this.onUp()}},{key:"animate",value:function(){var e=this;this.isDragging&&(this.positionDrag(),window.requestAnimationFrame(function(){e.animate()}))}},{key:"positionDrag",value:function(){var e="translate3d(".concat(this.dragPoint.x,"px, ").concat(this.dragPoint.y,"px, 0)");this._root.style.transform=e,this._root.style.webKitTransform=e}},{key:"setLeftTop",value:function(){this._root.style.left=this.position.x+"px",this._root.style.top=this.position.y+"px"}},{key:"onmousedown",value:function(e){this.dragStart(e,e)}},{key:"onmousemove",value:function(e){this.dragMove(e,e)}},{key:"onmouseup",value:function(e){this.dragEnd(e,e)}},{key:"ontouchstart",value:function(e){var n=e.changedTouches[0];this.dragStart(e,n),this.touchIdentifier=n.pointerId!==void 0?n.pointerId:n.identifier,e.preventDefault()}},{key:"ontouchmove",value:function(e){var n=Qn(e.changedTouches,this.touchIdentifier);n&&this.dragMove(e,n)}},{key:"ontouchend",value:function(e){var n=Qn(e.changedTouches,this.touchIdentifier);n&&this.dragEnd(e,n),e.preventDefault()}},{key:"ontouchcancel",value:function(e){var n=Qn(e.changedTouches,this.touchIdentifier);n&&this.dragCancel(e,n)}},{key:"dragStart",value:function(e,n){if(!(!this._root||this.isDown||!this.isEnabled)){this.downPoint=n,this.dragPoint.x=0,this.dragPoint.y=0,this._getPosition();var r=Ds(this._root);this.startPos.x=this.position.x,this.startPos.y=this.position.y,this.startPos.maxY=window.innerHeight-r.height,this.startPos.maxX=window.innerWidth-r.width,this.setLeftTop(),this.isDown=!0,this._bindPostStartEvents(e)}}},{key:"dragRealStart",value:function(e,n){this.isDragging=!0,this.animate(),this.emit(Jn.START,this.startPos)}},{key:"dragEnd",value:function(e,n){this._root&&(this._unbindPostStartEvents(),this.isDragging&&(this._root.style.transform="",this.setLeftTop(),this.emit(Jn.ENDED)),this.presetInfo())}},{key:"_dragPointerMove",value:function(e,n){var r={x:n.pageX-this.downPoint.pageX,y:n.pageY-this.downPoint.pageY};return!this.isDragging&&this.hasDragStarted(r)&&this.dragRealStart(e,n),r}},{key:"dragMove",value:function(e,n){if(e=e||window.event,!!this.isDown){var r=this.startPos,o=r.x,u=r.y,l=this._dragPointerMove(e,n),c=l.x,h=l.y;c=this.checkContain("x",c,o),h=this.checkContain("y",h,u),this.position.x=o+c,this.position.y=u+h,this.dragPoint.x=c,this.dragPoint.y=h,this.emit(Jn.MOVE,this.position)}}},{key:"dragCancel",value:function(e,n){this.dragEnd(e,n)}},{key:"presetInfo",value:function(){this.isDragging=!1,this.startPos={x:0,y:0},this.dragPoint={x:0,y:0},this.isDown=!1}},{key:"destroy",value:function(){this._unbindStartEvent(),this._unbindPostStartEvents(),this.isDragging&&this.dragEnd(),this.removeAllListeners(),this._handlerDom=null}},{key:"hasDragStarted",value:function(e){return Math.abs(e.x)>3||Math.abs(e.y)>3}},{key:"checkContain",value:function(e,n,r){return n+r<0?0-r:e==="x"&&n+r>this.startPos.maxX?this.startPos.maxX-r:e==="y"&&n+r>this.startPos.maxY?this.startPos.maxY-r:n}},{key:"_getPosition",value:function(){var e=window.getComputedStyle(this._root),n=this._getPositionCoord(e.left,"width"),r=this._getPositionCoord(e.top,"height");this.position.x=Number.isNaN(n)?0:n,this.position.y=Number.isNaN(r)?0:r,this._addTransformPosition(e)}},{key:"_addTransformPosition",value:function(e){var n=e.transform;if(n.indexOf("matrix")===0){var r=n.split(","),o=n.indexOf("matrix3d")===0?12:4,u=parseInt(r[o],10),l=parseInt(r[o+1],10);this.position.x+=u,this.position.y+=l}}},{key:"_getPositionCoord",value:function(e,n){if(e.indexOf("%")!==-1){var r=Ds(this._root.parentNode);return r?parseFloat(e)/100*r[n]:0}return parseInt(e,10)}}]),i}(ki),Lc=function(s){ie(i,s);var a=ne(i);function i(t){var e;q(this,i),e=a.call(this,t),I(x(e),"onCancelClick",function(o){e.exitMini(),e.isClose=!0}),I(x(e),"onCenterClick",function(o){var u=x(e),l=u.player;l.paused?l.play():l.pause()}),I(x(e),"onScroll",function(o){if(!(!window.scrollY&&window.scrollY!==0||Math.abs(window.scrollY-e.pos.scrollY)<50)){var u=parseInt(p.getCss(e.player.root,"height"));u+=e.config.scrollTop,e.pos.scrollY=window.scrollY,window.scrollY>u+5?!e.isMini&&!e.isClose&&e.getMini():window.scrollY<=u&&(e.isMini&&e.exitMini(),e.isClose=!1)}}),e.isMini=!1,e.isClose=!1;var n=x(e),r=n.config;return e.pos={left:r.left<0?window.innerWidth-r.width-20:r.left,top:r.top<0?window.innerHeight-r.height-20:r.top,height:e.config.height,width:e.config.width,scrollY:window.scrollY||0},e.lastStyle=null,e}return Q(i,[{key:"beforeCreate",value:function(e){typeof e.player.config.mini=="boolean"&&(e.config.isShowIcon=e.player.config.mini)}},{key:"afterCreate",value:function(){var e=this;this.initIcons(),this.on(dt,function(){e.setAttr("data-state","pause")}),this.on(je,function(){e.setAttr("data-state","play")})}},{key:"onPluginsReady",value:function(){var e=this,n=this.player,r=this.config;if(!r.disable){if(this.config.isShowIcon){var o={config:{onClick:function(){e.getMini()}}};n.controls.registerPlugin(xs,o,xs.pluginName)}var u=p.checkTouchSupport()?"touchend":"click";this.bind(".mini-cancel-btn",u,this.onCancelClick),this.bind(".play-icon",u,this.onCenterClick),this.config.disableDrag||(this._draggabilly=new xc(this.player.root,{handle:this.root})),this.config.isScrollSwitch&&window.addEventListener("scroll",this.onScroll)}}},{key:"registerIcons",value:function(){return{play:{icon:Qr,class:"xg-icon-play"},pause:{icon:Jr,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".play-icon",e.play),this.appendChild(".play-icon",e.pause)}},{key:"getMini",value:function(){var e=this;if(!this.isMini){var n=this.player,r=this.playerConfig,o=this.config.target||this.player.root;this.lastStyle={},p.addClass(n.root,"xgplayer-mini"),["width","height","top","left"].map(function(u){e.lastStyle[u]=o.style[u],o.style[u]="".concat(e.pos[u],"px")}),r.fluid&&(o.style["padding-top"]=""),this.emit(mn,!0),n.isMini=this.isMini=!0}}},{key:"exitMini",value:function(){var e=this;if(!this.isMini)return!1;var n=this.player,r=this.playerConfig,o=this.config.target||this.player.root;p.removeClass(n.root,"xgplayer-mini"),this.lastStyle&&Object.keys(this.lastStyle).map(function(u){o.style[u]=e.lastStyle[u]}),this.lastStyle=null,r.fluid&&(n.root.style.width="100%",n.root.style.height="0",n.root.style["padding-top"]="".concat(r.height*100/r.width,"%")),this.emit(mn,!1),this.isMini=n.isMini=!1}},{key:"destroy",value:function(){window.removeEventListener("scroll",this.onScroll);var e=p.checkTouchSupport()?"touchend":"click";this.unbind(".mini-cancel-btn",e,this.onCancelClick),this.unbind(".play-icon",e,this.onCenterClick),this._draggabilly&&this._draggabilly.destroy(),this._draggabilly=null,this.exitMini()}},{key:"render",value:function(){if(!this.config.disable)return`
      <xg-mini-layer class="xg-mini-layer">
      <xg-mini-header class="xgplayer-mini-header">
      `.concat(Bt(this,"MINI_DRAG",this.playerConfig.isHideTips),`
      </xg-mini-header>
      <div class="mini-cancel-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">
          <path fill="#fff" fill-rule="evenodd" d="M3.99 3.49a1 1 0 0 1 1.414 0L10 8.085l4.596-4.595a1 1 0 1 1 1.414 1.414L11.414 9.5l4.596 4.596a1 1 0 0 1 .084 1.32l-.084.094a1 1 0 0 1-1.414 0L10 10.914 5.404 15.51a1 1 0 0 1-1.414-1.414L8.585 9.5 3.99 4.904a1 1 0 0 1-.084-1.32z"></path>
        </svg>
      </div>
      <div class="play-icon">
      </div>
      </xg-mini-layer>`)}}],[{key:"pluginName",get:function(){return"miniscreen"}},{key:"defaultConfig",get:function(){return{index:10,disable:!1,width:320,height:180,left:-1,top:-1,isShowIcon:!1,isScrollSwitch:!1,scrollTop:0,disableDrag:!1}}}]),i}(fe),Qi={mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mousemove:"onMouseMove"},Zn=["videoClick","videoDbClick"],er=function(s){ie(i,s);var a=ne(i);function i(){var t;q(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=a.call.apply(a,[this].concat(n)),I(x(t),"onMouseMove",function(o){var u=x(t),l=u.player,c=u.playerConfig;l.isActive||(l.focus({autoHide:!c.closeDelayBlur}),!c.closeFocusVideoFocus&&l.media.focus())}),I(x(t),"onMouseEnter",function(o){var u=x(t),l=u.playerConfig,c=u.player;!l.closeFocusVideoFocus&&c.media.focus(),l.closeDelayBlur?c.focus({autoHide:!1}):c.focus(),t.emit(Oa)}),I(x(t),"onMouseLeave",function(o){var u=t.playerConfig,l=u.closePlayerBlur,c=u.leavePlayerTime,h=u.closeDelayBlur;!l&&!h&&(c?t.player.focus({autoHide:!0,delay:c}):t.player.blur({ignorePaused:!0})),t.emit(Ia)}),I(x(t),"onVideoClick",function(o){var u=x(t),l=u.player,c=u.playerConfig;o.target&&c.closeVideoClick||(o.target===l.root||o.target===l.media||o.target===l.innerContainer||o.target===l.media.__canvas)&&(o.preventDefault(),c.closeVideoStopPropagation||o.stopPropagation(),t._clickCount++,t.clickTimer&&(clearTimeout(t.clickTimer),t.clickTimer=null),t.clickTimer=setTimeout(function(){t._clickCount&&(t._clickCount--,ht(x(t),Zn[0],function(h,f){t.switchPlayPause(f.e)},{e:o,paused:l.paused}),clearTimeout(t.clickTimer),t.clickTimer=null)},300))}),I(x(t),"onVideoDblClick",function(o){var u=x(t),l=u.player,c=u.playerConfig;if(!(c.closeVideoDblclick||!o.target||o.target!==l.media&&o.target!==l.media.__canvas)){if(!c.closeVideoClick&&t._clickCount<2){t._clickCount=0;return}t._clickCount=0,t.clickTimer&&(clearTimeout(t.clickTimer),t.clickTimer=null),o.preventDefault(),o.stopPropagation(),ht(x(t),Zn[1],function(h,f){t.emitUserAction(f.e,"switch_fullscreen",{props:"fullscreen",from:l.fullscreen,to:!l.fullscreen}),l.fullscreen?l.exitFullscreen():l.getFullscreen()},{e:o,fullscreen:l.fullscreen})}}),t}return Q(i,[{key:"afterCreate",value:function(){var e=this;this._clickCount=0,Zn.map(function(r){e.__hooks[r]=null});var n=this.playerConfig.isMobileSimulateMode;n==="mobile"||oe.device==="mobile"&&!oe.os.isIpad||this.initEvents()}},{key:"initEvents",value:function(){var e=this,n=this.player,r=n.media,o=n.root,u=this.playerConfig.enableContextmenu;o&&o.addEventListener("click",this.onVideoClick,!1),o&&o.addEventListener("dblclick",this.onVideoDblClick,!1),Object.keys(Qi).map(function(l){o.addEventListener(l,e[Qi[l]],!1)}),!u&&r&&r.addEventListener("contextmenu",this.onContextmenu,!1)}},{key:"switchPlayPause",value:function(e){var n=this.player;this.emitUserAction(e,"switch_play_pause",{props:"paused",from:n.paused,to:!n.paused}),n.ended?n.duration!==1/0&&n.duration>0&&n.replay():n.paused?n.play():n.pause()}},{key:"onContextmenu",value:function(e){e=e||window.event,e.preventDefault&&e.preventDefault(),e.stopPropagation?e.stopPropagation():(e.returnValue=!1,e.cancelBubble=!0)}},{key:"destroy",value:function(){var e=this,n=this.player,r=n.video,o=n.root;this.clickTimer&&clearTimeout(this.clickTimer),o.removeEventListener("click",this.onVideoClick,!1),o.removeEventListener("dblclick",this.onVideoDblClick,!1),r.removeEventListener("contextmenu",this.onContextmenu,!1),Object.keys(Qi).map(function(u){o.removeEventListener(u,e[Qi[u]],!1)})}}],[{key:"pluginName",get:function(){return"pc"}},{key:"defaultConfig",get:function(){return{}}}]),i}(gt),Dt={PRESS:"press",PRESS_END:"pressend",DOUBlE_CLICK:"doubleclick",CLICK:"click",TOUCH_MOVE:"touchmove",TOUCH_START:"touchstart",TOUCH_END:"touchend"},Dc={start:"touchstart",end:"touchend",move:"touchmove",cancel:"touchcancel"},Ic={start:"mousedown",end:"mouseup",move:"mousemove",cancel:"mouseleave"};function Os(s){return s&&s.length>0?s[s.length-1]:null}function Oc(){return{pressDelay:600,dbClickDelay:200,disablePress:!1,disableDbClick:!1,miniStep:2,needPreventDefault:!0}}var Rc=function(){function s(a){var i=this,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{eventType:"touch"};q(this,s),I(this,"onTouchStart",function(e){var n=i._pos,r=i.root,o=Os(e.touches);n.x=o?parseInt(o.pageX,10):e.pageX,n.y=o?parseInt(o.pageX,10):e.pageX,n.start=!0,i.__setPress(e),r.addEventListener(i.events.end,i.onTouchEnd),r.addEventListener(i.events.cancel,i.onTouchCancel),r.addEventListener(i.events.move,i.onTouchMove),i.trigger(Dt.TOUCH_START,e)}),I(this,"onTouchCancel",function(e){i.onTouchEnd(e)}),I(this,"onTouchEnd",function(e){var n=i._pos,r=i.root;i.__clearPress(),r.removeEventListener(i.events.cancel,i.onTouchCancel),r.removeEventListener(i.events.end,i.onTouchEnd),r.removeEventListener(i.events.move,i.onTouchMove),e.moving=n.moving,e.press=n.press,n.press&&i.trigger(Dt.PRESS_END,e),i.trigger(Dt.TOUCH_END,e),!n.press&&!n.moving&&i.__setDb(e),n.press=!1,n.start=!1,n.moving=!1}),I(this,"onTouchMove",function(e){var n=i._pos,r=i.config,o=Os(e.touches),u=o?parseInt(o.pageX,10):e.pageX,l=o?parseInt(o.pageY,10):e.pageX,c=u-n.x,h=l-n.y;Math.abs(h)<r.miniStep&&Math.abs(c)<r.miniStep||(i.__clearPress(),n.press&&i.trigger(Dt.PRESS_END,e),n.press=!1,n.moving=!0,i.trigger(Dt.TOUCH_MOVE,e))}),this._pos={moving:!1,start:!1,x:0,y:0},this.config=Oc(),Object.keys(t).map(function(e){i.config[e]=t[e]}),this.root=a,this.events=t.eventType==="mouse"?Ic:Dc,this.pressIntrvalId=null,this.dbIntrvalId=null,this.__handlers={},this._initEvent()}return Q(s,[{key:"_initEvent",value:function(){this.root.addEventListener(this.events.start,this.onTouchStart)}},{key:"__setPress",value:function(i){var t=this,e=this.config;this.pressIntrvalId&&this.__clearPress(),this.pressIntrvalId=setTimeout(function(){t.trigger(Dt.PRESS,i),t._pos.press=!0,t.__clearPress()},e.pressDelay)}},{key:"__clearPress",value:function(){window.clearTimeout(this.pressIntrvalId),this.pressIntrvalId=null}},{key:"__setDb",value:function(i){var t=this,e=this.config;if(this.dbIntrvalId){this.__clearDb(),this.trigger(Dt.DOUBlE_CLICK,i);return}this.dbIntrvalId=setTimeout(function(){t.__clearDb(),!t._pos.start&&!t._pos.press&&!t._pos.moving&&t.trigger(Dt.CLICK,i)},e.dbClickDelay)}},{key:"__clearDb",value:function(){clearTimeout(this.dbIntrvalId),this.dbIntrvalId=null}},{key:"on",value:function(i,t){this.__handlers[i]||(this.__handlers[i]=[]),this.__handlers[i].push(t)}},{key:"off",value:function(i,t){if(this.__handlers[i]){for(var e=this.__handlers[i],n=-1,r=0;r<e.length;r++)if(e[r]===t){n=r;break}n>=0&&this.__handlers[i].splice(n,1)}}},{key:"trigger",value:function(i,t){this.__handlers[i]&&this.__handlers[i].map(function(e){try{e(t)}catch(n){console.error("trigger>>:".concat(i),n)}})}},{key:"destroy",value:function(){var i=this,t={touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart"};Object.keys(t).forEach(function(e){i.root.removeEventListener(e,i[t[e]])})}}]),s}();function Mc(){return new DOMParser().parseFromString(`<svg width="20" height="9" viewBox="0 0 8 9" fill="none" xmlns="http://www.w3.org/2000/svg"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <path opacity="0.54"
    d="M7.5 3.63397C8.16667 4.01887 8.16667 4.98113 7.5 5.36603L1.5 8.83013C0.833334 9.21503 0 8.7339 0 7.9641L0 1.0359C0 0.266098 0.833333 -0.215027 1.5 0.169873L7.5 3.63397Z"
    fill="white" />
  <path transform="translate(5 0)" d="M7.5 3.63397C8.16667 4.01887 8.16667 4.98113 7.5 5.36603L1.5 8.83013C0.833334 9.21503 0 8.7339 0 7.9641L0 1.0359C0 0.266098 0.833333 -0.215027 1.5 0.169873L7.5 3.63397Z" fill="white"/>
</svg>`,"image/svg+xml").firstChild}var ui={AUTO:"auto",SEEKING:"seeking",PLAYBACK:"playbackrate",LIGHT:""},tr=["videoClick","videoDbClick"],Nc=function(s){ie(i,s);var a=ne(i);function i(t){var e;return q(this,i),e=a.call(this,t),I(x(e),"onTouchStart",function(n){var r=x(e),o=r.player,u=r.config,l=r.pos,c=r.playerConfig,h=e.getTouche(n);if(h&&!u.disableGesture&&e.duration>0&&!o.ended){l.isStart=!0,e.timer&&clearTimeout(e.timer),p.checkIsFunction(c.disableSwipeHandler)&&c.disableSwipeHandler(),e.find(".xg-dur").innerHTML=p.format(e.duration);var f=e.root.getBoundingClientRect();o.rotateDeg===90?(l.top=f.left,l.left=f.top,l.width=f.height,l.height=f.width):(l.top=f.top,l.left=f.left,l.width=f.width,l.height=f.height);var d=parseInt(h.pageX-l.left,10),v=parseInt(h.pageY-l.top,10);l.x=o.rotateDeg===90?v:d,l.y=o.rotateDeg===90?d:v,l.scopeL=u.scopeL*l.width,l.scopeR=(1-u.scopeR)*l.width,l.scopeM1=l.width*(1-u.scopeM)/2,l.scopeM2=l.width-l.scopeM1}}),I(x(e),"onTouchMove",function(n){var r=e.getTouche(n),o=x(e),u=o.pos,l=o.config,c=o.player;if(!(!r||l.disableGesture||!e.duration||!u.isStart)){var h=l.miniMoveStep,f=l.hideControlsActive,d=parseInt(r.pageX-u.left,10),v=parseInt(r.pageY-u.top,10),m=c.rotateDeg===90?v:d,g=c.rotateDeg===90?d:v;if(Math.abs(m-u.x)>h||Math.abs(g-u.y)>h){var b=m-u.x,k=g-u.y,E=u.scope;if(E===-1&&(E=e.checkScope(m,g,b,k,u),E===0&&(f?c.blur():c.focus({autoHide:!1}),!u.time&&(u.time=parseInt(c.currentTime*1e3,10)+e.timeOffset*1e3)),u.scope=E),E===-1||E>0&&!l.gestureY||E===0&&!l.gestureX)return;e.executeMove(b,k,E,u.width,u.height),u.x=m,u.y=g}}}),I(x(e),"onTouchEnd",function(n){var r=x(e),o=r.player,u=r.pos,l=r.playerConfig;if(setTimeout(function(){o.getPlugin("progress")&&o.getPlugin("progress").resetSeekState()},10),!!u.isStart){u.scope>-1&&n.cancelable&&n.preventDefault();var c=e.config,h=c.disableGesture,f=c.gestureX;!h&&f?e.endLastMove(u.scope):u.time=0,u.scope=-1,e.resetPos(),p.checkIsFunction(l.enableSwipeHandler)&&l.enableSwipeHandler(),e.changeAction(ui.AUTO)}}),I(x(e),"onRootTouchMove",function(n){e.config.disableGesture||!e.config.gestureX||e.checkIsRootTarget(n)&&(n.stopPropagation(),e.pos.isStart?e.onTouchMove(n):e.onTouchStart(n))}),I(x(e),"onRootTouchEnd",function(n){e.pos.scope>-1&&e.onTouchEnd(n)}),e.pos={isStart:!1,x:0,y:0,time:0,volume:0,rate:1,light:0,width:0,height:0,scopeL:0,scopeR:0,scopeM1:0,scopeM2:0,scope:-1},e.timer=null,e}return Q(i,[{key:"duration",get:function(){return this.playerConfig.customDuration||this.player.duration}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"registerIcons",value:function(){return{seekTipIcon:{icon:Mc,class:"xg-seek-pre"}}}},{key:"afterCreate",value:function(){var e=this;tr.map(function(f){e.__hooks[f]=null});var n=this.playerConfig,r=this.config,o=this.player;n.closeVideoDblclick===!0&&(r.closedbClick=!0),this.resetPos(),p.isUndefined(n.disableGesture)||(r.disableGesture=!!n.disableGesture),this.appendChild(".xg-seek-icon",this.icons.seekTipIcon),this.xgMask=p.createDom("xg-mask","",{},"xgmask"),o.root.appendChild(this.xgMask),this.initCustomStyle(),this.registerThumbnail();var u=this.domEventType==="mouse"?"mouse":"touch";this.touch=new Rc(this.root,{eventType:u,needPreventDefault:!this.config.disableGesture}),this.root.addEventListener("contextmenu",function(f){f.preventDefault()}),o.root.addEventListener("touchmove",this.onRootTouchMove,!0),o.root.addEventListener("touchend",this.onRootTouchEnd,!0),o.root.addEventListener("touchcancel",this.onRootTouchEnd,!0);var l=this.player.controls;l&&l.center&&(l.center.addEventListener("touchmove",this.onRootTouchMove,!0),l.center.addEventListener("touchend",this.onRootTouchEnd,!0),l.center.addEventListener("touchcancel",this.onRootTouchEnd,!0)),this.on(Pt,function(){var f=e.player,d=e.config;f.duration>0&&f.duration*1e3<d.moveDuration&&(d.moveDuration=f.duration*1e3)}),this.on([bt,Ct],function(){var f=e.pos,d=f.time,v=f.isStart;!v&&d>0&&(e.pos.time=0)});var c={touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",press:"onPress",pressend:"onPressEnd",click:"onClick",doubleclick:"onDbClick"};if(Object.keys(c).map(function(f){e.touch.on(f,function(d){e[c[f]](d)})}),!r.disableActive){var h=o.plugins.progress;h&&(h.addCallBack("dragmove",function(f){e.activeSeekNote(f.currentTime,f.forward)}),["dragend","click"].forEach(function(f){h.addCallBack(f,function(){e.changeAction(ui.AUTO)})}))}}},{key:"registerThumbnail",value:function(){var e=this.player,n=e.plugins.thumbnail;if(n&&n.usable){this.thumbnail=n.createThumbnail(null,"mobile-thumbnail");var r=this.find(".time-preview");r.insertBefore(this.thumbnail,r.children[0])}}},{key:"initCustomStyle",value:function(){var e=this.playerConfig||{},n=e.commonStyle,r=n.playedColor,o=n.progressColor,u=n.timePreviewStyle,l=n.curTimeColor,c=n.durationColor;if(r&&(this.find(".xg-curbar").style.backgroundColor=r),o&&(this.find(".xg-bar").style.backgroundColor=o),u){var h=this.find(".time-preview");Object.keys(u).forEach(function(v){h.style[v]=u[v]})}var f=l||r,d=c;f&&(this.find(".xg-cur").style.color=f),d&&(this.find(".xg-dur").style.color=d),this.config.disableTimeProgress&&p.addClass(this.find(".xg-timebar"),"hide")}},{key:"resetPos",value:function(){var e=this;this.pos?(this.pos.isStart=!1,this.pos.scope=-1,["x","y","width","height","scopeL","scopeR","scopeM1","scopeM2"].map(function(n){e.pos[n]=0})):this.pos={isStart:!1,x:0,y:0,volume:0,rate:1,light:0,width:0,height:0,scopeL:0,scopeR:0,scopeM1:0,scopeM2:0,scope:-1,time:0}}},{key:"changeAction",value:function(e){var n=this.player,r=this.root;r.setAttribute("data-xg-action",e);var o=n.plugins.start;o&&o.recover()}},{key:"getTouche",value:function(e){var n=this.player.rotateDeg,r=e.touches&&e.touches.length>0?e.touches[e.touches.length-1]:e;return n===0?{pageX:r.pageX,pageY:r.pageY}:{pageX:r.pageX,pageY:r.pageY}}},{key:"checkScope",value:function(e,n,r,o,u){var l=u.width,c=-1;if(e<0||e>l)return c;var h=Math.abs(o===0?r:r/o);return Math.abs(r)>0&&h>=1.73&&e>u.scopeM1&&e<u.scopeM2?c=0:(Math.abs(r)===0||h<=.57)&&(c=e<u.scopeL?1:e>u.scopeR?2:3),c}},{key:"executeMove",value:function(e,n,r,o,u){switch(r){case 0:this.updateTime(e/o*this.config.scopeM);break;case 1:this.updateBrightness(n/u);break;case 2:oe.os.isIos||this.updateVolume(n/u);break}}},{key:"endLastMove",value:function(e){var n=this,r=this.pos,o=this.player,u=this.config,l=(r.time-this.timeOffset)/1e3;switch(e){case 0:o.seek(Number(l).toFixed(1)),u.hideControlsEnd?o.blur():o.focus(),this.timer=setTimeout(function(){n.pos.time=0},500);break}this.changeAction(ui.AUTO)}},{key:"checkIsRootTarget",value:function(e){var n=this.player.plugins||{};return n.progress&&n.progress.root.contains(e.target)?!1:n.start&&n.start.root.contains(e.target)||n.controls&&n.controls.root.contains(e.target)}},{key:"sendUseAction",value:function(e){var n=this.player.paused;this.emitUserAction(e,"switch_play_pause",{prop:"paused",from:n,to:!n})}},{key:"clickHandler",value:function(e){var n=this.player,r=this.config,o=this.playerConfig;if(n.state<me.RUNNING){o.closeVideoClick||(this.sendUseAction(p.createEvent("click")),n.play());return}!r.closedbClick||o.closeVideoClick?n.isActive?n.blur():n.focus():o.closeVideoClick||((n.isActive||r.focusVideoClick)&&(this.sendUseAction(p.createEvent("click")),this.switchPlayPause()),n.focus())}},{key:"dbClickHandler",value:function(e){var n=this.config,r=this.player;!n.closedbClick&&r.state>=me.RUNNING&&(this.sendUseAction(p.createEvent("dblclick")),this.switchPlayPause())}},{key:"onClick",value:function(e){var n=this,r=this.player;ht(this,tr[0],function(o,u){n.clickHandler(u.e)},{e,paused:r.paused})}},{key:"onDbClick",value:function(e){var n=this,r=this.player;ht(this,tr[1],function(o,u){n.dbClickHandler(u.e)},{e,paused:r.paused})}},{key:"onPress",value:function(e){var n=this.pos,r=this.config,o=this.player;r.disablePress||(n.rate=this.player.playbackRate,this.emitUserAction("press","change_rate",{prop:"playbackRate",from:o.playbackRate,to:r.pressRate}),o.playbackRate=r.pressRate,this.changeAction(ui.PLAYBACK))}},{key:"onPressEnd",value:function(e){var n=this.pos,r=this.config,o=this.player;r.disablePress||(this.emitUserAction("pressend","change_rate",{prop:"playbackRate",from:o.playbackRate,to:n.rate}),o.playbackRate=n.rate,n.rate=1,this.changeAction(ui.AUTO))}},{key:"updateTime",value:function(e){var n=this.player,r=this.config,o=this.player.duration;e=Number(e.toFixed(4));var u=parseInt(e*r.moveDuration,10)+this.timeOffset;u+=this.pos.time,u=u<0?0:u>o*1e3?o*1e3-200:u,n.getPlugin("time")&&n.getPlugin("time").updateTime(u/1e3),n.getPlugin("progress")&&n.getPlugin("progress").updatePercent(u/1e3/this.duration,!0),this.activeSeekNote(u/1e3,e>0),r.isTouchingSeek&&n.seek(Number((u-this.timeOffset)/1e3).toFixed(1)),this.pos.time=u}},{key:"updateVolume",value:function(e){this.player.rotateDeg&&(e=-e);var n=this.player,r=this.pos;if(e=parseInt(e*100,10),r.volume+=e,!(Math.abs(r.volume)<10)){var o=parseInt(n.volume*10,10)-parseInt(r.volume/10,10);o=o>10?10:o<1?0:o,n.volume=o/10,r.volume=0}}},{key:"updateBrightness",value:function(e){var n=this.pos,r=this.config,o=this.xgMask;if(r.darkness){this.player.rotateDeg&&(e=-e);var u=n.light+.8*e;u=u>r.maxDarkness?r.maxDarkness:u<0?0:u,o&&(o.style.backgroundColor="rgba(0,0,0,".concat(u,")")),n.light=u}}},{key:"activeSeekNote",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this.player,o=this.config,u=!(this.duration!==1/0&&this.duration>0);if(!(!e||typeof e!="number"||u||o.disableActive)){e<0?e=0:e>r.duration&&(e=r.duration-.2),this.changeAction(ui.SEEKING);var l=r.plugins.start;l&&l.focusHide(),this.find(".xg-dur").innerHTML=p.format(this.duration),this.find(".xg-cur").innerHTML=p.format(e),this.find(".xg-curbar").style.width="".concat(e/this.duration*100,"%"),n?p.removeClass(this.find(".xg-seek-show"),"xg-back"):p.addClass(this.find(".xg-seek-show"),"xg-back"),this.updateThumbnails(e)}}},{key:"updateThumbnails",value:function(e){var n=this.player,r=n.plugins.thumbnail;r&&r.usable&&this.thumbnail&&r.update(this.thumbnail,e,160,90)}},{key:"switchPlayPause",value:function(){var e=this.player;if(e.state<me.ATTACHED)return!1;e.ended||(e.paused?e.play():e.pause())}},{key:"disableGesture",value:function(){this.config.disableGesture=!0}},{key:"enableGesture",value:function(){this.config.disableGesture=!1}},{key:"destroy",value:function(){var e=this.player;this.timer&&clearTimeout(this.timer),this.thumbnail=null,e.root.removeChild(this.xgMask),this.xgMask=null,this.touch&&this.touch.destroy(),this.touch=null,e.root.removeEventListener("touchmove",this.onRootTouchMove,!0),e.root.removeEventListener("touchend",this.onRootTouchEnd,!0),e.root.removeEventListener("touchcancel",this.onRootTouchEnd,!0);var n=this.player.controls;n&&n.center&&(n.center.removeEventListener("touchmove",this.onRootTouchMove,!0),n.center.removeEventListener("touchend",this.onRootTouchEnd,!0),n.center.removeEventListener("touchcancel",this.onRootTouchEnd,!0))}},{key:"render",value:function(){var e=this.config.gradient!=="normal"?"gradient ".concat(this.config.gradient):"gradient";return`
     <xg-trigger class="trigger">
     <div class="`.concat(e,`"></div>
        <div class="time-preview">
            <div class="xg-seek-show `).concat(this.config.disableSeekIcon?" hide-seek-icon":"",`">
              <i class="xg-seek-icon"></i>
              <span class="xg-cur">00:00</span>
              <span class="xg-separator">/</span>
              <span class="xg-dur">00:00</span>
            </div>
              <div class="xg-bar xg-timebar">
                <div class="xg-curbar"></div>
              </div>
        </div>
        <div class="xg-playbackrate xg-top-note">
            <span><i>`).concat(this.config.pressRate,"X</i>").concat(this.i18n.FORWARD,`</span>
        </div>
     </xg-trigger>
    `)}}],[{key:"pluginName",get:function(){return"mobile"}},{key:"defaultConfig",get:function(){return{index:0,disableGesture:!1,gestureX:!0,gestureY:!0,gradient:"normal",isTouchingSeek:!1,miniMoveStep:5,miniYPer:5,scopeL:.25,scopeR:.25,scopeM:.9,pressRate:2,darkness:!0,maxDarkness:.8,disableActive:!1,disableTimeProgress:!1,hideControlsActive:!1,hideControlsEnd:!1,moveDuration:60*6*1e3,closedbClick:!1,disablePress:!0,disableSeekIcon:!1,focusVideoClick:!1}}}]),i}(fe);function Bc(s){s.preventDefault(),s.returnValue=!1}function Rs(s){var a=s.tagName;return!!(a==="INPUT"||a==="TEXTAREA"||s.isContentEditable)}var Ms=function(s){ie(i,s);var a=ne(i);function i(){var t;q(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=a.call.apply(a,[this].concat(n)),I(x(t),"onBodyKeyDown",function(o){if(t.player){var u=o||window.event,l=u.keyCode,c=x(t),h=c._keyState,f=c.player,d=t.config,v=d.disable,m=d.disableBodyTrigger,g=d.isIgnoreUserActive;if(v||m||!(f.isUserActive||g)||Rs(u.target)||!t.checkIsVisible()||u.metaKey||u.altKey||u.ctrlKey){h.isBodyKeyDown=!1;return}!o.repeat&&!h.isKeyDown&&((u.target===document.body||t.config.isGlobalTrigger&&!Rs(u.target))&&t.checkCode(l,!0)&&(h.isBodyKeyDown=!0),document.addEventListener("keyup",t.onBodyKeyUp)),h.isBodyKeyDown&&t.handleKeyDown(u)}}),I(x(t),"onBodyKeyUp",function(o){t.player&&(document.removeEventListener("keyup",t.onBodyKeyUp),t.handleKeyUp(o))}),I(x(t),"onKeydown",function(o){if(t.player){var u=o||window.event,l=x(t),c=l._keyState;if(!u.repeat){if(t.config.disable||t.config.disableRootTrigger||u.metaKey||u.altKey||u.ctrlKey)return;u&&(u.keyCode===37||t.checkCode(u.keyCode))&&(u.target===t.player.root||u.target===t.player.video||u.target===t.player.controls.el)&&(c.isKeyDown=!0),t.player.root.addEventListener("keyup",t.onKeyup)}c.isKeyDown&&t.handleKeyDown(u)}}),I(x(t),"onKeyup",function(o){t.player&&(t.player.root.removeEventListener("keyup",t.onKeyup),t.handleKeyUp(o))}),t}return Q(i,[{key:"mergekeyCodeMap",value:function(){var e=this,n=this.config.keyCodeMap;n&&Object.keys(n).map(function(r){e.keyCodeMap[r]?["keyCode","action","disable","pressAction","disablePress","isBodyTarget"].map(function(o){n[r][o]&&(e.keyCodeMap[r][o]=n[r][o])}):e.keyCodeMap[r]=n[r]})}},{key:"afterCreate",value:function(){this.config.disable=!this.playerConfig.keyShortcut;var e=typeof this.config.seekStep=="function"?this.config.seekStep(this.player):this.config.seekStep;!e||typeof e!="number"||(this.seekStep=e),this.keyCodeMap={space:{keyCode:32,action:"playPause",disable:!1,disablePress:!1,noBodyTarget:!1},up:{keyCode:38,action:"upVolume",disable:!1,disablePress:!1,noBodyTarget:!0},down:{keyCode:40,action:"downVolume",disable:!1,disablePress:!1,noBodyTarget:!0},left:{keyCode:37,action:"seekBack",disablePress:!1,disable:!1},right:{keyCode:39,action:"seek",pressAction:"changePlaybackRate",disablePress:!1,disable:!1},esc:{keyCode:27,action:"exitFullscreen",disablePress:!0,disable:!1}},this.mergekeyCodeMap(),this._keyState={isKeyDown:!1,isBodyKeyDown:!1,isPress:!1,tt:0,playbackRate:0},this.player.root.addEventListener("keydown",this.onKeydown),document.addEventListener("keydown",this.onBodyKeyDown)}},{key:"setConfig",value:function(e){var n=this;Object.keys(e).forEach(function(r){n.config[r]=e[r]})}},{key:"checkIsVisible",value:function(){if(!this.config.checkVisible)return!0;var e=this.player.root.getBoundingClientRect(),n=e.height,r=e.top,o=e.bottom,u=window.innerHeight;return!(r<0&&r<0-n*.9||o>0&&o-u>n*.9)}},{key:"checkCode",value:function(e,n){var r=this,o=!1;return Object.keys(this.keyCodeMap).map(function(u){r.keyCodeMap[u]&&e===r.keyCodeMap[u].keyCode&&!r.keyCodeMap[u].disable&&(o=!n||n&&!r.keyCodeMap[u].noBodyTarget)}),o}},{key:"downVolume",value:function(e){var n=this.player;if(!(n.volume<=0)){var r=parseFloat((n.volume-.1).toFixed(1)),o={volume:{from:n.volume,to:r}};this.emitUserAction(e,"change_volume",{props:o}),r>=0?n.volume=r:n.volume=0}}},{key:"upVolume",value:function(e){var n=this.player;if(!(n.volume>=1)){var r=parseFloat((n.volume+.1).toFixed(1)),o={volume:{from:n.volume,to:r}};this.emitUserAction(e,"change_volume",{props:o}),r<=1?n.volume=r:n.volume=1}}},{key:"seek",value:function(e){var n=this.player,r=n.currentTime,o=n.offsetCurrentTime,u=n.duration,l=n.offsetDuration,c=n.timeSegments,h=o>-1?o:r,f=l||u,d=e.repeat&&this.seekStep>=4?parseInt(this.seekStep/2,10):this.seekStep;h+d<=f?h=h+d:h=f;var v=p.getCurrentTimeByOffset(h,c),m={currentTime:{from:r,to:v}};this.emitUserAction(e,"seek",{props:m}),this.player.currentTime=v}},{key:"seekBack",value:function(e){var n=this.player,r=n.currentTime,o=n.offsetCurrentTime,u=n.timeSegments,l=e.repeat?parseInt(this.seekStep/2,10):this.seekStep,c=o>-1?o:r,h=c-l;h<0&&(h=0),h=p.getCurrentTimeByOffset(h,u);var f={currentTime:{from:r,to:h}};this.emitUserAction(e,"seek",{props:f}),this.player.currentTime=h}},{key:"changePlaybackRate",value:function(e){var n=this._keyState,r=this.config,o=this.player;n.playbackRate===0&&(n.playbackRate=o.playbackRate,o.playbackRate=r.playbackRate)}},{key:"playPause",value:function(e){var n=this.player;n&&(this.emitUserAction(e,"switch_play_pause"),n.paused?n.play():n.pause())}},{key:"exitFullscreen",value:function(e){var n=this.player,r=n.fullscreen,o=n.cssfullscreen;r&&(this.emitUserAction("keyup","switch_fullscreen",{prop:"fullscreen",from:r,to:!r}),n.exitFullscreen()),o&&(this.emitUserAction("keyup","switch_css_fullscreen",{prop:"cssfullscreen",from:o,to:!o}),n.exitCssFullscreen())}},{key:"handleKeyDown",value:function(e){var n=this._keyState;if(e.repeat){n.isPress=!0;var r=Date.now();if(r-n.tt<200)return;n.tt=r}this.handleKeyCode(e.keyCode,e,n.isPress)}},{key:"handleKeyUp",value:function(e){var n=this._keyState;n.playbackRate>0&&(this.player.playbackRate=n.playbackRate,n.playbackRate=0),n.isKeyDown=!1,n.isPress=!1,n.tt=0}},{key:"handleKeyCode",value:function(e,n,r){for(var o=Object.keys(this.keyCodeMap),u=0;u<o.length;u++){var l=this.keyCodeMap[o[u]],c=l.action,h=l.keyCode,f=l.disable,d=l.pressAction,v=l.disablePress;if(h===e){if(!f&&!(r&&v)){var m=r&&d||c;typeof m=="function"?c(n,this.player,r):typeof m=="string"&&typeof this[m]=="function"&&this[m](n,this.player,r),this.emit(Ba,Le({key:o[u],target:n.target,isPress:r},this.keyCodeMap[o[u]]))}Bc(n),n.stopPropagation();break}}}},{key:"destroy",value:function(){this.player.root.removeEventListener("keydown",this.onKeydown),document.removeEventListener("keydown",this.onBodyKeyDown),this.player.root.removeEventListener("keyup",this.onKeyup),document.removeEventListener("keyup",this.onBodyKeyUp)}},{key:"disable",value:function(){this.config.disable=!0}},{key:"enable",value:function(){this.config.disable=!1}}],[{key:"pluginName",get:function(){return"keyboard"}},{key:"defaultConfig",get:function(){return{seekStep:10,checkVisible:!1,disableBodyTrigger:!1,disableRootTrigger:!1,isGlobalTrigger:!0,keyCodeMap:{},disable:!1,playbackRate:2,isIgnoreUserActive:!0}}}]),i}(gt);function Fc(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="-5 -5 110 110">
  <path d="M100,50A50,50,0,1,1,50,0" stroke-width="5" stroke="#ddd" stroke-dasharray="236" fill="none"></path>
</svg>
`,"image/svg+xml").firstChild}var Uc=function(s){ie(i,s);var a=ne(i);function i(){return q(this,i),a.apply(this,arguments)}return Q(i,[{key:"registerIcons",value:function(){return{loadingIcon:Fc}}},{key:"afterCreate",value:function(){this.appendChild("xg-loading-inner",this.icons.loadingIcon)}},{key:"render",value:function(){return`
    <xg-loading class="xgplayer-loading">
      <xg-loading-inner></xg-loading-inner>
    </xg-loading>`}}],[{key:"pluginName",get:function(){return"loading"}},{key:"defaultConfig",get:function(){return{position:Te.ROOT}}}]),i}(fe),Hc=[{tag:"xg-cache",className:"xgplayer-progress-cache",styleKey:"cachedColor"},{tag:"xg-played",className:"xgplayer-progress-played",styleKey:"playedColor"}],Vc=function(){function s(a){q(this,s),this.fragments=a.fragments||[],this.fragments.length===0&&this.fragments.push({percent:1}),this._callBack=a.actionCallback,this.fragConfig={fragFocusClass:a.fragFocusClass||"inner-focus-point",fragAutoFocus:!!a.fragAutoFocus,fragClass:a.fragClass||""},this.style=a.style||{playedColor:"",cachedColor:"",progressColor:""},this.duration=0,this.cachedIndex=0,this.playedIndex=0,this.focusIndex=-1}return Q(s,[{key:"updateDuration",value:function(i){var t=this;this.duration=i;var e=0,n=this.fragments;this.fragments=n.map(function(r){return r.start=parseInt(e,10),r.end=parseInt(e+r.percent*t.duration,10),r.duration=parseInt(r.percent*t.duration,10),e+=r.percent*t.duration,r})}},{key:"updateProgress",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"played",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{newIndex:0,curIndex:0,millisecond:0},e=this.progressList,n=this.fragments;if(!(e.length<1)){var r=t.newIndex,o=t.curIndex,u=t.millisecond;r!==o&&e.map(function(h,f){f<r?h[i].style.width="100%":f>r&&(h[i].style.width=0)});var l=n[r],c=u===0?0:(u-l.start)/l.duration;e[r][i].style.width=c<0?0:"".concat(c*100,"%")}}},{key:"updateFocus",value:function(i){if(!(!this.fragConfig.fragAutoFocus||this.fragments.length<2)){if(!i){if(this.focusIndex>-1){this.unHightLight(this.focusIndex);var t={index:-1,preIndex:this.focusIndex,fragment:null};this._callBack&&this._callBack(t),this.focusIndex=-1}return}var e=this.findIndex(i.currentTime*1e3,this.focusIndex);if(e>=0&&e!==this.focusIndex){this.focusIndex>-1&&this.unHightLight(this.focusIndex),this.setHightLight(e);var n={index:e,preIndex:this.focusIndex,fragment:this.fragments[this.focusIndex]};this.focusIndex=e,this._callBack&&this._callBack(n)}}}},{key:"update",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{cached:0,played:0},t=arguments.length>1?arguments[1]:void 0;if(!this.duration||parseInt(t*1e3,10)!==this.duration){if(!t&&t!==0)return;this.updateDuration(parseInt(t*1e3,10))}var e=this.playedIndex,n=this.cachedIndex;if(p.typeOf(i.played)!=="Undefined"){var r=this.findIndex(i.played*1e3,e);if(r<0)return;this.updateProgress("played",{newIndex:r,curIndex:e,millisecond:parseInt(i.played*1e3,10)}),this.playedIndex=r}if(p.typeOf(i.cached)!=="Undefined"){var o=this.findIndex(i.cached*1e3,n);if(o<0)return;this.updateProgress("cached",{newIndex:o,curIndex:n,millisecond:parseInt(i.cached*1e3,10)}),this.cachedIndex=o}}},{key:"findIndex",value:function(i,t){var e=this.fragments;if(!e||e.length===0)return-1;if(e.length===1)return 0;if(t>-1&&t<e.length&&i>e[t].start&&i<e[t].end)return t;if(i>e[e.length-1].start)return e.length-1;for(var n=0;n<e.length;n++)if(i>e[n].start&&i<=e[n].end){t=n;break}return t}},{key:"findHightLight",value:function(){for(var i=this.root.children,t=0;t<i.length;t++)if(p.hasClass(i[t],this.fragConfig.fragFocusClass))return{dom:i[t],pos:i[t].getBoundingClientRect()}}},{key:"findFragment",value:function(i){var t=this.root.children;return i<0||i>=t.length?null:{dom:t[i],pos:t[i].getBoundingClientRect()}}},{key:"unHightLight",value:function(){for(var i=this.root.children,t=0;t<i.length;t++)p.removeClass(i[t],this.fragConfig.fragFocusClass)}},{key:"setHightLight",value:function(i){var t=this.root.children;if(i<t.length)return p.addClass(t[i],this.fragConfig.fragFocusClass),{dom:t[i],pos:t[i].getBoundingClientRect()}}},{key:"destroy",value:function(){this.progressList=null,this.fragments=null,this.root.innerHTML=""}},{key:"reset",value:function(i){var t=this;if(Object.keys(this.fragConfig).forEach(function(n){i[n]!==void 0&&(t.fragConfig[n]=i[n])}),i.fragments){if(this.fragments=i.fragments.length===0?[{percent:1}]:i.fragments,this.updateDuration(this.duration),this.playedIndex=0,this.cachedIndex=0,this.root)for(var e=this.root.children;e.length>0;)this.root.removeChild(e[0]);this.render()}}},{key:"render",value:function(){var i=this,t=this.style.progressColor;if(this.root||(this.root=p.createDom("xg-inners","",{},"progress-list")),this.fragments){var e=this.fragConfig,n=e.fragClass,r=e.fragFocusClass;this.progressList=this.fragments.map(function(o){var u=p.createDom("xg-inner","",{style:t?"background:".concat(t,"; flex: ").concat(o.percent):"flex: ".concat(o.percent)},"".concat(o.isFocus?r:""," xgplayer-progress-inner ").concat(n));return i.root.appendChild(u),Hc.forEach(function(l){u.appendChild(p.createDom(l.tag,"",{style:l.styleKey?"background: ".concat(i.style[l.styleKey],"; width:0;"):"width:0;"},l.className))}),{cached:u.children[0],played:u.children[1]}})}return this.root}}]),s}(),Ns={POINT:"inner-focus-point",HIGHLIGHT:"inner-focus-highlight"},Qa=function(s){ie(i,s);var a=ne(i);function i(t){var e;return q(this,i),e=a.call(this,t),I(x(e),"onMoveOnly",function(n,r){var o=x(e),u=o.pos,l=o.config,c=o.player,h=r;if(n){p.event(n);var f=p.getEventPos(n,c.zoom),d=c.rotateDeg===90?f.clientY:f.clientX;if(u.moving&&Math.abs(u.x-d)<l.miniMoveStep)return;u.moving=!0,u.x=d,h=e.computeTime(n,d)}e.triggerCallbacks("dragmove",h,n),e._updateInnerFocus(h)}),I(x(e),"onBodyClick",function(n){e.pos.isLocked&&(e.pos.isLocked=!1,n.preventDefault(),n.stopPropagation())}),I(x(e),"_mouseDownHandler",function(n,r){e._state.time=r.currentTime,e.updateWidth(r.currentTime,r.seekTime,r.percent,0),e._updateInnerFocus(r)}),I(x(e),"_mouseUpHandler",function(n,r){var o=x(e),u=o.pos;u.moving&&e.updateWidth(r.currentTime,r.seekTime,r.percent,2)}),I(x(e),"_mouseMoveHandler",function(n,r){var o=x(e),u=o._state,l=o.pos,c=o.config,h=o.player;u.time<r.currentTime?r.forward=!0:r.forward=!1,u.time=r.currentTime,l.isDown&&!l.moving&&(l.moving=!0,c.isPauseMoving&&h.pause(),e.triggerCallbacks("dragstart",r,n),e.emitUserAction("drag","dragstart",r)),e.updateWidth(r.currentTime,r.seekTime,r.percent,1),e.triggerCallbacks("dragmove",r,n),e._updateInnerFocus(r)}),I(x(e),"onMouseDown",function(n){var r=x(e),o=r._state,u=r.player,l=r.pos,c=r.config,h=r.playerConfig,f=p.getEventPos(n,u.zoom),d=u.rotateDeg===90?f.clientY:f.clientX;if(!(u.isMini||c.closeMoveSeek||!h.allowSeekAfterEnded&&u.ended)){if(!u.duration&&!u.isPlaying){u.play();return}n.stopPropagation(),e.focus(),p.checkIsFunction(h.disableSwipeHandler)&&h.disableSwipeHandler(),p.checkIsFunction(c.onMoveStart)&&c.onMoveStart(),p.event(n),l.x=d,l.isDown=!0,l.moving=!1,o.prePlayTime=u.currentTime,u.focus({autoHide:!1}),e.isProgressMoving=!0,p.addClass(e.progressBtn,"active");var v=e.computeTime(n,d);v.prePlayTime=o.prePlayTime,e._mouseDownHandlerHook(n,v);var m=n.type;return m==="touchstart"?(e.root.addEventListener("touchmove",e.onMouseMove),e.root.addEventListener("touchend",e.onMouseUp),e.root.addEventListener("touchcancel",e.onMouseUp)):(e.unbind("mousemove",e.onMoveOnly),document.addEventListener("mousemove",e.onMouseMove,!1),document.addEventListener("mouseup",e.onMouseUp,!1)),!0}}),I(x(e),"onMouseUp",function(n){var r=x(e),o=r.player,u=r.config,l=r.pos,c=r.playerConfig,h=r._state;n.stopPropagation(),n.preventDefault(),p.checkIsFunction(c.enableSwipeHandler)&&c.enableSwipeHandler(),p.checkIsFunction(u.onMoveEnd)&&u.onMoveEnd(),p.event(n),p.removeClass(e.progressBtn,"active");var f=e.computeTime(n,l.x);f.prePlayTime=h.prePlayTime,l.moving?(e.triggerCallbacks("dragend",f,n),e.emitUserAction("drag","dragend",f)):(e.triggerCallbacks("click",f,n),e.emitUserAction("click","click",f)),e._mouseUpHandlerHook(n,f),l.moving=!1,l.isDown=!1,l.x=0,l.y=0,l.isLocked=!0,h.prePlayTime=0,h.time=0;var d=n.type;d==="touchend"||d==="touchcancel"?(e.root.removeEventListener("touchmove",e.onMouseMove),e.root.removeEventListener("touchend",e.onMouseUp),e.root.removeEventListener("touchcancel",e.onMouseUp),e.blur()):(document.removeEventListener("mousemove",e.onMouseMove,!1),document.removeEventListener("mouseup",e.onMouseUp,!1),l.isEnter?c.isMobileSimulateMode!=="mobile"&&e.bind("mousemove",e.onMoveOnly):e.onMouseLeave(n)),p.setTimeout(x(e),function(){e.resetSeekState()},1),o.focus()}),I(x(e),"onMouseMove",function(n){var r=x(e),o=r._state,u=r.pos,l=r.player,c=r.config;p.checkTouchSupport()&&n.preventDefault(),p.event(n);var h=p.getEventPos(n,l.zoom),f=l.rotateDeg===90?h.clientY:h.clientX,d=Math.abs(u.x-f);if(!(u.moving&&d<c.miniMoveStep||!u.moving&&d<c.miniStartStep)){u.x=f;var v=e.computeTime(n,f);v.prePlayTime=o.prePlayTime,e._mouseMoveHandlerHook(n,v)}}),I(x(e),"onMouseOut",function(n){e.triggerCallbacks("mouseout",null,n)}),I(x(e),"onMouseOver",function(n){e.triggerCallbacks("mouseover",null,n)}),I(x(e),"onMouseEnter",function(n){var r=x(e),o=r.player,u=r.pos;if(!(u.isDown||u.isEnter||o.isMini||!o.config.allowSeekAfterEnded&&o.ended)){u.isEnter=!0,e.bind("mousemove",e.onMoveOnly),e.bind("mouseleave",e.onMouseLeave),p.event(n);var l=p.getEventPos(n,o.zoom),c=o.rotateDeg===90?l.clientY:l.clientX,h=e.computeTime(n,c);e.triggerCallbacks("mouseenter",h,n),e.focus()}}),I(x(e),"onMouseLeave",function(n){e.triggerCallbacks("mouseleave",null,n),e.unlock(),e._updateInnerFocus(null)}),I(x(e),"onVideoResize",function(){var n=e.pos,r=n.x,o=n.isDown,u=n.isEnter;if(u&&!o){var l=e.computeTime(null,r);e.onMoveOnly(null,l)}}),e.useable=!1,e.isProgressMoving=!1,e.__dragCallBacks=[],e._state={now:-1,direc:0,time:0,prePlayTime:-1},e._disableBlur=!1,typeof e.config.isDragingSeek=="boolean"&&(console.warn("[XGPLAYER] 'isDragingSeek' is deprecated, please use 'isDraggingSeek' instead"),e.config.isDraggingSeek=e.config.isDragingSeek),e}return Q(i,[{key:"offsetDuration",get:function(){return this.playerConfig.customDuration||this.player.offsetDuration||this.player.duration}},{key:"duration",get:function(){return this.playerConfig.customDuration||this.player.duration}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"currentTime",get:function(){var e=this.player,n=e.offsetCurrentTime,r=e.currentTime;return n>=0?n:r+this.timeOffset}},{key:"changeState",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.useable=e}},{key:"show",value:function(e){this.root&&(this.root.style.display="flex")}},{key:"_initInner",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(!n||n.length===0)&&(n=[{percent:1}]);var o=Le(Le({fragments:n},r),{},{actionCallback:function(l){e.emitUserAction("fragment_focus","fragment_focus",l)}});this.innerList?this.innerList.reset(o):(this.innerList=new Vc(o),this.outer.insertBefore(this.innerList.render(),this.outer.children[0]),["findHightLight","unHightLight","setHightLight","findFragment"].map(function(u){e[u]=e.innerList[u].bind(e.innerList)}))}},{key:"_updateInnerFocus",value:function(e){this.innerList&&this.innerList.updateFocus(e)}},{key:"afterCreate",value:function(){if(!(this.config.disable||this.playerConfig.isLive)){this.pos={x:0,y:0,moving:!1,isDown:!1,isEnter:!1,isLocked:!1},this.outer=this.find("xg-outer");var e=this.config,n=e.fragFocusClass,r=e.fragAutoFocus,o=e.fragClass;this._initInner(this.config.fragments,{fragFocusClass:n,fragAutoFocus:r,fragClass:o,style:this.playerConfig.commonStyle||{}}),oe.device==="mobile"&&(this.config.isDraggingSeek=!1,this.isMobile=!0),this.progressBtn=this.find(".xgplayer-progress-btn"),this.listenEvents(),this.bindDomEvents(),this.initCustomStyle()}}},{key:"listenEvents",value:function(){var e=this;this.on(Pt,function(){e.onMouseLeave()}),this.on($e,function(){e.onTimeupdate()}),this.on(kt,function(){e.onTimeupdate(),e.onCacheUpdate()}),this.on(xa,function(){e.onCacheUpdate()}),this.on(Ct,function(){e.onCacheUpdate(!0),e.onTimeupdate(!0),e._state.now=0}),this.on(ii,function(){e.onReset()}),this.on(pt,function(){e.onVideoResize()})}},{key:"setConfig",value:function(e){var n=this,r=null;Object.keys(e).forEach(function(o){n.config[o]=e[o],o==="fragments"&&(r=e[o])}),r&&this._initInner(r,e)}},{key:"initCustomStyle",value:function(){var e=this.playerConfig||{},n=e.commonStyle,r=n.sliderBtnStyle,o=this.progressBtn;r&&(typeof r=="string"?o.style.boxShadow=r:Ge(r)==="object"&&Object.keys(r).map(function(u){o.style[u]=r[u]}))}},{key:"triggerCallbacks",value:function(e,n,r){this.__dragCallBacks.length>0&&this.__dragCallBacks.map(function(o){if(o&&o.handler&&o.type===e)try{o.handler(n,r)}catch(u){console.error("[XGPLAYER][triggerCallbacks] ".concat(o," error"),u)}})}},{key:"addCallBack",value:function(e,n){n&&typeof n=="function"&&this.__dragCallBacks.push({type:e,handler:n})}},{key:"removeCallBack",value:function(e,n){var r=this.__dragCallBacks,o=-1;r.map(function(u,l){u&&u.type===e&&u.handler===n&&(o=l)}),o>-1&&r.splice(o,1)}},{key:"unlock",value:function(){var e=this.player,n=this.pos;if(n.isEnter=!1,n.isLocked=!1,!e.isMini){if(this.unbind("mousemove",this.onMoveOnly),n.isDown){this.unbind("mouseleave",this.onMouseLeave);return}this.blur()}}},{key:"bindDomEvents",value:function(){var e=this.player.config;this._mouseDownHandlerHook=this.hook("dragstart",this._mouseDownHandler),this._mouseUpHandlerHook=this.hook("dragend",this._mouseUpHandler),this._mouseMoveHandlerHook=this.hook("drag",this._mouseMoveHandler),(this.domEventType==="touch"||this.domEventType==="compatible")&&this.root.addEventListener("touchstart",this.onMouseDown),(this.domEventType==="mouse"||this.domEventType==="compatible")&&(this.bind("mousedown",this.onMouseDown),e.isMobileSimulateMode!=="mobile"&&this.bind("mouseenter",this.onMouseEnter),this.bind("mouseover",this.onMouseOver),this.bind("mouseout",this.onMouseOut),this.player.root.addEventListener("click",this.onBodyClick,!0))}},{key:"focus",value:function(){this.player.controls.pauseAutoHide(),p.addClass(this.root,"active")}},{key:"blur",value:function(){this._disableBlur||(this.player.controls.recoverAutoHide(),p.removeClass(this.root,"active"))}},{key:"disableBlur",value:function(){this._disableBlur=!0}},{key:"enableBlur",value:function(){this._disableBlur=!1}},{key:"updateWidth",value:function(e,n,r,o){var u=this.config,l=this.player;if(!(u.isCloseClickSeek&&o===0)){var c=n=n>=l.duration?l.duration-u.endedDiff:Number(n).toFixed(1);this.updatePercent(r),this.updateTime(e),!(o===1&&(!u.isDraggingSeek||l.config.mediaType==="audio"))&&(this._state.now=c,this._state.direc=c>l.currentTime?0:1,l.seek(c))}}},{key:"computeTime",value:function(e,n){var r=this.player,o=this.root.getBoundingClientRect(),u=o.width,l=o.height,c=o.top,h=o.left,f,d,v=n;r.rotateDeg===90?(f=l,d=c):(f=u,d=h);var m=v-d;m=m>f?f:m<0?0:m;var g=m/f;g=g<0?0:g>1?1:g;var b=parseInt(g*this.offsetDuration*1e3,10)/1e3,k=p.getCurrentTimeByOffset(b,r.timeSegments);return{percent:g,currentTime:b,seekTime:k,offset:m,width:f,left:d,e}}},{key:"updateTime",value:function(e){var n=this.player,r=this.duration;e>r?e=r:e<0&&(e=0);var o=n.plugins.time;o&&o.updateTime(e)}},{key:"resetSeekState",value:function(){this.isProgressMoving=!1;var e=this.player.plugins.time;e&&e.resetActive()}},{key:"updatePercent",value:function(e,n){if(this.isProgressMoving=!0,!this.config.disable){e=e>1?1:e<0?0:e,this.progressBtn.style.left="".concat(e*100,"%"),this.innerList.update({played:e*this.offsetDuration},this.offsetDuration);var r=this.player.plugins.miniprogress;r&&r.update({played:e*this.offsetDuration},this.offsetDuration)}}},{key:"onTimeupdate",value:function(e){var n=this.player,r=this._state,o=this.offsetDuration;if(!(n.isSeeking&&n.media.seeking||this.isProgressMoving||!n.hasStart)){if(r.now>-1){var u=parseInt(r.now*1e3,10)-parseInt(n.currentTime*1e3,10);if(r.direc===0&&u>300||r.direc===1&&u>-300){r.now=-1;return}else r.now=-1}var l=this.currentTime;l=p.adjustTimeByDuration(l,o,e),this.innerList.update({played:l},o),this.progressBtn.style.left="".concat(l/o*100,"%")}}},{key:"onCacheUpdate",value:function(e){var n=this.player,r=this.duration;if(n){var o=n.bufferedPoint.end;o=p.adjustTimeByDuration(o,r,e),this.innerList.update({cached:o},r)}}},{key:"onReset",value:function(){this.innerList.update({played:0,cached:0},0),this.progressBtn.style.left="0%"}},{key:"destroy",value:function(){var e=this.player;this.thumbnailPlugin=null,this.innerList.destroy(),this.innerList=null;var n=this.domEventType;(n==="touch"||n==="compatible")&&(this.root.removeEventListener("touchstart",this.onMouseDown),this.root.removeEventListener("touchmove",this.onMouseMove),this.root.removeEventListener("touchend",this.onMouseUp),this.root.removeEventListener("touchcancel",this.onMouseUp)),(n==="mouse"||n==="compatible")&&(this.unbind("mousedown",this.onMouseDown),this.unbind("mouseenter",this.onMouseEnter),this.unbind("mousemove",this.onMoveOnly),this.unbind("mouseleave",this.onMouseLeave),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1),e.root.removeEventListener("click",this.onBodyClick,!0))}},{key:"render",value:function(){if(!(this.config.disable||this.playerConfig.isLive)){var e=this.player.controls?this.player.controls.config.mode:"",n=e==="bottom"?"xgplayer-progress-bottom":"";return`
    <xg-progress class="xgplayer-progress `.concat(n,`">
      <xg-outer class="xgplayer-progress-outer">
        <xg-progress-btn class="xgplayer-progress-btn"></xg-progress-btn>
      </xg-outer>
    </xg-progress>
    `)}}}],[{key:"pluginName",get:function(){return"progress"}},{key:"defaultConfig",get:function(){return{position:Te.CONTROLS_CENTER,index:0,disable:!1,isDraggingSeek:!0,closeMoveSeek:!1,isPauseMoving:!1,isCloseClickSeek:!1,fragments:[{percent:1}],fragFocusClass:Ns.POINT,fragClass:"",fragAutoFocus:!1,miniMoveStep:5,miniStartStep:2,onMoveStart:function(){},onMoveEnd:function(){},endedDiff:.2}}},{key:"FRAGMENT_FOCUS_CLASS",get:function(){return Ns}}]),i}(fe),ni=function(s){ie(i,s);var a=ne(i);function i(){var t;q(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=a.call.apply(a,[this].concat(n)),I(x(t),"_onMouseenter",function(o){t.emit("icon_mouseenter",{pluginName:t.pluginName})}),I(x(t),"_onMouseLeave",function(o){t.emit("icon_mouseleave",{pluginName:t.pluginName})}),t}return Q(i,[{key:"afterCreate",value:function(){this.bind("mouseenter",this._onMouseenter),this.bind("mouseleave",this._onMouseLeave),this.config.disable&&this.disable()}},{key:"destroy",value:function(){this.unbind("mouseenter",this._onMouseenter),this.unbind("mouseleave",this._onMouseLeave)}}]),i}(fe),Ja=function(s){ie(i,s);var a=ne(i);function i(){var t;q(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=a.call.apply(a,[this].concat(n)),I(x(t),"btnClick",function(o){o.preventDefault(),o.stopPropagation();var u=x(t),l=u.player;return t.emitUserAction(o,"switch_play_pause",{prop:"paused",from:l.paused,to:!l.paused}),l.ended?l.replay():l.paused?(l.play(),t.animate(!1)):(l.pause(),t.animate(!0)),!1}),t}return Q(i,[{key:"afterCreate",value:function(){ue(se(i.prototype),"afterCreate",this).call(this);var e=this.config;e.disable||(this.initIcons(),this.bind(["touchend","click"],this.btnClick),this.listenEvents(),this.animate(!0))}},{key:"listenEvents",value:function(){var e=this,n=this.player;this.on([je,dt,Ti,ii],function(){e.animate(n.paused)})}},{key:"registerIcons",value:function(){return{play:{icon:Qr,class:"xg-icon-play"},pause:{icon:Jr,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.play),this.appendChild(".xgplayer-icon",e.pause)}},{key:"animate",value:function(e){if(this.player){var n=this.i18nKeys,r=this.find(".xg-tips");e?(this.setAttr("data-state","pause"),r&&this.changeLangTextKey(r,n.PLAY_TIPS)):(this.setAttr("data-state","play"),r&&this.changeLangTextKey(r,n.PAUSE_TIPS))}}},{key:"destroy",value:function(){ue(se(i.prototype),"destroy",this).call(this),this.unbind(["touchend","click"],this.btnClick)}},{key:"render",value:function(){if(!this.config.disable)return`<xg-icon class="xgplayer-play">
    <div class="xgplayer-icon">
    </div>
    `.concat(Bt(this,"PLAY_TIPS",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"play"}},{key:"defaultConfig",get:function(){return{position:Te.CONTROLS_LEFT,index:0,disable:!1}}}]),i}(ni);function $c(){return new DOMParser().parseFromString(`<svg width="32px" height="40px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <path d="M11.2374369,14 L17.6187184,7.61871843 C17.9604272,7.27700968 17.9604272,6.72299032 17.6187184,6.38128157 C17.2770097,6.03957281 16.7229903,6.03957281 16.3812816,6.38128157 L9.38128157,13.3812816 C9.03957281,13.7229903 9.03957281,14.2770097 9.38128157,14.6187184 L16.3812816,21.6187184 C16.7229903,21.9604272 17.2770097,21.9604272 17.6187184,21.6187184 C17.9604272,21.2770097 17.9604272,20.7229903 17.6187184,20.3812816 L11.2374369,14 L11.2374369,14 Z" fill="#FFFFFF"></path>
    </g>
</svg>`,"image/svg+xml").firstChild}var Gc=function(s){ie(i,s);var a=ne(i);function i(){return q(this,i),a.apply(this,arguments)}return Q(i,[{key:"afterCreate",value:function(){var e=this;this.initIcons(),this.onClick=function(n){n.preventDefault(),n.stopPropagation(),e.config.onClick(n)},this.bind(["click","touchend"],this.onClick)}},{key:"registerIcons",value:function(){return{screenBack:{icon:$c,class:"xg-fullscreen-back"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(this.root,e.screenBack)}},{key:"show",value:function(){p.addClass(this.root,"show")}},{key:"hide",value:function(){p.removeClass(this.root,"show")}},{key:"render",value:function(){return`<xg-icon class="xgplayer-back">
    </xg-icon>`}}],[{key:"pluginName",get:function(){return"topbackicon"}},{key:"defaultConfig",get:function(){return{position:Te.ROOT_TOP,index:0}}}]),i}(fe);function jc(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="2 -4 28 40">
  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M598 214h212v212h-84v-128h-128v-84zM726 726v-128h84v212h-212v-84h128zM214 426v-212h212v84h-128v128h-84zM298 598v128h128v84h-212v-212h84z"></path>
</svg>
`,"image/svg+xml").firstChild}function zc(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="2 -4 28 40">
  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M682 342h128v84h-212v-212h84v128zM598 810v-212h212v84h-128v128h-84zM342 342v-128h84v212h-212v-84h128zM214 682v-84h212v212h-84v-128h-128z"></path>
</svg>
`,"image/svg+xml").firstChild}var Wc=function(s){ie(i,s);var a=ne(i);function i(){var t;q(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=a.call.apply(a,[this].concat(n)),I(x(t),"_onOrientationChange",function(o){t.player.fullscreen&&t.config.rotateFullscreen&&(window.orientation===90||window.orientation===-90?t.player.setRotateDeg(0):t.player.setRotateDeg(90))}),t}return Q(i,[{key:"afterCreate",value:function(){var e=this;ue(se(i.prototype),"afterCreate",this).call(this);var n=this.config,r=this.playerConfig;if(!n.disable){n.target&&(this.playerConfig.fullscreenTarget=this.config.target);var o=p.getFullScreenEl();r.fullscreenTarget===o&&this.player.getFullscreen().catch(function(u){}),this.initIcons(),this.handleFullscreen=this.hook("fullscreenChange",this.toggleFullScreen,{pre:function(l){var c=e.player.fullscreen;e.emitUserAction(l,"switch_fullscreen",{prop:"fullscreen",from:c,to:!c})}}),this.bind(".xgplayer-fullscreen",["touchend","click"],this.handleFullscreen),this.on(_t,function(u){var l=e.find(".xg-tips");l&&e.changeLangTextKey(l,u?e.i18nKeys.EXITFULLSCREEN_TIPS:e.i18nKeys.FULLSCREEN_TIPS),e.animate(u)}),this.config.needBackIcon&&(this.topBackIcon=this.player.registerPlugin({plugin:Gc,options:{config:{onClick:function(l){e.handleFullscreen(l)}}}})),oe.device==="mobile"&&window.addEventListener("orientationchange",this._onOrientationChange)}}},{key:"registerIcons",value:function(){return{fullscreen:{icon:jc,class:"xg-get-fullscreen"},exitFullscreen:{icon:zc,class:"xg-exit-fullscreen"}}}},{key:"destroy",value:function(){ue(se(i.prototype),"destroy",this).call(this),this.unbind(".xgplayer-icon",oe.device==="mobile"?"touchend":"click",this.handleFullscreen),oe.device==="mobile"&&window.removeEventListener("orientationchange",this._onOrientationChange)}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.fullscreen),this.appendChild(".xgplayer-icon",e.exitFullscreen)}},{key:"toggleFullScreen",value:function(e){e&&(e.preventDefault(),e.stopPropagation());var n=this.player,r=this.config,o=r.useCssFullscreen===!0||typeof r.useCssFullscreen=="function"&&r.useCssFullscreen();o?(n.fullscreen?n.exitCssFullscreen():n.getCssFullscreen(),this.animate(n.fullscreen)):r.rotateFullscreen?(n.fullscreen?n.exitRotateFullscreen():n.getRotateFullscreen(),this.animate(n.fullscreen)):r.switchCallback&&typeof r.switchCallback=="function"?r.switchCallback(n.fullscreen):n.fullscreen?(n.exitFullscreen(),r.useScreenOrientation&&this.unlockScreen()):(n.getFullscreen().catch(function(u){}),r.useScreenOrientation&&n.aspectRatio>1&&this.lockScreen(r.lockOrientationType))}},{key:"animate",value:function(e){e?this.setAttr("data-state","full"):this.setAttr("data-state","normal"),this.topBackIcon&&(e?(this.topBackIcon.show(),this.hide()):(this.topBackIcon.hide(),this.show()))}},{key:"render",value:function(){if(!this.config.disable){var e="FULLSCREEN_TIPS";return`<xg-icon class="xgplayer-fullscreen">
    <div class="xgplayer-icon">
    </div>
    `.concat(Bt(this,e,this.playerConfig.isHideTips),`
    </xg-icon>`)}}},{key:"lockScreen",value:function(e){try{screen.orientation.lock(e).catch(function(n){})}catch{}}},{key:"unlockScreen",value:function(){try{screen.orientation.unlock().catch(function(e){})}catch{}}}],[{key:"pluginName",get:function(){return"fullscreen"}},{key:"defaultConfig",get:function(){return{position:Te.CONTROLS_RIGHT,index:0,useCssFullscreen:!1,rotateFullscreen:!1,useScreenOrientation:!1,lockOrientationType:"landscape",switchCallback:null,target:null,disable:!1,needBackIcon:!1}}}]),i}(ni),Za=function(s){ie(i,s);var a=ne(i);function i(t){var e;return q(this,i),e=a.call(this,t),e.isActiving=!1,e}return Q(i,[{key:"duration",get:function(){var e=this.player,n=e.offsetDuration,r=e.duration;return this.playerConfig.customDuration||n||r}},{key:"currentTime",get:function(){var e=this.player,n=e.offsetCurrentTime,r=e.currentTime;return n>=0?n:r}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"afterCreate",value:function(){var e=this.player.controls.config.mode;this.mode=e==="flex"?"flex":"normal",!this.config.disable&&(this.mode==="flex"&&(this.createCenterTime(),this.root.style.display="none"),this.durationDom=this.find(".time-duration"),this.timeDom=this.find(".time-current"),this.listenEvents())}},{key:"listenEvents",value:function(){var e=this;this.on([Pt,kt,$e],function(n){n.eventName==="durationchange"&&(e.isActiving=!1),e.onTimeUpdate()}),this.on(Ct,function(){e.onTimeUpdate(!0)}),this.on(ii,function(){e.onReset()})}},{key:"show",value:function(e){if(this.mode==="flex"){this.centerCurDom&&(this.centerCurDom.style.display="block"),this.centerDurDom&&(this.centerDurDom.style.display="block");return}this.root.style.display="block"}},{key:"hide",value:function(){if(this.mode==="flex"){this.centerCurDom&&(this.centerCurDom.style.display="none"),this.centerDurDom&&(this.centerDurDom.style.display="none");return}this.root.style.display="none"}},{key:"onTimeUpdate",value:function(e){var n=this.player,r=this.config,o=this.duration;if(!(r.disable||this.isActiving||!n.hasStart)){var u=this.currentTime+this.timeOffset;u=p.adjustTimeByDuration(u,o,e),this.mode==="flex"?(this.centerCurDom.innerHTML=this.minWidthTime(p.format(u)),o!==1/0&&o>0&&(this.centerDurDom.innerHTML=p.format(o))):(this.timeDom.innerHTML=this.minWidthTime(p.format(u)),o!==1/0&&o>0&&(this.durationDom.innerHTML=p.format(o)))}}},{key:"onReset",value:function(){this.mode==="flex"?(this.centerCurDom.innerHTML=this.minWidthTime(p.format(0)),this.centerDurDom.innerHTML=p.format(0)):(this.timeDom.innerHTML=this.minWidthTime(p.format(0)),this.durationDom.innerHTML=p.format(0))}},{key:"createCenterTime",value:function(){var e=this.player;if(!(!e.controls||!e.controls.center)){var n=e.controls.center;this.centerCurDom=p.createDom("xg-icon","00:00",{},"xgplayer-time xg-time-left"),this.centerDurDom=p.createDom("xg-icon","00:00",{},"xgplayer-time xg-time-right"),n.children.length>0?n.insertBefore(this.centerCurDom,n.children[0]):n.appendChild(this.centerCurDom),n.appendChild(this.centerDurDom)}}},{key:"afterPlayerInit",value:function(){var e=this.config;if(this.duration===1/0||this.playerConfig.isLive?(p.hide(this.durationDom),p.hide(this.timeDom),p.hide(this.find(".time-separator")),p.show(this.find(".time-live-tag"))):p.hide(this.find(".time-live-tag")),e.hide){this.hide();return}this.show()}},{key:"changeLiveState",value:function(e){e?(p.hide(this.durationDom),p.hide(this.timeDom),p.hide(this.find(".time-separator")),p.show(this.find(".time-live-tag"))):(p.hide(this.find(".time-live-tag")),p.show(this.find(".time-separator")),p.show(this.durationDom),p.show(this.timeDom))}},{key:"updateTime",value:function(e){if(this.isActiving=!0,!(!e&&e!==0||e>this.duration)){if(this.mode==="flex"){this.centerCurDom.innerHTML=this.minWidthTime(p.format(e));return}this.timeDom.innerHTML=this.minWidthTime(p.format(e))}}},{key:"minWidthTime",value:function(e){return e.split(":").map(function(n){return'<span class="time-min-width">'.concat(n,"</span>")}).join(":")}},{key:"resetActive",value:function(){var e=this,n=this.player,r=function(){e.isActiving=!1};this.off(kt,r),n.isSeeking&&n.media.seeking?this.once(kt,r):this.isActiving=!1}},{key:"destroy",value:function(){var e=this.player.controls.center;this.centerCurDom&&e.removeChild(this.centerCurDom),this.centerCurDom=null,this.centerDurDom&&e.removeChild(this.centerDurDom),this.centerDurDom=null}},{key:"render",value:function(){if(!this.config.disable)return`<xg-icon class="xgplayer-time">
    <span class="time-current">00:00</span>
    <span class="time-separator">/</span>
    <span class="time-duration">00:00</span>
    <span class="time-live-tag">`.concat(this.i18n.LIVE_TIP,`</span>
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"time"}},{key:"defaultConfig",get:function(){return{position:Te.CONTROLS_LEFT,index:2,disable:!1}}}]),i}(fe),Kc=function(s){ie(i,s);var a=ne(i);function i(){var t;q(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=a.call.apply(a,[this].concat(n)),I(x(t),"_onDurationChange",function(){t.updateSegments();var o=t.player,u=o.currentTime,l=o.timeSegments;if(t._checkIfEnabled(l)){var c=p.getIndexByTime(u,l),h=p.getOffsetCurrentTime(u,l,c);t.player.offsetCurrentTime=h,t.changeIndex(c,l)}}),I(x(t),"_onLoadedData",function(){var o=t.player.timeSegments;if(t._checkIfEnabled(o)){var u=p.getOffsetCurrentTime(0,o);t.player.offsetCurrentTime=u,t.changeIndex(0,o),t.curPos.start>0&&(t.player.currentTime=t.curPos.start)}}),I(x(t),"_onTimeupdate",function(){var o=t.player,u=o.currentTime,l=o.timeSegments;if(t._checkIfEnabled(l)){var c=l.length;t.lastCurrentTime=u;var h=p.getIndexByTime(u,l);h!==t.curIndex&&t.changeIndex(h,l);var f=p.getOffsetCurrentTime(u,l,h);if(t.player.offsetCurrentTime=f,!!t.curPos){var d=t.curPos,v=d.start,m=d.end;u<v?t.player.currentTime=v:u>m&&h>=c-1&&t.player.pause()}}}),I(x(t),"_onSeeking",function(){var o=t.player,u=o.currentTime,l=o.timeSegments;if(t._checkIfEnabled(l))if(u<l[0].start)t.player.currentTime=l[0].start;else if(u>l[l.length-1].end)t.player.currentTime=l[l.length-1].end;else{var c=p.getIndexByTime(u,l);if(c>=0){var h=t.getSeekTime(u,t.lastCurrentTime,c,l);h>=0&&(t.player.currentTime=h)}}}),I(x(t),"_onPlay",function(){var o=t.player,u=o.currentTime,l=o.timeSegments;t._checkIfEnabled(l)&&u>=l[l.length-1].end&&(t.player.currentTime=l[0].start)}),t}return Q(i,[{key:"afterCreate",value:function(){this.curIndex=-1,this.curPos=null,this.lastCurrentTime=0,this.updateSegments(),this.on(Pt,this._onDurationChange),this.on(vt,this._onLoadedData),this.on($e,this._onTimeupdate),this.on(Ln,this._onSeeking),this.on(je,this._onPlay)}},{key:"setConfig",value:function(e){var n=this;if(e){var r=Object.keys(e);r.length<1||(r.forEach(function(o){n.config[o]=e[o]}),this.updateSegments())}}},{key:"updateSegments",value:function(){var e=this.config,n=e.disable,r=e.segments,o=this.player;if(n||!r||r.length===0)o.timeSegments=[],o.offsetDuration=0,o.offsetCurrentTime=-1;else{var u=this.formatTimeSegments(r,o.duration);o.timeSegments=u,o.offsetDuration=u.length>0?u[u.length-1].duration:0}}},{key:"formatTimeSegments",value:function(e,n){var r=[];return e?(e.sort(function(o,u){return o.start-u.start}),e.forEach(function(o,u){var l={};if(l.start=o.start<0?0:o.start,l.end=n>0&&o.end>n?n:o.end,!(n>0&&l.start>n)){r.push(l);var c=l.end-l.start;if(u===0)l.offset=o.start,l.cTime=0,l.segDuration=c,l.duration=c;else{var h=r[u-1];l.offset=h.offset+(l.start-h.end),l.cTime=h.duration+h.cTime,l.segDuration=c,l.duration=h.duration+c}}}),r):[]}},{key:"getSeekTime",value:function(e,n,r,o){var u=-1,l=o[r],c=l.start,h=l.end;if(e>=c&&e<=h)return u;var f=e-n;if(f<0&&e<c){var d=n>c?n-c:0;return u=r-1>=0?o[r-1].end+f+d:0,u}return-1}},{key:"_checkIfEnabled",value:function(e){return!(!e||e.length<1)}},{key:"changeIndex",value:function(e,n){this.curIndex=e,e>=0&&n.length>0?this.curPos=n[e]:this.curPos=null}}],[{key:"pluginName",get:function(){return"TimeSegmentsControls"}},{key:"defaultConfig",get:function(){return{disable:!0,segments:[]}}}]),i}(gt);function Yc(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M940.632 837.632l-72.192-72.192c65.114-64.745 105.412-154.386 105.412-253.44s-40.299-188.695-105.396-253.424l-0.016-0.016 72.192-72.192c83.639 83.197 135.401 198.37 135.401 325.632s-51.762 242.434-135.381 325.612l-0.020 0.020zM795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021z"></path>
</svg>
`,"image/svg+xml").firstChild}function Xc(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021zM795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021z"></path>
</svg>
`,"image/svg+xml").firstChild}function qc(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M920.4 439.808l-108.544-109.056-72.704 72.704 109.568 108.544-109.056 108.544 72.704 72.704 108.032-109.568 108.544 109.056 72.704-72.704-109.568-108.032 109.056-108.544-72.704-72.704-108.032 109.568z"></path>
</svg>
`,"image/svg+xml").firstChild}var Qc=function(s){ie(i,s);var a=ne(i);function i(){var t;q(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=a.call.apply(a,[this].concat(n)),I(x(t),"onBarMousedown",function(o){var u=x(t),l=u.player,c=t.find(".xgplayer-bar");p.event(o);var h=c.getBoundingClientRect(),f=p.getEventPos(o,l.zoom),d=h.height-(f.clientY-h.top);if(f.h=d,f.barH=h.height,t.pos=f,!(d<-2))return t.updateVolumePos(d,o),document.addEventListener("mouseup",t.onBarMouseUp),t._d.isStart=!0,!1}),I(x(t),"onBarMouseMove",function(o){var u=x(t),l=u._d;if(l.isStart){var c=x(t),h=c.pos,f=c.player;o.preventDefault(),o.stopPropagation(),p.event(o);var d=p.getEventPos(o,f.zoom);l.isMoving=!0;var v=h.h-d.clientY+h.clientY;v>h.barH||t.updateVolumePos(v,o)}}),I(x(t),"onBarMouseUp",function(o){p.event(o),document.removeEventListener("mouseup",t.onBarMouseUp);var u=x(t),l=u._d;l.isStart=!1,l.isMoving=!1}),I(x(t),"onMouseenter",function(o){t._d.isActive=!0,t.focus(),t.emit("icon_mouseenter",{pluginName:t.pluginName})}),I(x(t),"onMouseleave",function(o){t._d.isActive=!1,t.unFocus(100,!1,o),t.emit("icon_mouseleave",{pluginName:t.pluginName})}),I(x(t),"onVolumeChange",function(o){if(t.player){var u=t.player,l=u.muted,c=u.volume;t._d.isMoving||(t.find(".xgplayer-drag").style.height=l||c===0?"4px":"".concat(c*100,"%"),t.config.showValueLabel&&t.updateVolumeValue()),t.animate(l,c)}}),t}return Q(i,[{key:"registerIcons",value:function(){return{volumeSmall:{icon:Xc,class:"xg-volume-small"},volumeLarge:{icon:Yc,class:"xg-volume"},volumeMuted:{icon:qc,class:"xg-volume-mute"}}}},{key:"afterCreate",value:function(){var e=this;if(this._timerId=null,this._d={isStart:!1,isMoving:!1,isActive:!1},!this.config.disable){this.initIcons();var n=this.playerConfig,r=n.commonStyle,o=n.volume;r.volumeColor&&(this.find(".xgplayer-drag").style.backgroundColor=r.volumeColor),this.changeMutedHandler=this.hook("mutedChange",function(u){e.changeMuted(u)},{pre:function(l){l.preventDefault(),l.stopPropagation()}}),this._onMouseenterHandler=this.hook("mouseenter",this.onMouseenter),this._onMouseleaveHandler=this.hook("mouseleave",this.onMouseleave),oe.device!=="mobile"&&this.playerConfig.isMobileSimulateMode!=="mobile"&&(this.bind("mouseenter",this._onMouseenterHandler),this.bind(["blur","mouseleave"],this._onMouseleaveHandler),this.bind(".xgplayer-slider","mousedown",this.onBarMousedown),this.bind(".xgplayer-slider","mousemove",this.onBarMouseMove),this.bind(".xgplayer-slider","mouseup",this.onBarMouseUp)),this.bind(".xgplayer-icon",["touchend","click"],this.changeMutedHandler),this.on(Ii,this.onVolumeChange),this.once(vt,this.onVolumeChange),p.typeOf(o)!=="Number"&&(this.player.volume=this.config.default),this.onVolumeChange()}}},{key:"updateVolumePos",value:function(e,n){var r=this.player,o=this.find(".xgplayer-drag"),u=this.find(".xgplayer-bar");if(!(!u||!o)){var l=parseInt(e/u.getBoundingClientRect().height*1e3,10);o.style.height="".concat(e,"px");var c=Math.max(Math.min(l/1e3,1),0),h={volume:{from:r.volume,to:c}};r.muted&&(h.muted={from:!0,to:!1}),this.emitUserAction(n,"change_volume",{muted:r.muted,volume:r.volume,props:h}),r.volume=Math.max(Math.min(l/1e3,1),0),r.muted&&(r.muted=!1),this.config.showValueLabel&&this.updateVolumeValue()}}},{key:"updateVolumeValue",value:function(){var e=this.player,n=e.volume,r=e.muted,o=this.find(".xgplayer-value-label"),u=Math.max(Math.min(n,1),0);o.innerText=r?0:Math.round(u*100)}},{key:"focus",value:function(){var e=this.player;e.focus({autoHide:!1}),this._timerId&&(p.clearTimeout(this,this._timerId),this._timerId=null),p.addClass(this.root,"slide-show")}},{key:"unFocus",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,o=arguments.length>2?arguments[2]:void 0,u=this._d,l=this.player;u.isActive||(this._timerId&&(p.clearTimeout(this,this._timerId),this._timerId=null),this._timerId=p.setTimeout(this,function(){u.isActive||(r?l.blur():l.focus(),p.removeClass(e.root,"slide-show"),u.isStart&&e.onBarMouseUp(o)),e._timerId=null},n))}},{key:"changeMuted",value:function(e){e&&e.stopPropagation();var n=this.player,r=this._d;r.isStart&&this.onBarMouseUp(e),this.emitUserAction(e,"change_muted",{muted:n.muted,volume:n.volume,props:{muted:{from:n.muted,to:!n.muted}}}),n.volume>0&&(n.muted=!n.muted),n.volume<.01&&(n.volume=this.config.miniVolume)}},{key:"animate",value:function(e,n){e||n===0?this.setAttr("data-state","mute"):n<.5&&this.icons.volumeSmall?this.setAttr("data-state","small"):this.setAttr("data-state","normal")}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.volumeSmall),this.appendChild(".xgplayer-icon",e.volumeLarge),this.appendChild(".xgplayer-icon",e.volumeMuted)}},{key:"destroy",value:function(){this._timerId&&(p.clearTimeout(this,this._timerId),this._timerId=null),this.unbind("mouseenter",this.onMouseenter),this.unbind(["blur","mouseleave"],this.onMouseleave),this.unbind(".xgplayer-slider","mousedown",this.onBarMousedown),this.unbind(".xgplayer-slider","mousemove",this.onBarMouseMove),this.unbind(".xgplayer-slider","mouseup",this.onBarMouseUp),document.removeEventListener("mouseup",this.onBarMouseUp),this.unbind(".xgplayer-icon",oe.device==="mobile"?"touchend":"click",this.changeMutedHandler)}},{key:"render",value:function(){if(!this.config.disable){var e=this.config.default||this.player.volume,n=this.config.showValueLabel;return`
    <xg-icon class="xgplayer-volume" data-state="normal">
      <div class="xgplayer-icon">
      </div>
      <xg-slider class="xgplayer-slider">
        `.concat(n?'<div class="xgplayer-value-label">'.concat(e*100,"</div>"):"",`
        <div class="xgplayer-bar">
          <xg-drag class="xgplayer-drag" style="height: `).concat(e*100,`%"></xg-drag>
        </div>
      </xg-slider>
    </xg-icon>`)}}}],[{key:"pluginName",get:function(){return"volume"}},{key:"defaultConfig",get:function(){return{position:Te.CONTROLS_RIGHT,index:1,disable:!1,showValueLabel:!1,default:.6,miniVolume:.2}}}]),i}(fe);function Jc(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="-4 -6 40 40" fill="none">
  <g>
    <path transform="scale(1.5 1.5)" d="M11.6665 9.16663H4.1665C2.78579 9.16663 1.6665 10.2859 1.6665 11.6666V15.8333C1.6665 17.214 2.78579 18.3333 4.1665 18.3333H11.6665C13.0472 18.3333 14.1665 17.214 14.1665 15.8333V11.6666C14.1665 10.2859 13.0472 9.16663 11.6665 9.16663Z" fill="white"/>
    <path transform="scale(1.5 1.5)" fill-rule="evenodd" clip-rule="evenodd" d="M3.88148 4.06298C3.75371 4.21005 3.67667 4.40231 3.67749 4.61242C3.67847 4.87253 3.79852 5.10435 3.98581 5.25646L6.99111 8.05895C7.32771 8.37283 7.85502 8.35443 8.16891 8.01782C8.48279 7.68122 8.46437 7.15391 8.12778 6.84003L6.62061 5.43457L9.8198 5.4224C9.82848 5.42239 9.8372 5.42221 9.84591 5.4219C10.9714 5.38233 12.0885 5.6285 13.0931 6.13744C14.0976 6.64635 14.957 7.40148 15.5908 8.33234C16.2246 9.2632 16.6122 10.3394 16.7177 11.4606C16.823 12.5819 16.6427 13.7115 16.1934 14.7442C16.0098 15.1661 16.203 15.6571 16.6251 15.8408C17.0471 16.0243 17.5381 15.8311 17.7216 15.4091C18.2833 14.1183 18.5087 12.7063 18.3771 11.3047C18.2453 9.90318 17.7607 8.55792 16.9684 7.39433C16.1761 6.23073 15.1021 5.28683 13.8463 4.65065C12.5946 4.01651 11.203 3.70872 9.80072 3.75583L6.43415 3.76862L7.96326 2.12885C8.27715 1.79225 8.25872 1.26494 7.92213 0.951061C7.58553 0.63718 7.05822 0.655585 6.74433 0.99219L3.90268 4.0395C3.89545 4.04724 3.88841 4.05509 3.88154 4.06303L3.88148 4.06298Z" fill="white"/>
  </g>
  <defs>
    <clipPath>
      <rect width="40" height="40" fill="white"/>
    </clipPath>
  </defs>
</svg>
`,"image/svg+xml").firstChild}var Zc=function(s){ie(i,s);var a=ne(i);function i(t){var e;return q(this,i),e=a.call(this,t),e.rotateDeg=e.config.rotateDeg||0,e}return Q(i,[{key:"afterCreate",value:function(){var e=this;if(!this.config.disable){ue(se(i.prototype),"afterCreate",this).call(this),this.appendChild(".xgplayer-icon",this.icons.rotate),this.onBtnClick=this.onBtnClick.bind(this),this.bind(".xgplayer-icon",["click","touchend"],this.onBtnClick),this.on(pt,function(){e.rotateDeg&&e.config.innerRotate&&p.setTimeout(e,function(){e.updateRotateDeg(e.rotateDeg,e.config.innerRotate)},100)});var n=this.player.root;this.rootWidth=n.style.width||n.offsetWidth||n.clientWidth,this.rootHeight=n.style.height||n.offsetHeight||n.clientHeight,this.rotateDeg&&this.updateRotateDeg(this.rotateDeg,this.config.innerRotate)}}},{key:"destroy",value:function(){ue(se(i.prototype),"destroy",this).call(this),this.unbind(".xgplayer-icon",["click","touchend"],this.onBtnClick)}},{key:"onBtnClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.emitUserAction(e,"rotate"),this.rotate(this.config.clockwise,this.config.innerRotate,1)}},{key:"updateRotateDeg",value:function(e,n){if(e||(e=0),n){this.player.videoRotateDeg=e;return}var r=this.player,o=this.rootWidth,u=this.rootHeight,l=r.root,c=r.innerContainer,h=r.media,f=l.offsetWidth,d=c&&n?c.offsetHeight:l.offsetHeight,v=o,m=u,g=0,b=0;(e===.75||e===.25)&&(v="".concat(d,"px"),m="".concat(f,"px"),g=-(d-f)/2,b=-(f-d)/2);var k="translate(".concat(g,"px,").concat(b,"px) rotate(").concat(e,"turn)"),E={transformOrigin:"center center",transform:k,webKitTransform:k,height:m,width:v},w=n?h:l,C=n?r.getPlugin("poster"):null;Object.keys(E).map(function(B){w.style[B]=E[B],C&&C.root&&(C.root.style[B]=E[B])})}},{key:"rotate",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=this.player;this.rotateDeg||(this.rotateDeg=0);var u=e?1:-1;this.rotateDeg=(this.rotateDeg+1+u*.25*r)%1,this.updateRotateDeg(this.rotateDeg,n),o.emit(Ma,this.rotateDeg*360)}},{key:"registerIcons",value:function(){return{rotate:Jc}}},{key:"render",value:function(){if(!this.config.disable)return`
    <xg-icon class="xgplayer-rotate">
      <div class="xgplayer-icon">
      </div>
      `.concat(Bt(this,"ROTATE_TIPS",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"rotate"}},{key:"defaultConfig",get:function(){return{position:Te.CONTROLS_RIGHT,index:6,innerRotate:!0,clockwise:!1,rotateDeg:0,disable:!1}}}]),i}(ni);function eh(){return new DOMParser().parseFromString(`<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd"
    d="M16.5 4.3H3.5C3.38954 4.3 3.3 4.38954 3.3 4.5V15.5C3.3 15.6105 3.38954 15.7 3.5 15.7H8.50005L8.50006 17.5H3.5C2.39543 17.5 1.5 16.6046 1.5 15.5V4.5C1.5 3.39543 2.39543 2.5 3.5 2.5H16.5C17.6046 2.5 18.5 3.39543 18.5 4.5V8.5H16.7V4.5C16.7 4.38954 16.6105 4.3 16.5 4.3ZM12 11.5C11.4477 11.5 11 11.9477 11 12.5L11 16.5C11 17.0523 11.4478 17.5 12 17.5H17.5C18.0523 17.5 18.5 17.0523 18.5 16.5L18.5 12.5C18.5 11.9477 18.0523 11.5 17.5 11.5H12Z"
    fill="white" />
</svg>`,"image/svg+xml").firstChild}function th(){return new DOMParser().parseFromString(`<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd"
    d="M16.5 4.3H3.5C3.38954 4.3 3.3 4.38954 3.3 4.5V15.5C3.3 15.6105 3.38954 15.7 3.5 15.7H8.50005L8.50006 17.5H3.5C2.39543 17.5 1.5 16.6046 1.5 15.5V4.5C1.5 3.39543 2.39543 2.5 3.5 2.5H16.5C17.6046 2.5 18.5 3.39543 18.5 4.5V8.5H16.7V4.5C16.7 4.38954 16.6105 4.3 16.5 4.3ZM12 11.5C11.4477 11.5 11 11.9477 11 12.5L11 16.5C11 17.0523 11.4478 17.5 12 17.5H17.5C18.0523 17.5 18.5 17.0523 18.5 16.5L18.5 12.5C18.5 11.9477 18.0523 11.5 17.5 11.5H12Z"
    fill="white" />
  <path fill-rule="evenodd" clip-rule="evenodd"
    d="M9.4998 7.7C9.77595 7.7 9.9998 7.47614 9.9998 7.2V6.5C9.9998 6.22386 9.77595 6 9.4998 6H5.5402L5.52754 6.00016H5.5C5.22386 6.00016 5 6.22401 5 6.50016V10.4598C5 10.7359 5.22386 10.9598 5.5 10.9598H6.2C6.47614 10.9598 6.7 10.7359 6.7 10.4598V8.83005L8.76983 10.9386C8.96327 11.1357 9.27984 11.1386 9.47691 10.9451L9.97645 10.4548C10.1735 10.2613 10.1764 9.94476 9.983 9.7477L7.97289 7.7H9.4998Z"
    fill="white" />
</svg>`,"image/svg+xml").firstChild}var li={PIP:"picture-in-picture",INLINE:"inline",FULLSCREEN:"fullscreen"},ih=function(s){ie(i,s);var a=ne(i);function i(){var t;q(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=a.call.apply(a,[this].concat(n)),I(x(t),"switchPIP",function(o){if(!t.isPIPAvailable())return!1;o.stopPropagation&&o.stopPropagation(),t.isPip?(t.exitPIP(),t.emitUserAction(o,"change_pip",{props:"pip",from:!0,to:!1}),t.setAttr("data-state","normal")):t.player.media.readyState===4&&(t.requestPIP(),t.emitUserAction(o,"change_pip",{props:"pip",from:!1,to:!0}),t.setAttr("data-state","pip"))}),t}return Q(i,[{key:"beforeCreate",value:function(e){typeof e.player.config.pip=="boolean"&&(e.config.showIcon=e.player.config.pip)}},{key:"afterCreate",value:function(){var e=this;this.isPIPAvailable()&&(ue(se(i.prototype),"afterCreate",this).call(this),this.pMode=li.INLINE,this.initPipEvents(),this.config.showIcon&&this.initIcons(),this.once(Dn,function(){e.config.showIcon&&(p.removeClass(e.find(".xgplayer-icon"),"xg-icon-disable"),e.bind("click",e.switchPIP))}))}},{key:"registerIcons",value:function(){return{pipIcon:{icon:eh,class:"xg-get-pip"},pipIconExit:{icon:th,class:"xg-exit-pip"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.pipIcon),this.appendChild(".xgplayer-icon",e.pipIconExit)}},{key:"initPipEvents",value:function(){var e=this,n=this.player;this.leavePIPCallback=function(){var r=n.paused;p.setTimeout(e,function(){!r&&n.mediaPlay()},0),!r&&n.mediaPlay(),e.setAttr("data-state","normal"),e.pipWindow=null,n.emit(kr,!1)},this.enterPIPCallback=function(r){n.emit(kr,!0),r!=null&&r.pictureInPictureWindow&&(e.pipWindow=r.pictureInPictureWindow),e.setAttr("data-state","pip")},this.onWebkitpresentationmodechanged=function(r){var o=n.media.webkitPresentationMode;e.pMode===li.FULLSCREEN&&o!==li.FULLSCREEN&&n.onFullscreenChange(null,!1),e.pMode=o,o===li.PIP?e.enterPIPCallback(r):o===li.INLINE&&e.leavePIPCallback(r)},n.media&&(n.media.addEventListener("enterpictureinpicture",this.enterPIPCallback),n.media.addEventListener("leavepictureinpicture",this.leavePIPCallback),i.checkWebkitSetPresentationMode(n.media)&&n.media.addEventListener("webkitpresentationmodechanged",this.onWebkitpresentationmodechanged))}},{key:"copyStyleIntoPiPWindow",value:function(e){var n=ot(document.styleSheets).map(function(o){try{return ot(o.cssRules).map(function(l){return l.cssText}).join("")}catch{var u=document.createElement("link");u.rel="stylesheet",u.type=o.type,u.media=o.media,u.href=o.href,e.document.head.appendChild(u)}return""}).filter(Boolean).join(`
`),r=document.createElement("style");r.textContent=n,e.document.head.appendChild(r)}},{key:"requestPIP",value:function(){var e=this,n=this.player,r=this.playerConfig,o=this.config;if(!(!this.isPIPAvailable()||this.isPip))try{var u=r.poster;if(u&&(n.media.poster=p.typeOf(u)==="String"?u:u.poster),o.preferDocument&&this.isDocPIPAvailable()){var l={};if(o.width&&o.height)l.width=o.width,l.height=o.height;else{var c=n.root.getBoundingClientRect();l.width=c.width,l.height=c.height}documentPictureInPicture.requestWindow(l).then(function(h){var f=o.docPiPNode,d=o.docPiPStyle;e.enterPIPCallback();var v=f||n.root,m=v.parentElement,g=v.previousSibling,b=v.nextSibling;e.copyStyleIntoPiPWindow(h);var k=document.createElement("style");if(k.append("body{padding:0; margin:0;}"),d){var E="";typeof d=="string"?E=d:typeof d=="function"&&(E=d.call(o)),E&&k.append(E)}else v===n.root&&k.append(`
              .xgplayer{width: 100%!important; height: 100%!important;}
            `);h.document.head.append(k),h.document.body.append(v),h.addEventListener("pagehide",function(w){m&&(b?m.insertBefore(v,b):g?m.insertBefore(v,g.nextSibling):m.appendChild(v)),e.leavePIPCallback()},{once:!0})})}else i.checkWebkitSetPresentationMode(n.media)?n.media.webkitSetPresentationMode("picture-in-picture"):n.media.requestPictureInPicture();return!0}catch(h){return console.error("requestPiP",h),!1}}},{key:"exitPIP",value:function(){var e=this.player;try{if(this.isPIPAvailable()&&this.isPip){var n;this.isDocPIPAvailable()&&(n=documentPictureInPicture)!==null&&n!==void 0&&n.window?documentPictureInPicture.window.close():i.checkWebkitSetPresentationMode(e.media)?e.media.webkitSetPresentationMode("inline"):document.exitPictureInPicture()}return!0}catch(r){return console.error("exitPIP",r),!1}}},{key:"isPip",get:function(){var e,n=this.player;return!!(this.isDocPIPAvailable()&&(e=documentPictureInPicture)!==null&&e!==void 0&&e.window)||document.pictureInPictureElement&&document.pictureInPictureElement===n.media||n.media.webkitPresentationMode===li.PIP}},{key:"isPIPAvailable",value:function(){var e=this.player.media,n=p.typeOf(document.pictureInPictureEnabled)==="Boolean"?document.pictureInPictureEnabled:!1;return n&&(p.typeOf(e.disablePictureInPicture)==="Boolean"&&!e.disablePictureInPicture||e.webkitSupportsPresentationMode&&p.typeOf(e.webkitSetPresentationMode)==="Function")||this.isDocPIPAvailable()}},{key:"isDocPIPAvailable",value:function(){return"documentPictureInPicture"in window&&/^(https|file)/.test(location.protocol)}},{key:"destroy",value:function(){ue(se(i.prototype),"destroy",this).call(this);var e=this.player;e.media.removeEventListener("enterpictureinpicture",this.enterPIPCallback),e.media.removeEventListener("leavepictureinpicture",this.leavePIPCallback),i.checkWebkitSetPresentationMode(e.media)&&e.media.removeEventListener("webkitpresentationmodechanged",this.onWebkitpresentationmodechanged),this.exitPIP(),this.unbind("click",this.btnClick)}},{key:"render",value:function(){if(!(!this.config.showIcon||!this.isPIPAvailable()))return`<xg-icon class="xgplayer-pip">
      <div class="xgplayer-icon xg-icon-disable">
      </div>
      `.concat(Bt(this,"PIP",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"pip"}},{key:"defaultConfig",get:function(){return{position:Te.CONTROLS_RIGHT,index:6,showIcon:!1,preferDocument:!1,width:void 0,height:void 0,docPiPNode:void 0,docPiPStyle:void 0}}},{key:"checkWebkitSetPresentationMode",value:function(e){return typeof e.webkitSetPresentationMode=="function"}}]),i}(ni);function nh(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="40" viewBox="10 0 24 40">
  <path transform="scale(0.038 0.028)" d="M800 380v768h-128v-352l-320 320v-704l320 320v-352z"></path>
</svg>
`,"image/svg+xml").firstChild}var rh=function(s){ie(i,s);var a=ne(i);function i(t){var e;return q(this,i),e=a.call(this,t),I(x(e),"playNext",function(n){var r=x(e),o=r.player;n.preventDefault(),n.stopPropagation(),e.idx+1<e.config.urlList.length?(e.idx++,e.nextHandler(e.config.urlList[e.idx],e.idx),o.emit(yn,e.idx+1)):(e.nextHandler(),o.emit(yn))}),e.idx=-1,e}return Q(i,[{key:"afterCreate",value:function(){!this.config.urlList||this.config.urlList.length===0||(this.appendChild(".xgplayer-icon",this.icons.playNext),this.initEvents())}},{key:"registerIcons",value:function(){return{playNext:nh}}},{key:"initEvents",value:function(){this.nextHandler=this.hook("nextClick",this.changeSrc);var e=oe.device==="mobile"?"touchend":"click";this.bind(e,this.playNext),this.show()}},{key:"changeSrc",value:function(e){var n=this.player;e&&(n.pause(),n.currentTime=0,n.switchURL?n.switchURL(e):n.src=e,n.config.url=e,n.play())}},{key:"destroy",value:function(){this.unbind(["touchend","click"],this.playNext)}},{key:"render",value:function(){if(!(!this.config.urlList||this.config.urlList.length===0))return`
     <xg-icon class="xgplayer-playnext">
      <div class="xgplayer-icon">
      </div>
      `.concat(Bt(this,"PLAYNEXT_TIPS",this.playerConfig.isHideTips),`
     </xg-icon>
    `)}}],[{key:"pluginName",get:function(){return"playNext"}},{key:"defaultConfig",get:function(){return{position:Te.CONTROLS_LEFT,index:1,url:null,urlList:[]}}}]),i}(fe),eo={exports:{}};(function(s,a){(function(i,t){s.exports=t()})($o,function(){return function i(t,e,n){var r=window,o="application/octet-stream",u=n||o,l=t,c=!e&&!n&&l,h=document.createElement("a"),f=function(L){return String(L)},d=r.Blob||r.MozBlob||r.WebKitBlob||f,v=e||"download",m,g;if(d=d.call?d.bind(r):Blob,String(this)==="true"&&(l=[l,u],u=l[0],l=l[1]),c&&c.length<2048&&(v=c.split("/").pop().split("?")[0],h.href=c,h.href.indexOf(c)!==-1)){var b=new XMLHttpRequest;return b.open("GET",c,!0),b.responseType="blob",b.onload=function(L){i(L.target.response,v,o)},setTimeout(function(){b.send()},0),b}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(l))if(l.length>1024*1024*1.999&&d!==f)l=C(l),u=l.type||o;else return navigator.msSaveBlob?navigator.msSaveBlob(C(l),v):B(l);else if(/([\x80-\xff])/.test(l)){var k=0,E=new Uint8Array(l.length),w=E.length;for(k;k<w;++k)E[k]=l.charCodeAt(k);l=new d([E],{type:u})}m=l instanceof d?l:new d([l],{type:u});function C(L){var D=L.split(/[:;,]/),O=D[1],R=D[2]=="base64"?atob:decodeURIComponent,j=R(D.pop()),y=j.length,_=0,S=new Uint8Array(y);for(_;_<y;++_)S[_]=j.charCodeAt(_);return new d([S],{type:O})}function B(L,D){if("download"in h)return h.href=L,h.setAttribute("download",v),h.className="download-js-link",h.innerHTML="downloading...",h.style.display="none",document.body.appendChild(h),setTimeout(function(){h.click(),document.body.removeChild(h),D===!0&&setTimeout(function(){r.URL.revokeObjectURL(h.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(L)&&(L="data:"+L.replace(/^data:([\w\/\-\+]+)/,o)),window.open(L)||confirm(`Displaying New Document

Use Save As... to download, then click back to return to this page.`)&&(location.href=L),!0;var O=document.createElement("iframe");document.body.appendChild(O),!D&&/^data:/.test(L)&&(L="data:"+L.replace(/^data:([\w\/\-\+]+)/,o)),O.src=L,setTimeout(function(){document.body.removeChild(O)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(m,v);if(r.URL)B(r.URL.createObjectURL(m),!0);else{if(typeof m=="string"||m.constructor===f)try{return B("data:"+u+";base64,"+r.btoa(m))}catch{return B("data:"+u+","+encodeURIComponent(m))}g=new FileReader,g.onload=function(L){B(this.result)},g.readAsDataURL(m)}return!0}})})(eo);var sh=eo.exports;const ah=Br(sh);function oh(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24">
  <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
    <g transform="translate(-488.000000, -340.000000)" fill="#FFFFFF">
      <g id="Group-2">
        <g id="volme_big-copy" transform="translate(488.000000, 340.000000)">
          <rect id="Rectangle-18" x="11" y="4" width="2" height="12" rx="1"></rect>
          <rect id="Rectangle-2" x="3" y="18" width="18" height="2" rx="1"></rect>
          <rect id="Rectangle-2" transform="translate(4.000000, 17.500000) rotate(90.000000) translate(-4.000000, -17.500000) " x="1.5" y="16.5" width="5" height="2" rx="1"></rect><rect id="Rectangle-2-Copy-3" transform="translate(20.000000, 17.500000) rotate(90.000000) translate(-20.000000, -17.500000) " x="17.5" y="16.5" width="5" height="2" rx="1"></rect>
          <path d="M9.48791171,8.26502656 L9.48791171,14.2650266 C9.48791171,14.8173113 9.04019646,15.2650266 8.48791171,15.2650266 C7.93562696,15.2650266 7.48791171,14.8173113 7.48791171,14.2650266 L7.48791171,7.26502656 C7.48791171,6.71274181 7.93562696,6.26502656 8.48791171,6.26502656 L15.4879117,6.26502656 C16.0401965,6.26502656 16.4879117,6.71274181 16.4879117,7.26502656 C16.4879117,7.81731131 16.0401965,8.26502656 15.4879117,8.26502656 L9.48791171,8.26502656 Z" id="Combined-Shape" transform="translate(11.987912, 10.765027) scale(1, -1) rotate(45.000000) translate(-11.987912, -10.765027) "></path>
        </g>
      </g>
    </g>
  </g>
</svg>
`,"image/svg+xml").firstChild}var uh=function(s){ie(i,s);var a=ne(i);function i(t){var e;return q(this,i),e=a.call(this,t),I(x(e),"download",function(n){if(!e.isLock){e.emitUserAction(n,"download");var r=e.playerConfig.url,o="";p.typeOf(r)==="String"?o=r:p.typeOf(r)==="Array"&&r.length>0&&(o=r[0].src);var u=e.getAbsoluteURL(o);ah(u),e.isLock=!0,e.timer=window.setTimeout(function(){e.isLock=!1,window.clearTimeout(e.timer),e.timer=null},300)}}),e.timer=null,e.isLock=!1,e}return Q(i,[{key:"afterCreate",value:function(){ue(se(i.prototype),"afterCreate",this).call(this),!this.config.disable&&(this.appendChild(".xgplayer-icon",this.icons.download),this._handler=this.hook("click",this.download,{pre:function(n){n.preventDefault(),n.stopPropagation()}}),this.bind(["click","touchend"],this._handler))}},{key:"registerIcons",value:function(){return{download:oh}}},{key:"getAbsoluteURL",value:function(e){if(!e.match(/^https?:\/\//)){var n=document.createElement("div");n.innerHTML='<a href="'.concat(e,'">x</a>'),e=n.firstChild.href}return e}},{key:"destroy",value:function(){ue(se(i.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.download),window.clearTimeout(this.timer),this.timer=null}},{key:"render",value:function(){if(!this.config.disable)return`<xg-icon class="xgplayer-download">
   <div class="xgplayer-icon">
   </div>
   `.concat(Bt(this,"DOWNLOAD_TIPS",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"download"}},{key:"defaultConfig",get:function(){return{position:Te.CONTROLS_RIGHT,index:3,disable:!0}}}]),i}(ni),lh=function(s){ie(i,s);var a=ne(i);function i(){return q(this,i),a.apply(this,arguments)}return Q(i,[{key:"beforeCreate",value:function(e){typeof e.player.config.screenShot=="boolean"&&(e.config.disable=!e.player.config.screenShot)}},{key:"afterCreate",value:function(){ue(se(i.prototype),"afterCreate",this).call(this),this.appendChild(".xgplayer-icon",this.icons.screenshotIcon);var e=this.config;this.initSize=function(n){e.fitVideo&&(e.width=n.vWidth,e.height=n.vHeight)},this.once(pt,this.initSize)}},{key:"onPluginsReady",value:function(){this.show(),this.onClickBtn=this.onClickBtn.bind(this),this.bind(["click","touchend"],this.onClickBtn)}},{key:"saveScreenShot",value:function(e,n){var r=document.createElement("a");r.href=e,r.download=n;var o;try{typeof MouseEvent<"u"?o=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}):(o=document.createEvent("MouseEvents"),o.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null))}catch(u){console.error("MouseEvent unsupported",u)}o&&r.dispatchEvent(o)}},{key:"createCanvas",value:function(e,n){var r=document.createElement("canvas"),o=r.getContext("2d");this.canvasCtx=o,this.canvas=r,r.width=e||this.config.width,r.height=n||this.config.height,o.imageSmoothingEnabled=!0,o.imageSmoothingEnabled&&(o.imageSmoothingQuality="high")}},{key:"onClickBtn",value:function(e){var n=this;e.preventDefault(),e.stopPropagation(),this.emitUserAction(e,"shot");var r=this.config;this.shot(r.width,r.height).then(function(o){n.emit(Na,o),r.saveImg&&n.saveScreenShot(o,r.name+r.format)})}},{key:"shot",value:function(e,n){var r=this,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{quality:.92,type:"image/png"},u=this.config,l=this.player,c=o.quality||u.quality,h=o.type||u.type;return new Promise(function(f,d){var v=null,m;if(l.media.canvas)v=l.media.canvas;else{r.canvas?(r.canvas.width=e||u.width,r.canvas.height=n||u.height):r.createCanvas(e,n),v=r.canvas,m=r.canvasCtx;var g=l.media.videoWidth/l.media.videoHeight,b=v.width/v.height,k=0,E=0,w=l.media.videoWidth,C=l.media.videoHeight,B,L,D,O;g>b?(D=v.width,O=v.width/g,B=0,L=Math.round((v.height-O)/2)):g===b?(D=v.width,O=v.height,B=0,L=0):g<b&&(D=v.height*g,O=v.height,B=Math.round((v.width-D)/2),L=0),m.drawImage(l.media,k,E,w,C,B,L,D,O)}var R=v.toDataURL(h,c).replace(h,"image/octet-stream");R=R.replace(/^data:image\/[^;]+/,"data:application/octet-stream"),f(R)})}},{key:"registerIcons",value:function(){return{screenshotIcon:null}}},{key:"destroy",value:function(){ue(se(i.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.onClickBtn),this.off(pt,this.initSize)}},{key:"render",value:function(){if(!this.config.disable){var e=this.icons.screenshotIcon?"xgplayer-icon":"xgplayer-icon btn-text",n="SCREENSHOT";return`
      <xg-icon class="xgplayer-shot">
      <div class="`.concat(e,`">
      `).concat(this.icons.screenshotIcon?"":'<span lang-key="'.concat(this.i18nKeys[n],'">').concat(this.i18n[n],"</span>"),`
      </div>
    </xg-icon>`)}}}],[{key:"pluginName",get:function(){return"screenShot"}},{key:"defaultConfig",get:function(){return{position:Te.CONTROLS_RIGHT,index:5,quality:.92,type:"image/png",format:".png",width:600,height:337,saveImg:!0,fitVideo:!0,disable:!1,name:"screenshot"}}}]),i}(ni),ch=function(){function s(a){q(this,s),this.config=a.config,this.parent=a.root,this.root=p.createDom("ul","",{},"xg-options-list xg-list-slide-scroll ".concat(this.config.className)),a.root.appendChild(this.root);var i=this.config.maxHeight;i&&this.setStyle({maxHeight:i}),this.onItemClick=this.onItemClick.bind(this),this.renderItemList();var t=this.config.domEventType==="touch"?"touchend":"click";this._delegates=fe.delegate.call(this,this.root,"li",t,this.onItemClick)}return Q(s,[{key:"renderItemList",value:function(i){var t=this,e=this.config,n=this.root;i?e.data=i:i=e.data,e.style&&Object.keys(e.style).map(function(r){n.style[r]=e[r]}),i.length>0&&(this.attrKeys=Object.keys(i[0])),this.root.innerHTML="",i.map(function(r,o){var u=r.selected?"option-item selected":"option-item";r["data-index"]=o,t.root.appendChild(p.createDom("li","<span>".concat(r.showText,"</span>"),r,u))})}},{key:"onItemClick",value:function(i){i.delegateTarget||(i.delegateTarget=i.target);var t=i.delegateTarget;if(t&&p.hasClass(t,"selected"))return!1;var e=typeof this.config.onItemClick=="function"?this.config.onItemClick:null,n=this.root.querySelector(".selected");p.addClass(t,"selected"),n&&p.removeClass(n,"selected"),e(i,{from:n?this.getAttrObj(n,this.attrKeys):null,to:this.getAttrObj(t,this.attrKeys)})}},{key:"getAttrObj",value:function(i,t){if(!i||!t)return{};var e={};t.map(function(r){e[r]=i.getAttribute(r)});var n=i.getAttribute("data-index");return n&&(e.index=Number(n)),e}},{key:"show",value:function(){p.removeClass(this.root,"hide"),p.addClass(this.root,"active")}},{key:"hide",value:function(){p.removeClass(this.root,"active"),p.addClass(this.root,"hide")}},{key:"setStyle",value:function(i){var t=this;Object.keys(i).forEach(function(e){t.root.style[e]=i[e]})}},{key:"destroy",value:function(){this._delegates&&(this._delegates.map(function(i){i.destroy&&i.destroy()}),this._delegates=null),this.root.innerHTML=null,this.parent.removeChild(this.root),this.root=null}}]),s}(),lt={SIDE:"side",MIDDLE:"middle",DEFAULT:"default"},ci={CLICK:"click",HOVER:"hover"};function hh(s,a){return s===lt.SIDE?a===Te.CONTROLS_LEFT?"xg-side-list xg-left-side":"xg-side-list xg-right-side":""}var jt=oe.device==="mobile",kn=function(s){ie(i,s);var a=ne(i);function i(t){var e;return q(this,i),e=a.call(this,t),I(x(e),"onEnter",function(n){n.stopPropagation(),e.emit("icon_mouseenter",{pluginName:e.pluginName}),e.switchActiveState(n)}),I(x(e),"switchActiveState",function(n){n.stopPropagation();var r=e.config.toggleMode;r===ci.CLICK?e.toggle(!e.isActive):e.toggle(!0)}),I(x(e),"onLeave",function(n){n.stopPropagation(),e.emit("icon_mouseleave",{pluginName:e.pluginName}),e.config.listType!==lt.SIDE&&e.isActive&&e.toggle(!1)}),I(x(e),"onListEnter",function(n){e.enterType=2}),I(x(e),"onListLeave",function(n){e.enterType=0,e.isActive&&e.toggle(!1)}),e.isIcons=!1,e.isActive=!1,e.curValue=null,e.curIndex=0,e}return Q(i,[{key:"updateLang",value:function(e){this.renderItemList(this.config.list,this.curIndex)}},{key:"afterCreate",value:function(){var e=this,n=this.config;this.initIcons(),jt=jt||this.domEventType==="touch",jt&&oe.device==="mobile"&&n.listType===lt.DEFAULT&&(n.listType=lt.SIDE),n.hidePortrait&&p.addClass(this.root,"portrait"),this.on([pt,_t],function(){e._resizeList()}),this.once(bt,function(){n.list&&n.list.length>0&&(e.renderItemList(n.list),e.show())}),jt&&this.on(Wr,function(){e.isActive&&(e.optionsList&&e.optionsList.hide(),e.isActive=!1)}),jt?(n.toggleMode=ci.CLICK,this.activeEvent="touchend"):this.activeEvent=n.toggleMode===ci.CLICK?"click":"mouseenter",n.toggleMode===ci.CLICK?this.bind(this.activeEvent,this.switchActiveState):(this.bind(this.activeEvent,this.onEnter),this.bind("mouseleave",this.onLeave)),this.isIcons&&this.bind("click",this.onIconClick)}},{key:"initIcons",value:function(){var e=this,n=this.icons,r=Object.keys(n),o=!1;r.length>0&&(r.forEach(function(u){e.appendChild(".xgplayer-icon",n[u]),!o&&(o=n[u])}),this.isIcons=o),!o&&(this.appendChild(".xgplayer-icon",p.createDom("span","",{},"icon-text")),p.addClass(this.find(".xgplayer-icon"),"btn-text"))}},{key:"show",value:function(e){!this.config.list||this.config.list.length<2||p.addClass(this.root,"show")}},{key:"hide",value:function(){p.removeClass(this.root,"show")}},{key:"getTextByLang",value:function(e,n,r){if(e===void 0)return"";var o=this.config.list;!r&&(r=this.player.lang),n=!n||p.isUndefined(e[n])?"text":n,typeof e=="number"&&(e=o[e]);try{return Ge(e[n])==="object"?e[n][r]||e[n].en:e[n]}catch(u){return console.warn(u),""}}},{key:"toggle",value:function(e){if(!(e===this.isActive||this.config.disable)){var n=this.player.controls,r=this.config.listType;e?(r===lt.SIDE?n.blur():n.focus(),this.optionsList&&this.optionsList.show()):(r===lt.SIDE?n.focus():n.focusAwhile(),this.optionsList&&this.optionsList.hide()),this.isActive=e}}},{key:"onItemClick",value:function(e,n){e.stopPropagation();var r=this.config,o=r.listType,u=r.list;this.curIndex=n.to.index,this.curItem=u[this.curIndex],this.changeCurrentText();var l=this.config.isItemClickHide;(l||jt||o===lt.SIDE)&&this.toggle(!1)}},{key:"onIconClick",value:function(e){}},{key:"changeCurrentText",value:function(){if(!this.isIcons){var e=this.config.list,n=this.curIndex<e.length?this.curIndex:0,r=e[n];r&&(this.find(".icon-text").innerHTML=this.getTextByLang(r,"iconText"))}}},{key:"renderItemList",value:function(e,n){var r=this,o=this.config,u=this.optionsList,l=this.player;if(typeof n=="number"&&(this.curIndex=n,this.curItem=o.list[n]),u){u.renderItemList(e),this.changeCurrentText();return}var c={config:{data:e||[],className:hh(o.listType,o.position),onItemClick:function(m,g){r.onItemClick(m,g)},domEventType:jt?"touch":"mouse"},root:o.listType===lt.SIDE?l.innerContainer||l.root:this.root};if(this.config.isShowIcon){var h=this.player.root.getBoundingClientRect(),f=h.height,d=o.listType===lt.MIDDLE?f-50:f;d&&o.heightLimit&&(c.config.maxHeight="".concat(d,"px")),this.optionsList=new ch(c),this.changeCurrentText(),this.show()}this._resizeList()}},{key:"_resizeList",value:function(){if(this.config.heightLimit){var e=this.player.root.getBoundingClientRect(),n=e.height,r=this.config.listType===lt.MIDDLE?n-50:n;this.optionsList&&this.optionsList.setStyle({maxHeight:"".concat(r,"px")})}}},{key:"destroy",value:function(){var e=this.config;e.toggleMode===ci.CLICK?this.unbind(this.activeEvent,this.switchActiveState):(this.unbind(this.activeEvent,this.onEnter),this.unbind("mouseleave",this.onLeave)),this.isIcons&&this.unbind("click",this.onIconClick),this.optionsList&&(this.optionsList.destroy(),this.optionsList=null)}},{key:"render",value:function(){if(this.config.isShowIcon)return'<xg-icon class="xg-options-icon '.concat(this.config.className||"",`">
    <div class="xgplayer-icon">
    </div>
   </xg-icon>`)}}],[{key:"pluginName",get:function(){return"optionsIcon"}},{key:"defaultConfig",get:function(){return{position:Te.CONTROLS_RIGHT,index:100,list:[],listType:"default",listStyle:{},hidePortrait:!0,isShowIcon:!1,isItemClickHide:!0,toggleMode:ci.HOVER,heightLimit:!0}}}]),i}(fe),fh=function(s){ie(i,s);var a=ne(i);function i(t){var e;return q(this,i),e=a.call(this,t),e.curTime=0,e.isPaused=!0,e}return Q(i,[{key:"beforeCreate",value:function(e){var n=e.config.list;Array.isArray(n)&&n.length>0&&(e.config.list=n.map(function(r){return!r.text&&r.name&&(r.text=r.name),r.text||(r.text=r.definition),r}))}},{key:"afterCreate",value:function(){var e=this;ue(se(i.prototype),"afterCreate",this).call(this),this.on("resourceReady",function(n){e.changeDefinitionList(n)}),this.on(Xr,function(n){e.renderItemList(e.config.list,n.to)}),this.player.definitionList.length<2&&this.hide()}},{key:"show",value:function(e){!this.config.list||this.config.list.length<2||p.addClass(this.root,"show")}},{key:"initDefinition",value:function(){var e=this.config,n=e.list,r=e.defaultDefinition;if(n.length>0){var o=null;n.map(function(u){u.definition===r&&(o=u)}),o||(o=n[0]),this.changeDefinition(o)}}},{key:"renderItemList",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.config.list||[],r=arguments.length>1?arguments[1]:void 0,o=r&&r.definition?r.definition:this.config.defaultDefinition;r&&n.forEach(function(c){c.selected=!1});var u=0,l=n.map(function(c,h){var f=Le(Le({},c),{},{showText:e.getTextByLang(c)||c.definition,selected:!1});return(c.selected||c.definition&&c.definition==o)&&(f.selected=!0,u=h),f});ue(se(i.prototype),"renderItemList",this).call(this,l,u)}},{key:"changeDefinitionList",value:function(e){Array.isArray(e)&&(this.config.list=e.map(function(n){return!n.text&&n.name&&(n.text=n.name),n.text||(n.text=n.definition),n}),this.renderItemList(),this.config.list.length<2?this.hide():this.show())}},{key:"changeDefinition",value:function(e,n){this.player.changeDefinition(e,n)}},{key:"onItemClick",value:function(e,n){var r=this.player.definitionList;ue(se(i.prototype),"onItemClick",this).apply(this,arguments),this.emitUserAction(e,"change_definition",{from:n.from,to:n.to});for(var o=0;o<r.length;o++)n.to&&r[o].definition===n.to.definition&&(n.to.url=r[o].url),n.from&&r[o].definition===n.from.definition&&(n.from.url=r[o].url);this.player.changeDefinition(n.to,n.from)}}],[{key:"pluginName",get:function(){return"definition"}},{key:"defaultConfig",get:function(){return Le(Le({},kn.defaultConfig),{},{position:Te.CONTROLS_RIGHT,index:3,list:[],defaultDefinition:"",disable:!1,hidePortrait:!1,className:"xgplayer-definition",isShowIcon:!0})}}]),i}(kn),dh=function(s){ie(i,s);var a=ne(i);function i(t){var e;return q(this,i),e=a.call(this,t),e.curRate=1,e}return Q(i,[{key:"beforeCreate",value:function(e){var n=e.player.config.playbackRate,r=n?Array.isArray(n)?n:e.config.list:[];Array.isArray(r)&&(e.config.list=r.map(function(o){return typeof o=="number"?o={rate:o,text:"".concat(o,"x")}:!o.text&&o.rate&&(o.text="".concat(o.rate,"x")),o}))}},{key:"afterCreate",value:function(){var e=this;ue(se(i.prototype),"afterCreate",this).call(this),this.on(Pa,function(){e.curValue!==e.player.playbackRate&&e.renderItemList()}),this.renderItemList()}},{key:"show",value:function(e){!this.config.list||this.config.list.length===0||ue(se(i.prototype),"show",this).call(this)}},{key:"onItemClick",value:function(e,n){ue(se(i.prototype),"onItemClick",this).call(this,e,n);var r=e.delegateTarget,o=Number(r.getAttribute("rate"));if(!o||o===this.curValue)return!1;var u={playbackRate:{from:this.player.playbackRate,to:o}};this.emitUserAction(e,"change_rate",{props:u}),this.curValue=o,this.player.playbackRate=o}},{key:"renderItemList",value:function(){var e=this,n=this.player.playbackRate||1;this.curValue=n;var r=-1,o=this.config.list.map(function(u,l){var c={rate:u.rate};return c.rate===n&&(c.selected=!0,r=l),c.showText=e.getTextByLang(u),c});ue(se(i.prototype),"renderItemList",this).call(this,o,r)}},{key:"changeCurrentText",value:function(){if(!this.isIcons){var e=this.config.list,n=this.curIndex<e.length?this.curIndex:0,r=e[n],o="";!r||this.curIndex<0?o="".concat(this.player.playbackRate,"x"):o=this.getTextByLang(r,"iconText"),this.find(".icon-text").innerHTML=o}}},{key:"destroy",value:function(){ue(se(i.prototype),"destroy",this).call(this)}}],[{key:"pluginName",get:function(){return"playbackRate"}},{key:"defaultConfig",get:function(){return Le(Le({},kn.defaultConfig),{},{position:Te.CONTROLS_RIGHT,index:4,list:[2,1.5,1,.75,.5],className:"xgplayer-playbackrate",isShowIcon:!0,hidePortrait:!1})}}]),i}(kn);function vh(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="31" height="40" viewBox="0 -5 31 40">
  <path fill="#fff" transform="scale(1.3, 1.3)" class='path_full' d="M9,10v1a.9.9,0,0,1-1,1,.9.9,0,0,1-1-1V9A.9.9,0,0,1,8,8h2a.9.9,0,0,1,1,1,.9.9,0,0,1-1,1Zm6,4V13a1,1,0,0,1,2,0v2a.9.9,0,0,1-1,1H14a1,1,0,0,1,0-2Zm3-7H6V17H18Zm2,0V17a2,2,0,0,1-2,2H6a2,2,0,0,1-2-2V7A2,2,0,0,1,6,5H18A2,2,0,0,1,20,7Z"></path>
</svg>
`,"image/svg+xml").firstChild}function ph(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="31" height="40" viewBox="0 -5 31 40">
  <path fill="#fff" transform="scale(1.3, 1.3)" d="M9,10V9a.9.9,0,0,1,1-1,.9.9,0,0,1,1,1v2a.9.9,0,0,1-1,1H8a.9.9,0,0,1-1-1,.9.9,0,0,1,1-1Zm6,4v1a1,1,0,0,1-2,0V13a.9.9,0,0,1,1-1h2a1,1,0,0,1,0,2Zm3-7H6V17H18Zm2,0V17a2,2,0,0,1-2,2H6a2,2,0,0,1-2-2V7A2,2,0,0,1,6,5H18A2,2,0,0,1,20,7Z"></path>
</svg>
`,"image/svg+xml").firstChild}var Bs=function(s){ie(i,s);var a=ne(i);function i(){return q(this,i),a.apply(this,arguments)}return Q(i,[{key:"beforeCreate",value:function(e){typeof e.player.config.cssFullscreen=="boolean"&&(e.config.disable=!e.player.config.cssFullscreen)}},{key:"afterCreate",value:function(){var e=this;ue(se(i.prototype),"afterCreate",this).call(this),!this.config.disable&&(this.config.target&&(this.playerConfig.fullscreenTarget=this.config.target),this.initIcons(),this.on(gn,function(n){e.animate(n)}),this.btnClick=this.btnClick.bind(this),this.handleCssFullscreen=this.hook("cssFullscreen_change",this.btnClick,{pre:function(r){r.preventDefault(),r.stopPropagation()}}),this.bind(["click","touchend"],this.handleCssFullscreen))}},{key:"initIcons",value:function(){var e=this.icons,n=this.find(".xgplayer-icon");n.appendChild(e.cssFullscreen),n.appendChild(e.exitCssFullscreen)}},{key:"btnClick",value:function(e){e.preventDefault(),e.stopPropagation();var n=this.player.isCssfullScreen;this.emitUserAction(e,"switch_cssfullscreen",{cssfullscreen:n}),n?this.player.exitCssFullscreen():this.player.getCssFullscreen()}},{key:"animate",value:function(e){this.root&&(e?this.setAttr("data-state","full"):this.setAttr("data-state","normal"),this.switchTips(e))}},{key:"switchTips",value:function(e){var n=this.i18nKeys,r=this.find(".xg-tips");r&&this.changeLangTextKey(r,e?n.EXITCSSFULLSCREEN_TIPS:n.CSSFULLSCREEN_TIPS)}},{key:"registerIcons",value:function(){return{cssFullscreen:{icon:vh,class:"xg-get-cssfull"},exitCssFullscreen:{icon:ph,class:"xg-exit-cssfull"}}}},{key:"destroy",value:function(){ue(se(i.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.btnClick)}},{key:"render",value:function(){if(!this.config.disable)return`<xg-icon class='xgplayer-cssfullscreen'>
    <div class="xgplayer-icon">
    </div>
    `.concat(Bt(this,"CSSFULLSCREEN_TIPS",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"cssFullscreen"}},{key:"defaultConfig",get:function(){return{position:Te.CONTROLS_RIGHT,index:1,disable:!1,target:null}}}]),i}(ni),gh=function(s){ie(i,s);var a=ne(i);function i(){return q(this,i),a.apply(this,arguments)}return Q(i,[{key:"afterCreate",value:function(){var e=this;this.clickHandler=this.hook("errorRetry",this.errorRetry,{pre:function(r){r.preventDefault(),r.stopPropagation()}}),this.onError=this.hook("showError",this.handleError),this.bind(".xgplayer-error-refresh","click",this.clickHandler),this.on(Ti,function(n){e.onError(n)})}},{key:"errorRetry",value:function(e){this.emitUserAction(e,"error_retry",{}),this.player.retry()}},{key:"handleError",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this.player,r=e.errorType,o=n.errorNote?this.i18n[n.errorNote]:"";if(!o)switch(r){case"decoder":o=this.i18n.MEDIA_ERR_DECODE;break;case"network":o=this.i18n.MEDIA_ERR_NETWORK;break;default:o=this.i18n.MEDIA_ERR_SRC_NOT_SUPPORTED}this.find(".xgplayer-error-text").innerHTML=o,this.find(".xgplayer-error-tips").innerHTML="".concat(this.i18n.REFRESH_TIPS,'<span class="xgplayer-error-refresh">').concat(this.i18n.REFRESH,"</span>")}},{key:"destroy",value:function(){this.unbind(".xgplayer-error-refresh","click",this.clickHandler)}},{key:"render",value:function(){return`<xg-error class="xgplayer-error">
      <div class="xgplayer-errornote">
       <span class="xgplayer-error-text"></span>
       <span class="xgplayer-error-tips"><em class="xgplayer-error-refresh"></em></span>
      </div>
    </xg-error>`}}],[{key:"pluginName",get:function(){return"error"}}]),i}(fe),mh=function(s){ie(i,s);var a=ne(i);function i(){return q(this,i),a.apply(this,arguments)}return Q(i,[{key:"afterCreate",value:function(){var e=this;this.intervalId=0,this.customConfig=null,this.bind(".highlight",["click","touchend"],function(n){(e.config.onClick||e.customOnClick)&&(n.preventDefault(),n.stopPropagation(),e.customOnClick?e.customOnClick(n):e.config.onClick(n))}),this.player.showPrompt=function(){e.showPrompt.apply(e,arguments)},this.player.hidePrompt=function(){e.hide()}}},{key:"setStyle",value:function(e){var n=this;Object.keys(e).map(function(r){n.root.style[r]=e[r]})}},{key:"showPrompt",value:function(e){var n=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){};if(e){this.customOnClick=o;var u=this.config.interval;this.intervalId&&(clearTimeout(this.intervalId),this.intervalId=null),p.addClass(this.root,"show"),r.mode==="arrow"&&p.addClass(this.root,"arrow"),typeof e=="string"?this.find(".xgplayer-prompt-detail").innerHTML=e:this.find(".xgplayer-prompt-detail").innerHTML="".concat(e.text||"")+"".concat(e.highlight?'<i class="highlight">'.concat(e.highlight,"</i>"):""),r.style&&this.setStyle(r.style);var l=typeof r.autoHide=="boolean"?r.autoHide:this.config.autoHide;if(l){var c=r.interval||u;this.intervalId=setTimeout(function(){n.hide()},c)}}}},{key:"hide",value:function(){p.removeClass(this.root,"show"),p.removeClass(this.root,"arrow"),this.root.removeAttribute("style"),this.customOnClick=null}},{key:"render",value:function(){return'<xg-prompt class="xgplayer-prompt '.concat(U.CONTROLS_FOLLOW,`">
    <span class="xgplayer-prompt-detail"></span>
    </xg-prompt>`)}}],[{key:"pluginName",get:function(){return"prompt"}},{key:"defaultConfig",get:function(){return{interval:3e3,style:{},mode:"arrow",autoHide:!0,detail:{text:"",highlight:""},onClick:function(){}}}}]),i}(fe),Fs={time:0,text:"",id:1,duration:1,color:"#fff",style:{},width:6,height:6};function to(s){Object.keys(Fs).map(function(a){s[a]===void 0&&(s[a]=Fs[a])})}var Us={_updateDotDom:function(a,i){if(i){var t=this.calcuPosition(a.time,a.duration),e=a.style||{};e.left="".concat(t.left,"%"),e.width="".concat(t.width,"%"),i.setAttribute("data-text",a.text),i.setAttribute("data-time",a.time),t.isMini?p.addClass(i,"mini"):p.removeClass(i,"mini"),Object.keys(e).map(function(n){i.style[n]=e[n]})}},initDots:function(){var a=this;this._ispots.map(function(i){a.createDot(i,!1)}),this.ispotsInit=!0},createDot:function(a){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=this.player.plugins.progress;if(t&&(i&&(to(a),this._ispots.push(a)),!(!this.ispotsInit&&i))){var e=this.calcuPosition(a.time,a.duration),n=a.style||{};n.left="".concat(e.left,"%"),n.width="".concat(e.width,"%");var r="xgspot_".concat(a.id," xgplayer-spot");e.isMini&&(r+=" mini");var o=a.template?'<div class="xgplayer-spot-pop">'.concat(a.template,"</div>"):"",u=p.createDom("xg-spot",o,{"data-text":a.text,"data-time":a.time,"data-id":a.id},r);Object.keys(n).map(function(l){u.style[l]=n[l]}),t.outer&&t.outer.appendChild(u),this.positionDot(u,a.id)}},findDot:function(a){if(this.player.plugins.progress){var i=this._ispots.filter(function(t,e){return t.id===a});return i.length>0?i[0]:null}},updateDot:function(a){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=this.player.plugins.progress;if(t){var e=this.findDot(a.id);if(e&&Object.keys(a).map(function(r){e[r]=a[r]}),!!this.ispotsInit){var n=t.find('xg-spot[data-id="'.concat(a.id,'"]'));n&&(this._updateDotDom(a,n),i&&this.showDot(a.id))}}},deleteDot:function(a){var i=this._ispots,t=this.player.plugins.progress;if(t){for(var e=[],n=0;n<i.length;n++)i[n].id===a&&e.push(n);for(var r=e.length,o=r-1;o>=0;o--)if(i.splice(e[o],1),this.ispotsInit){var u=t.find('xg-spot[data-id="'.concat(a,'"]'));u&&u.parentElement.removeChild(u)}}},deleteAllDots:function(){var a=this.player.plugins.progress;if(a){if(!this.ispotsInit){this._ispots=[];return}for(var i=a.root.getElementsByTagName("xg-spot"),t=i.length-1;t>=0;t--)a.outer.removeChild(i[t]);this._ispots=[]}},updateAllDots:function(){var a=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=this.player.plugins.progress;if(t){if(!this.ispotsInit){this._ispots=i;return}this._ispots=[];var e=t.root.getElementsByTagName("xg-spot"),n=e.length;if(n>i.length)for(var r=n-1;r>i.length-1;r--)t.outer.removeChild(e[r]);i.forEach(function(o,u){u<n?(e[u].setAttribute("data-id","".concat(o.id)),a._ispots.push(o),a.updateDot(o)):a.createDot(o)})}},positionDots:function(){var a=this,i=this._ispots,t=this.playerSize,e=this.player.sizeInfo,n=this.player.plugins.progress;!n||e.width===t.width||(t.width=e.width,t.left=e.left,i.forEach(function(r){var o=n.find('xg-spot[data-id="'.concat(r.id,'"]'));o&&a.positionDot(o,r.id)}))},positionDot:function(a,i){var t=p.findDom(a,".xgplayer-spot-pop");if(t){var e=this.playerSize,n=a.getBoundingClientRect(),r=t.getBoundingClientRect(),o=n.left-e.left,u=e.width-o-n.width/2;if(o<r.width/2||e.width<r.width){var l=r.width/2-o;t.style.left="".concat(l,"px")}else if(u<r.width/2){var c=u-r.width/2+n.width/2;t.style.left="".concat(c,"px")}else t.style.left="50%"}},updateDuration:function(){var a=this,i=this.player.plugins.progress;if(i){var t=this._ispots;t.forEach(function(e){var n=i.find('xg-spot[data-id="'.concat(e.id,'"]'));a._updateDotDom(e,n)})}},getAllDotsDom:function(){var a=this.player.plugins.progress;if(!a)return[];var i=a.root.getElementsByTagName("xg-spot");return i},getDotDom:function(a){var i=this.player.plugins.progress;if(i)return i.find('xg-spot[data-id="'.concat(a,'"]'))}};function yh(s){var a=s.config,i=s.player;Object.keys(Us).map(function(e){s[e]=Us[e].bind(s)});var t=i.config.progressDot||a.ispots||[];s._ispots=t.map(function(e){return to(e),e}),s.ispotsInit=!1,s.playerSize={left:i.sizeInfo.left,width:i.sizeInfo.width},s.on(Pt,function(){s.ispotsInit?s.updateDuration():s.initDots()}),s.on(pt,function(){s.positionDots()})}var hi={dragmove:"onProgressMove",dragstart:"onProgressDragStart",dragend:"onProgressDragEnd",click:"onProgressClick",mouseover:"onProgressMouseOver",mouseenter:"onProgressMouseOver"},_h=function(s){ie(i,s);var a=ne(i);function i(t){var e;return q(this,i),e=a.call(this,t),I(x(e),"onMousemove",function(n){if(!e.config.disable){if(p.hasClass(n.target,"xg-spot-content")&&e.config.isHideThumbnailHover){e.player.plugins.progress.onMouseLeave(n);return}(e._state.f||p.hasClass(n.target,"xg-spot-content"))&&(p.event(n),n.stopPropagation())}}),I(x(e),"onMousedown",function(n){e.config.disable||(e._state.f||p.hasClass(n.target,"xg-spot-content"))&&(p.event(n),n.stopPropagation())}),I(x(e),"onMouseup",function(n){if(e.isDrag){var r=e.player.plugins.progress;r&&r.pos&&(r.onMouseUp(n),!r.pos.isEnter&&r.onMouseLeave(n))}}),I(x(e),"onDotMouseLeave",function(n){if(!e.config.disable){e._curDot.removeEventListener("mouseleave",e.onDotMouseLeave),e.blurDot(n.target),e._curDot=null;var r=e.player.plugins.progress;r&&r.enableBlur(),e.show()}}),I(x(e),"onProgressMouseOver",function(n,r){if(!e.config.disable&&p.hasClass(r.target,"xgplayer-spot")&&!e._curDot){e._curDot=r.target,e.focusDot(r.target),e._curDot.children.length>0&&e.hide();var o=e.player.plugins.progress;o&&o.disableBlur(),e._curDot.addEventListener("mouseleave",e.onDotMouseLeave)}}),e._ispots=[],e.videoPreview=null,e.videothumbnail=null,e.thumbnail=null,e.timeStr="",e._state={now:0,f:!1},e}return Q(i,[{key:"beforeCreate",value:function(e){var n=e.player.plugins.progress;n&&(e.root=n.root)}},{key:"afterCreate",value:function(){var e=this;this._curDot=null,this.handlerSpotClick=this.hook("spotClick",function(n,r){r.seekTime&&e.player.seek(r.seekTime)}),this.transformTimeHook=this.hook("transformTime",function(n){e.setTimeContent(p.format(n))}),yh(this),this.on(Pt,function(){e.show()}),this.config.disable&&this.disable(),this.extTextRoot=this.find(".xg-spot-ext-text")}},{key:"setConfig",value:function(e){var n=this;e&&Object.keys(e).map(function(r){n.config[r]=e[r]})}},{key:"onPluginsReady",value:function(){var e=this.player;e.plugins.progress&&(this.previewLine=this.find(".xg-spot-line"),this.timePoint=this.find(".xgplayer-progress-point"),this.timeText=this.find(".xg-spot-time"),this.tipText=this.find(".spot-inner-text"),this._hasThumnail=!1,this.registerThumbnail(),this.bindEvents())}},{key:"bindEvents",value:function(){var e=this,n=this.player.plugins.progress;if(n&&(Object.keys(hi).map(function(o){e[hi[o]]=e[hi[o]].bind(e),n.addCallBack(o,e[hi[o]])}),oe.device!=="mobile")){this.bind(".xg-spot-info","mousemove",this.onMousemove),this.bind(".xg-spot-info","mousedown",this.onMousedown),this.bind(".xg-spot-info","mouseup",this.onMouseup);var r=this.hook("previewClick",function(){});this.handlerPreviewClick=function(o){o.stopPropagation(),r(parseInt(e._state.now*1e3,10)/1e3,o)},this.bind(".xg-spot-content","mouseup",this.handlerPreviewClick)}}},{key:"onProgressMove",value:function(e,n){this.config.disable||!this.player.duration||this.updatePosition(e.offset,e.width,e.currentTime,e.e)}},{key:"onProgressDragStart",value:function(e){this.config.disable||!this.player.duration||(this.isDrag=!0,this.videoPreview&&p.addClass(this.videoPreview,"show"))}},{key:"onProgressDragEnd",value:function(e){this.config.disable||!this.player.duration||(this.isDrag=!1,this.videoPreview&&p.removeClass(this.videoPreview,"show"))}},{key:"onProgressClick",value:function(e,n){this.config.disable||p.hasClass(n.target,"xgplayer-spot")&&(n.stopPropagation(),n.preventDefault(),["time","id","text"].map(function(r){e[r]=n.target.getAttribute("data-".concat(r))}),e.time&&(e.time=Number(e.time)),this.handlerSpotClick(n,e))}},{key:"updateLinePos",value:function(e,n){var r=this.root,o=this.previewLine,u=this.player,l=this.config,c=u.controls.mode,h=c==="flex",f=r.getBoundingClientRect().width;if(!(!f&&this._hasThumnail)){f=this._hasThumnail&&f<l.width?l.width:f;var d=e-f/2,v;d<0&&!h?(d=0,v=e-f/2):d>n-f&&!h?(v=d-(n-f),d=n-f):v=0,v!==void 0&&(o.style.transform="translateX(".concat(v.toFixed(2),"px)")),r.style.transform="translateX(".concat(d.toFixed(2),"px) translateZ(0)")}}},{key:"updateTimeText",value:function(e){var n=this.timeText,r=this.timePoint;n.innerHTML=e,!this.thumbnail&&(r.innerHTML=e)}},{key:"updatePosition",value:function(e,n,r,o){var u=this.root,l=this.config,c=this._state;if(u){c.now=r,this.transformTimeHook(r);var h=this.timeStr;o&&o.target&&p.hasClass(o.target,"xgplayer-spot")?(this.showTips(o.target.getAttribute("data-text"),!1,h),this.focusDot(o.target),c.f=!0,l.isFocusDots&&c.f&&(c.now=parseInt(o.target.getAttribute("data-time"),10))):l.defaultText?(c.f=!1,this.showTips(l.defaultText,!0,h)):(c.f=!1,this.hideTips("")),this.updateTimeText(h),this.updateThumbnails(c.now),this.updateLinePos(e,n)}}},{key:"setTimeContent",value:function(e){this.timeStr=e}},{key:"updateThumbnails",value:function(e){var n=this.player,r=this.videoPreview,o=this.config,u=n.plugins.thumbnail;if(u&&u.usable){this.thumbnail&&u.update(this.thumbnail,e,o.width,o.height);var l=r&&r.getBoundingClientRect();this.videothumbnail&&u.update(this.videothumbnail,e,l.width,l.height)}}},{key:"registerThumbnail",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(oe.device!=="mobile"){var n=this.player,r=this.config,o=n.getPlugin("thumbnail");if(o&&o.setConfig(e),!o||!o.usable||!r.isShowThumbnail){p.addClass(this.root,"short-line no-thumbnail");return}else p.removeClass(this.root,"short-line no-thumbnail");r.mode==="short"&&p.addClass(this.root,"short-line"),this._hasThumnail=!0;var u=this.find(".xg-spot-thumbnail");this.thumbnail=o.createThumbnail(u,"progress-thumbnail"),r.isShowCoverPreview&&(this.videoPreview=p.createDom("xg-video-preview","",{},"xgvideo-preview"),n.root.appendChild(this.videoPreview),this.videothumbnail=o.createThumbnail(this.videoPreview,"xgvideo-thumbnail")),this.updateThumbnails(0)}}},{key:"calcuPosition",value:function(e,n){var r=this.player.plugins.progress,o=this.player,u=r.root.getBoundingClientRect().width,l=o.duration/u*6;return e+n>o.duration&&(n=o.duration-e),e/o.duration*100,n/o.duration,{left:e/o.duration*100,width:n/o.duration*100,isMini:n<l}}},{key:"showDot",value:function(e){var n=this.findDot(e);if(n){var r=this.root.getBoundingClientRect(),o=r.width,u=n.time/this.player.duration*o;this.updatePosition(u,o,n.time)}}},{key:"focusDot",value:function(e,n){e&&(n||(n=e.getAttribute("data-id")),p.addClass(e,"active"),this._activeDotId=n)}},{key:"blurDot",value:function(e){if(!e){var n=this._activeDotId;e=this.getDotDom(n)}e&&(p.removeClass(e,"active"),this._activeDotId=null)}},{key:"showTips",value:function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";p.addClass(this.root,"no-timepoint"),e&&(p.addClass(this.find(".xg-spot-content"),"show-text"),n&&this.config.mode==="production"?(p.addClass(this.root,"product"),this.tipText.textContent=e):(p.removeClass(this.root,"product"),this.tipText.textContent=this._hasThumnail?e:"".concat(r," ").concat(e)))}},{key:"hideTips",value:function(){p.removeClass(this.root,"no-timepoint"),this.tipText.textContent="",p.removeClass(this.find(".xg-spot-content"),"show-text"),p.removeClass(this.root,"product")}},{key:"hide",value:function(){p.addClass(this.root,"hide")}},{key:"show",value:function(e){p.removeClass(this.root,"hide")}},{key:"enable",value:function(){var e=this.config,n=this.playerConfig;this.config.disable=!1,this.show(),!this.thumbnail&&e.isShowThumbnail&&this.registerThumbnail(n.thumbnail||{})}},{key:"disable",value:function(){this.config.disable=!0,this.hide()}},{key:"destroy",value:function(){var e=this,n=this.player.plugins.progress;n&&Object.keys(hi).map(function(r){n.removeCallBack(r,e[hi[r]])}),this.videothumbnail=null,this.thumbnail=null,this.videoPreview&&this.player.root.removeChild(this.videoPreview),this.unbind(".xg-spot-info","mousemove",this.onMousemove),this.unbind(".xg-spot-info","mousedown",this.onMousedown),this.unbind(".xg-spot-info","mouseup",this.onMouseup),this.unbind(".xg-spot-content","mouseup",this.handlerPreviewClick)}},{key:"render",value:function(){return oe.device==="mobile"||this.playerConfig.isMobileSimulateMode==="mobile"?"":'<div class="xg-spot-info hide '.concat(this.config.mode==="short"?"short-line":"",`">
      <div class="xg-spot-content">
        <div class="xg-spot-thumbnail">
          <span class="xg-spot-time"></span>
        </div>
        <div class="xg-spot-text"><span class="spot-inner-text"></span></div>
      </div>
      <div class="xgplayer-progress-point">00:00</div>
      <div class="xg-spot-ext-text"></div>
      <div class="xg-spot-line"></div>
    </div>`)}}],[{key:"pluginName",get:function(){return"progresspreview"}},{key:"defaultConfig",get:function(){return{index:1,miniWidth:6,ispots:[],defaultText:"",isFocusDots:!0,isHideThumbnailHover:!0,isShowThumbnail:!0,isShowCoverPreview:!1,mode:"",disable:!1,width:160,height:90}}}]),i}(fe),bh=function(s){ie(i,s);var a=ne(i);function i(t){var e;return q(this,i),e=a.call(this,t),e.ratio=1,e.interval=null,e._preloadMark={},e}return Q(i,[{key:"afterCreate",value:function(){var e=this;this.usable&&this.initThumbnail(),this.on([Pt],function(){var n=e.config,r=n.pic_num,o=n.interval;e.usable&&(e.interval=o>0?o:Math.round(e.player.duration*1e3/r)/1e3)})}},{key:"setConfig",value:function(e){var n=this;if(e){var r=Object.keys(e);r.length<1||(r.forEach(function(o){n.config[o]=e[o]}),this.usable&&this.initThumbnail())}}},{key:"usable",get:function(){var e=this.config,n=e.urls,r=e.pic_num;return n&&n.length>0&&r>0}},{key:"initThumbnail",value:function(){var e=this.config,n=e.width,r=e.height,o=e.pic_num,u=e.interval;this.ratio=n/r*100,this.interval=u||Math.round(this.player.duration/o),this._preloadMark={}}},{key:"getUrlByIndex",value:function(e){return e>=0&&e<this.config.urls.length?this.config.urls[e]:""}},{key:"preload",value:function(e){var n=this;if(!this._preloadMark[e]){var r=this.config.urls,o=r.length,u=[];e>0&&u.push(e-1),u.push(e),e>0&&e<o-1&&u.push(e+1),u.map(function(l){!n._preloadMark[l]&&l>=0&&l<o&&(n._preloadMark[l]=1,p.preloadImg(r[l],function(){n._preloadMark[l]=2}))})}}},{key:"getPosition",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=this.config,u=o.pic_num,l=o.row,c=o.col,h=o.width,f=o.height;this.interval=Math.round(this.player.duration/u);var d=Math.ceil(e/this.interval);d=d>u?u:d;var v=d<l*c?0:Math.ceil(d/(l*c))-1,m=d-v*(c*l),g=m>0?Math.ceil(m/c)-1:0,b=m>0?m-g*c-1:0,k=0,E=0;if(n&&r){var w=n/r;w<h/f?(E=r,k=E*(h/f)):(k=n,E=k/(h/f))}else r?n||(E=r||f,k=E*(h/f)):(k=n||h,E=k/(h/f));var C=this.getUrlByIndex(v);return{urlIndex:v,rowIndex:g,colIndex:b,url:C,height:E,width:k,style:{backgroundImage:"url(".concat(C,")"),backgroundSize:"".concat(k*c,"px auto"),backgroundPosition:"-".concat(b*k,"px -").concat(g*E,"px"),width:"".concat(k,"px"),height:"".concat(E,"px")}}}},{key:"update",value:function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"",l=this.config,c=l.pic_num,h=l.urls;if(!(c<=0||!h||h.length===0)){var f=this.getPosition(n,r,o);this.preload(f.urlIndex),Object.keys(f.style).map(function(d){e.style[d]=f.style[d]}),Object.keys(u).map(function(d){e.style[d]=u[d]})}}},{key:"changeConfig",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.setConfig(e)}},{key:"createThumbnail",value:function(e,n){var r=p.createDom("xg-thumbnail","",{},"thumbnail ".concat(n));return e&&e.appendChild(r),r}}],[{key:"pluginName",get:function(){return"thumbnail"}},{key:"defaultConfig",get:function(){return{isShow:!1,urls:[],pic_num:0,col:0,row:0,height:90,width:160,scale:1,className:"",hidePortrait:!1}}}]),i}(fe);function ir(s){return s?"background:".concat(s,";"):""}var Sh=function(s){ie(i,s);var a=ne(i);function i(){var t;q(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=a.call.apply(a,[this].concat(n)),I(x(t),"onTimeupdate",function(){var o=t.player.ended,u=x(t),l=u.offsetDuration,c=t.currentTime;c=p.adjustTimeByDuration(c,l,o),t.update({played:c},l)}),t}return Q(i,[{key:"offsetDuration",get:function(){return this.playerConfig.customDuration||this.player.offsetDuration||this.player.duration}},{key:"currentTime",get:function(){var e=this.player,n=e.offsetCurrentTime,r=e.currentTime;return n>=0?n:r}},{key:"afterCreate",value:function(){var e=this;this.root&&(this.on($e,this.onTimeupdate),this.on(ii,function(){e.reset()}))}},{key:"reset",value:function(){this.update({played:0,cached:0},0)}},{key:"update",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{cached:0,played:0},n=arguments.length>1?arguments[1]:void 0;!n||!this.root||(e.cached&&(this.find("xg-mini-progress-cache").style.width="".concat(e.cached/n*100,"%")),e.played&&(this.find("xg-mini-progress-played").style.width="".concat(e.played/n*100,"%")))}},{key:"render",value:function(){var e=this.playerConfig,n=e.commonStyle,r=e.miniprogress;if(r){var o=this.config,u=o.mode,l=o.height,c={cached:ir(n.cachedColor),played:ir(n.playedColor),progress:ir(n.progressColor),height:l>0&&l!==2?"height: ".concat(l,"px;"):""},h=u==="show"?"xg-mini-progress-show":"";return'<xg-mini-progress class="xg-mini-progress '.concat(h,'" style="').concat(c.progress," ").concat(c.height,`">
    <xg-mini-progress-cache class="xg-mini-progress-cache" style="`).concat(c.cached,`"></xg-mini-progress-cache>
    <xg-mini-progress-played class="xg-mini-progress-played" style="`).concat(c.played,`"></xg-mini-progress-played>
    </xg-mini-progress>`)}}}],[{key:"pluginName",get:function(){return"MiniProgress"}},{key:"defaultConfig",get:function(){return{mode:"auto",height:2}}}]),i}(fe),fi={REAL_TIME:"realtime",FIRST_FRAME:"firstframe",FRAME_RATE:"framerate",POSTER:"poster"};function Eh(){try{return parseInt(window.performance.now(),10)}catch{return new Date().getTime()}}function kh(){try{var s=document.createElement("canvas").getContext;return!!s}catch{return!1}}var Ji=null,Th=function(s){ie(i,s);var a=ne(i);function i(){var t;q(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=a.call.apply(a,[this].concat(n)),I(x(t),"onLoadedData",function(o){t.player&&(t._frameCount=t.config.startFrameCount,t.stop(),t.renderOnTimeupdate(o),t.off($e,t.renderOnTimeupdate),t.on($e,t.renderOnTimeupdate))}),I(x(t),"onVisibilitychange",function(o){document.visibilityState==="visible"?t._checkIfCanStart()&&t.start():document.visibilityState==="hidden"&&t.stop()}),I(x(t),"renderOnTimeupdate",function(o){if(t._frameCount>0)t.renderOnce(),t._frameCount--;else{t._isLoaded=!0,t.off($e,t.renderOnTimeupdate);var u=t.config.startInterval;!t.player.paused&&t._checkIfCanStart()&&t.start(0,u)}}),I(x(t),"start",function(o,u){var l=t.player.video,c=Eh(),h=t.checkVideoIsSupport(l);!h||!t.canvasCtx||(u||(u=t.interval),t.stop(),l.videoWidth&&l.videoHeight&&(t.videoPI=l.videoHeight>0?parseInt(l.videoWidth/l.videoHeight*100,10):0,(t.config.mode===fi.REAL_TIME||c-t.preTime>=u)&&(l&&l.videoWidth&&t.update(h,t.videoPI),t.preTime=c)),t.frameId=t._loopType==="timer"?p.setTimeout(x(t),t.start,u):p.requestAnimationFrame(t.start))}),I(x(t),"stop",function(){t.frameId&&(t._loopType==="timer"?p.clearTimeout(x(t),t.frameId):p.cancelAnimationFrame(t.frameId),t.frameId=null)}),t}return Q(i,[{key:"afterCreate",value:function(){var e=this;this.playerConfig.dynamicBg===!0&&(this.config.disable=!1),i.isSupport||(this.config.disable=!0);var n=this.config,r=n.disable,o=n.mode,u=n.frameRate;r||(this._pos={width:0,height:0,rwidth:0,rheight:0,x:0,y:0,pi:0},this.isStart=!1,this._isLoaded=!1,this.videoPI=0,this.preTime=0,this.interval=parseInt(1e3/u,10),this.canvas=null,this.canvasCtx=null,this._frameCount=0,this._loopType=this.config.mode!==fi.REAL_TIME&&this.interval>=1e3?"timer":"animation",this.once(Dn,function(){e.player&&(e.init(),e.renderByPoster(),e.player.paused||e.start())}),o!==fi.POSTER&&(o!==fi.FIRST_FRAME&&(this.on(ii,function(){e.stop()}),this.on(je,function(){var l=e.config.startInterval;e._checkIfCanStart()&&e.start(0,l)}),this.on(dt,function(){e.stop()})),this.on(vt,this.onLoadedData),this.on(zr,function(){e._isLoaded=!1,e.stop()}),document.addEventListener("visibilitychange",this.onVisibilitychange)))}},{key:"setConfig",value:function(e){var n=this;Object.keys(e).forEach(function(r){r==="root"&&e[r]!==n.config[r]?n.reRender(e[r]):r==="frameRate"?n.interval=parseInt(1e3/e[r],10):r==="disable"&&e[r]&&n.stop(),n.config[r]=e[r]})}},{key:"init",value:function(e){var n=this.player,r=this.config;this.canvasFilter=i.supportCanvasFilter();try{var o=e||r.root;o||(o=r.isInnerRender&&n.innerContainer||n.root),o.insertAdjacentHTML("afterbegin",'<div class="xgplayer-dynamic-bg" data-index="'.concat(r.index,`"><canvas>
        </canvas><xgmask></xgmask></div>`)),this.root=o.children[0],this.canvas=this.find("canvas"),this.canvasFilter||(this.canvas.style.filter=r.filter,this.canvas.style.webkitFilter=r.filter),this.mask=this.find("xgmask"),r.addMask&&(this.mask.style.background=r.maskBg),this.canvasCtx=this.canvas.getContext("2d")}catch(u){pe.logError("plugin:DynamicBg",u)}}},{key:"reRender",value:function(e){var n=this.config.disable;if(!(!n&&!this.root)){this.stop();var r=this.root?this.root.parentElement:null;if(r!==e&&r.removeChild(this.root),!e){this.root=null;return}this.init(e),this.renderOnce();var o=this.config.startInterval;this._checkIfCanStart()&&this.start(0,o)}}},{key:"checkVideoIsSupport",value:function(e){if(!e)return null;var n=e&&e instanceof window.HTMLVideoElement?e:e.canvas?e.canvas:e.flyVideo?e.flyVideo:null;if(n&&!(oe.browser==="safari"&&p.isMSE(n)))return n;var r=n?n.tagName.toLowerCase():"";return r==="canvas"||r==="img"?n:null}},{key:"renderByPoster",value:function(){var e=this.playerConfig.poster;if(e){var n=p.typeOf(e)==="String"?e:p.typeOf(e.poster)==="String"?e.poster:null;this.updateImg(n)}}},{key:"_checkIfCanStart",value:function(){var e=this.config.mode;return this._isLoaded&&!this.player.paused&&e!==fi.FIRST_FRAME&&e!==fi.POSTER}},{key:"renderOnce",value:function(){var e=this.player.video;if(!(!e.videoWidth||!e.videoHeight)){this.videoPI=parseInt(e.videoWidth/e.videoHeight*100,10);var n=this.checkVideoIsSupport(e);n&&this.update(n,this.videoPI)}}},{key:"updateImg",value:function(e){var n=this;if(e){var r=this.canvas.getBoundingClientRect(),o=r.width,u=r.height,l=new window.Image;l.onload=function(){if(!(!n.canvas||n.frameId||n.isStart)){n.canvas.height=u,n.canvas.width=o;var c=parseInt(o/u*100,10);n.update(l,c),l=null}},l.src=e}}},{key:"update",value:function(e,n){if(!(!this.canvas||!this.canvasCtx||!n))try{var r=this._pos,o=this.config,u=this.canvas.getBoundingClientRect(),l=u.width,c=u.height;if(l!==r.width||c!==r.height||r.pi!==n){var h=parseInt(l/c*100,10);r.pi=n,r.width!==l&&(r.width=this.canvas.width=l),r.height!==c&&(r.height=this.canvas.height=c);var f=c,d=l;h<n?d=parseInt(c*n/100,10):h>n&&(f=parseInt(l*100/n,10)),r.rwidth=d*o.multiple,r.rheight=f*o.multiple,r.x=(l-r.rwidth)/2,r.y=(c-r.rheight)/2}this.canvasFilter&&(this.canvasCtx.filter=o.filter),this.canvasCtx.drawImage(e,r.x,r.y,r.rwidth,r.rheight)}catch(v){pe.logError("plugin:DynamicBg",v)}}},{key:"destroy",value:function(){this.stop(),document.removeEventListener("visibilitychange",this.onVisibilitychange),this.canvasCtx=null,this.canvas=null}},{key:"render",value:function(){return""}}],[{key:"pluginName",get:function(){return"dynamicBg"}},{key:"defaultConfig",get:function(){return{isInnerRender:!1,disable:!0,index:-1,mode:"framerate",frameRate:10,filter:"blur(50px)",startFrameCount:2,startInterval:0,addMask:!0,multiple:1.2,maskBg:"rgba(0,0,0,0.7)"}}},{key:"isSupport",get:function(){return typeof Ji=="boolean"||(Ji=kh()),Ji}},{key:"supportCanvasFilter",value:function(){return!(oe.browser==="safari"||oe.browser==="firefox")}}]),i}(fe),wh={LANG:"zh-cn",TEXT:{ERROR_TYPES:{network:{code:1,msg:"视频下载错误"},mse:{code:2,msg:"流追加错误"},parse:{code:3,msg:"解析错误"},format:{code:4,msg:"格式错误"},decoder:{code:5,msg:"解码错误"},runtime:{code:6,msg:"语法错误"},timeout:{code:7,msg:"播放超时"},other:{code:8,msg:"其他错误"}},HAVE_NOTHING:"没有关于音频/视频是否就绪的信息",HAVE_METADATA:"音频/视频的元数据已就绪",HAVE_CURRENT_DATA:"关于当前播放位置的数据是可用的，但没有足够的数据来播放下一帧/毫秒",HAVE_FUTURE_DATA:"当前及至少下一帧的数据是可用的",HAVE_ENOUGH_DATA:"可用数据足以开始播放",NETWORK_EMPTY:"音频/视频尚未初始化",NETWORK_IDLE:"音频/视频是活动的且已选取资源，但并未使用网络",NETWORK_LOADING:"浏览器正在下载数据",NETWORK_NO_SOURCE:"未找到音频/视频来源",MEDIA_ERR_ABORTED:"取回过程被用户中止",MEDIA_ERR_NETWORK:"网络错误",MEDIA_ERR_DECODE:"解码错误",MEDIA_ERR_SRC_NOT_SUPPORTED:"不支持的音频/视频格式",REPLAY:"重播",ERROR:"网络连接似乎出现了问题",PLAY_TIPS:"播放",PAUSE_TIPS:"暂停",PLAYNEXT_TIPS:"下一集",DOWNLOAD_TIPS:"下载",ROTATE_TIPS:"旋转",RELOAD_TIPS:"重新载入",FULLSCREEN_TIPS:"进入全屏",EXITFULLSCREEN_TIPS:"退出全屏",CSSFULLSCREEN_TIPS:"进入样式全屏",EXITCSSFULLSCREEN_TIPS:"退出样式全屏",TEXTTRACK:"字幕",PIP:"画中画",SCREENSHOT:"截图",LIVE:"正在直播",OFF:"关闭",OPEN:"开启",MINI_DRAG:"点击按住可拖动视频",MINISCREEN:"小屏幕",REFRESH_TIPS:"请试试",REFRESH:"刷新",FORWARD:"快进中",LIVE_TIP:"直播"}},wi="info",nr=Ga,Ch=function(s){ie(i,s);var a=ne(i);function i(){var t;q(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=a.call.apply(a,[this].concat(n)),I(x(t),"_recordUserActions",function(o){var u=t._getTime(),l=Object.assign({},o,{msg:o.msg||o.action});t._stats[wi].push(Le(Le({type:"userAction"},u),{},{payload:l}))}),I(x(t),"_onReset",function(){t.reset()}),I(x(t),"_recordInfo",function(o){t.info(o)}),I(x(t),"_downloadStats",function(){var o=t.getStats(),u=new Blob([JSON.stringify(o)],{type:"application/json"}),l=window.URL.createObjectURL(u),c=document.createElement("a");c.style.display="none",c.href=l,c.download="player.txt",c.disabled=!1,c.click()}),t}return Q(i,[{key:"_getTime",value:function(){return{timestamp:Date.now(),timeFormat:new Date().toISOString()}}},{key:"afterCreate",value:function(){this.reset(),this.on(_n,this._recordUserActions),this.on(nr.STATS_INFO,this._recordInfo),this.on(nr.STATS_DOWNLOAD,this._downloadStats),this.on(nr.STATS_RESET,this._onReset)}},{key:"destroy",value:function(){this.offAll()}},{key:"downloadStats",value:function(){this._downloadStats()}},{key:"info",value:function(e){e.profile?this._infoProfile(e):this._info(e)}},{key:"_info",value:function(e){var n=this._getTime();this._stats[wi].push(Le(Le({},n),{},{payload:e}))}},{key:"_infoProfile",value:function(e){if(e&&e.startMs){var n=Date.now(),r=n-e.startMs,o=Le({cat:"function",dur:r,name:e.name||e.msg,ph:"X",pid:0,tid:0,ts:e.startMs,profile:!0},e);this._info(o)}else console.warn("infoProfile need object data, include startMs")}},{key:"reset",value:function(){var e;this._stats=(e={},I(e,wi,[]),I(e,"media",{}),e)}},{key:"getStats",value:function(){for(var e=this.player,n=e.media,r=[],o=0;o<n.buffered.length;o++)r.push({start:n.buffered.start(o),end:n.buffered.end(o)});var u={currentTime:n.currentTime,readyState:n.readyState,buffered:r,paused:n.paused,ended:n.ended};return this._stats.media=u,{raw:this._stats,timestat:this._getTimeStats(),profile:this._getProfile()}}},{key:"_getTimeStats",value:function(){var e=this._stats[wi],n=e.map(function(r){var o=r.payload.data,u="";try{o instanceof Error?u=o.msg:o!==void 0&&(u=JSON.stringify(o))}catch(l){console.log("err",l)}return"[".concat(r.timeFormat,"] : ").concat(r.payload.msg," ").concat(u," ")});return n}},{key:"_getProfile",value:function(){var e={traceEvents:[]},n=this._stats[wi];return n.forEach(function(r){r.payload.profile&&e.traceEvents.push(r.payload)}),e}}],[{key:"pluginName",get:function(){return"stats"}},{key:"defaultConfig",get:function(){return{}}}]),i}(gt),io=function(s){ie(i,s);var a=ne(i);function i(){var t;q(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=a.call.apply(a,[this].concat(n)),I(x(t),"onGapJump",function(){var o=x(t),u=o.player,l=o.config;if(u.media.readyState!==HTMLMediaElement.HAVE_NOTHING){if(u.media.seeking){if(!t.seekingEventReceived)return}else t.seekingEventReceived=!1;if(!(u.media.paused&&u.media.currentTime!==0&&t.hasPlayed)){var c=u.media.buffered,h=l.smallGapLimit||.5,f=l.gapDetectionThreshold||.3,d=u.media.currentTime,v=t._getIndex(c,d,f);if(!(v===null||v===0)){console.log("GapJump  bufferRange ",c.start(v),c.end(v));var m=c.start(v)+.1,g=u.media.duration;if(!(m>g)){var b=m-d,k=b<=h;b<i.BROWSER_GAP_TOLERANCE||k&&(l.useGapJump!==!1&&(u.media.currentTime=t.isSafari?m+.1:m),t.player&&t.player.emit("detectGap"),console.log("gapJump gapIndex",v," isGapSamll:",k," currentTime:",u.media.currentTime," jumpSize:",d-u.media.currentTime),m!==.08&&u&&u.emit("log",{type:"oneevent",end_type:"gap",vid:u.config.vid,ext:{video_postion:Math.floor(m*1e3)}}))}}}}}),t}return Q(i,[{key:"afterCreate",value:function(){var e=this,n=this.config.useGapJump;n!==!1&&(this.hasPlayed=!1,this.seekingEventReceived=!1,this.isSafari=/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),this.on(zi,this.onGapJump),this.on(je,function(){e.hasPlayed=!0}),this.on(Ln,function(){e.seekingEventReceived=!0}))}},{key:"_getIndex",value:function(e,n,r){if(!e||!e.length||e.length===1&&e.end(0)-e.start(0)<1e-6)return null;for(var o=this._getBuffered(e),u=null,l=0;l<o.length;l++){var c=o[l];if(c.start>n&&(l===0||o[l-1].end-n<=r)){u=l;break}}return u}},{key:"_getBuffered",value:function(e){if(!e)return[];for(var n=[],r=0;r<e.length;r++)n.push({start:e.start(r),end:e.end(r)});return n}}],[{key:"pluginName",get:function(){return"gapJump"}},{key:"defaultConfig",get:function(){return{useGapJump:!1,smallGapLimit:.5,gapDetectionThreshold:.3}}}]),i}(fe);io.BROWSER_GAP_TOLERANCE=.001;var Ah=function(s){ie(i,s);var a=ne(i);function i(){var t;q(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=a.call.apply(a,[this].concat(n)),I(x(t),"onWaiting",function(){var o=x(t),u=o.config;t.jumpCnt>u.jumpCntMax||t.timer||u.useWaitingTimeoutJump===!1||(t.timer=setTimeout(t.onJump,u.waitingTime*1e3))}),I(x(t),"onJump",function(){var o=x(t),u=o.player,l=o.config;if(clearTimeout(t.timer),t.timer=null,!(t.jumpCnt>l.jumpCntMax||l.useWaitingTimeoutJump===!1)&&!(u.media.paused&&u.media.currentTime!==0&&t.hasPlayed)){t.jumpSize=l.jumpSize*(t.jumpCnt+1),t.jumpCnt===l.jumpSize&&t.jumpSize<6&&(t.jumpSize=6);var c=u.currentTime+t.jumpSize,h=u.media.duration;c>h||(t.jumpCnt++,u.currentTime=c)}}),t}return Q(i,[{key:"afterCreate",value:function(){var e=this,n=this.config,r=n.useWaitingTimeoutJump,o=n.jumpSize;r!==!1&&(this.hasPlayed=!1,this.jumpCnt=0,this.timer=null,this.jumpSize=o,this.on(zi,this.onWaiting),this.on([jr,bt],function(){clearTimeout(e.timer),e.timer=null,e.jumpSize=e.config.jumpSize}),this.on(je,function(){e.hasPlayed=!0}))}}],[{key:"pluginName",get:function(){return"waitingTimeoutJump"}},{key:"defaultConfig",get:function(){return{useWaitingTimeoutJump:!1,waitingTime:15,jumpSize:2,jumpCntMax:4}}}]),i}(fe),di="cdn",Zi=["cdn"],Ph=function(s){ie(i,s);var a=ne(i);function i(){var t;q(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=a.call.apply(a,[this].concat(n)),I(x(t),"getSpeed",function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:di;if(!t.speedListCache||!t.speedListCache[o]||t.speedListCache[o].length<=0)return 0;var u=0;return t.speedListCache[o].map(function(l){u+=l}),Math.floor(u/t.speedListCache[o].length)}),I(x(t),"startTimer",function(){p.isMSE(t.player.video)||(t.initSpeedList(),t.cnt=0,t.timer=setTimeout(t.testSpeed,t.config.testTimeStep))}),I(x(t),"initSpeedList",function(){t.speedListCache={},Zi.forEach(function(o){t.speedListCache[o]=[]})}),I(x(t),"_onRealSpeedChange",function(o){o.speed&&t.appendList(o.speed,o.type||di)}),I(x(t),"testSpeed",function(){if(clearTimeout(t.timer),t.timer=null,!(!t.player||!t.config.openSpeed)){var o=t.config,u=o.url,l=o.loadSize,c=o.testCnt,h=o.testTimeStep,f=u+(u.indexOf("?")<0?"?testst=":"&testst=")+Date.now();if(!(t.cnt>=c)){t.cnt++;try{var d=new Date().getTime(),v=null,m=new XMLHttpRequest;t.xhr=m,m.open("GET",f);var g={},b=Math.floor(Math.random()*10);g.Range="bytes="+b+"-"+(l+b),g&&Object.keys(g).forEach(function(k){m.setRequestHeader(k,g[k])}),m.onreadystatechange=function(){if(m.readyState===4){t.xhr=null,v=new Date().getTime();var k=m.getResponseHeader("Content-Length")/1024*8,E=Math.round(k*1e3/(v-d));t.appendList(E),t.timer=setTimeout(t.testSpeed,h)}},m.send()}catch(k){console.error(k)}}}}),I(x(t),"appendList",function(o){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:di;if(!(!t.speedListCache||!t.speedListCache[u])){var l=t.config.saveSpeedMax;t.speedListCache[u].length>=l&&t.speedListCache[u].shift(),t.speedListCache[u].push(o);var c=x(t),h=c.player;h&&(u===di?h.realTimeSpeed=o:h[t.getSpeedName("realTime",u)]=o),t.updateSpeed(u)}}),I(x(t),"updateSpeed",function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:di,u=t.getSpeed(o),l=x(t),c=l.player;if(c)if(o===di)(!c.avgSpeed||u!==c.avgSpeed)&&(c.avgSpeed=u,c.emit(Er,{speed:u,realTimeSpeed:c.realTimeSpeed}));else{var h=t.getSpeedName("avg",o);(!c[h]||u!==c[h])&&(c[h]=u,c.emit(Er,{speed:u,realTimeSpeed:c.realTimeSpeed}))}}),t}return Q(i,[{key:"afterCreate",value:function(){var e=this.config,n=e.openSpeed,r=e.addSpeedTypeList;(r==null?void 0:r.length)>0&&Zi.push.apply(Zi,ot(r)),this.initSpeedList(),this.on("real_time_speed",this._onRealSpeedChange),this.timer=null,this.cnt=0,this.xhr=null,n&&this.on([vt,pn],this.startTimer)}},{key:"getSpeedName",value:function(e,n){return e+"Speed"+n.toUpperCase()}},{key:"openSpeed",get:function(){return this.config.openSpeed},set:function(e){if(this.config.openSpeed=e,!e&&this.timer){clearTimeout(this.timer),this.timer=null;return}if(this.config.openSpeed){if(this.timer)return;this.timer=setTimeout(this.testSpeed,this.config.testTimeStep)}}},{key:"destroy",value:function(){var e=this;this.off("real_time_speed",this._onRealSpeedChange),this.off([vt,pn],this.startTimer),Zi.forEach(function(n){e.speedListCache&&e.speedListCache[n]&&(e.speedListCache[n]=[])}),this.speedListCache&&(this.speedListCache={}),clearTimeout(this.timer),this.timer=null,this.xhr&&this.xhr.readyState!==4&&(this.xhr.cancel&&this.xhr.cancel(),this.xhr=null)}}],[{key:"pluginName",get:function(){return"testspeed"}},{key:"defaultConfig",get:function(){return{openSpeed:!1,testCnt:3,loadSize:200*1024,testTimeStep:3e3,url:"",saveSpeedMax:5,addSpeedTypeList:[]}}}]),i}(fe),xh=function(s){ie(i,s);var a=ne(i);function i(){return q(this,i),a.apply(this,arguments)}return Q(i,[{key:"afterCreate",value:function(){var e=this,n=this.player,r=this.config,o=n.media||n.video;if(this.timer=null,this._lastDecodedFrames=0,this._currentStuckCount=0,this._lastCheckPoint=null,this._payload=[],!r.disabled){var u=o.getVideoPlaybackQuality;u&&(this.on(je,function(){e._startTick()}),this.on(dt,function(){e._stopTick()}),this.on(Ct,function(){e._stopTick()}),this.on(ii,function(){e._stopTick()}))}}},{key:"_startTick",value:function(){var e=this;this._stopTick(),this._timer=setTimeout(function(){e._checkDecodeFPS(),e._startTick()},this.config.tick)}},{key:"_stopTick",value:function(){clearTimeout(this._timer),this._timer=null}},{key:"_checkBuffer",value:function(e,n){for(var r=!1,o=[],u=0;u<n.length;u++){var l=n.start(u),c=n.end(u);if(o.push({start:l,end:c}),l<=e&&e<=c-1){r=!0;break}}return{enoughBuffer:r,buffers:o}}},{key:"_checkStuck",value:function(e,n,r,o){var u=this.player.media||this.player.video,l=document.hidden,c=u.paused,h=u.readyState,f=u.currentTime,d=u.buffered;if(!(l||c||h<4)){var v=this._checkBuffer(f,d),m=v.enoughBuffer,g=v.buffers;m&&(e<=this.config.reportFrame?(this._currentStuckCount++,this._payload.push({currentTime:f,buffers:g,curDecodedFrames:e,totalVideoFrames:n,droppedVideoFrames:r,checkInterval:o}),this._currentStuckCount>=this.config.stuckCount&&(this.emit(ja,this._payload),this._reset())):this._reset())}}},{key:"_reset",value:function(){this._payload=[],this._currentStuckCount=0}},{key:"_checkDecodeFPS",value:function(){var e=this.player.media||this.player.video;if(e){var n=e.getVideoPlaybackQuality(),r=n.totalVideoFrames,o=n.droppedVideoFrames,u=performance.now();if(r&&this._lastCheckPoint){var l=r-this._lastDecodedFrames,c=u-this._lastCheckPoint;this._checkStuck(l,r,o,c)}this._lastDecodedFrames=r,this._lastCheckPoint=u}}},{key:"destroy",value:function(){this._stopTick()}}],[{key:"pluginName",get:function(){return"FpsDetect"}},{key:"defaultConfig",get:function(){return{disabled:!1,tick:1e3,stuckCount:3,reportFrame:0}}}]),i}(fe);gi.use(wh);var Lh=Q(function s(a,i){var t,e,n;q(this,s);var r=i&&i.isMobileSimulateMode==="mobile",o=i.isLive,u=o?[]:[Kc,Qa,Sh,_h,Za],l=[].concat(u,[Ja,Wc,Zc,rh,fh,dh,uh,lh,Qc,ih]),c=[Ec,kc,wc,Uc,Cc,gh,mh,bh,Lc];this.plugins=[Ch,bc].concat(ot(l),c,[io,Ah]);var h=r?"mobile":oe.device;switch(h){case"pc":(t=this.plugins).push.apply(t,[Ms,er,Bs,Ph,xh]);break;case"mobile":(e=this.plugins).push.apply(e,[Nc]);break;default:(n=this.plugins).push.apply(n,[Ms,er,Bs])}(oe.os.isIpad||h==="pc")&&this.plugins.push(Th),oe.os.isIpad&&this.plugins.push(er),this.ignores=[],this.i18n=[]}),ut=function(s){ie(i,s);var a=ne(i);function i(){return q(this,i),a.apply(this,arguments)}return Q(i)}(Rn);I(ut,"defaultPreset",Lh);I(ut,"Util",p);I(ut,"Sniffer",oe);I(ut,"Errors",Di);I(ut,"Events",Yl);I(ut,"Plugin",fe);I(ut,"BasePlugin",gt);I(ut,"I18N",gi);I(ut,"STATE_CLASS",U);I(ut,"InstManager",Xa);class Hs extends fe{constructor(){super(...arguments),this.customHookCbs=[]}static get pluginName(){return"overlay"}static get defaultConfig(){return{position:fe.POSITIONS.ROOT,index:0}}addCustomHook(a){this.customHookCbs.push(a)}runCustomHooks(a){return()=>{for(const i of this.customHookCbs)if(!i())return;a()}}afterCreate(){this.customHookCbs=[];let a=!1,i=null;this.onDblclick=()=>{a=!0,clearTimeout(i),this.player.getPlugin("fullscreen").handleFullscreen()},this.onClick=this.runCustomHooks(()=>{i=setTimeout(()=>{if(a){a=!1;return}this.player.paused?this.player.play():this.player.pause()},300)}),this.bind(".xgplayer-overlay","dblclick",this.onDblclick),this.bind(".xgplayer-overlay","click",this.onClick)}destroy(){this.unbind(".xgplayer-overlay","dblclick",this.onDblclick),this.unbind(".xgplayer-overlay","click",this.onClick),this.customHookCbs=[]}hide(){this.root.classList.add("hidden")}show(){this.root.classList.remove("hidden")}render(){return'<div class="xgplayer-overlay"></div>'}}class no{constructor(){this.events={},this.isActive=!0}on(a,i){return this.events[a]||(this.events[a]=[]),this.events[a].push(i),this}off(a,i){return this.events[a]&&(this.events[a]=this.events[a].filter(t=>t!==i)),this}offAll(){this.events={}}emit(a,...i){this.isActive&&this.events[a]&&this.events[a].forEach(t=>t(...i))}start(){this.isActive=!0}stop(){this.isActive=!1}}class Vs{constructor(a,i){this.emitter=new no,this.plugin=a,this.config=this.initializeConfig(i),this.isDisabled=_e(this.config.disabled),this.lastClicked=_e(0),this.renderButton(),this.initWatchers(),this.initEventListeners()}initializeConfig(a){return{class:"",disabled:!1,recentClickedThreshold:500,...a}}wasRecentlyClicked(){return Date.now()-this.lastClicked.value<=this.config.recentClickedThreshold}disabled(a=!0){this.isDisabled.value=a}selector(a=""){return`${this.config.container} ${a}`.trim()}el(a=""){return this.plugin.find(this.selector(a))}initWatchers(){yi(this.isDisabled,a=>{this.emitter.emit("disabled-toggle",a),this.toggleDisabledClass(a)})}initEventListeners(){this.handleClick=a=>{this.isDisabled.value||(a.preventDefault(),a.stopPropagation(),this.lastClicked.value=Date.now(),this.emitter.emit("click"))},this.plugin.bind(this.selector(),"click",this.handleClick)}toggleDisabledClass(a){const i=this.el(".playlist-button");i&&(a?i.classList.add("disabled"):i.classList.remove("disabled"))}destroy(){var a;this.emitter.offAll(),(a=this.el())==null||a.remove(),this.plugin.unbind(this.selector(),"click",this.handleClick)}renderButton(){const a=`<div class="playlist-button ${this.config.class}">${this.config.label}</div>`,i=p.createDom("button",a,{});this.plugin.appendChild(this.config.container,i),this.isDisabled.value&&i.classList.add("disabled")}}class $s{constructor(a,i){this.emitter=new no,this.plugin=a,this.config=this.initializeConfig(i),this.isOpen=_e(!1),this.selected=_e(null),this.options=_e([]),this.lastChanged=_e(0),this.filteredOptions=He(()=>typeof this.config.filter=="function"?this.config.filter(this.options.value):this.options.value),this.selectedOption=He(()=>this.options.value.find(t=>t.id===this.selected.value)),this.renderDropdown(),this.initWatchers(),this.initEventListeners()}initializeConfig(a){return{class:"",filter:null,invisible:!1,recentChangeThreshold:500,formatOptionLabel:i=>i.label,...a}}refreshOptions(){this.options.value=[...this.options.value]}getDropdownStatus(){return this.isOpen.value}suspendEmitter(a=!0){try{return this.emitter.stop(),this}finally{a&&Hi(()=>this.emitter.start())}}wasRecentlyChanged(){return Date.now()-this.lastChanged.value<=this.config.recentChangeThreshold}closeDropdown(){this.isOpen.value=!1}setOptions(a){this.options.value=a}getOptions(){return this.options.value}hasSelected(){return!!this.selected.value}setSelected(a){this.selected.value=a,this.lastChanged.value=Date.now()}getSelectedOption(){return this.selectedOption.value}getSelected(){return this.selected.value}getSelectedIndex(){return this.filteredOptions.value.findIndex(a=>a.id===this.getSelected())}first(){return this.filteredOptions.value[0]}last(){return this.filteredOptions.value[this.filteredOptions.value.length-1]}prev(){var i;const a=this.getSelectedIndex();return(i=this.filteredOptions.value)==null?void 0:i[a-1]}next(){var i;const a=this.getSelectedIndex();return(i=this.filteredOptions.value)==null?void 0:i[a+1]}selector(a=""){return`${this.config.container} ${a}`.trim()}el(a=""){return this.plugin.find(this.selector(a))}scrollToSelected(){const a=this.getSelected();if(!a)return;const i=this.el(`.dropdown li[data-value="${a}"]`),t=this.el(".dropdown");if(i&&t){const e=i.offsetTop-t.offsetTop-i.offsetHeight;t.scrollTop=Math.max(0,e)}}initWatchers(){this.config.invisible||(yi(this.isOpen,a=>{var i,t;this.emitter.emit("open-toggle",a),a?((i=this.el(".playlist-dropdown"))==null||i.classList.add("open"),this.scrollToSelected()):(t=this.el(".playlist-dropdown"))==null||t.classList.remove("open")}),yi(this.selected,()=>{this.emitter.emit("selected-updated"),this.lastChanged.value=Date.now(),this.highlightSelectedOption()}),yi(this.filteredOptions,()=>{this.emitter.emit("options-updated"),this.renderOptions()}))}initEventListeners(){this.isInvisible()||(this.handleContainerClick=a=>{a.preventDefault(),a.stopPropagation(),this.isOpen.value=!this.isOpen.value},this.handleOptionClick=a=>{a.preventDefault(),a.stopPropagation(),this.setSelected(+a.delegateTarget.dataset.value)},this.plugin.bind(this.selector(".playlist-dropdown"),"click",this.handleContainerClick),this.plugin.bind(this.selector(".dropdown-option"),"click",this.handleOptionClick))}destroy(){var a;this.emitter.offAll(),(a=this.el())==null||a.remove(),!this.isInvisible()&&(this.plugin.unbind(this.selector(".playlist-dropdown"),"click",this.handleContainerClick),this.plugin.unbind(this.selector(".dropdown-option"),"click",this.handleOptionClick))}isInvisible(){return!!this.config.invisible}highlightSelectedOption(){var i,t;if(this.isInvisible())return;(i=this.el(".dropdown-option.selected"))==null||i.classList.remove("selected"),(t=this.el(`.dropdown-option[data-value="${this.selected.value}"]`))==null||t.classList.add("selected");const a=this.el(".selected-option");a&&this.selectedOption.value&&(a.innerHTML=this.config.formatOptionLabel(this.selectedOption.value))}renderOptions(){if(this.isInvisible())return;const a=this.filteredOptions.value.map(i=>{const t=this.selected.value===i.id?"selected":"";return p.createDom("li",this.config.formatOptionLabel(i,!1),{class:`dropdown-option ${t}`,"data-value":i.id}).outerHTML}).join("");this.el(".dropdown").innerHTML=a}renderDropdown(){if(this.isInvisible())return;const i=p.createDom("div",`<div class="selected-option-container">
        <div class="selected-option"></div>
        <svg class="icon" viewBox="0 0 330 330"><path d="m250.606 154.389-150-149.996c-5.857-5.858-15.355-5.858-21.213.001-5.857 5.858-5.857 15.355.001 21.213l139.393 139.39L79.393 304.394c-5.857 5.858-5.857 15.355.001 21.213C82.322 328.536 86.161 330 90 330s7.678-1.464 10.607-4.394l149.999-150.004a14.996 14.996 0 0 0 0-21.213"/></svg>
    </div>
    <div class="dropdown-container"><ul class="dropdown"></ul></div>`,{},`playlist-dropdown ${this.config.class}`);this.plugin.appendChild(this.config.container,i)}}class Dh{constructor(a){this.plugin=a,this.initEventListeners()}initEventListeners(){this.onMouseEnter=i=>{const{player:t,playerConfig:e}=this.plugin;e.closeControlsBlur&&t.focus({autoHide:!1})},this.onMouseLeave=i=>{this.plugin.player.focus()};const{isMobileSimulateMode:a}=this.plugin.playerConfig;oe.device!=="mobile"&&a!=="mobile"&&(this.plugin.bind("mouseenter",this.onMouseEnter),this.plugin.bind("mouseleave",this.onMouseLeave))}destroy(){oe.device!=="mobile"&&(this.plugin.unbind("mouseenter",this.onMouseEnter),this.plugin.unbind("mouseleave",this.onMouseLeave))}}class Ih{constructor(a,i){this.plugin=a,this.container=i,this.indicatorElement=this.createIndicatorElement(),this.appendToContainer(),this.hide()}createIndicatorElement(){const a=document.createElement("div");return a.className="spinner-overlay",a.innerHTML='<div class="spinner"></div>',a}appendToContainer(){this.plugin.appendChild(this.container,this.indicatorElement)}show(){this.indicatorElement.style.display="block"}hide(){this.indicatorElement.style.display="none"}destroy(){this.indicatorElement.remove()}}class Oh extends fe{static get pluginName(){return"PlaylistPlugin"}static get defaultConfig(){return{position:fe.POSITIONS.ROOT_TOP,index:0,playbackManager:null,isSingleEpisode:!1}}afterCreate(){this.initLoading=!0,this.playbackManager=this.config.playbackManager,this.focusManager=new Dh(this),this.spinnerOverlay=new Ih(this,"xg-spinner"),this.initDropdowns(),this.initButtons(),this.loadEpisodes(),this.listenEvents()}initDropdowns(){const a=new $s(this,{container:"xg-translations",class:"w-long",invisible:!1,formatOptionLabel:(t,e=!0)=>!e&&!this.config.isSingleEpisode?`<div class="with-counter">
                <div class="with-counter__label">${t.label}</div>
                <div class="with-counter__count">${t.episodes_count}</div>
            </div>`:t.label}),i=new $s(this,{container:"xg-episodes",class:"w-short",invisible:this.config.isSingleEpisode,filter:t=>t.filter(e=>e.translation_id===this.dropdowns.translations.getSelected()),formatOptionLabel:t=>`${t.label} серия`});a.emitter.on("selected-updated",()=>{if(this.dropdowns.episodes.refreshOptions(),!this.dropdowns.episodes.hasSelected())return;const t=this.dropdowns.episodes.getOptions(),e=this.dropdowns.episodes.getSelectedOption();let n=null;e&&(n=t.find(r=>e.label===r.label&&r.translation_id===this.dropdowns.translations.getSelected())),n||(n=this.dropdowns.episodes.last()),this.dropdowns.episodes.setSelected(n==null?void 0:n.id)}).on("open-toggle",t=>{i.suspendEmitter().closeDropdown(),this.player.innerStates.isActiveLocked=t,t||this.player.focus()}),i.emitter.on("selected-updated",()=>{this.updatePlaybackState(),this.player.onWaiting(),this.buttons.prev.disabled(!this.dropdowns.episodes.prev()),this.buttons.next.disabled(!this.dropdowns.episodes.next());const t=!a.wasRecentlyChanged();this.spinnerOverlay.show(),!this.initLoading&&this.playbackManager.reloadLinks().then(()=>{t&&(this.player.currentTime=0),this.player.definitionList=this.playbackManager.links.value}).catch(e=>{console.error(e)}).finally(()=>{this.spinnerOverlay.hide()})}).on("open-toggle",t=>{a.suspendEmitter().closeDropdown(),this.player.innerStates.isActiveLocked=t,t||this.player.focus()}),this.dropdowns={translations:a,episodes:i}}initButtons(){const a=new Vs(this,{container:"xg-prev",label:"Previous"}),i=new Vs(this,{container:"xg-next",label:"Next"});a.emitter.on("click",()=>{const t=this.dropdowns.episodes.prev();t&&this.dropdowns.episodes.setSelected(t.id)}),i.emitter.on("click",()=>{const t=this.dropdowns.episodes.next();t&&this.dropdowns.episodes.setSelected(t.id)}),this.buttons={prev:a,next:i}}listenEvents(){this.onPause=()=>{this.playbackManager.savePlaybackState()},this.onTimeUpdate=()=>{this.updatePlaybackState()},this.onDefinitionChanged=a=>{this.player.play()},this.on(dt,this.onPause),this.on($e,this.onTimeUpdate),this.on(Oi,this.onDefinitionChanged),this.player.getPlugin("overlay").addCustomHook(()=>{try{return!(this.dropdowns.translations.getDropdownStatus()||this.dropdowns.episodes.getDropdownStatus())}finally{this.dropdowns.translations.closeDropdown(),this.dropdowns.episodes.closeDropdown()}})}destroy(){this.off(dt,this.onPause),this.off($e,this.onTimeUpdate),this.off(Oi,this.onDefinitionChanged),this.playbackManager.savePlaybackState(),this.dropdowns.translations.destroy(),this.dropdowns.episodes.destroy(),this.buttons.prev.destroy(),this.buttons.next.destroy(),this.focusManager.destroy()}loadEpisodes(){this.spinnerOverlay.show(),this.playbackManager.loadEpisodes().then(()=>{const{translations:a,episodes:i}=this.playbackManager.episodes.value;this.dropdowns.translations.setOptions(a),this.dropdowns.episodes.setOptions(i),this.applyPlaybackState(this.playbackManager.playbackState.value)}).catch(a=>{console.error(a)}).finally(()=>{this.initLoading=!1,this.spinnerOverlay.hide()})}applyPlaybackState(a){var e,n;let i=a==null?void 0:a.translation_id,t=a==null?void 0:a.episode_id;i||(i=(e=this.dropdowns.translations.first())==null?void 0:e.id),t||(t=(n=this.dropdowns.episodes.first())==null?void 0:n.id),this.dropdowns.translations.setSelected(i),this.dropdowns.episodes.setSelected(t),this.player.currentTime=(a==null?void 0:a.time)??0}updatePlaybackState(){this.playbackManager.setPlaybackState({episode_id:this.dropdowns.episodes.getSelected(),translation_id:this.dropdowns.translations.getSelected(),time:Math.ceil(this.player.currentTime)})}render(){return`
    <xg-playlist class="w-full text-white xgplayer-ignore xgplayer-playlist">
        <xg-translations></xg-translations>
        -
        <xg-prev></xg-prev>
        <xg-episodes></xg-episodes>
        <xg-next></xg-next>
        -
        <xg-spinner></xg-spinner>
    </xg-playlist>`}}const Rh="/build/assets/back-rI6wa1IX.svg",Mh="/build/assets/check-8HgdcoZc.svg",Nh="/build/assets/definition-DXX0jQ0E.svg",Bh="/build/assets/fhd-KhQsJOlI.svg",Fh="/build/assets/hd-BOHbcx4P.svg",Uh="/build/assets/hq-B9KQr36A.svg",Hh="/build/assets/sd-2VTs096e.svg",Vh="/build/assets/uhd-DTfx2RHh.svg",$h="/build/assets/8k-DhROB3yT.svg",Gh={hd:Fh,hq:Uh,sd:Hh,fhd:Bh,uhd:Vh,q8k:$h},jh="/build/assets/playbackRate-Bnmc9PTZ.svg",zh="/build/assets/playbackSpinner-CBKWoj4Z.svg",Wh="/build/assets/settings-Dfxf5mvo.svg";class Kh extends fe{constructor(){super(...arguments);st(this,"toggleModalHandler",()=>{this._d.isActive=!this._d.isActive,this.player.innerStates.isActiveLocked=this._d.isActive,this._d.isActive?this.renderTabs():this.player.focus(),this.find(".xgplayer-modal").style.width=null,this.root.classList.toggle("xgplayer-active",this._d.isActive)});st(this,"toggleTabListHandler",i=>{const t=i.delegateTarget.dataset.target;this.switchTab(t),this.renderTabItems(t)});st(this,"toggleTabHandler",i=>{const t=i.delegateTarget.dataset.tab,e=i.delegateTarget.dataset.index,n=this.getTabs().find(o=>o.name===t),r=n.getItems(this.player);n.onClick(i,this.player,r[e]),this.toggleModalHandler()});st(this,"backTabHandler",i=>{this.switchTab("list")})}static get pluginName(){return"settings"}static get defaultConfig(){return{position:fe.POSITIONS.CONTROLS_RIGHT,index:1}}getTabs(){const i=t=>{const e={360:"sd",480:"hq",720:"hd",1080:"fhd",2160:"uhd",4320:"q8k"},n=Object.keys(e).reverse().find(r=>t>=r);return Gh[e[n]||"fhd"]};return[{name:"definition",width:"12rem",getTitle:()=>"Definition",getLabel:t=>`
                    <div class="flex justify-between items-center img-wave-on-hover">
                        <div class="flex gap-2 items-center">
                            <img src="${Nh}" />
                            <div>Definition</div>
                        </div>
                        <div class="text-xs">
                            ${t.curDefinition.text}p
                        </div>
                    </div>
                `,getItems:t=>[...t.definitionList].map(e=>({...e,icon:i(+e.definition),iconClass:"item-icon-wave !h-[initial] !w-8 border-px !border-white/50 rounded-md",containerClass:"",active:e.definition===t.curDefinition.definition})),onClick:(t,e,n)=>{e.changeDefinition(n)}},{name:"playbackRate",width:"12em",getTitle:()=>"Playback Speed",getLabel:t=>{const e=t.getPlugin("playbackRate"),n=e.config.list.find(({rate:r})=>r===e.curValue).text;return`
                    <div class="flex justify-between items-center img-wave-on-hover">
                        <div class="flex gap-2 items-center">
                            <img src="${jh}" />
                            <div>Playback Speed</div>
                        </div>
                        <div class="text-xs">${n}</div>
                    </div>`},getItems:t=>[...t.getPlugin("playbackRate").config.list].map(n=>({...n,icon:zh,iconClass:"!h-5 icon-item",containerClass:`rate-item rate-item-${n.rate}`.replace(".","_"),active:n.rate===t.playbackRate})),onClick:(t,e,{rate:n})=>{const r=e.getPlugin("playbackRate");if(!n||n===r.curValue)return!1;const o={playbackRate:{from:e.playbackRate,to:n}};r.emitUserAction(t,"change_rate",{props:o}),r.curValue=n,e.playbackRate=n}}]}registerIcons(){return{settings:{icon:Wh,class:""}}}afterCreate(){this._d={isActive:!1},this.initIcons(),this.bind(".xgplayer-icon",["touchend","click"],this.toggleModalHandler),this.bind('.xgplayer-modal-tab[data-tab="list"] ul > li',["touchend","click"],this.toggleTabListHandler),this.bind('.xgplayer-modal-tab:not([data-tab="list"]) ul > li',["touchend","click"],this.toggleTabHandler),this.bind(".xgplayer-modal-tab .list-header",["touchend","click"],this.backTabHandler),this.player.getPlugin("overlay").addCustomHook(()=>{try{return!this._d.isActive}finally{this._d.isActive=!1,this.player.innerStates.isActiveLocked=!1,this.player.focus(),this.root.classList.remove("xgplayer-active")}})}destroy(){this.unbind(".xgplayer-icon",["touchend","click"],this.toggleModalHandler),this.unbind(".xgplayer-modal-tab .list-header",["touchend","click"],this.backTabHandler),this.unbind('.xgplayer-modal-tab[data-tab="list"] ul > li',["touchend","click"],this.toggleTabHandler)}initIcons(){const{icons:i}=this;this.appendChild(".xgplayer-icon",i.settings)}switchTab(i){this.find(".xgplayer-modal-tab[data-tab].show-tab").classList.remove("show-tab"),this.find(`.xgplayer-modal-tab[data-tab="${i}"]`).classList.add("show-tab");const t=this.getTabs().find(e=>e.name===i);this.find(".xgplayer-modal").style.width=(t==null?void 0:t.width)||null}renderTabs(){this.find(".xgplayer-modal").innerHTML=[{name:"list",show:!0},...this.getTabs()].map(i=>{let t="";return i.name!=="list"&&(t=`
            <div class="list-header">
                <img src="${Rh}" class="!h-4" />
                <span>${i.getTitle()}</span>
            </div>`),`
        <div
            class="xgplayer-modal-tab ${i.show?"show-tab":""}"
            data-tab="${i.name}"
        >
            ${t}
            <ul></ul>
        </div>`}).join(""),this.find('.xgplayer-modal-tab[data-tab="list"] ul').innerHTML=this.getTabs().map(i=>`<li data-target="${i.name}">${i.getLabel(this.player)}</li>`).join("")}renderTabItems(i){const t=this.getTabs().find(({name:e})=>e===i).getItems(this.player);this.find(`.xgplayer-modal-tab[data-tab="${i}"] ul`).innerHTML=t.map((e,n)=>`<li
                class="flex justify-between items-center ${e.active?"item-active":""} ${e.containerClass}"
                data-index="${n}"
                data-tab="${i}"
            >
            <div class="flex gap-2 items-center">
                <div class="w-4">
                    <img src="${Mh}"
                        class="${e.active?"":"!hidden"} !h-4" />
                </div>
                <div>${e.text}</div>
            </div>

            <div class="${e.icon?"":"!hidden"} ${e.iconClass}">
                <img src="${e.icon}" class="!w-[initial] !h-full" />
            </div>
          </li>`).join("")}render(){return`
      <xg-icon class="xgplayer-settings xgplayer-ignore">
        <div class="xgplayer-icon"></div>
        <xg-modal class="xgplayer-modal"></xg-modal>
      </xg-icon>`}}const Yh="/build/assets/volumeLarge-DwsVE9O6.svg",Xh="/build/assets/volumeMuted-5ELTcIpJ.svg",qh="/build/assets/volumeSmall-BQEplc5x.svg";class Qh extends fe{constructor(){super(...arguments);st(this,"onBarMousedown",i=>{const{player:t}=this,e=this.find(".xgplayer-bar");p.event(i);const n=e.getBoundingClientRect(),r=p.getEventPos(i,t.zoom),o=r.clientX-n.left;if(r.w=o,r.barW=n.width,this.pos=r,!(o<-2))return this.updateVolumePos(o,i),document.addEventListener("mouseup",this.onBarMouseUp),this._d.isStart=!0,!1});st(this,"onBarMouseMove",i=>{const{_d:t}=this;if(!t.isStart)return;const{pos:e,player:n}=this;i.preventDefault(),i.stopPropagation(),p.event(i);const r=p.getEventPos(i,n.zoom);t.isMoving=!0;const o=r.clientX-e.clientX+e.w;o>e.barW||this.updateVolumePos(o,i)});st(this,"onBarMouseUp",i=>{p.event(i),document.removeEventListener("mouseup",this.onBarMouseUp);const{_d:t}=this;t.isStart=!1,t.isMoving=!1});st(this,"onMouseenter",i=>{this._d.isActive=!0,this.focus(),this.emit("icon_mouseenter",{pluginName:this.pluginName})});st(this,"onMouseleave",i=>{this._d.isMoving||(this._d.isActive=!1,this.unFocus(100,!1,i),this.emit("icon_mouseleave",{pluginName:this.pluginName}))});st(this,"onVolumeChange",i=>{if(!this.player)return;const{muted:t,volume:e}=this.player;if(!this._d.isMoving){const n=t||e===0?"4px":`${e*100}%`;this.find(".xgplayer-drag").style.width=n,this.config.showValueLabel&&this.updateVolumeValue()}this.animate(t,e)})}static get pluginName(){return"volume"}static get defaultConfig(){return{position:fe.POSITIONS.CONTROLS_LEFT,index:1,disable:!1,showValueLabel:!1,default:1,miniVolume:.2}}registerIcons(){return{volumeSmall:{icon:qh,class:"xg-volume-small"},volumeLarge:{icon:Yh,class:"xg-volume"},volumeMuted:{icon:Xh,class:"xg-volume-mute"}}}afterCreate(){if(this._timerId=null,this._d={isStart:!1,isMoving:!1,isActive:!1},this.config.disable)return;this.initIcons();const{commonStyle:i,volume:t}=this.playerConfig;if(i.volumeColor&&(this.find(".xgplayer-drag").style.backgroundColor=i.volumeColor),this.changeMutedHandler=this.hook("mutedChange",e=>{this.changeMuted(e)},{pre:e=>{e.preventDefault(),e.stopPropagation()}}),this._onMouseenterHandler=this.hook("mouseenter",this.onMouseenter),this._onMouseleaveHandler=this.hook("mouseleave",this.onMouseleave),oe.device!=="mobile"&&this.playerConfig.isMobileSimulateMode!=="mobile"){this.bind("mouseenter",this._onMouseenterHandler);const e=this.player.getPlugin("controls");e&&(e.bind("blur",this._onMouseleaveHandler),e.bind("mouseleave",this._onMouseleaveHandler)),this.bind(".xgplayer-slider","mousedown",this.onBarMousedown),this.bind(".xgplayer-slider","mousemove",this.onBarMouseMove),this.bind(".xgplayer-slider","mouseup",this.onBarMouseUp)}this.bind(".xgplayer-icon",["touchend","click"],this.changeMutedHandler),this.on(Ii,this.onVolumeChange),this.once(vt,this.onVolumeChange),p.typeOf(t)!=="Number"&&(this.player.volume=this.config.default),this.onVolumeChange()}updateVolumePos(i,t){const{player:e}=this,n=this.find(".xgplayer-drag"),r=this.find(".xgplayer-bar");if(!r||!n)return;const o=parseInt(i/r.getBoundingClientRect().width*1e3,10);n.style.width=`${i}px`;const u=Math.max(Math.min(o/1e3,1),0),l={volume:{from:e.volume,to:u}};e.muted&&(l.muted={from:!0,to:!1}),this.emitUserAction(t,"change_volume",{muted:e.muted,volume:e.volume,props:l}),e.volume=u,e.muted&&(e.muted=!1),this.config.showValueLabel&&this.updateVolumeValue()}updateVolumeValue(){const{volume:i,muted:t}=this.player,e=this.find(".xgplayer-value-label"),n=Math.max(Math.min(i,1),0);e.innerText=t?0:Math.round(n*100)}focus(){const{player:i}=this;i.focus({autoHide:!1}),this._timerId&&(p.clearTimeout(this,this._timerId),this._timerId=null),p.addClass(this.root,"slide-show")}unFocus(i=100,t=!0,e){const{_d:n,player:r}=this;n.isActive||(this._timerId&&(p.clearTimeout(this,this._timerId),this._timerId=null),this._timerId=p.setTimeout(this,()=>{n.isActive||(t?r.blur():r.focus(),p.removeClass(this.root,"slide-show"),n.isStart&&this.onBarMouseUp(e)),this._timerId=null},i))}changeMuted(i){i&&i.stopPropagation();const{player:t,_d:e}=this;e.isStart&&this.onBarMouseUp(i),this.emitUserAction(i,"change_muted",{muted:t.muted,volume:t.volume,props:{muted:{from:t.muted,to:!t.muted}}}),t.volume>0&&(t.muted=!t.muted),t.volume<.01&&(t.volume=this.config.miniVolume)}animate(i,t){i||t===0?this.setAttr("data-state","mute"):t<.5&&this.icons.volumeSmall?this.setAttr("data-state","small"):this.setAttr("data-state","normal")}initIcons(){const{icons:i}=this;this.appendChild(".xgplayer-icon",i.volumeSmall),this.appendChild(".xgplayer-icon",i.volumeLarge),this.appendChild(".xgplayer-icon",i.volumeMuted)}destroy(){this._timerId&&(p.clearTimeout(this,this._timerId),this._timerId=null),this.unbind("mouseenter",this.onMouseenter);const i=this.player.getPlugin("controls");i&&(i.unbind("blur",this.onMouseleave),i.unbind("mouseleave",this.onMouseleave)),this.unbind(".xgplayer-slider","mousedown",this.onBarMousedown),this.unbind(".xgplayer-slider","mousemove",this.onBarMouseMove),this.unbind(".xgplayer-slider","mouseup",this.onBarMouseUp),document.removeEventListener("mouseup",this.onBarMouseUp),this.unbind(".xgplayer-icon",oe.device==="mobile"?"touchend":"click",this.changeMutedHandler)}render(){if(this.config.disable)return;const i=this.config.default||this.player.volume;return`
      <xg-icon class="xgplayer-volume" data-state="normal">
        <div class="xgplayer-icon"></div>
        <xg-slider class="xgplayer-slider">
          ${this.config.showValueLabel?`<div class="xgplayer-value-label">${i*100}</div>`:""}
          <div class="xgplayer-bar-wrap">
            <div class="xgplayer-bar">
                <xg-drag class="xgplayer-drag" style="width: ${i*100}%">
                    <div class="xgplayer-drag-btn"></div>
                </xg-drag>
            </div>
          </div>
        </xg-slider>
      </xg-icon>`}}var Tn="ad_play",ro="ad_pause",es="ad_time_update",Jh="ima_sdk_load_success",Zh="ima_sdk_load_error",ef="ima_ad_loader_ready",Tr="ima_ad_manager_ready",Gs="ima_ad_error",tf="ima_ad_loaded",nf="ima_ad_break_ready",so="ima_content_pause_requested",ao="ima_content_resume_requested",un="ima_ready_to_play";function rf(s,a){var i=s==null?null:typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(i!=null){var t,e,n,r,o=[],u=!0,l=!1;try{if(n=(i=i.call(s)).next,a!==0)for(;!(u=(t=n.call(i)).done)&&(o.push(t.value),o.length!==a);u=!0);}catch(c){l=!0,e=c}finally{try{if(!u&&i.return!=null&&(r=i.return(),Object(r)!==r))return}finally{if(l)throw e}}return o}}function js(s,a){var i=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);a&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(s,e).enumerable})),i.push.apply(i,t)}return i}function zs(s){for(var a=1;a<arguments.length;a++){var i=arguments[a]!=null?arguments[a]:{};a%2?js(Object(i),!0).forEach(function(t){nt(s,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(i)):js(Object(i)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(i,t))})}return s}function Yt(){Yt=function(){return s};var s={},a=Object.prototype,i=a.hasOwnProperty,t=Object.defineProperty||function(y,_,S){y[_]=S.value},e=typeof Symbol=="function"?Symbol:{},n=e.iterator||"@@iterator",r=e.asyncIterator||"@@asyncIterator",o=e.toStringTag||"@@toStringTag";function u(y,_,S){return Object.defineProperty(y,_,{value:S,enumerable:!0,configurable:!0,writable:!0}),y[_]}try{u({},"")}catch{u=function(_,S,P){return _[S]=P}}function l(y,_,S,P){var T=_&&_.prototype instanceof f?_:f,M=Object.create(T.prototype),G=new O(P||[]);return t(M,"_invoke",{value:C(y,S,G)}),M}function c(y,_,S){try{return{type:"normal",arg:y.call(_,S)}}catch(P){return{type:"throw",arg:P}}}s.wrap=l;var h={};function f(){}function d(){}function v(){}var m={};u(m,n,function(){return this});var g=Object.getPrototypeOf,b=g&&g(g(R([])));b&&b!==a&&i.call(b,n)&&(m=b);var k=v.prototype=f.prototype=Object.create(m);function E(y){["next","throw","return"].forEach(function(_){u(y,_,function(S){return this._invoke(_,S)})})}function w(y,_){function S(T,M,G,K){var Z=c(y[T],y,M);if(Z.type!=="throw"){var $=Z.arg,be=$.value;return be&&typeof be=="object"&&i.call(be,"__await")?_.resolve(be.__await).then(function(Y){S("next",Y,G,K)},function(Y){S("throw",Y,G,K)}):_.resolve(be).then(function(Y){$.value=Y,G($)},function(Y){return S("throw",Y,G,K)})}K(Z.arg)}var P;t(this,"_invoke",{value:function(T,M){function G(){return new _(function(K,Z){S(T,M,K,Z)})}return P=P?P.then(G,G):G()}})}function C(y,_,S){var P="suspendedStart";return function(T,M){if(P==="executing")throw new Error("Generator is already running");if(P==="completed"){if(T==="throw")throw M;return j()}for(S.method=T,S.arg=M;;){var G=S.delegate;if(G){var K=B(G,S);if(K){if(K===h)continue;return K}}if(S.method==="next")S.sent=S._sent=S.arg;else if(S.method==="throw"){if(P==="suspendedStart")throw P="completed",S.arg;S.dispatchException(S.arg)}else S.method==="return"&&S.abrupt("return",S.arg);P="executing";var Z=c(y,_,S);if(Z.type==="normal"){if(P=S.done?"completed":"suspendedYield",Z.arg===h)continue;return{value:Z.arg,done:S.done}}Z.type==="throw"&&(P="completed",S.method="throw",S.arg=Z.arg)}}}function B(y,_){var S=_.method,P=y.iterator[S];if(P===void 0)return _.delegate=null,S==="throw"&&y.iterator.return&&(_.method="return",_.arg=void 0,B(y,_),_.method==="throw")||S!=="return"&&(_.method="throw",_.arg=new TypeError("The iterator does not provide a '"+S+"' method")),h;var T=c(P,y.iterator,_.arg);if(T.type==="throw")return _.method="throw",_.arg=T.arg,_.delegate=null,h;var M=T.arg;return M?M.done?(_[y.resultName]=M.value,_.next=y.nextLoc,_.method!=="return"&&(_.method="next",_.arg=void 0),_.delegate=null,h):M:(_.method="throw",_.arg=new TypeError("iterator result is not an object"),_.delegate=null,h)}function L(y){var _={tryLoc:y[0]};1 in y&&(_.catchLoc=y[1]),2 in y&&(_.finallyLoc=y[2],_.afterLoc=y[3]),this.tryEntries.push(_)}function D(y){var _=y.completion||{};_.type="normal",delete _.arg,y.completion=_}function O(y){this.tryEntries=[{tryLoc:"root"}],y.forEach(L,this),this.reset(!0)}function R(y){if(y){var _=y[n];if(_)return _.call(y);if(typeof y.next=="function")return y;if(!isNaN(y.length)){var S=-1,P=function T(){for(;++S<y.length;)if(i.call(y,S))return T.value=y[S],T.done=!1,T;return T.value=void 0,T.done=!0,T};return P.next=P}}return{next:j}}function j(){return{value:void 0,done:!0}}return d.prototype=v,t(k,"constructor",{value:v,configurable:!0}),t(v,"constructor",{value:d,configurable:!0}),d.displayName=u(v,o,"GeneratorFunction"),s.isGeneratorFunction=function(y){var _=typeof y=="function"&&y.constructor;return!!_&&(_===d||(_.displayName||_.name)==="GeneratorFunction")},s.mark=function(y){return Object.setPrototypeOf?Object.setPrototypeOf(y,v):(y.__proto__=v,u(y,o,"GeneratorFunction")),y.prototype=Object.create(k),y},s.awrap=function(y){return{__await:y}},E(w.prototype),u(w.prototype,r,function(){return this}),s.AsyncIterator=w,s.async=function(y,_,S,P,T){T===void 0&&(T=Promise);var M=new w(l(y,_,S,P),T);return s.isGeneratorFunction(_)?M:M.next().then(function(G){return G.done?G.value:M.next()})},E(k),u(k,o,"Generator"),u(k,n,function(){return this}),u(k,"toString",function(){return"[object Generator]"}),s.keys=function(y){var _=Object(y),S=[];for(var P in _)S.push(P);return S.reverse(),function T(){for(;S.length;){var M=S.pop();if(M in _)return T.value=M,T.done=!1,T}return T.done=!0,T}},s.values=R,O.prototype={constructor:O,reset:function(y){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(D),!y)for(var _ in this)_.charAt(0)==="t"&&i.call(this,_)&&!isNaN(+_.slice(1))&&(this[_]=void 0)},stop:function(){this.done=!0;var y=this.tryEntries[0].completion;if(y.type==="throw")throw y.arg;return this.rval},dispatchException:function(y){if(this.done)throw y;var _=this;function S(Z,$){return M.type="throw",M.arg=y,_.next=Z,$&&(_.method="next",_.arg=void 0),!!$}for(var P=this.tryEntries.length-1;P>=0;--P){var T=this.tryEntries[P],M=T.completion;if(T.tryLoc==="root")return S("end");if(T.tryLoc<=this.prev){var G=i.call(T,"catchLoc"),K=i.call(T,"finallyLoc");if(G&&K){if(this.prev<T.catchLoc)return S(T.catchLoc,!0);if(this.prev<T.finallyLoc)return S(T.finallyLoc)}else if(G){if(this.prev<T.catchLoc)return S(T.catchLoc,!0)}else{if(!K)throw new Error("try statement without catch or finally");if(this.prev<T.finallyLoc)return S(T.finallyLoc)}}}},abrupt:function(y,_){for(var S=this.tryEntries.length-1;S>=0;--S){var P=this.tryEntries[S];if(P.tryLoc<=this.prev&&i.call(P,"finallyLoc")&&this.prev<P.finallyLoc){var T=P;break}}T&&(y==="break"||y==="continue")&&T.tryLoc<=_&&_<=T.finallyLoc&&(T=null);var M=T?T.completion:{};return M.type=y,M.arg=_,T?(this.method="next",this.next=T.finallyLoc,h):this.complete(M)},complete:function(y,_){if(y.type==="throw")throw y.arg;return y.type==="break"||y.type==="continue"?this.next=y.arg:y.type==="return"?(this.rval=this.arg=y.arg,this.method="return",this.next="end"):y.type==="normal"&&_&&(this.next=_),h},finish:function(y){for(var _=this.tryEntries.length-1;_>=0;--_){var S=this.tryEntries[_];if(S.finallyLoc===y)return this.complete(S.completion,S.afterLoc),D(S),h}},catch:function(y){for(var _=this.tryEntries.length-1;_>=0;--_){var S=this.tryEntries[_];if(S.tryLoc===y){var P=S.completion;if(P.type==="throw"){var T=P.arg;D(S)}return T}}throw new Error("illegal catch attempt")},delegateYield:function(y,_,S){return this.delegate={iterator:R(y),resultName:_,nextLoc:S},this.method==="next"&&(this.arg=void 0),h}},s}function wr(s){"@babel/helpers - typeof";return wr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},wr(s)}function Ws(s,a,i,t,e,n,r){try{var o=s[n](r),u=o.value}catch(l){i(l);return}o.done?a(u):Promise.resolve(u).then(t,e)}function rr(s){return function(){var a=this,i=arguments;return new Promise(function(t,e){var n=s.apply(a,i);function r(u){Ws(n,t,e,r,o,"next",u)}function o(u){Ws(n,t,e,r,o,"throw",u)}r(void 0)})}}function Ft(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")}function Ks(s,a){for(var i=0;i<a.length;i++){var t=a[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(s,oo(t.key),t)}}function Ut(s,a,i){return a&&Ks(s.prototype,a),i&&Ks(s,i),Object.defineProperty(s,"prototype",{writable:!1}),s}function nt(s,a,i){return a=oo(a),a in s?Object.defineProperty(s,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):s[a]=i,s}function ri(s,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(a&&a.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),a&&Cr(s,a)}function Nt(s){return Nt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},Nt(s)}function Cr(s,a){return Cr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Cr(s,a)}function sf(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ke(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function af(s,a){if(a&&(typeof a=="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ke(s)}function si(s){var a=sf();return function(){var t=Nt(s),e;if(a){var n=Nt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return af(this,e)}}function of(s,a){for(;!Object.prototype.hasOwnProperty.call(s,a)&&(s=Nt(s),s!==null););return s}function _i(){return typeof Reflect<"u"&&Reflect.get?_i=Reflect.get.bind():_i=function(a,i,t){var e=of(a,i);if(e){var n=Object.getOwnPropertyDescriptor(e,i);return n.get?n.get.call(arguments.length<3?a:t):n.value}},_i.apply(this,arguments)}function ln(s,a){return uf(s)||rf(s,a)||lf(s,a)||cf()}function uf(s){if(Array.isArray(s))return s}function lf(s,a){if(s){if(typeof s=="string")return Ys(s,a);var i=Object.prototype.toString.call(s).slice(8,-1);if(i==="Object"&&s.constructor&&(i=s.constructor.name),i==="Map"||i==="Set")return Array.from(s);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Ys(s,a)}}function Ys(s,a){(a==null||a>s.length)&&(a=s.length);for(var i=0,t=new Array(a);i<a;i++)t[i]=s[i];return t}function cf(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hf(s,a){if(typeof s!="object"||s===null)return s;var i=s[Symbol.toPrimitive];if(i!==void 0){var t=i.call(s,a);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}function oo(s){var a=hf(s,"string");return typeof a=="symbol"?a:String(a)}function Mi(s){"@babel/helpers - typeof";return Mi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Mi(s)}function ff(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")}function Xs(s,a){for(var i=0;i<a.length;i++){var t=a[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(s,uo(t.key),t)}}function df(s,a,i){return a&&Xs(s.prototype,a),i&&Xs(s,i),Object.defineProperty(s,"prototype",{writable:!1}),s}function vf(s,a,i){return a=uo(a),a in s?Object.defineProperty(s,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):s[a]=i,s}function pf(s,a){if(typeof s!="object"||s===null)return s;var i=s[Symbol.toPrimitive];if(i!==void 0){var t=i.call(s,a||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}function uo(s){var a=pf(s,"string");return typeof a=="symbol"?a:String(a)}var en={DEBUG:1,LOG:2,WARN:3,ERROR:4},gf=200*1024,mf=["Boolean","Number","String","Undefined","Null","Date","Object"],Mn=function(){function s(a,i){ff(this,s),this.name=a||"",this._prefix="[".concat(this.name,"]"),this.logCacheLevel=(i==null?void 0:i.logCacheLevel)||3,this.logMaxSize=(i==null?void 0:i.logMaxSize)||gf,this.logSize=0,this.logTextArray=[]}return df(s,[{key:"debug",value:function(){for(var i,t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.logCache.apply(this,[en.DEBUG].concat(e)),!s.disabled&&(i=console).debug.apply(i,[this._prefix,Ci()].concat(e))}},{key:"log",value:function(){for(var i,t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.logCache.apply(this,[en.LOG].concat(e)),!s.disabled&&(i=console).log.apply(i,[this._prefix,Ci()].concat(e))}},{key:"warn",value:function(){for(var i,t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.logCache.apply(this,[en.WARN].concat(e)),!s.disabled&&(i=console).warn.apply(i,[this._prefix,Ci()].concat(e))}},{key:"error",value:function(){for(var i,t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.logCache.apply(this,[en.ERROR].concat(e)),!s.disabled&&(i=console).error.apply(i,[this._prefix,Ci()].concat(e))}},{key:"logCache",value:function(i){if(!(i<this.logCacheLevel)){var t="";try{for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var o=n.map(function(l){return lo(l)});t=this._prefix+Ci()+JSON.stringify(o)}catch{return}if(i>=this.logCacheLevel&&(this.logSize+=t.length,this.logTextArray.push(t)),this.logSize>this.logMaxSize){var u=this.logTextArray.shift();this.logSize-=u.length}}}},{key:"getLogCache",value:function(){var i=this.logTextArray.join(`
`);return this.reset(),i}},{key:"reset",value:function(){this.logTextArray=[],this.logSize=0}},{key:"table",value:function(){var i;s.disabled||(console.group(this._prefix),(i=console).table.apply(i,arguments),console.groupEnd())}},{key:"setLogLevel",value:function(i){this.logCacheLevel=i}}],[{key:"enable",value:function(){s.disabled=!1}},{key:"disable",value:function(){s.disabled=!0}}]),s}();vf(Mn,"disabled",!0);function Ci(){return new Date().toLocaleString()}function yf(s){if(Mi(s)!=="object")return s;var a=Object.prototype.toString.call(s).slice(8,-1);switch(a){case"Array":case"Uint8Array":case"ArrayBuffer":return a+"["+s.length+"]";case"Object":return"{}";default:return a}}function lo(s,a,i){i||(i=1),a||(a=2);var t={};if(!s||Mi(s)!=="object")return s;var e=Object.prototype.toString.call(s).slice(8,-1);if(!mf.includes(e))return e;if(!(i>a)){for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(i===a?t[n]=yf(s[n]):Mi(s[n])==="object"?t[n]=lo(s[n],a,i+1):t[n]=s[n]);return t}}function _f(){var s,a,i=new Promise(function(t,e){s=t,a=e});return i.used=!1,i.resolve=function(){return i.used=!0,s.apply(void 0,arguments)},i.reject=function(){return i.used=!0,a.apply(void 0,arguments)},i}var bf=new Blob([new Uint8Array([255,227,24,196,0,0,0,3,72,1,64,0,0,4,132,16,31,227,192,225,76,255,67,12,255,221,27,255,228,97,73,63,255,195,131,69,192,232,223,255,255,207,102,239,255,255,255,101,158,206,70,20,59,255,254,95,70,149,66,4,16,128,0,2,2,32,240,138,255,36,106,183,255,227,24,196,59,11,34,62,80,49,135,40,0,253,29,191,209,200,141,71,7,255,252,152,74,15,130,33,185,6,63,255,252,195,70,203,86,53,15,255,255,247,103,76,121,64,32,47,255,34,227,194,209,138,76,65,77,69,51,46,57,55,170,170,170,170,170,170,170,170,170,170,255,227,24,196,73,13,153,210,100,81,135,56,0,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170])],{type:"audio/mpeg"}),Sf=new Blob([new Uint8Array([0,0,0,28,102,116,121,112,105,115,111,109,0,0,2,0,105,115,111,109,105,115,111,50,109,112,52,49,0,0,0,8,102,114,101,101,0,0,2,239,109,100,97,116,33,16,5,32,164,27,255,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,55,167,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,112,33,16,5,32,164,27,255,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,55,167,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,112,0,0,2,194,109,111,111,118,0,0,0,108,109,118,104,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,232,0,0,0,47,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,1,236,116,114,97,107,0,0,0,92,116,107,104,100,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,47,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,101,100,116,115,0,0,0,28,101,108,115,116,0,0,0,0,0,0,0,1,0,0,0,47,0,0,0,0,0,1,0,0,0,0,1,100,109,100,105,97,0,0,0,32,109,100,104,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,172,68,0,0,8,0,85,196,0,0,0,0,0,45,104,100,108,114,0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0,0,0,1,15,109,105,110,102,0,0,0,16,115,109,104,100,0,0,0,0,0,0,0,0,0,0,0,36,100,105,110,102,0,0,0,28,100,114,101,102,0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1,0,0,0,211,115,116,98,108,0,0,0,103,115,116,115,100,0,0,0,0,0,0,0,1,0,0,0,87,109,112,52,97,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,2,0,16,0,0,0,0,172,68,0,0,0,0,0,51,101,115,100,115,0,0,0,0,3,128,128,128,34,0,2,0,4,128,128,128,20,64,21,0,0,0,0,1,244,0,0,1,243,249,5,128,128,128,2,18,16,6,128,128,128,1,2,0,0,0,24,115,116,116,115,0,0,0,0,0,0,0,1,0,0,0,2,0,0,4,0,0,0,0,28,115,116,115,99,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,1,0,0,0,28,115,116,115,122,0,0,0,0,0,0,0,0,0,0,0,2,0,0,1,115,0,0,1,116,0,0,0,20,115,116,99,111,0,0,0,0,0,0,0,1,0,0,0,44,0,0,0,98,117,100,116,97,0,0,0,90,109,101,116,97,0,0,0,0,0,0,0,33,104,100,108,114,0,0,0,0,0,0,0,0,109,100,105,114,97,112,112,108,0,0,0,0,0,0,0,0,0,0,0,0,45,105,108,115,116,0,0,0,37,169,116,111,111,0,0,0,29,100,97,116,97,0,0,0,1,0,0,0,0,76,97,118,102,53,54,46,52,48,46,49,48,49])],{type:"video/mp4"});function co(s){return Object.assign({muted:!1,timeout:250,inline:!1},s)}function ho(s,a){var i=s.muted,t=s.timeout,e=s.inline,n=a(),r=n.element,o=n.source,u=void 0,l=void 0,c=void 0;return r.muted=i,i===!0&&r.setAttribute("muted","muted"),e===!0&&r.setAttribute("playsinline","playsinline"),r.src=o,new Promise(function(h){u=r.play(),l=setTimeout(function(){c(!1,new Error("Timeout "+t+" ms has been reached"))},t),c=function(d){var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;r.remove(),r.srcObject=null,clearTimeout(l),h({result:d,error:v})},u!==void 0?u.then(function(){return c(!0)}).catch(function(f){return c(!1,f)}):c(!0)})}function Ef(s){return s=co(s),ho(s,function(){return{element:document.createElement("video"),source:URL.createObjectURL(Sf)}})}function kf(s){return s=co(s),ho(s,function(){return{element:document.createElement("audio"),source:URL.createObjectURL(bf)}})}var qs={audio:kf,video:Ef},Tf=new Mn("AdsPluginBaseAdManager"),wf=function(s){ri(i,s);var a=si(i);function i(){var t,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Ft(this,i),t=a.call(this),t.options=e,t.config=e.config||{},t.player=e.player,t.mediaElement=e.player.media||e.player.video,t.isAdRunning=!1,t.shouldBlockVideoContent=!1,t._isAdPaused=!0,t._isMediaEnded=!1,t.context={currentTime:0,duration:0},t}return Ut(i,[{key:"currentTime",get:function(){return this.context.currentTime}},{key:"duration",get:function(){return this.context.duration}},{key:"updateConfig",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!e){Tf.warn("config is empty");return}this.config=zs(zs({},this.config),e)}},{key:"isFullScreen",value:function(){return!!this.player.fullscreen}},{key:"paused",get:function(){return this._isAdPaused}},{key:"destroy",value:function(){this.removeAllListeners()}}]),i}(Gr.EventEmitter),zt=new Mn("AdsPluginImaAdManager"),sr="xgplayer-ads-playing",Cf=function(s){ri(i,s);var a=si(i);function i(){var t,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Ft(this,i),t=a.call(this,e),nt(Ke(t),"_onMediaEnded",function(){var n;t.isAdRunning||(t._isMediaEnded=!0,(n=t.adsLoader)===null||n===void 0||n.contentComplete())}),nt(Ke(t),"_onMediaResize",function(){var n,r=Ke(t),o=r.player,u=t.isFullScreen()?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL;(n=t.adsManager)===null||n===void 0||n.resize(o.sizeInfo.width,o.sizeInfo.height,u)}),nt(Ke(t),"_onMediaPlay",function(){t._mediaPlayed=!0}),nt(Ke(t),"_onMediaPause",function(){t._mediaPlayed=!1}),nt(Ke(t),"_onMediaVolumeChange",function(){var n;(n=t.adsManager)===null||n===void 0||n.setVolume(t.player.muted?0:t.player.volume)}),nt(Ke(t),"_onAdsManagerLoaded",function(n){var r=new google.ima.AdsRenderingSettings;r.restoreCustomPlaybackStateOnAdBreakComplete=!0,r.enablePreloading=!0;var o=t.adsManager=n.getAdsManager(t.mediaElement,r);zt.log("AdManager Loaded",o);var u=o.getCuePoints();u.length&&zt.log("cuePoints",u),t._initAdsManagerEventListeners(),t.player.emit(Tr,{adsManager:o})}),nt(Ke(t),"_onAdsManagerAdError",function(n){t._handleAdError(n.getError()),t._resumeContent()}),nt(Ke(t),"_onAdsLoaderAdError",function(n){t._handleAdError(n.getError())}),nt(Ke(t),"_handleAdError",function(n){var r;zt.log("AdError",n),t.shouldBlockVideoContent=!1,t.isAdRunning=!1,(r=t.adsManager)===null||r===void 0||r.destroy(),t.player.emit(Gs,n)}),nt(Ke(t),"onAdEvent",function(n){var r=Ke(t),o=r.player,u=n==null?void 0:n.getAd(),l;switch(zt.log("AdEvent",n==null?void 0:n.type,n==null?void 0:n.getAd()),n==null?void 0:n.type){case google.ima.AdEvent.Type.AD_BREAK_READY:{t.player.emit(nf,{ad:u});break}case google.ima.AdEvent.Type.LOADED:{if(!u.isLinear()){var c;(c=t.mediaElement)===null||c===void 0||c.play()}t.player.emit(tf,{ad:u});break}case google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED:{t._resumeContent(),t.emit(ao,{ad:u});break}case google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED:{t.isAdRunning=!0,t.shouldBlockVideoContent=!0,p.addClass(t.player.root,sr),o==null||o.pause(),t.emit(so,{ad:u});break}case google.ima.AdEvent.Type.STARTED:{u.isLinear()&&(t._isAdPaused=!1,t.player.emit(Tn,{ad:u}),l=setInterval(function(){},300));break}case google.ima.AdEvent.Type.RESUMED:{t._isAdPaused=!1,t.player.emit(Tn,{ad:u});break}case google.ima.AdEvent.Type.PAUSED:{t._isAdPaused=!0,t.player.emit(ro,{ad:u});break}case google.ima.AdEvent.Type.AD_PROGRESS:{var h=n.getAdData(),f=h.currentTime,d=h.duration;Object.assign(t.context,{currentTime:f,duration:d}),t.player.emit(es,{ad:u});break}case google.ima.AdEvent.Type.COMPLETE:default:u!=null&&u.isLinear()&&clearInterval(l);break}}),t.displayContainer=null,t.adsLoader=null,t.adsManager=null,t}return Ut(i,[{key:"init",value:function(){var t=rr(Yt().mark(function n(){return Yt().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.shouldBlockVideoContent=!0,o.prev=1,o.next=4,this._loadIMASdk();case 4:this.emit(Jh),o.next=13;break;case 7:return o.prev=7,o.t0=o.catch(1),zt.error("google.ima sdk is not loaded, due to error",(o.t0===null||o.t0===void 0?void 0:o.t0.message)||o.t0),this.emit(Zh),this.shouldBlockVideoContent=!1,o.abrupt("return");case 13:this._initConfig(),this._initMediaEvents(),this._initContainer(),this._initLoader(),this._initAdsRequest();case 18:case"end":return o.stop()}},n,this,[[1,7]])}));function e(){return t.apply(this,arguments)}return e}()},{key:"destroy",value:function(){_i(Nt(i.prototype),"destroy",this).call(this),this.reset(),this._removeMediaEvents(),this._destroyLoader()}},{key:"_initConfig",value:function(){var e=this.config.locale;e&&google.ima.settings.setLocale(e)}},{key:"_loadIMASdk",value:function(){var e=this;return new Promise(function(n,r){if(typeof google<"u"&&google.ima){n();return}var o=document.createElement("script"),u=setTimeout(function(){r(new Error("google.ima sdk load timeout"))},e.config.loadSdkTimeout||3e3);o.src="https://imasdk.googleapis.com/js/sdkloader/ima3".concat(e.config.debug?"_debug":"",".js"),o.onload=function(){clearTimeout(u),n()},o.onerror=function(l){clearTimeout(u),r(l==null?void 0:l.message)},document.head.appendChild(o)})}},{key:"_initMediaEvents",value:function(){var e=this.player;e.on(pt,this._onMediaResize),e.on(Ct,this._onMediaEnded),e.on(je,this._onMediaPlay),e.on(dt,this._onMediaPause),e.on(Ii,this._onMediaVolumeChange)}},{key:"_removeMediaEvents",value:function(){var e=this.player;e.off(pt,this._onMediaResize),e.off(Ct,this._onMediaEnded),e.off(je,this._onMediaPlay),e.off(dt,this._onMediaPause),e.off(Ii,this._onMediaVolumeChange)}},{key:"_initContainer",value:function(){var e=this.options.displayContainer;this.displayContainer=new google.ima.AdDisplayContainer(e,this.mediaElement)}},{key:"_initLoader",value:function(){var e=this.adsLoader=new google.ima.AdsLoader(this.displayContainer);e.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this._onAdsManagerLoaded,!1),e.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this._onAdsLoaderAdError,!1),this.player.emit(ef,{adsLoader:e})}},{key:"_destroyLoader",value:function(){var e=this.adsLoader;e||(e.removeEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this._onAdsManagerLoaded,!1),e.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this._onAdsLoaderAdError,!1))}},{key:"_initAdsRequest",value:function(){var t=rr(Yt().mark(function n(){var r=this,o,u,l,c;return Yt().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(o=this.config,u=o.adsRequest,l=o.adsResponse,c=o.adTagUrl,!(u||l||c)){f.next=9;break}return f.next=4,this._checkAutoplaySupport();case 4:this.requestAds(),this.player.once(Tr,function(){if(r.autoplayAllowed)r.playAds();else{var d=function v(){return r.playAds(),r.player.removeHooks("play",v),!1};r.player.useHooks("play",d)}r.emit(un)}),this.player.once(Gs,function(){r.player.config.autoplay=r._originAutoplay,r.player.media.autoplay=r._originAutoplay,r.emit(un)}),f.next=10;break;case 9:this.emit(un);case 10:case"end":return f.stop()}},n,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"playAds",value:function(){try{this._onMediaVolumeChange(),this.displayContainerInitialized||(this.displayContainer.initialize(),this.displayContainerInitialized=!0);var e=this.player,n=this.isFullScreen()?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL;this.adsManager.init(e.sizeInfo.width,e.sizeInfo.height,n),this.adsManager.start()}catch(r){this._handleAdError(r),this._resumeContent()}}},{key:"_initAdsManagerEventListeners",value:function(){var e=this,n=this.adsManager;n.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this._onAdsManagerAdError);var r=["LOADED","STARTED","RESUMED","PAUSED","COMPLETE","ALL_ADS_COMPLETED","CONTENT_PAUSE_REQUESTED","CONTENT_RESUME_REQUESTED","VOLUME_CHANGED","VOLUME_MUTED","AD_METADATA","AD_CAN_PLAY","AD_PROGRESS","AD_BUFFERING","CLICK","VIDEO_CLICKED","VIDEO_ICON_CLICKED","FIRST_QUARTILE","MIDPOINT","THIRD_QUARTILE","COMPLETE","SKIPPED","USER_CLOSE","AD_BREAK_READY","AD_BREAK_FETCH_ERROR"];r.forEach(function(o){n.addEventListener(google.ima.AdEvent.Type[o],e.onAdEvent)})}},{key:"_resumeContent",value:function(){if(this.isAdRunning=!1,this.shouldBlockVideoContent=!1,p.removeClass(this.player.root,sr),!this._isMediaEnded){var e;(e=this.player)===null||e===void 0||e.play()}}},{key:"reset",value:function(){var e,n;this.isAdRunning=!1,(e=this.adsManager)===null||e===void 0||e.destroy(),this.adsManager=null,(n=this.adsLoader)===null||n===void 0||n.contentComplete(),p.removeClass(this.player.root,sr)}},{key:"requestAds",value:function(){var e,n=this.config,r=n.adsRequest,o=n.adsResponse,u=n.adTagUrl,l=this.player,c=new google.ima.AdsRequest;c.linearAdSlotWidth=l.sizeInfo.width,c.linearAdSlotHeight=l.sizeInfo.height,c.nonLinearAdSlotWidth=l.sizeInfo.width,c.nonLinearAdSlotHeight=l.sizeInfo.height,c.setAdWillAutoPlay(this.autoplayAllowed),c.setAdWillPlayMuted(this.autoplayRequiresMuted),u?c.adTagUrl=u:o?c.adsResponse=o:r&&wr(r)==="object"&&Object.keys(r).forEach(function(h){c[h]=r[h]}),zt.log("requestAds",JSON.stringify(c)),(e=this.adsLoader)===null||e===void 0||e.requestAds(c)}},{key:"pause",value:function(){var e;return(e=this.adsManager)===null||e===void 0?void 0:e.pause()}},{key:"play",value:function(){var e;return(e=this.adsManager)===null||e===void 0?void 0:e.resume()}},{key:"skip",value:function(){var e;return(e=this.adsManager)===null||e===void 0?void 0:e.skip()}},{key:"updateConfig",value:function(e){_i(Nt(i.prototype),"updateConfig",this).call(this,e),this._initConfig()}},{key:"_checkAutoplaySupport",value:function(){var t=rr(Yt().mark(function n(){var r,o,u,l;return Yt().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return this._originAutoplay=this.player.config.autoplay,this._originAutoplay&&(this.player.media.autoplay=!1,this.player.config.autoplay=!1),h.next=4,Promise.all([this._originAutoplay?qs.video({timeout:100}).then(function(f){var d=f.result;return d}):Promise.resolve(!1),this._originAutoplay&&this.player.config.autoplayMuted?qs.video({timeout:100,muted:!0}).then(function(f){var d=f.result;return d}):Promise.resolve(!1)]);case 4:r=h.sent,o=ln(r,2),u=o[0],l=o[1],this.autoplayAllowed=u||l,this.autoplayRequiresMuted=!u&&l,zt.log("checkAutoplaySupport",this.autoplayAllowed,this.autoplayRequiresMuted);case 11:case"end":return h.stop()}},n,this)}));function e(){return t.apply(this,arguments)}return e}()}]),i}(wf),Af=function(s){ri(i,s);var a=si(i);function i(){var t;Ft(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=a.call.apply(a,[this].concat(n)),nt(Ke(t),"btnClick",function(o){o.preventDefault(),o.stopPropagation();var u=t.getAdPlugin();return u.paused?(u.play(),t.animate(!1)):(u.pause(),t.animate(!0)),!1}),t}return Ut(i,[{key:"getAdPlugin",value:function(){return this.player.getPlugin("ad")}},{key:"listenEvents",value:function(){var e=this;this.on([ro],function(){e.animate(!0)}),this.on(Tn,function(){e.animate(!1)})}}],[{key:"pluginName",get:function(){return"adPlay"}}]),i}(Ja),Pf=function(s){ri(i,s);var a=si(i);function i(){return Ft(this,i),a.apply(this,arguments)}return Ut(i,[{key:"render",value:function(){return p.createDom("xg-ad-stub","",{})}}],[{key:"pluginName",get:function(){return"adStub"}}]),i}(fe),xf=function(s){ri(i,s);var a=si(i);function i(){return Ft(this,i),a.apply(this,arguments)}return Ut(i,[{key:"getAdPlugin",value:function(){return this.player.getPlugin("ad")}},{key:"duration",get:function(){var e=this.getAdPlugin();return(e==null?void 0:e.duration)||0}},{key:"currentTime",get:function(){var e=this.getAdPlugin();return(e==null?void 0:e.currentTime)||0}},{key:"listenEvents",value:function(){var e=this;this.on([es],function(n){e.onTimeUpdate()})}}],[{key:"pluginName",get:function(){return"adTime"}}]),i}(Za),Lf=function(s){ri(i,s);var a=si(i);function i(){return Ft(this,i),a.apply(this,arguments)}return Ut(i,[{key:"getAdPlugin",value:function(){return this.player.getPlugin("ad")}},{key:"duration",get:function(){var e=this.getAdPlugin();return(e==null?void 0:e.duration)||0}},{key:"offsetDuration",get:function(){return this.duration}},{key:"timeOffset",get:function(){return 0}},{key:"currentTime",get:function(){var e=this.getAdPlugin();return(e==null?void 0:e.currentTime)||0}},{key:"afterCreate",value:function(){Object.assign(this.config,{isCloseClickSeek:!0,isDraggingSeek:!0,closeMoveSeek:!0}),_i(Nt(i.prototype),"afterCreate",this).call(this)}},{key:"listenEvents",value:function(){var e=this;this.on(es,function(){e.onTimeupdate()})}}],[{key:"pluginName",get:function(){return"adProgress"}}]),i}(Qa),Df=function(){function s(a,i){var t=i.player,e=i.plugin;Ft(this,s),this.player=t,this.config=a,this.adPlugin=e,this.adUIPlugins=[],this.fragment=document.createDocumentFragment(),this.controlsPos=null,this.init()}return Ut(s,[{key:"init",value:function(){var i=this.player,t=this.adUIPlugins,e=this.fragment,n=[[i.getPlugin("play"),Af],[i.getPlugin("time"),xf],[i.getPlugin("playbackRate"),Pf],[i.getPlugin("progress"),Lf]];n.forEach(function(r){var o=ln(r,2),u=o[0],l=o[1];if(u&&!i.getPlugin(l.pluginName)){i.registerPlugin(l);var c=i.getPlugin(l.pluginName);e.appendChild(c.root),t.push([u,c])}})}},{key:"showAdUI",value:function(){var i=this.player,t=this.config,e=this.adUIPlugins,n=this.fragment;e.forEach(function(r){var o=ln(r,2),u=o[0],l=o[1];if(l){var c=l.root,h=u.root;n.contains(c)&&n.removeChild(c),h.parentNode.insertBefore(c,h),n.appendChild(h)}}),t.controls===!1&&i.controls&&this.hideControls()}},{key:"hideAdUI",value:function(){var i,t=this.player,e=this.config,n=this.adUIPlugins,r=this.fragment;n.forEach(function(o){var u=ln(o,2),l=u[0],c=u[1];if(c){var h=c.root,f=l.root;r.contains(f)&&r.removeChild(f),h.parentNode.insertBefore(f,h),r.appendChild(h)}}),e.controls===!1&&r.contains((i=t.controls)===null||i===void 0?void 0:i.root)&&this.showControls()}},{key:"hideControls",value:function(){var i=this.player,t=this.config,e=this.fragment;if(t.controls===!1&&i.controls){var n=i.controls.root,r=n.parentElement,o=n.previousSibling,u=n.nextSibling;this.controlsPos={parentNode:r,previousSibling:o,nextSibling:u},e.appendChild(i.controls.root)}}},{key:"showControls",value:function(){var i=this.player,t=this.config,e=this.fragment;if(t.controls===!1&&i.controls){if(!this.controlsPos)return;var n=i.controls.root;e.contains(n)&&e.removeChild(n);var r=this.controlsPos,o=r.parentNode,u=r.previousSibling,l=r.nextSibling;o&&(l?o.insertBefore(n,l):u?o.insertBefore(n,u.nextSibling):o.appendChild(n)),this.controlsPos=null}}}]),s}(),ar=new Mn("AdsPlugin"),Qs=function(s){ri(i,s);var a=si(i);function i(){return Ft(this,i),a.apply(this,arguments)}return Ut(i,[{key:"version",get:function(){return"3.0.20-alpha.0"}},{key:"paused",get:function(){var e,n;return!!((e=this.csManager)!==null&&e!==void 0&&e.isAdRunning&&(n=this.csManager)!==null&&n!==void 0&&n.paused)}},{key:"currentTime",get:function(){var e;return((e=this.csManager)===null||e===void 0?void 0:e.currentTime)||0}},{key:"duration",get:function(){var e;return((e=this.csManager)===null||e===void 0?void 0:e.duration)||0}},{key:"afterCreate",value:function(){var e=this.config;ar.log("plugin afterCreate, config: ".concat(JSON.stringify(e||{}))),this.csManager=void 0,this._blockContentPlay()}},{key:"beforePlayerInit",value:function(){switch(ar.log("plugin beforePlayerInit"),this.initPromise=_f(),this.uiManager=new Df(this.config,{plugin:this,player:this.player}),this.config.adType){case"ima":case"google-ima":this._initClientSideAd();break}return this.initPromise}},{key:"render",value:function(){return p.createDom("xg-ad","",{},"xgplayer-ads")}},{key:"_initClientSideAd",value:function(){switch(this.config.adType){case"ima":case"google-ima":this._initImaAd();break}}},{key:"_initImaAd",value:function(){var e=this;this.csManager=new Cf({player:this.player,config:this.config.ima,displayContainer:this.root}),this.csManager.once(un,function(){var n;(n=e.initPromise)===null||n===void 0||n.resolve()}),this.csManager.on(so,function(){e.uiManager.showAdUI()}),this.csManager.on(ao,function(){e.uiManager.hideAdUI()}),this.csManager.init()}},{key:"requestAds",value:function(){var e;(e=this.csManager)===null||e===void 0||e.requestAds()}},{key:"playAds",value:function(){var e;(e=this.csManager)===null||e===void 0||e.playAds()}},{key:"pause",value:function(){var e;(e=this.csManager)===null||e===void 0||e.pause()}},{key:"play",value:function(){var e;(e=this.csManager)===null||e===void 0||e.play()}},{key:"destroy",value:function(){var e;(e=this.csManager)===null||e===void 0||e.destroy()}},{key:"reset",value:function(){var e;(e=this.csManager)===null||e===void 0||e.reset()}},{key:"updateConfig",value:function(e){var n;(n=this.csManager)===null||n===void 0||n.updateConfig(e)}},{key:"_blockContentPlay",value:function(){var e=this,n=this.player;n.on("play",function(){var r;(r=e.csManager)!==null&&r!==void 0&&r.shouldBlockVideoContent&&!n.paused&&(ar.log("block content play"),n.pause())})}}],[{key:"pluginName",get:function(){return"ad"}}]),i}(fe);function If(s,a){var i=s==null?null:typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(i!=null){var t,e,n,r,o=[],u=!0,l=!1;try{if(n=(i=i.call(s)).next,a===0){if(Object(i)!==i)return;u=!1}else for(;!(u=(t=n.call(i)).done)&&(o.push(t.value),o.length!==a);u=!0);}catch(c){l=!0,e=c}finally{try{if(!u&&i.return!=null&&(r=i.return(),Object(r)!==r))return}finally{if(l)throw e}}return o}}function Js(s,a){var i=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);a&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(s,e).enumerable})),i.push.apply(i,t)}return i}function ge(s){for(var a=1;a<arguments.length;a++){var i=arguments[a]!=null?arguments[a]:{};a%2?Js(Object(i),!0).forEach(function(t){A(s,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(i)):Js(Object(i)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(i,t))})}return s}function W(){W=function(){return s};var s={},a=Object.prototype,i=a.hasOwnProperty,t=Object.defineProperty||function(y,_,S){y[_]=S.value},e=typeof Symbol=="function"?Symbol:{},n=e.iterator||"@@iterator",r=e.asyncIterator||"@@asyncIterator",o=e.toStringTag||"@@toStringTag";function u(y,_,S){return Object.defineProperty(y,_,{value:S,enumerable:!0,configurable:!0,writable:!0}),y[_]}try{u({},"")}catch{u=function(_,S,P){return _[S]=P}}function l(y,_,S,P){var T=_&&_.prototype instanceof f?_:f,M=Object.create(T.prototype),G=new O(P||[]);return t(M,"_invoke",{value:C(y,S,G)}),M}function c(y,_,S){try{return{type:"normal",arg:y.call(_,S)}}catch(P){return{type:"throw",arg:P}}}s.wrap=l;var h={};function f(){}function d(){}function v(){}var m={};u(m,n,function(){return this});var g=Object.getPrototypeOf,b=g&&g(g(R([])));b&&b!==a&&i.call(b,n)&&(m=b);var k=v.prototype=f.prototype=Object.create(m);function E(y){["next","throw","return"].forEach(function(_){u(y,_,function(S){return this._invoke(_,S)})})}function w(y,_){function S(T,M,G,K){var Z=c(y[T],y,M);if(Z.type!=="throw"){var $=Z.arg,be=$.value;return be&&typeof be=="object"&&i.call(be,"__await")?_.resolve(be.__await).then(function(Y){S("next",Y,G,K)},function(Y){S("throw",Y,G,K)}):_.resolve(be).then(function(Y){$.value=Y,G($)},function(Y){return S("throw",Y,G,K)})}K(Z.arg)}var P;t(this,"_invoke",{value:function(T,M){function G(){return new _(function(K,Z){S(T,M,K,Z)})}return P=P?P.then(G,G):G()}})}function C(y,_,S){var P="suspendedStart";return function(T,M){if(P==="executing")throw new Error("Generator is already running");if(P==="completed"){if(T==="throw")throw M;return j()}for(S.method=T,S.arg=M;;){var G=S.delegate;if(G){var K=B(G,S);if(K){if(K===h)continue;return K}}if(S.method==="next")S.sent=S._sent=S.arg;else if(S.method==="throw"){if(P==="suspendedStart")throw P="completed",S.arg;S.dispatchException(S.arg)}else S.method==="return"&&S.abrupt("return",S.arg);P="executing";var Z=c(y,_,S);if(Z.type==="normal"){if(P=S.done?"completed":"suspendedYield",Z.arg===h)continue;return{value:Z.arg,done:S.done}}Z.type==="throw"&&(P="completed",S.method="throw",S.arg=Z.arg)}}}function B(y,_){var S=_.method,P=y.iterator[S];if(P===void 0)return _.delegate=null,S==="throw"&&y.iterator.return&&(_.method="return",_.arg=void 0,B(y,_),_.method==="throw")||S!=="return"&&(_.method="throw",_.arg=new TypeError("The iterator does not provide a '"+S+"' method")),h;var T=c(P,y.iterator,_.arg);if(T.type==="throw")return _.method="throw",_.arg=T.arg,_.delegate=null,h;var M=T.arg;return M?M.done?(_[y.resultName]=M.value,_.next=y.nextLoc,_.method!=="return"&&(_.method="next",_.arg=void 0),_.delegate=null,h):M:(_.method="throw",_.arg=new TypeError("iterator result is not an object"),_.delegate=null,h)}function L(y){var _={tryLoc:y[0]};1 in y&&(_.catchLoc=y[1]),2 in y&&(_.finallyLoc=y[2],_.afterLoc=y[3]),this.tryEntries.push(_)}function D(y){var _=y.completion||{};_.type="normal",delete _.arg,y.completion=_}function O(y){this.tryEntries=[{tryLoc:"root"}],y.forEach(L,this),this.reset(!0)}function R(y){if(y){var _=y[n];if(_)return _.call(y);if(typeof y.next=="function")return y;if(!isNaN(y.length)){var S=-1,P=function T(){for(;++S<y.length;)if(i.call(y,S))return T.value=y[S],T.done=!1,T;return T.value=void 0,T.done=!0,T};return P.next=P}}return{next:j}}function j(){return{value:void 0,done:!0}}return d.prototype=v,t(k,"constructor",{value:v,configurable:!0}),t(v,"constructor",{value:d,configurable:!0}),d.displayName=u(v,o,"GeneratorFunction"),s.isGeneratorFunction=function(y){var _=typeof y=="function"&&y.constructor;return!!_&&(_===d||(_.displayName||_.name)==="GeneratorFunction")},s.mark=function(y){return Object.setPrototypeOf?Object.setPrototypeOf(y,v):(y.__proto__=v,u(y,o,"GeneratorFunction")),y.prototype=Object.create(k),y},s.awrap=function(y){return{__await:y}},E(w.prototype),u(w.prototype,r,function(){return this}),s.AsyncIterator=w,s.async=function(y,_,S,P,T){T===void 0&&(T=Promise);var M=new w(l(y,_,S,P),T);return s.isGeneratorFunction(_)?M:M.next().then(function(G){return G.done?G.value:M.next()})},E(k),u(k,o,"Generator"),u(k,n,function(){return this}),u(k,"toString",function(){return"[object Generator]"}),s.keys=function(y){var _=Object(y),S=[];for(var P in _)S.push(P);return S.reverse(),function T(){for(;S.length;){var M=S.pop();if(M in _)return T.value=M,T.done=!1,T}return T.done=!0,T}},s.values=R,O.prototype={constructor:O,reset:function(y){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(D),!y)for(var _ in this)_.charAt(0)==="t"&&i.call(this,_)&&!isNaN(+_.slice(1))&&(this[_]=void 0)},stop:function(){this.done=!0;var y=this.tryEntries[0].completion;if(y.type==="throw")throw y.arg;return this.rval},dispatchException:function(y){if(this.done)throw y;var _=this;function S(Z,$){return M.type="throw",M.arg=y,_.next=Z,$&&(_.method="next",_.arg=void 0),!!$}for(var P=this.tryEntries.length-1;P>=0;--P){var T=this.tryEntries[P],M=T.completion;if(T.tryLoc==="root")return S("end");if(T.tryLoc<=this.prev){var G=i.call(T,"catchLoc"),K=i.call(T,"finallyLoc");if(G&&K){if(this.prev<T.catchLoc)return S(T.catchLoc,!0);if(this.prev<T.finallyLoc)return S(T.finallyLoc)}else if(G){if(this.prev<T.catchLoc)return S(T.catchLoc,!0)}else{if(!K)throw new Error("try statement without catch or finally");if(this.prev<T.finallyLoc)return S(T.finallyLoc)}}}},abrupt:function(y,_){for(var S=this.tryEntries.length-1;S>=0;--S){var P=this.tryEntries[S];if(P.tryLoc<=this.prev&&i.call(P,"finallyLoc")&&this.prev<P.finallyLoc){var T=P;break}}T&&(y==="break"||y==="continue")&&T.tryLoc<=_&&_<=T.finallyLoc&&(T=null);var M=T?T.completion:{};return M.type=y,M.arg=_,T?(this.method="next",this.next=T.finallyLoc,h):this.complete(M)},complete:function(y,_){if(y.type==="throw")throw y.arg;return y.type==="break"||y.type==="continue"?this.next=y.arg:y.type==="return"?(this.rval=this.arg=y.arg,this.method="return",this.next="end"):y.type==="normal"&&_&&(this.next=_),h},finish:function(y){for(var _=this.tryEntries.length-1;_>=0;--_){var S=this.tryEntries[_];if(S.finallyLoc===y)return this.complete(S.completion,S.afterLoc),D(S),h}},catch:function(y){for(var _=this.tryEntries.length-1;_>=0;--_){var S=this.tryEntries[_];if(S.tryLoc===y){var P=S.completion;if(P.type==="throw"){var T=P.arg;D(S)}return T}}throw new Error("illegal catch attempt")},delegateYield:function(y,_,S){return this.delegate={iterator:R(y),resultName:_,nextLoc:S},this.method==="next"&&(this.arg=void 0),h}},s}function Ni(s){"@babel/helpers - typeof";return Ni=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Ni(s)}function Zs(s,a,i,t,e,n,r){try{var o=s[n](r),u=o.value}catch(l){i(l);return}o.done?a(u):Promise.resolve(u).then(t,e)}function ve(s){return function(){var a=this,i=arguments;return new Promise(function(t,e){var n=s.apply(a,i);function r(u){Zs(n,t,e,r,o,"next",u)}function o(u){Zs(n,t,e,r,o,"throw",u)}r(void 0)})}}function Oe(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")}function ea(s,a){for(var i=0;i<a.length;i++){var t=a[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(s,vo(t.key),t)}}function Re(s,a,i){return a&&ea(s.prototype,a),i&&ea(s,i),Object.defineProperty(s,"prototype",{writable:!1}),s}function A(s,a,i){return a=vo(a),a in s?Object.defineProperty(s,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):s[a]=i,s}function Nn(s,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(a&&a.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),a&&Ar(s,a)}function wn(s){return wn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},wn(s)}function Ar(s,a){return Ar=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ar(s,a)}function Of(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Rf(s,a){if(s==null)return{};var i={},t=Object.keys(s),e,n;for(n=0;n<t.length;n++)e=t[n],!(a.indexOf(e)>=0)&&(i[e]=s[e]);return i}function Pr(s,a){if(s==null)return{};var i=Rf(s,a),t,e;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(s);for(e=0;e<n.length;e++)t=n[e],!(a.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(s,t)&&(i[t]=s[t])}return i}function ae(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function Mf(s,a){if(a&&(typeof a=="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ae(s)}function Bn(s){var a=Of();return function(){var t=wn(s),e;if(a){var n=wn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Mf(this,e)}}function At(s,a){return Ff(s)||If(s,a)||fo(s,a)||Vf()}function Nf(s){return Bf(s)||Uf(s)||fo(s)||Hf()}function Bf(s){if(Array.isArray(s))return xr(s)}function Ff(s){if(Array.isArray(s))return s}function Uf(s){if(typeof Symbol<"u"&&s[Symbol.iterator]!=null||s["@@iterator"]!=null)return Array.from(s)}function fo(s,a){if(s){if(typeof s=="string")return xr(s,a);var i=Object.prototype.toString.call(s).slice(8,-1);if(i==="Object"&&s.constructor&&(i=s.constructor.name),i==="Map"||i==="Set")return Array.from(s);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return xr(s,a)}}function xr(s,a){(a==null||a>s.length)&&(a=s.length);for(var i=0,t=new Array(a);i<a;i++)t[i]=s[i];return t}function Hf(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Vf(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $f(s,a){if(typeof s!="object"||s===null)return s;var i=s[Symbol.toPrimitive];if(i!==void 0){var t=i.call(s,a||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}function vo(s){var a=$f(s,"string");return typeof a=="symbol"?a:String(a)}function ta(s,a){var i=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);a&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(s,e).enumerable})),i.push.apply(i,t)}return i}function Bi(s){for(var a=1;a<arguments.length;a++){var i=arguments[a]!=null?arguments[a]:{};a%2?ta(Object(i),!0).forEach(function(t){N(s,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(i)):ta(Object(i)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(i,t))})}return s}function Ie(){Ie=function(){return s};var s={},a=Object.prototype,i=a.hasOwnProperty,t=Object.defineProperty||function(y,_,S){y[_]=S.value},e=typeof Symbol=="function"?Symbol:{},n=e.iterator||"@@iterator",r=e.asyncIterator||"@@asyncIterator",o=e.toStringTag||"@@toStringTag";function u(y,_,S){return Object.defineProperty(y,_,{value:S,enumerable:!0,configurable:!0,writable:!0}),y[_]}try{u({},"")}catch{u=function(_,S,P){return _[S]=P}}function l(y,_,S,P){var T=_&&_.prototype instanceof f?_:f,M=Object.create(T.prototype),G=new O(P||[]);return t(M,"_invoke",{value:C(y,S,G)}),M}function c(y,_,S){try{return{type:"normal",arg:y.call(_,S)}}catch(P){return{type:"throw",arg:P}}}s.wrap=l;var h={};function f(){}function d(){}function v(){}var m={};u(m,n,function(){return this});var g=Object.getPrototypeOf,b=g&&g(g(R([])));b&&b!==a&&i.call(b,n)&&(m=b);var k=v.prototype=f.prototype=Object.create(m);function E(y){["next","throw","return"].forEach(function(_){u(y,_,function(S){return this._invoke(_,S)})})}function w(y,_){function S(T,M,G,K){var Z=c(y[T],y,M);if(Z.type!=="throw"){var $=Z.arg,be=$.value;return be&&typeof be=="object"&&i.call(be,"__await")?_.resolve(be.__await).then(function(Y){S("next",Y,G,K)},function(Y){S("throw",Y,G,K)}):_.resolve(be).then(function(Y){$.value=Y,G($)},function(Y){return S("throw",Y,G,K)})}K(Z.arg)}var P;t(this,"_invoke",{value:function(T,M){function G(){return new _(function(K,Z){S(T,M,K,Z)})}return P=P?P.then(G,G):G()}})}function C(y,_,S){var P="suspendedStart";return function(T,M){if(P==="executing")throw new Error("Generator is already running");if(P==="completed"){if(T==="throw")throw M;return j()}for(S.method=T,S.arg=M;;){var G=S.delegate;if(G){var K=B(G,S);if(K){if(K===h)continue;return K}}if(S.method==="next")S.sent=S._sent=S.arg;else if(S.method==="throw"){if(P==="suspendedStart")throw P="completed",S.arg;S.dispatchException(S.arg)}else S.method==="return"&&S.abrupt("return",S.arg);P="executing";var Z=c(y,_,S);if(Z.type==="normal"){if(P=S.done?"completed":"suspendedYield",Z.arg===h)continue;return{value:Z.arg,done:S.done}}Z.type==="throw"&&(P="completed",S.method="throw",S.arg=Z.arg)}}}function B(y,_){var S=_.method,P=y.iterator[S];if(P===void 0)return _.delegate=null,S==="throw"&&y.iterator.return&&(_.method="return",_.arg=void 0,B(y,_),_.method==="throw")||S!=="return"&&(_.method="throw",_.arg=new TypeError("The iterator does not provide a '"+S+"' method")),h;var T=c(P,y.iterator,_.arg);if(T.type==="throw")return _.method="throw",_.arg=T.arg,_.delegate=null,h;var M=T.arg;return M?M.done?(_[y.resultName]=M.value,_.next=y.nextLoc,_.method!=="return"&&(_.method="next",_.arg=void 0),_.delegate=null,h):M:(_.method="throw",_.arg=new TypeError("iterator result is not an object"),_.delegate=null,h)}function L(y){var _={tryLoc:y[0]};1 in y&&(_.catchLoc=y[1]),2 in y&&(_.finallyLoc=y[2],_.afterLoc=y[3]),this.tryEntries.push(_)}function D(y){var _=y.completion||{};_.type="normal",delete _.arg,y.completion=_}function O(y){this.tryEntries=[{tryLoc:"root"}],y.forEach(L,this),this.reset(!0)}function R(y){if(y){var _=y[n];if(_)return _.call(y);if(typeof y.next=="function")return y;if(!isNaN(y.length)){var S=-1,P=function T(){for(;++S<y.length;)if(i.call(y,S))return T.value=y[S],T.done=!1,T;return T.value=void 0,T.done=!0,T};return P.next=P}}return{next:j}}function j(){return{value:void 0,done:!0}}return d.prototype=v,t(k,"constructor",{value:v,configurable:!0}),t(v,"constructor",{value:d,configurable:!0}),d.displayName=u(v,o,"GeneratorFunction"),s.isGeneratorFunction=function(y){var _=typeof y=="function"&&y.constructor;return!!_&&(_===d||(_.displayName||_.name)==="GeneratorFunction")},s.mark=function(y){return Object.setPrototypeOf?Object.setPrototypeOf(y,v):(y.__proto__=v,u(y,o,"GeneratorFunction")),y.prototype=Object.create(k),y},s.awrap=function(y){return{__await:y}},E(w.prototype),u(w.prototype,r,function(){return this}),s.AsyncIterator=w,s.async=function(y,_,S,P,T){T===void 0&&(T=Promise);var M=new w(l(y,_,S,P),T);return s.isGeneratorFunction(_)?M:M.next().then(function(G){return G.done?G.value:M.next()})},E(k),u(k,o,"Generator"),u(k,n,function(){return this}),u(k,"toString",function(){return"[object Generator]"}),s.keys=function(y){var _=Object(y),S=[];for(var P in _)S.push(P);return S.reverse(),function T(){for(;S.length;){var M=S.pop();if(M in _)return T.value=M,T.done=!1,T}return T.done=!0,T}},s.values=R,O.prototype={constructor:O,reset:function(y){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(D),!y)for(var _ in this)_.charAt(0)==="t"&&i.call(this,_)&&!isNaN(+_.slice(1))&&(this[_]=void 0)},stop:function(){this.done=!0;var y=this.tryEntries[0].completion;if(y.type==="throw")throw y.arg;return this.rval},dispatchException:function(y){if(this.done)throw y;var _=this;function S(Z,$){return M.type="throw",M.arg=y,_.next=Z,$&&(_.method="next",_.arg=void 0),!!$}for(var P=this.tryEntries.length-1;P>=0;--P){var T=this.tryEntries[P],M=T.completion;if(T.tryLoc==="root")return S("end");if(T.tryLoc<=this.prev){var G=i.call(T,"catchLoc"),K=i.call(T,"finallyLoc");if(G&&K){if(this.prev<T.catchLoc)return S(T.catchLoc,!0);if(this.prev<T.finallyLoc)return S(T.finallyLoc)}else if(G){if(this.prev<T.catchLoc)return S(T.catchLoc,!0)}else{if(!K)throw new Error("try statement without catch or finally");if(this.prev<T.finallyLoc)return S(T.finallyLoc)}}}},abrupt:function(y,_){for(var S=this.tryEntries.length-1;S>=0;--S){var P=this.tryEntries[S];if(P.tryLoc<=this.prev&&i.call(P,"finallyLoc")&&this.prev<P.finallyLoc){var T=P;break}}T&&(y==="break"||y==="continue")&&T.tryLoc<=_&&_<=T.finallyLoc&&(T=null);var M=T?T.completion:{};return M.type=y,M.arg=_,T?(this.method="next",this.next=T.finallyLoc,h):this.complete(M)},complete:function(y,_){if(y.type==="throw")throw y.arg;return y.type==="break"||y.type==="continue"?this.next=y.arg:y.type==="return"?(this.rval=this.arg=y.arg,this.method="return",this.next="end"):y.type==="normal"&&_&&(this.next=_),h},finish:function(y){for(var _=this.tryEntries.length-1;_>=0;--_){var S=this.tryEntries[_];if(S.finallyLoc===y)return this.complete(S.completion,S.afterLoc),D(S),h}},catch:function(y){for(var _=this.tryEntries.length-1;_>=0;--_){var S=this.tryEntries[_];if(S.tryLoc===y){var P=S.completion;if(P.type==="throw"){var T=P.arg;D(S)}return T}}throw new Error("illegal catch attempt")},delegateYield:function(y,_,S){return this.delegate={iterator:R(y),resultName:_,nextLoc:S},this.method==="next"&&(this.arg=void 0),h}},s}function Zt(s){"@babel/helpers - typeof";return Zt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Zt(s)}function ia(s,a,i,t,e,n,r){try{var o=s[n](r),u=o.value}catch(l){i(l);return}o.done?a(u):Promise.resolve(u).then(t,e)}function Tt(s){return function(){var a=this,i=arguments;return new Promise(function(t,e){var n=s.apply(a,i);function r(u){ia(n,t,e,r,o,"next",u)}function o(u){ia(n,t,e,r,o,"throw",u)}r(void 0)})}}function Qe(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")}function na(s,a){for(var i=0;i<a.length;i++){var t=a[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(s,go(t.key),t)}}function Je(s,a,i){return a&&na(s.prototype,a),i&&na(s,i),Object.defineProperty(s,"prototype",{writable:!1}),s}function N(s,a,i){return a=go(a),a in s?Object.defineProperty(s,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):s[a]=i,s}function Ki(s,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(a&&a.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),a&&Fi(s,a)}function ei(s){return ei=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},ei(s)}function Fi(s,a){return Fi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Fi(s,a)}function po(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function cn(s,a,i){return po()?cn=Reflect.construct.bind():cn=function(e,n,r){var o=[null];o.push.apply(o,n);var u=Function.bind.apply(e,o),l=new u;return r&&Fi(l,r.prototype),l},cn.apply(null,arguments)}function Gf(s){return Function.toString.call(s).indexOf("[native code]")!==-1}function Cn(s){var a=typeof Map=="function"?new Map:void 0;return Cn=function(t){if(t===null||!Gf(t))return t;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(typeof a<"u"){if(a.has(t))return a.get(t);a.set(t,e)}function e(){return cn(t,arguments,ei(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Fi(e,t)},Cn(s)}function jf(s,a){if(s==null)return{};var i={},t=Object.keys(s),e,n;for(n=0;n<t.length;n++)e=t[n],!(a.indexOf(e)>=0)&&(i[e]=s[e]);return i}function zf(s,a){if(s==null)return{};var i=jf(s,a),t,e;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(s);for(e=0;e<n.length;e++)t=n[e],!(a.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(s,t)&&(i[t]=s[t])}return i}function J(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function Wf(s,a){if(a&&(typeof a=="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return J(s)}function Yi(s){var a=po();return function(){var t=ei(s),e;if(a){var n=ei(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Wf(this,e)}}function Kf(s,a){for(;!Object.prototype.hasOwnProperty.call(s,a)&&(s=ei(s),s!==null););return s}function hn(){return typeof Reflect<"u"&&Reflect.get?hn=Reflect.get.bind():hn=function(a,i,t){var e=Kf(a,i);if(e){var n=Object.getOwnPropertyDescriptor(e,i);return n.get?n.get.call(arguments.length<3?a:t):n.value}},hn.apply(this,arguments)}function Yf(s,a){if(s){if(typeof s=="string")return ra(s,a);var i=Object.prototype.toString.call(s).slice(8,-1);if(i==="Object"&&s.constructor&&(i=s.constructor.name),i==="Map"||i==="Set")return Array.from(s);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return ra(s,a)}}function ra(s,a){(a==null||a>s.length)&&(a=s.length);for(var i=0,t=new Array(a);i<a;i++)t[i]=s[i];return t}function Xf(s,a){var i=typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(!i){if(Array.isArray(s)||(i=Yf(s))||a){i&&(s=i);var t=0,e=function(){};return{s:e,n:function(){return t>=s.length?{done:!0}:{done:!1,value:s[t++]}},e:function(u){throw u},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var n=!0,r=!1,o;return{s:function(){i=i.call(s)},n:function(){var u=i.next();return n=u.done,u},e:function(u){r=!0,o=u},f:function(){try{!n&&i.return!=null&&i.return()}finally{if(r)throw o}}}}function qf(s,a){if(typeof s!="object"||s===null)return s;var i=s[Symbol.toPrimitive];if(i!==void 0){var t=i.call(s,a||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}function go(s){var a=qf(s,"string");return typeof a=="symbol"?a:String(a)}var Ue=function(){function s(){Qe(this,s)}return Je(s,null,[{key:"start",value:function(i){return!i||!i.length||i.length===1&&i.end(0)-i.start(0)<1e-6||i.length===1&&i.start(0)<0?0:i.start(0)}},{key:"end",value:function(i){return!i||!i.length||i.length===1&&i.end(0)-i.start(0)<1e-6?0:i.end(i.length-1)}},{key:"get",value:function(i){if(i)try{return i.buffered}catch{}}},{key:"buffers",value:function(i,t){if(!i||!i.length)return[];for(var e=[],n=0,r=i.length;n<r;n++){var o=e.length;if(!o||!t)e.push([i.start(n),i.end(n)]);else{var u=e[o-1],l=u[1],c=i.start(n);if(c-l<=t){var h=i.end(n);h>l&&(u[1]=h)}else e.push([i.start(n),i.end(n)])}}return e}},{key:"totalLength",value:function(i){return!i||!i.length?0:i.reduce(function(t,e){return t+=e[1]-e[0]},0)}},{key:"info",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(!i||!i.length)return{start:0,end:0,buffers:[]};for(var n=0,r=0,o=0,u=0,l=0,c=0,h=0,f=s.buffers(i,e),d=0,v=f.length;d<v;d++){var m=f[d];if(t+e>=m[0]&&t<=m[1])n=m[0],r=m[1],o=d;else if(t+e<m[0]){u=m[0],l=m[1];break}else t+e>m[1]&&(c=m[0],h=m[1])}return{start:n,end:r,index:o,buffers:f,nextStart:u,nextEnd:l,prevStart:c,prevEnd:h,currentTime:t,behind:t-n,remaining:r?r-t:0,length:s.totalLength&&s.totalLength(f)}}},{key:"isBuffered",value:function(i,t){if(i){var e=s.get(i);if(e!=null&&e.length){for(var n=0;n<e.length;n++)if(t>=e.start(n)&&t<=e.end(n))return!0}}return!1}}]),s}(),Qf=typeof window<"u",ze,ce={MANIFEST:"manifest",NETWORK:"network",NETWORK_TIMEOUT:"network_timeout",NETWORK_FORBIDDEN:"network_forbidden",NETWORK_NOTFOUND:"network_notfound",NETWROK_RANGE_NOT_SATISFIABLE:"network_range_not_satisfiable",DEMUX:"demux",REMUX:"remux",MEDIA:"media",DRM:"drm",OTHER:"other",RUNTIME:"runtime",SUB_TYPES:{FLV:"FLV",HLS:"HLS",MP4:"MP4",FMP4:"FMP4",MSE_ADD_SB:"MSE_ADD_SB",MSE_APPEND_BUFFER:"MSE_APPEND_BUFFER",MSE_OTHER:"MSE_OTHER",MSE_FULL:"MSE_FULL",MSE_CHANGE_TYPE:"MSE_CHANGE_TYPE",OPTION:"OPTION",DASH:"DASH",LICENSE:"LICENSE",CUSTOM_LICENSE:"CUSTOM_LICENSE",MSE_HIJACK:"MSE_HIJACK",EME_HIJACK:"EME_HIJACK",SIDX:"SIDX",NO_CANPLAY_ERROR:"NO_CANPLAY_ERROR",BUFFERBREAK_ERROR:"BUFFERBREAK_ERROR",WAITING_TIMEOUT_ERROR:"WAITING_TIMEOUT_ERROR",MEDIA_ERR_ABORTED:"MEDIA_ERR_ABORTED",MEDIA_ERR_NETWORK:"MEDIA_ERR_NETWORK",MEDIA_ERR_DECODE:"MEDIA_ERR_DECODE",MEDIA_ERR_SRC_NOT_SUPPORTED:"MEDIA_ERR_SRC_NOT_SUPPORTED",MEDIA_ERR_CODEC_NOT_SUPPORTED:"MEDIA_ERR_CODEC_NOT_SUPPORTED",MEDIA_ERR_URL_EMPTY:"MEDIA_ERR_URL_EMPTY"}},or=(ze={},N(ze,ce.MANIFEST,{HLS:1100,DASH:1200}),N(ze,ce.NETWORK,2100),N(ze,ce.NETWORK_TIMEOUT,2101),N(ze,ce.NETWORK_FORBIDDEN,2103),N(ze,ce.NETWORK_NOTFOUND,2104),N(ze,ce.NETWROK_RANGE_NOT_SATISFIABLE,2116),N(ze,ce.DEMUX,{FLV:3100,HLS:3200,MP4:3300,FMP4:3400,SIDX:3410}),N(ze,ce.REMUX,{FMP4:4100,MP4:4200}),N(ze,ce.MEDIA,{MEDIA_ERR_ABORTED:5101,MEDIA_ERR_NETWORK:5102,MEDIA_ERR_DECODE:5103,MEDIA_ERR_SRC_NOT_SUPPORTED:5104,MEDIA_ERR_CODEC_NOT_SUPPORTED:5105,MEDIA_ERR_URL_EMPTY:5106,MSE_ADD_SB:5200,MSE_APPEND_BUFFER:5201,MSE_OTHER:5202,MSE_FULL:5203,MSE_HIJACK:5204,MSE_CHANGE_TYPE:5205,EME_HIJACK:5301}),N(ze,ce.DRM,{LICENSE:7100,CUSTOM_LICENSE:7200}),N(ze,ce.OTHER,8e3),N(ze,ce.RUNTIME,{NO_CANPLAY_ERROR:9001,BUFFERBREAK_ERROR:9002,WAITING_TIMEOUT_ERROR:9003}),ze),Ce=function(s){Ki(i,s);var a=Yi(i);function i(t,e,n,r,o){var u;return Qe(this,i),u=a.call(this,o||(n==null?void 0:n.message)),u.errorType=t===ce.NETWORK_TIMEOUT?ce.NETWORK:t,u.originError=n,u.ext=r,u.errorCode=or[t][e]||or[t],u.errorMessage=u.message,u.errorCode||(u.errorType=ce.OTHER,u.errorCode=or[u.errorType]),u}return Je(i,null,[{key:"create",value:function(e,n,r,o,u){return e instanceof i?e:(e instanceof Error&&(r=e,e=""),e||(e=ce.OTHER),new i(e,n,r,o,u))}},{key:"network",value:function(e){var n;return new i(e!=null&&e.isTimeout?ce.NETWORK_TIMEOUT:ce.NETWORK,null,e instanceof Error?e:null,{url:e==null?void 0:e.url,response:e==null?void 0:e.response,httpCode:e==null||(n=e.response)===null||n===void 0?void 0:n.status})}}]),i}(Cn(Error)),tn={DEBUG:1,LOG:2,WARN:3,ERROR:4},Jf=200*1024,Zf=["Boolean","Number","String","Undefined","Null","Date","Object"],mt=function(){function s(a,i){Qe(this,s),this.name=a||"",this._prefix="[".concat(this.name,"]"),this.logCacheLevel=(i==null?void 0:i.logCacheLevel)||3,this.logMaxSize=(i==null?void 0:i.logMaxSize)||Jf,this.logSize=0,this.logTextArray=[]}return Je(s,[{key:"debug",value:function(){for(var i,t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.logCache.apply(this,[tn.DEBUG].concat(e)),!s.disabled&&(i=console).debug.apply(i,["[".concat(Ai(),"]"),this._prefix].concat(e))}},{key:"log",value:function(){for(var i,t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.logCache.apply(this,[tn.LOG].concat(e)),!s.disabled&&(i=console).log.apply(i,["[".concat(Ai(),"]"),this._prefix].concat(e))}},{key:"warn",value:function(){for(var i,t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.logCache.apply(this,[tn.WARN].concat(e)),!s.disabled&&(i=console).warn.apply(i,["[".concat(Ai(),"]"),this._prefix].concat(e))}},{key:"error",value:function(){for(var i,t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.logCache.apply(this,[tn.ERROR].concat(e)),!s.disabled&&(i=console).error.apply(i,["[".concat(Ai(),"]"),this._prefix].concat(e))}},{key:"logCache",value:function(i){if(!(i<this.logCacheLevel)){var t="";try{for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var o=n.map(function(l){return mo(l)});t="[".concat(Ai(),"]")+this._prefix+JSON.stringify(o)}catch{return}if(i>=this.logCacheLevel&&(this.logSize+=t.length,this.logTextArray.push(t)),this.logSize>this.logMaxSize){var u=this.logTextArray.shift();this.logSize-=u.length}}}},{key:"getLogCache",value:function(){var i=this.logTextArray.join(`
`);return this.reset(),i}},{key:"reset",value:function(){this.logTextArray=[],this.logSize=0}},{key:"table",value:function(){var i;s.disabled||(console.group(this._prefix),(i=console).table.apply(i,arguments),console.groupEnd())}},{key:"setLogLevel",value:function(i){this.logCacheLevel=i}}],[{key:"enable",value:function(){s.disabled=!1}},{key:"disable",value:function(){s.disabled=!0}}]),s}();N(mt,"disabled",!0);function Ai(){return new Date().toLocaleString()}function ed(s){if(Zt(s)!=="object")return s;var a=Object.prototype.toString.call(s).slice(8,-1);switch(a){case"Array":case"Uint8Array":case"ArrayBuffer":return a+"["+s.length+"]";case"Object":return"{}";default:return a}}function mo(s,a,i){i||(i=1),a||(a=2);var t={};if(!s||Zt(s)!=="object")return s;var e=Object.prototype.toString.call(s).slice(8,-1);if(!Zf.includes(e))return e;if(!(i>a)){for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(i===a?t[n]=ed(s[n]):Zt(s[n])==="object"?t[n]=mo(s[n],a,i+1):t[n]=s[n]);return t}}function pi(){var s,a,i=new Promise(function(t,e){s=t,a=e});return i.used=!1,i.resolve=function(){return i.used=!0,s.apply(void 0,arguments)},i.reject=function(){return i.used=!0,a.apply(void 0,arguments)},i}function vi(){try{return parseInt(performance.now(),10)}catch{return new Date().getTime()}}var td={stringify:function(a){try{return JSON.stringify(a)}catch{return""}},parse:function(a){try{return JSON.parse(a)}catch{return}}};function sa(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;try{return Qf?s&&typeof ManagedMediaSource<"u"?ManagedMediaSource:window.MediaSource:null}catch{}}function ur(s){return/ManagedMediaSource/gi.test(Object.prototype.toString.call(s))}function id(s){var a=[];if(s instanceof TimeRanges)for(var i=0;i<s.length;i++)a.push({start:s.start(i),end:s.end(i)});return a}var nn={APPEND:"appendBuffer",REMOVE:"removeBuffer",UPDATE_DURATION:"updateDuration"},Ye=function(){function s(a,i){var t=this;Qe(this,s),N(this,"media",null),N(this,"mediaSource",null),N(this,"_openPromise",pi()),N(this,"_queue",Object.create(null)),N(this,"_sourceBuffer",Object.create(null)),N(this,"_mseFullFlag",{}),N(this,"_st",0),N(this,"_opst",0),N(this,"_logger",null),N(this,"_config",null),N(this,"_url",null),N(this,"_onStartStreaming",function(){t._logger.debug("startstreaming")}),N(this,"_onEndStreaming",function(){t._logger.debug("endstreaming")}),N(this,"_onSBUpdateEnd",function(e){var n=t._queue[e];if(n){var r=n[0];if((r==null?void 0:r.opName)!==nn.UPDATE_DURATION&&n.shift(),r){var o,u,l=vi()-t._opst;t._logger.debug("UpdateEnd(".concat(e,"/").concat(r.opName,")"),td.stringify(id((o=t._sourceBuffer[e])===null||o===void 0?void 0:o.buffered)),l,r.context),r.promise.resolve({name:r.opName,context:r.context,costtime:l});var c=(u=r.context)===null||u===void 0?void 0:u.callback;c&&typeof c=="function"&&c(r.context),t._startQueue(e)}}}),N(this,"_onSBUpdateError",function(e,n){var r=t._queue[e];if(r){var o=r[0];o&&(t._logger.error("UpdateError",e,o.opName,o.context),o.promise.reject(new Ce(ce.MEDIA,ce.SUB_TYPES.MSE_APPEND_BUFFER,n)))}}),this._config=Object.assign(s.getDefaultConfig(),i),a&&this.bindMedia(a),this._logger=new mt("MSE"),this._config.openLog&&mt.enable()}return Je(s,[{key:"isOpened",get:function(){var i;return((i=this.mediaSource)===null||i===void 0?void 0:i.readyState)==="open"}},{key:"hasOpTasks",get:function(){var i=this,t=!1;return Object.keys(this._queue).forEach(function(e){var n=i._queue[e];Array.isArray(n)&&(t||(t=n.length>0))}),t}},{key:"url",get:function(){return this._url}},{key:"duration",get:function(){var i;return((i=this.mediaSource)===null||i===void 0?void 0:i.duration)||-1}},{key:"isEnded",get:function(){return this.mediaSource?this.mediaSource.readyState==="ended":!1}},{key:"streaming",get:function(){return ur(this.mediaSource)?this.mediaSource.streaming:!0}},{key:"isFull",value:function(i){return i?this._mseFullFlag[i]:this._mseFullFlag[s.VIDEO]}},{key:"updateDuration",value:function(i){var t=this,e=this.mediaSource&&this.mediaSource.duration>i;if(this.mediaSource&&this.mediaSource.duration>i){var n=0;if(Object.keys(this._sourceBuffer).forEach(function(r){try{n=Math.max(t.bufferEnd(r)||0,n)}catch{}}),i<n)return Promise.resolve()}return this._enqueueBlockingOp(function(){if(t.isEnded){t._logger.debug("setDuration but ended");return}t.mediaSource&&(t.mediaSource.duration=i,t._logger.debug("setDuration",i))},nn.UPDATE_DURATION,{isReduceDuration:e})}},{key:"open",value:function(){var i=this;if(this._openPromise.used&&!this.isOpened&&this.mediaSource){var t=this.mediaSource,e=function n(){var r=vi()-i._st;i._logger.debug("sourceopen",r),t.removeEventListener("sourceopen",n),i._openPromise.resolve({costtime:r})};t.addEventListener("sourceopen",e),this._openPromise=pi()}return this._openPromise}},{key:"bindMedia",value:function(){var a=Tt(Ie().mark(function t(e){var n=this,r,o,u,l;return Ie().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(!(this.mediaSource||this.media)){h.next=3;break}return h.next=3,this.unbindMedia();case 3:if(r=sa(this._config.preferMMS),!(!e||!r)){h.next=6;break}throw new Error("Param media or MediaSource does not exist");case 6:return this.media=e,o=this.mediaSource=new r,u=ur(o),this._st=vi(),l=function f(){var d=vi()-n._st;n._logger.debug("sourceopen"),o.removeEventListener("sourceopen",f),URL.revokeObjectURL(e.src),n._openPromise.resolve({costtime:d})},o.addEventListener("sourceopen",l),u&&(o.addEventListener("startstreaming",this._onStartStreaming),o.addEventListener("endstreaming",this._onEndStreaming)),this._url=URL.createObjectURL(o),e.src=this._url,e.disableRemotePlayback=u,h.abrupt("return",this._openPromise);case 17:case"end":return h.stop()}},t,this)}));function i(t){return a.apply(this,arguments)}return i}()},{key:"unbindMedia",value:function(){var a=Tt(Ie().mark(function t(){var e=this,n,r,o;return Ie().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(this._openPromise.used||this._openPromise.resolve(),n=this.mediaSource,n){if(Object.keys(this._queue).forEach(function(c){var h=e._queue[c];h&&h.forEach(function(f){var d,v;return(d=f.promise)===null||d===void 0||(v=d.resolve)===null||v===void 0?void 0:v.call(d)})}),r=!!this.media&&this.media.readyState>=1,o=n.readyState==="open",r&&o)try{n.endOfStream()}catch{}Object.keys(this._sourceBuffer).forEach(function(c){try{n.removeSourceBuffer(e._sourceBuffer[c])}catch{}}),ur(n)&&(n.removeEventListener("startstreaming",this._onStartStreaming),n.removeEventListener("endstreaming",this._onEndStreaming))}if(this.media){this.media.disableRemotePlayback=!1,this.media.removeAttribute("src");try{this.media.load()}catch{}this.media=null}this.mediaSource=null,this._openPromise=pi(),this._queue=Object.create(null),this._sourceBuffer=Object.create(null);case 8:case"end":return l.stop()}},t,this)}));function i(){return a.apply(this,arguments)}return i}()},{key:"createSource",value:function(i,t){if(!(this._sourceBuffer[i]||!this.mediaSource)){var e;try{e=this._sourceBuffer[i]=this.mediaSource.addSourceBuffer(t)}catch(n){throw new Ce(ce.MEDIA,ce.SUB_TYPES.MSE_ADD_SB,n)}e.mimeType=t,e.addEventListener("updateend",this._onSBUpdateEnd.bind(this,i)),e.addEventListener("error",this._onSBUpdateError.bind(this,i))}}},{key:"changeType",value:function(i,t){var e=this,n=this._sourceBuffer[i];return!this.mediaSource||!n||n.mimeType===t?Promise.resolve():typeof n.changeType!="function"?Promise.reject(new Ce(ce.MEDIA,ce.SUB_TYPES.MSE_CHANGE_TYPE,new Error("changeType is not a function"))):this._enqueueOp(i,function(){try{n.changeType(t)}catch(r){throw new Ce(ce.MEDIA,ce.SUB_TYPES.MSE_CHANGE_TYPE,r)}n.mimeType=t,e._onSBUpdateEnd(i)},"changeType",{mimeType:t})}},{key:"createOrChangeSource",value:function(i,t){return this.createSource(i,t),this.changeType(i,t)}},{key:"append",value:function(i,t,e){var n=this;return!t||!t.byteLength||!this._sourceBuffer[i]?Promise.resolve():this._enqueueOp(i,function(){var r;!n.mediaSource||n.media.error||(n._logger.debug("MSE APPEND START",e),n._opst=vi(),(r=n._sourceBuffer[i])===null||r===void 0||r.appendBuffer(t))},nn.APPEND,e)}},{key:"remove",value:function(i,t,e,n){var r=this,o=!1;return this._mseFullFlag[i]&&(o=!0),this._enqueueOp(i,function(){if(!(!r.mediaSource||r.media.error)){var u=r._sourceBuffer[i];if(t>=e||!u){r._onSBUpdateEnd(i);return}r._opst=vi(),r._logger.debug("MSE REMOVE START",i,t,e,n),u.remove(t,e)}},nn.REMOVE,n,o)}},{key:"clearBuffer",value:function(i,t){var e=this,n;return Object.keys(this._sourceBuffer).forEach(function(r){n=e.remove(r,i,t)}),n||Promise.resolve()}},{key:"clearAllBuffer",value:function(){var i=this,t;return Object.keys(this._sourceBuffer).forEach(function(e){var n=i._sourceBuffer[e];t=i.remove(e,0,Ue.end(Ue.get(n)))}),t}},{key:"clearOpQueues",value:function(i,t){var e;this._logger.debug("MSE clearOpQueue START");var n=this._queue[i];if(t&&n){this._queue[i]=[];return}if(!(!n||!n[i]||n.length<5)){var r=[];n.forEach(function(o){o.context&&o.context.isinit&&r.push(o)}),this._queue[i]=n.slice(0,2),r.length>0&&(e=this._queue[i]).push.apply(e,r)}}},{key:"endOfStream",value:function(i){var t=this;return!this.mediaSource||this.mediaSource.readyState!=="open"?Promise.resolve():this._enqueueBlockingOp(function(){var e=t.mediaSource;!e||e.readyState!=="open"||(t._logger.debug("MSE endOfStream START"),i?e.endOfStream(i):e.endOfStream())},"endOfStream")}},{key:"setLiveSeekableRange",value:function(i,t){var e=this.mediaSource;i<0||t<i||!(e!=null&&e.setLiveSeekableRange)||e.readyState!=="open"||e.setLiveSeekableRange(i,t)}},{key:"getSourceBuffer",value:function(i){return this._sourceBuffer[i]}},{key:"buffered",value:function(i){return Ue.get(this._sourceBuffer[i])}},{key:"bufferStart",value:function(i){return Ue.start(this.buffered(i))}},{key:"bufferEnd",value:function(i){return Ue.end(this.buffered(i))}},{key:"_enqueueOp",value:function(i,t,e,n,r){var o=this;if(!this.mediaSource)return Promise.resolve();var u=this._queue[i]=this._queue[i]||[],l={exec:t,promise:pi(),opName:e,context:n};return r?(u.splice(0,0,l),this._mseFullFlag[i]=!1,this._startQueue(i)):u.push(l),this.isOpened||this.isEnded?u.length===1&&this._startQueue(i):this._openPromise.then(function(){u.length===1&&o._startQueue(i)}),l.promise}},{key:"_enqueueBlockingOp",value:function(){var a=Tt(Ie().mark(function t(e,n,r){var o=this,u,l;return Ie().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(this.mediaSource){h.next=2;break}return h.abrupt("return",Promise.resolve());case 2:if(u=Object.keys(this._sourceBuffer),u.length){h.next=5;break}return h.abrupt("return",e());case 5:return l=[],u.forEach(function(f){var d=o._queue[f],v=pi();l.push(v),d.push({exec:function(){v.resolve()},promise:v,opName:n,context:r}),d.length===1&&o._startQueue(f)}),h.abrupt("return",Promise.all(l).then(function(){try{return e()}finally{u.forEach(function(f){var d=o._queue[f],v=o._sourceBuffer[f];d==null||d.shift(),(!v||!v.updating)&&o._startQueue(f)})}}));case 8:case"end":return h.stop()}},t,this)}));function i(t,e,n){return a.apply(this,arguments)}return i}()},{key:"_startQueue",value:function(i){var t=this._queue[i];if(t){var e=t[0];if(e&&!this._mseFullFlag[i])try{e.exec()}catch(n){n&&n.message&&n.message.indexOf("SourceBuffer is full")>=0?(this._mseFullFlag[i]=!0,e.context&&Zt(e.context)==="object"&&(e.context.isFull=!0),this._logger.error("[MSE error],  context,",e.context," ,name,",e.opName,",err,SourceBuffer is full"),e.promise.reject(new Ce(ce.MEDIA,ce.SUB_TYPES.MSE_FULL,n))):(this._logger.error(n),e.promise.reject(n.constructor===Ce?n:new Ce(ce.MEDIA,ce.SUB_TYPES.MSE_OTHER,n)),t.shift(),this._startQueue(i))}}}},{key:"setTimeoffset",value:function(i,t,e){var n=this;return this._enqueueOp(i,function(){t<0&&(t+=.001),n._sourceBuffer[i].timestampOffset=t,n._onSBUpdateEnd(i)},"setTimeoffset",e)}},{key:"abort",value:function(i,t){var e=this;return this.isOpened?this._enqueueOp(i,function(){e._sourceBuffer[i].abort(),e._onSBUpdateEnd(i)},"abort",t):Promise.resolve()}}],[{key:"isSupported",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"',t=sa();if(!t)return!1;try{return t.isTypeSupported(i)}catch(e){return this._logger.error(i,e),!1}}},{key:"isMMSOnly",value:function(){return typeof ManagedMediaSource<"u"&&typeof MediaSource>"u"}},{key:"getDefaultConfig",value:function(){return{openLog:!1,preferMMS:!1}}}]),s}();N(Ye,"VIDEO","video");N(Ye,"AUDIO","audio");var Xt={FETCH:"fetch",XHR:"xhr"},Ui={ARRAY_BUFFER:"arraybuffer",TEXT:"text",JSON:"json"},ft=function(s){Ki(i,s);var a=Yi(i);function i(t,e,n,r){var o;return Qe(this,i),o=a.call(this,r),N(J(o),"retryCount",0),N(J(o),"isTimeout",!1),N(J(o),"loaderType",Xt.FETCH),N(J(o),"startTime",0),N(J(o),"endTime",0),N(J(o),"options",{}),o.url=t,o.request=e,o.response=n,o}return Je(i)}(Cn(Error)),yo=Object.prototype.toString;function nd(s){return s!==null&&Zt(s)==="object"}function aa(s){if(yo.call(s)!=="[object Object]")return!1;var a=Object.getPrototypeOf(s);return a===null||a===Object.prototype}function rd(s){return yo.call(s)==="[object Date]"}function _o(s){if(!(!s||s[0]===null||s[0]===void 0||s[0]===0&&(s[1]===null||s[1]===void 0))){var a="bytes="+s[0]+"-";return s[1]&&(a+=s[1]),a}}function oa(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function bo(s,a){if(s){if(!a)return s;var i,t=Object.keys(a).map(function(n){if(i=a[n],i!=null)return Array.isArray(i)?n=n+"[]":i=[i],i.map(function(r){return rd(r)?r=r.toISOString():nd(r)&&(r=JSON.stringify(r)),"".concat(oa(n),"=").concat(oa(r))}).join("&")}).filter(Boolean).join("&");if(t){var e=s.indexOf("#");e!==-1&&(s=s.slice(0,e)),s+=(s.indexOf("?")===-1?"?":"&")+t}return s}}function Lr(s,a,i,t,e,n,r,o,u,l,c){e=e!=null?parseFloat(e):null,t=parseInt(t||"0",10),Number.isNaN(t)&&(t=0);var h={range:u,vid:l,index:o,contentLength:t,age:e,startTime:n,firstByteTime:r,endTime:Date.now(),priOptions:c};return{data:s,done:a,options:h,response:i}}function Dr(s,a){return Math.round(s*8*1e3/a/1024)}var ee={ERROR:"error",TTFB:"core.ttfb",LOAD_START:"core.loadstart",LOAD_RESPONSE_HEADERS:"core.loadresponseheaders",LOAD_COMPLETE:"core.loadcomplete",LOAD_RETRY:"core.loadretry",SOURCEBUFFER_CREATED:"core.sourcebuffercreated",MEDIASOURCE_OPENED:"core.mediasourceopened",ANALYZE_DURATION_EXCEEDED:"core.analyzedurationexceeded",APPEND_BUFFER:"core.appendbuffer",REMOVE_BUFFER:"core.removebuffer",BUFFEREOS:"core.buffereos",KEYFRAME:"core.keyframe",CHASEFRAME:"core.chaseframe",METADATA_PARSED:"core.metadataparsed",SEI:"core.sei",SEI_IN_TIME:"core.seiintime",FLV_SCRIPT_DATA:"core.flvscriptdata",LOWDECODE:"core.lowdecode",SWITCH_URL_SUCCESS:"core.switchurlsuccess",SWITCH_URL_FAILED:"core.switchurlfailed",SPEED:"core.speed",HLS_MANIFEST_LOADED:"core.hlsmanifestloaded",HLS_LEVEL_LOADED:"core.hlslevelloaded",DEMUXED_TRACK:"core.demuxedtrack",STREAM_EXCEPTION:"core.streamexception",LARGE_AV_FIRST_FRAME_GAP_DETECT:"LARGE_AV_FIRST_FRAME_GAP_DETECT",LARGE_VIDEO_DTS_GAP_DETECT:"LARGE_VIDEO_DTS_GAP_DETECT",LARGE_AUDIO_DTS_GAP_DETECT:"LARGE_AUDIO_DTS_GAP_DETECT",AUDIO_GAP_DETECT:"AUDIO_GAP_DETECT",AUDIO_OVERLAP_DETECT:"AUDIO_OVERLAP_DETECT",MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT:"MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT",REAL_TIME_SPEED:"real_time_speed"},ua=2*1024*1024,Ir=function(s){Ki(i,s);var a=Yi(i);function i(){var t;return Qe(this,i),t=a.call(this),N(J(t),"_abortController",null),N(J(t),"_timeoutTimer",null),N(J(t),"_reader",null),N(J(t),"_response",null),N(J(t),"_aborted",!1),N(J(t),"_index",-1),N(J(t),"_range",null),N(J(t),"_receivedLength",0),N(J(t),"_running",!1),N(J(t),"_logger",null),N(J(t),"_vid",""),N(J(t),"_onProcessMinLen",0),N(J(t),"_onCancel",null),N(J(t),"_priOptions",null),t}return Je(i,[{key:"load",value:function(e){var n,r=this,o=e.url,u=e.vid,l=e.timeout,c=e.responseType,h=e.onProgress,f=e.index,d=e.onTimeout,v=e.onCancel,m=e.range,g=e.transformResponse,b=e.request,k=e.params,E=e.logger,w=e.method,C=e.headers,B=e.body,L=e.mode,D=e.credentials,O=e.cache,R=e.redirect,j=e.referrer,y=e.referrerPolicy,_=e.onProcessMinLen,S=e.priOptions;this._logger=E,this._aborted=!1,this._onProcessMinLen=_,this._onCancel=v,this._abortController=typeof AbortController<"u"&&new AbortController,this._running=!0,this._index=f,this._range=m||[0,0],this._vid=u||o,this._priOptions=S||{};var P={method:w,headers:C,body:B,mode:L,credentials:D,cache:O,redirect:R,referrer:j,referrerPolicy:y,signal:(n=this._abortController)===null||n===void 0?void 0:n.signal},T=!1;clearTimeout(this._timeoutTimer),o=bo(o,k);var M=_o(m);M&&(b?C=b.headers:C=P.headers=P.headers||(Headers?new Headers:{}),Headers&&C instanceof Headers?C.append("Range",M):C.Range=M),l&&(this._timeoutTimer=setTimeout(function(){if(T=!0,r.cancel(),d){var K=new ft(o,P,null,"timeout");K.isTimeout=!0,d(K,{index:r._index,range:r._range,vid:r._vid,priOptions:r._priOptions})}},l));var G=Date.now();return this._logger.debug("[fetch load start], index,",f,",range,",m),new Promise(function(K,Z){fetch(b||o,b?void 0:P).then(function(){var $=Tt(Ie().mark(function be(Y){var Ht,it,Vt,ai;return Ie().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:if(clearTimeout(r._timeoutTimer),r._response=Y,!(r._aborted||!r._running)){xe.next=4;break}return xe.abrupt("return");case 4:if(g&&(Y=g(Y,o)||Y),Y.ok){xe.next=7;break}throw new ft(o,P,Y,"bad network response");case 7:if(Ht=Date.now(),c!==Ui.TEXT){xe.next=15;break}return xe.next=11,Y.text();case 11:it=xe.sent,r._running=!1,xe.next=37;break;case 15:if(c!==Ui.JSON){xe.next=22;break}return xe.next=18,Y.json();case 18:it=xe.sent,r._running=!1,xe.next=37;break;case 22:if(!h){xe.next=29;break}return r.resolve=K,r.reject=Z,r._loadChunk(Y,h,G,Ht),xe.abrupt("return");case 29:return xe.next=31,Y.arrayBuffer();case 31:it=xe.sent,it=new Uint8Array(it),r._running=!1,Vt=Date.now()-G,ai=Dr(it.byteLength,Vt),r.emit(ee.REAL_TIME_SPEED,{speed:ai,len:it.byteLength,time:Vt,vid:r._vid,index:r._index,range:r._range,priOptions:r._priOptions});case 37:r._logger.debug("[fetch load end], index,",f,",range,",m),K(Lr(it,!0,Y,Y.headers.get("Content-Length"),Y.headers.get("age"),G,Ht,f,m,r._vid,r._priOptions));case 39:case"end":return xe.stop()}},be)}));return function(be){return $.apply(this,arguments)}}()).catch(function($){var be;clearTimeout(r._timeoutTimer),r._running=!1,!(r._aborted&&!T)&&($=$ instanceof ft?$:new ft(o,P,null,(be=$)===null||be===void 0?void 0:be.message),$.startTime=G,$.endTime=Date.now(),$.isTimeout=T,$.options={index:r._index,range:r._range,vid:r._vid,priOptions:r._priOptions},Z($))})})}},{key:"cancel",value:function(){var t=Tt(Ie().mark(function n(){return Ie().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!this._aborted){o.next=2;break}return o.abrupt("return");case 2:if(this._aborted=!0,this._running=!1,!this._response){o.next=14;break}if(o.prev=5,!this._reader){o.next=9;break}return o.next=9,this._reader.cancel();case 9:o.next=13;break;case 11:o.prev=11,o.t0=o.catch(5);case 13:this._response=this._reader=null;case 14:if(this._abortController){try{this._abortController.abort()}catch{}this._abortController=null}this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions});case 16:case"end":return o.stop()}},n,this,[[5,11]])}));function e(){return t.apply(this,arguments)}return e}()},{key:"_loadChunk",value:function(e,n,r,o){var u=this;if(!e.body||!e.body.getReader){this._running=!1;var l=new ft(e.url,"",e,"onProgress of bad response.body.getReader");l.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this.reject(l);return}this._onProcessMinLen>0&&(this._cache=new Uint8Array(ua),this._writeIdx=0);var c=this._reader=e.body.getReader(),h,f,d,v=function(){var m=Tt(Ie().mark(function g(){var b,k,E,w,C,B,L,D;return Ie().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return f=Date.now(),R.prev=1,R.next=4,c.read();case 4:h=R.sent,d=Date.now(),R.next=13;break;case 8:return R.prev=8,R.t0=R.catch(1),d=Date.now(),u._aborted||(u._running=!1,R.t0.options={index:u._index,range:u._range,vid:u._vid,priOptions:u._priOptions},u.reject(R.t0)),R.abrupt("return");case 13:if(k=((b=u._range)===null||b===void 0?void 0:b.length)>0?u._range[0]:0,E=k+u._receivedLength,!u._aborted){R.next=19;break}return u._running=!1,n(void 0,!1,{range:[E,E],vid:u._vid,index:u._index,startTime:f,endTime:d,st:r,firstByteTime:o,priOptions:u._priOptions},e),R.abrupt("return");case 19:w=h.value?h.value.byteLength:0,u._receivedLength+=w,u._logger.debug("【fetchLoader,onProgress call】,task,",u._range,", start,",E,", end,",k+u._receivedLength,", done,",h.done),u._onProcessMinLen>0?u._writeIdx+w>=u._onProcessMinLen||h.done?(C=new Uint8Array(u._writeIdx+w),C.set(u._cache.slice(0,u._writeIdx),0),w>0&&C.set(h.value,u._writeIdx),u._writeIdx=0,u._logger.debug("【fetchLoader,onProgress enough】,done,",h.done,",len,",C.byteLength,", writeIdx,",u._writeIdx)):w>0&&u._writeIdx+w<ua?(u._cache.set(h.value,u._writeIdx),u._writeIdx+=w,u._logger.debug("【fetchLoader,onProgress cache】,len,",w,", writeIdx,",u._writeIdx)):w>0&&(B=new Uint8Array(u._writeIdx+w+2048),u._logger.debug("【fetchLoader,onProgress extra start】,size,",u._writeIdx+w+2048,", datalen,",w,", writeIdx,",u._writeIdx),B.set(u._cache.slice(0,u._writeIdx),0),w>0&&B.set(h.value,u._writeIdx),u._writeIdx+=w,delete u._cache,u._cache=B,u._logger.debug("【fetchLoader,onProgress extra end】,len,",w,", writeIdx,",u._writeIdx)):C=h.value,(C&&C.byteLength>0||h.done)&&n(C,h.done,{range:[u._range[0]+u._receivedLength-(C?C.byteLength:0),u._range[0]+u._receivedLength],vid:u._vid,index:u._index,startTime:f,endTime:d,st:r,firstByteTime:o,priOptions:u._priOptions},e),h.done?(L=Date.now()-r,D=Dr(u._receivedLength,L),u.emit(ee.REAL_TIME_SPEED,{speed:D,len:u._receivedLength,time:L,vid:u._vid,index:u._index,range:u._range,priOptions:u._priOptions}),u._running=!1,u._logger.debug("[fetchLoader onProgress end],task,",u._range,",done,",h.done),u.resolve(Lr(h,!0,e,e.headers.get("Content-Length"),e.headers.get("age"),r,o,u._index,u._range,u._vid,u._priOptions))):v();case 25:case"end":return R.stop()}},g,null,[[1,8]])}));return function(){return m.apply(this,arguments)}}();v()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}}],[{key:"isSupported",value:function(){return typeof fetch<"u"}}]),i}(ki);function sd(s){return Bi({loaderType:Xt.FETCH,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:Ui.TEXT,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0,onProcessMinLen:0},s)}var ad=function(s){Ki(i,s);var a=Yi(i);function i(){var t;return Qe(this,i),t=a.call(this),N(J(t),"_xhr",null),N(J(t),"_aborted",!1),N(J(t),"_timeoutTimer",null),N(J(t),"_range",null),N(J(t),"_receivedLength",0),N(J(t),"_url",null),N(J(t),"_onProgress",null),N(J(t),"_index",-1),N(J(t),"_headers",null),N(J(t),"_currentChunkSizeKB",384),N(J(t),"_timeout",null),N(J(t),"_xhr",null),N(J(t),"_withCredentials",null),N(J(t),"_startTime",-1),N(J(t),"_loadCompleteResolve",null),N(J(t),"_loadCompleteReject",null),N(J(t),"_runing",!1),N(J(t),"_logger",!1),N(J(t),"_vid",""),N(J(t),"_responseType",void 0),N(J(t),"_credentials",void 0),N(J(t),"_method",void 0),N(J(t),"_transformResponse",void 0),N(J(t),"_firstRtt",void 0),N(J(t),"_onCancel",null),N(J(t),"_priOptions",null),t}return Je(i,[{key:"load",value:function(e){var n=this;clearTimeout(this._timeoutTimer),this._logger=e.logger,this._range=e.range,this._onProgress=e.onProgress,this._index=e.index,this._headers=e.headers,this._withCredentials=e.credentials==="include"||e.credentials==="same-origin",this._body=e.body||null,e.method&&(this._method=e.method),this._timeout=e.timeout||null,this._runing=!0,this._vid=e.vid||e.url,this._responseType=e.responseType,this._firstRtt=-1,this._onTimeout=e.onTimeout,this._onCancel=e.onCancel,this._request=e.request,this._priOptions=e.priOptions||{},this._logger.debug("【xhrLoader task】, range",this._range),this._url=bo(e.url,e.params);var r=Date.now();return new Promise(function(o,u){n._loadCompleteResolve=o,n._loadCompleteReject=u,n._startLoad()}).catch(function(o){if(clearTimeout(n._timeoutTimer),n._runing=!1,!n._aborted)throw o=o instanceof ft?o:new ft(n._url,n._request),o.startTime=r,o.endTime=Date.now(),o.options={index:n._index,vid:n._vid,priOptions:n._priOptions},o})}},{key:"_startLoad",value:function(){var e=null;if(this._responseType===Ui.ARRAY_BUFFER&&this._range&&this._range.length>1)if(this._onProgress){this._firstRtt=-1;var n=this._currentChunkSizeKB*1024,r=this._range[0]+this._receivedLength,o=this._range[1];n<this._range[1]-r&&(o=r+n),e=[r,o],this._logger.debug("[xhr_loader->],tast :",this._range,", SubRange, ",e)}else e=this._range,this._logger.debug("[xhr_loader->],tast :",this._range,", allRange, ",e);this._internalOpen(e)}},{key:"_internalOpen",value:function(e){var n=this;try{this._startTime=Date.now();var r=this._xhr=new XMLHttpRequest;r.open(this._method||"GET",this._url,!0),r.responseType=this._responseType,this._timeout&&(r.timeout=this._timeout),r.withCredentials=this._withCredentials,r.onload=this._onLoad.bind(this),r.onreadystatechange=this._onReadyStatechange.bind(this),r.onerror=function(l){var c,h,f;n._running=!1;var d=new ft(n._url,n._request,l==null||(c=l.currentTarget)===null||c===void 0?void 0:c.response,"xhr.onerror.status:"+(l==null||(h=l.currentTarget)===null||h===void 0?void 0:h.status)+",statusText,"+(l==null||(f=l.currentTarget)===null||f===void 0?void 0:f.statusText));d.options={index:n._index,range:n._range,vid:n._vid,priOptions:n._priOptions},n._loadCompleteReject(d)},r.ontimeout=function(l){n.cancel();var c=new ft(n._url,n._request,{status:408},"timeout");n._onTimeout&&(c.isTimeout=!0,n._onTimeout(c,{index:n._index,range:n._range,vid:n._vid,priOptions:n._priOptions})),c.options={index:n._index,range:n._range,vid:n._vid,priOptions:n._priOptions},n._loadCompleteReject(c)};var o=this._headers||{},u=_o(e);u&&(o.Range=u),o&&Object.keys(o).forEach(function(l){r.setRequestHeader(l,o[l])}),this._logger.debug("[xhr.send->] tast,",this._range,",load sub range, ",e),r.send(this._body)}catch(l){l.options={index:this._index,range:e,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(l)}}},{key:"_onReadyStatechange",value:function(e){var n=e.target;n.readyState===2&&this._firstRtt<0&&(this._firstRtt=Date.now())}},{key:"_onLoad",value:function(e){var n,r=e.target.status;if(r<200||r>299){var o=new ft(this._url,null,Bi(Bi({},e.target.response),{},{status:r}),"bad response,status:"+r);return o.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(o)}var u=null,l=!1,c,h=((n=this._range)===null||n===void 0?void 0:n.length)>0?this._range[0]:0;if(this._responseType===Ui.ARRAY_BUFFER){var f,d=new Uint8Array(e.target.response);if(c=h+this._receivedLength,d&&d.byteLength>0){this._receivedLength+=d.byteLength;var v=Date.now()-this._startTime,m=Dr(this._receivedLength,v);this.emit(ee.REAL_TIME_SPEED,{speed:m,len:this._receivedLength,time:v,vid:this._vid,index:this._index,range:[c,h+this._receivedLength],priOptions:this._priOptions})}u=d,((f=this._range)===null||f===void 0?void 0:f.length)>1&&this._range[1]&&this._receivedLength<this._range[1]-this._range[0]?l=!1:l=!0,this._logger.debug("[xhr load done->], tast :",this._range,", start",c,"end ",h+this._receivedLength,",dataLen,",d?d.byteLength:0,",receivedLength",this._receivedLength,",index,",this._index,", done,",l)}else l=!0,u=e.target.response;var g={ok:r>=200&&r<300,status:r,statusText:this._xhr.statusText,url:this._xhr.responseURL,headers:this._getHeaders(this._xhr),body:this._xhr.response};this._transformResponse&&(g=this._transformResponse(g,this._url)||g),this._onProgress&&this._onProgress(u,l,{index:this._index,vid:this._vid,range:[c,h+this._receivedLength],startTime:this._startTime,endTime:Date.now(),priOptions:this._priOptions},g),l?(this._runing=!1,this._loadCompleteResolve&&this._loadCompleteResolve(Lr(this._onProgress?null:u,l,g,g.headers["content-length"],g.headers.age,this._startTime,this._firstRtt,this._index,this._range,this._vid,this._priOptions))):this._startLoad()}},{key:"cancel",value:function(){if(!this._aborted&&(this._aborted=!0,this._runing=!1,hn(ei(i.prototype),"removeAllListeners",this).call(this),this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions}),this._xhr))return this._xhr.abort()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}},{key:"_getHeaders",value:function(e){var n=e.getAllResponseHeaders().trim().split(`\r
`),r={},o=Xf(n),u;try{for(o.s();!(u=o.n()).done;){var l=u.value,c=l.split(": ");r[c[0].toLowerCase()]=c.slice(1).join(": ")}}catch(h){o.e(h)}finally{o.f()}return r}}],[{key:"isSupported",value:function(){return typeof XMLHttpRequest<"u"}}]),i}(ki),od=["retry","retryDelay","onRetryError","transformError"],ud=function(){function s(a,i){Qe(this,s),this.promise=pi(),this.alive=!!i.onProgress,!i.logger&&(i.logger=new mt("Loader")),this._loaderType=a,this._loader=a===Xt.FETCH&&typeof fetch<"u"?new Ir:new ad,this._config=i,this._retryCount=0,this._retryTimer=null,this._canceled=!1,this._retryCheckFunc=i.retryCheckFunc,this._logger=i.logger}return Je(s,[{key:"exec",value:function(){var i=this,t=this._config,e=t.retry,n=t.retryDelay,r=t.onRetryError,o=t.transformError,u=zf(t,od),l=function(){var c=Tt(Ie().mark(function h(){var f,d,v;return Ie().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.prev=0,g.next=3,i._loader.load(u);case 3:f=g.sent,i.promise.resolve(f),g.next=27;break;case 7:if(g.prev=7,g.t0=g.catch(0),i._loader.running=!1,i._logger.debug("[task request catch err]",g.t0),!i._canceled){g.next=13;break}return g.abrupt("return");case 13:if(g.t0.loaderType=i._loaderType,g.t0.retryCount=i._retryCount,d=g.t0,o&&(d=o(d)||d),r&&i._retryCount>0&&r(d,i._retryCount,{index:u.index,vid:u.vid,range:u.range,priOptions:u.priOptions}),i._retryCount++,v=!0,i._retryCheckFunc&&(v=i._retryCheckFunc(g.t0)),!(v&&i._retryCount<=e)){g.next=26;break}return clearTimeout(i._retryTimer),i._logger.debug("[task request setTimeout],retry",i._retryCount,",retry range,",u.range),i._retryTimer=setTimeout(l,n),g.abrupt("return");case 26:i.promise.reject(d);case 27:case"end":return g.stop()}},h,null,[[0,7]])}));return function(){return c.apply(this,arguments)}}();return l(),this.promise}},{key:"cancel",value:function(){var a=Tt(Ie().mark(function t(){return Ie().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return clearTimeout(this._retryTimer),this._canceled=!0,this._loader.running=!1,n.abrupt("return",this._loader.cancel());case 4:case"end":return n.stop()}},t,this)}));function i(){return a.apply(this,arguments)}return i}()},{key:"running",get:function(){return this._loader&&this._loader.running}},{key:"loader",get:function(){return this._loader}}]),s}();function ld(s){return s&&!s.paused&&!s.ended&&s.playbackRate!==0&&s.readyState!==0}function cd(s){if(!s)return{};if(typeof s.getVideoPlaybackQuality=="function"){var a=s.getVideoPlaybackQuality();return{droppedVideoFrames:a.droppedVideoFrames||a.corruptedVideoFrames,totalVideoFrames:a.totalVideoFrames,creationTime:a.creationTime}}return{droppedVideoFrames:s.webkitDroppedFrameCount,totalVideoFrames:s.webkitDecodedFrameCount,creationTime:performance.now()}}function fn(){for(var s=arguments.length,a=new Array(s),i=0;i<s;i++)a[i]=arguments[i];if(a=a.filter(Boolean),a.length<2)return a[0];var t=new Uint8Array(a.reduce(function(n,r){return n+r.byteLength},0)),e=0;return a.forEach(function(n){t.set(n,e),e+=n.byteLength}),t}function hd(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return new Promise(function(a){return setTimeout(a,s)})}var bi=function(s){Ki(i,s);var a=Yi(i);function i(t){var e;return Qe(this,i),e=a.call(this,t),N(J(e),"type",Xt.FETCH),N(J(e),"_queue",[]),N(J(e),"_alive",[]),N(J(e),"_currentTask",null),N(J(e),"_finnalUrl",""),N(J(e),"_config",void 0),e._config=sd(t),(e._config.loaderType===Xt.XHR||!Ir.isSupported())&&(e.type=Xt.XHR),e.log=t.logger,e}return Je(i,[{key:"isFetch",value:function(){return this.type===Xt.FETCH}},{key:"load",value:function(e){var n=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};typeof e=="string"||!e?r.url=e||r.url||this._config.url:r=e,r=Object.assign({},this._config,r),r.params&&(r.params=Object.assign({},r.params)),r.headers&&aa(r.headers)&&(r.headers=Object.assign({},r.headers)),r.body&&aa(r.body)&&(r.body=Object.assign({},r.body)),r.transformRequest&&(r=r.transformRequest(r)||r),r.logger=this.log;var o=new ud(this.type,r);return o.loader.on(ee.REAL_TIME_SPEED,function(u){n.emit(ee.REAL_TIME_SPEED,u)}),this._queue.push(o),this._queue.length===1&&(!this._currentTask||!this._currentTask.running)&&this._processTask(),o.promise}},{key:"cancel",value:function(){var t=Tt(Ie().mark(function n(){var r;return Ie().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return r=this._queue.map(function(l){return l.cancel()}).concat(this._alive.map(function(l){return l.cancel()})),this._currentTask&&r.push(this._currentTask.cancel()),this._queue=[],this._alive=[],u.next=6,Promise.all(r);case 6:return u.next=8,hd();case 8:case"end":return u.stop()}},n,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"_processTask",value:function(){var e=this;if(this._currentTask=this._queue.shift(),!!this._currentTask){this._currentTask.alive&&this._alive.push(this._currentTask);var n=this._currentTask.exec().catch(function(r){});n&&typeof n.finally=="function"&&n.finally(function(){var r,o;(r=e._currentTask)!==null&&r!==void 0&&r.alive&&((o=e._alive)===null||o===void 0?void 0:o.length)>0&&(e._alive=e._alive.filter(function(u){return u&&u!==e._currentTask})),e._processTask()})}}}],[{key:"isFetchSupport",value:function(){return Ir.isSupported()}}]),i}(ki),fd=function(){function s(){Qe(this,s),N(this,"_prevCurrentTime",0)}return Je(s,[{key:"do",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3,e=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;if(i){var r=i.currentTime,o=0;if(this._prevCurrentTime===r){var u=Ue.info(Ue.get(i),r);if(!u.buffers.length)return;e&&u.nextStart||u.nextStart&&u.nextStart-r<t?o=u.nextStart+.1:u.end&&u.end-r>n&&!i.seeking&&(o=r+.1)}this._prevCurrentTime=r,o&&r!==o&&(i.currentTime=o)}}}]),s}(),dd=function(){function s(a){var i=this;Qe(this,s),N(this,"_seiSet",new Set),this.emitter=a,a.on(ee.SEI,function(t){t&&i._seiSet.add(t)})}return Je(s,[{key:"throw",value:function(i,t){var e=this;if(!(i==null||!this._seiSet.size)){var n=i-.2,r=i+.2,o=[];this._seiSet.forEach(function(u){u.time>=n&&u.time<=r&&o.push(u)}),o.forEach(function(u){e._seiSet.delete(u),e.emitter.emit(ee.SEI_IN_TIME,u)}),t&&this._seiSet.forEach(function(u){u.time<i-5&&e._seiSet.delete(u)})}}},{key:"reset",value:function(){this._seiSet.clear()}}]),s}(),vd=1e3,pd=50,gd=3,md=3e3,yd=function(){function s(a){Qe(this,s),N(this,"_chunkSpeed",0),N(this,"_chunkCache",[]),N(this,"_speeds",[]),N(this,"_totalSize",0),N(this,"_totalCost",0),this._opts=a||{}}return Je(s,[{key:"addRecord",value:function(i,t){!i||!t||(this._speeds.push(8e3*i/t),this._speeds=this._speeds.slice(-gd))}},{key:"addChunkRecord",value:function(i,t){var e,n;if(!(!i||!t||i<(((e=this._opts)===null||e===void 0?void 0:e.skipChunkSize)||vd))){this._totalSize+=i,this._totalCost+=t,this._chunkSpeed=8e3*i/t,this._chunkCache.push({size:i,duration:t,timestamp:performance.now()});var r=((n=this._opts)===null||n===void 0?void 0:n.chunkCountForSpeed)||pd;this._chunkCache.length>r&&(this._chunkCache=this._chunkCache.slice(-r))}}},{key:"getAvgSpeed",value:function(){var i;if(!this._chunkCache.length&&!this._speeds.length)return 0;if(this._speeds.length)return this._speeds.reduce(function(o,u){return o+=u})/this._speeds.length;var t=this._chunkCache[this._chunkCache.length-1],e=performance.now()-t.timestamp;e>(((i=this._opts)===null||i===void 0?void 0:i.longtimeNoReceived)||md)&&this._chunkCache.push({size:0,duration:e,timestamp:performance.now()});var n=this._chunkCache.reduce(function(o,u){return o+=u.size},0),r=this._chunkCache.reduce(function(o,u){return o+=u.duration},0);return 8e3*n/r}},{key:"getLatestSpeed",value:function(){return!this._chunkCache.length&&!this._speeds.length?0:this._speeds.length?this._speeds[this._speeds.length-1]:this._chunkSpeed}},{key:"getTotalSize",value:function(){return this._totalSize}},{key:"getTotalCost",value:function(){return this._totalCost}},{key:"reset",value:function(){this._chunkCache=[],this._speeds=[],this._totalSize=0,this._totalCost=0}}]),s}(),la=function(){function s(a){Qe(this,s),N(this,"encodeType",""),N(this,"audioCodec",""),N(this,"videoCodec",""),N(this,"domain",""),N(this,"fps",0),N(this,"bitrate",0),N(this,"width",0),N(this,"height",0),N(this,"samplerate",0),N(this,"channelCount",0),N(this,"gop",0),N(this,"_bitsAccumulateSize",0),N(this,"_bitsAccumulateDuration",0),N(this,"_startGopId",-1),this._timescale=a}return Je(s,[{key:"getStats",value:function(){return{encodeType:this.encodeType,audioCodec:this.audioCodec,videoCodec:this.videoCodec,domain:this.domain,fps:this.fps,bitrate:this.bitrate,width:this.width,height:this.height,samplerate:this.samplerate,channelCount:this.channelCount,gop:this.gop}}},{key:"setEncodeType",value:function(i){this.encodeType=i}},{key:"setFpsFromScriptData",value:function(i){var t,e=i.data,n=e==null||(t=e.onMetaData)===null||t===void 0?void 0:t.framerate;n&&n>0&&n<100&&(this.fps=n)}},{key:"setVideoMeta",value:function(i){if(this.width=i.width,this.height=i.height,this.videoCodec=i.codec,this.encodeType=i.codecType,i.fpsNum&&i.fpsDen){var t=i.fpsNum/i.fpsDen;t>0&&t<100&&(this.fps=t)}}},{key:"setAudioMeta",value:function(i){this.audioCodec=i.codec,this.samplerate=i.sampleRate,this.channelCount=i.channelCount}},{key:"setDomain",value:function(i){this.domain=i.split("/").slice(2,3)[0]}},{key:"updateBitrate",value:function(i){var t=this;if((!this.fps||this.fps>=100)&&i.length){var e=i.reduce(function(n,r){return n+=r.duration},0)/i.length;this.fps=Math.round(this._timescale/e)}i.forEach(function(n){t._startGopId===-1&&(t._startGopId=n.gopId),n.gopId===t._startGopId&&t.gop++,t._bitsAccumulateDuration+=n.duration/(t._timescale/1e3),t._bitsAccumulateSize+=n.units.reduce(function(r,o){return r+=o.length},0),t._bitsAccumulateDuration>=1e3&&(t.bitrate=t._bitsAccumulateSize*8,t._bitsAccumulateDuration=0,t._bitsAccumulateSize=0)})}}]),s}(),_d=function(){function s(a){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;Qe(this,s),N(this,"_core",null),N(this,"_samples",[]),this._core=a,this._timescale=i,this._stats=new la(i),this._bindEvents()}return Je(s,[{key:"getStats",value:function(){var i,t,e,n,r,o,u,l,c,h,f,d=((i=this._core)===null||i===void 0?void 0:i.media)||{},v=d.currentTime,m=v===void 0?0:v,g=d.decodeFps,b=g===void 0?0:g;return Bi(Bi({},this._stats.getStats()),{},{downloadSpeed:((t=this._core)===null||t===void 0||(e=t.speedInfo)===null||e===void 0?void 0:e.call(t).speed)||0,avgSpeed:((n=this._core)===null||n===void 0||(r=n.speedInfo)===null||r===void 0?void 0:r.call(n).avgSpeed)||0,totalReceivedByte:((o=this._core)===null||o===void 0||(u=o.speedInfo)===null||u===void 0?void 0:u.call(o).totalSize)||0,totalReceivedCost:((l=this._core)===null||l===void 0||(c=l.speedInfo)===null||c===void 0?void 0:c.call(l).totalCost)||0,currentTime:m,bufferEnd:((h=this._core)===null||h===void 0||(f=h.bufferInfo())===null||f===void 0?void 0:f.remaining)||0,decodeFps:b})}},{key:"_bindEvents",value:function(){var i=this;this._core.on(ee.DEMUXED_TRACK,function(t){var e=t.videoTrack;return i._stats.updateBitrate(e.samples)}),this._core.on(ee.FLV_SCRIPT_DATA,function(t){i._stats.setFpsFromScriptData(t)}),this._core.on(ee.METADATA_PARSED,function(t){t.type==="video"?i._stats.setVideoMeta(t.track):i._stats.setAudioMeta(t.track)}),this._core.on(ee.TTFB,function(t){i._stats.setDomain(t.responseUrl)})}},{key:"reset",value:function(){this._samples=[],this._stats=new la(this._timescale)}}]),s}();function bd(s,a){var i=s==null?null:typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(i!=null){var t,e,n,r,o=[],u=!0,l=!1;try{if(n=(i=i.call(s)).next,a!==0)for(;!(u=(t=n.call(i)).done)&&(o.push(t.value),o.length!==a);u=!0);}catch(c){l=!0,e=c}finally{try{if(!u&&i.return!=null&&(r=i.return(),Object(r)!==r))return}finally{if(l)throw e}}return o}}function Ae(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")}function ca(s,a){for(var i=0;i<a.length;i++){var t=a[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(s,So(t.key),t)}}function Pe(s,a,i){return a&&ca(s.prototype,a),i&&ca(s,i),Object.defineProperty(s,"prototype",{writable:!1}),s}function F(s,a,i){return a=So(a),a in s?Object.defineProperty(s,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):s[a]=i,s}function Sd(s,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(a&&a.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),a&&Or(s,a)}function An(s){return An=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},An(s)}function Or(s,a){return Or=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Or(s,a)}function Ed(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function kd(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function Td(s,a){if(a&&(typeof a=="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return kd(s)}function wd(s){var a=Ed();return function(){var t=An(s),e;if(a){var n=An(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Td(this,e)}}function Cd(s,a){return Pd(s)||bd(s,a)||ts(s,a)||Dd()}function Xe(s){return Ad(s)||xd(s)||ts(s)||Ld()}function Ad(s){if(Array.isArray(s))return Rr(s)}function Pd(s){if(Array.isArray(s))return s}function xd(s){if(typeof Symbol<"u"&&s[Symbol.iterator]!=null||s["@@iterator"]!=null)return Array.from(s)}function ts(s,a){if(s){if(typeof s=="string")return Rr(s,a);var i=Object.prototype.toString.call(s).slice(8,-1);if(i==="Object"&&s.constructor&&(i=s.constructor.name),i==="Map"||i==="Set")return Array.from(s);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Rr(s,a)}}function Rr(s,a){(a==null||a>s.length)&&(a=s.length);for(var i=0,t=new Array(a);i<a;i++)t[i]=s[i];return t}function Ld(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Dd(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Id(s,a){var i=typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(!i){if(Array.isArray(s)||(i=ts(s))||a){i&&(s=i);var t=0,e=function(){};return{s:e,n:function(){return t>=s.length?{done:!0}:{done:!1,value:s[t++]}},e:function(u){throw u},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var n=!0,r=!1,o;return{s:function(){i=i.call(s)},n:function(){var u=i.next();return n=u.done,u},e:function(u){r=!0,o=u},f:function(){try{!n&&i.return!=null&&i.return()}finally{if(r)throw o}}}}function Od(s,a){if(typeof s!="object"||s===null)return s;var i=s[Symbol.toPrimitive];if(i!==void 0){var t=i.call(s,a||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}function So(s){var a=Od(s,"string");return typeof a=="symbol"?a:String(a)}var Rt={VIDEO:"video",AUDIO:"audio",METADATA:"metadata"},Mt={AV1:"av1",AVC:"avc",HEVC:"hevc"},It={AAC:"aac",G711PCMA:"g7110a",G711PCMU:"g7110m",OPUS:"opus"},rt={LARGE_AV_SHIFT:"LARGE_AV_SHIFT",LARGE_VIDEO_GAP:"LARGE_VIDEO_GAP",LARGE_VIDEO_GAP_BETWEEN_CHUNK:"LARGE_VIDEO_GAP_BETWEEN_CHUNK",LARGE_AUDIO_GAP:"LARGE_AUDIO_GAP",AUDIO_FILLED:"AUDIO_FILLED",AUDIO_DROPPED:"AUDIO_DROPPED"},Eo=function(){function s(){Ae(this,s),F(this,"id",1),F(this,"type",Rt.VIDEO),F(this,"codecType",Mt.AVC),F(this,"pid",-1),F(this,"hvcC",void 0),F(this,"codec",""),F(this,"timescale",0),F(this,"formatTimescale",0),F(this,"sequenceNumber",0),F(this,"baseMediaDecodeTime",0),F(this,"baseDts",0),F(this,"duration",0),F(this,"warnings",[]),F(this,"samples",[]),F(this,"pps",[]),F(this,"sps",[]),F(this,"vps",[]),F(this,"fpsNum",0),F(this,"fpsDen",0),F(this,"sarRatio",[]),F(this,"width",0),F(this,"height",0),F(this,"nalUnitSize",4),F(this,"present",!1),F(this,"isVideoEncryption",!1),F(this,"isAudioEncryption",!1),F(this,"isVideo",!0),F(this,"lastKeyFrameDts",0),F(this,"kid",null),F(this,"pssh",null),F(this,"ext",void 0)}return Pe(s,[{key:"reset",value:function(){this.sequenceNumber=this.width=this.height=this.fpsDen=this.fpsNum=this.duration=this.baseMediaDecodeTime=this.timescale=0,this.codec="",this.present=!1,this.pid=-1,this.pps=[],this.sps=[],this.vps=[],this.sarRatio=[],this.samples=[],this.warnings=[],this.hvcC=null}},{key:"firstDts",get:function(){return this.samples.length?this.samples[0].dts:null}},{key:"firstPts",get:function(){return this.samples.length?this.samples[0].pts:null}},{key:"samplesDuration",get:function(){if(this.samples.length>0){var i=this.samples[0],t=this.samples[this.samples.length-1];return t.dts-i.dts+t.duration}return 0}},{key:"exist",value:function(){return/av01/.test(this.codec)?!0:!!(this.pps.length&&this.sps.length&&this.codec)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isVideoEncryption}}]),s}(),ko=function(){function s(){Ae(this,s),F(this,"id",2),F(this,"type",Rt.AUDIO),F(this,"codecType",It.AAC),F(this,"pid",-1),F(this,"codec",""),F(this,"sequenceNumber",0),F(this,"sampleDuration",0),F(this,"timescale",0),F(this,"formatTimescale",0),F(this,"baseMediaDecodeTime",0),F(this,"duration",0),F(this,"warnings",[]),F(this,"samples",[]),F(this,"baseDts",0),F(this,"sampleSize",16),F(this,"sampleRate",0),F(this,"channelCount",0),F(this,"objectType",0),F(this,"sampleRateIndex",0),F(this,"config",[]),F(this,"present",!1),F(this,"isVideoEncryption",!1),F(this,"isAudioEncryption",!1),F(this,"kid",null),F(this,"ext",void 0)}return Pe(s,[{key:"reset",value:function(){this.sequenceNumber=0,this.timescale=0,this.sampleDuration=0,this.sampleRate=0,this.channelCount=0,this.baseMediaDecodeTime=0,this.present=!1,this.pid=-1,this.codec="",this.samples=[],this.config=[],this.warnings=[]}},{key:"exist",value:function(){return!!(this.sampleRate&&this.channelCount&&this.codec&&(this.codecType===It.AAC||this.codecType===It.G711PCMA||this.codecType===It.G711PCMU||this.codecType===It.OPUS))}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isAudioEncryption}},{key:"firstDts",get:function(){return this.samples.length?this.samples[0].dts:null}},{key:"firstPts",get:function(){return this.samples.length?this.samples[0].pts:null}},{key:"samplesDuration",get:function(){if(this.samples.length>0){var i=this.samples[0],t=this.samples[this.samples.length-1];return t.dts-i.dts+t.duration}return 0}}]),s}(),Mr=function(){function s(a,i,t){Ae(this,s),F(this,"flag",{}),F(this,"keyframe",!1),F(this,"gopId",0),F(this,"duration",0),F(this,"size",0),F(this,"units",[]),F(this,"chromaFormat",420),this.originPts=this.pts=a,this.originDts=this.dts=i,t&&(this.units=t)}return Pe(s,[{key:"cts",get:function(){return this.pts-this.dts}},{key:"setToKeyframe",value:function(){this.keyframe=!0,this.flag.dependsOn=2,this.flag.isNonSyncSample=0}}]),s}(),Li=Pe(function s(a,i,t,e){Ae(this,s),F(this,"duration",1024),F(this,"flag",{dependsOn:2,isNonSyncSample:0}),F(this,"keyframe",!0),this.originPts=this.pts=this.dts=a,this.data=i,this.size=i.byteLength,this.sampleOffset=e,t&&(this.duration=t)}),Rd=Pe(function s(a,i){Ae(this,s),F(this,"time",0),this.data=a,this.originPts=this.pts=i}),Md=function(s){Sd(i,s);var a=wd(i);function i(){return Ae(this,i),a.apply(this,arguments)}return Pe(i)}(Rd),To=function(){function s(){Ae(this,s),F(this,"id",3),F(this,"type",Rt.METADATA),F(this,"timescale",0),F(this,"flvScriptSamples",[]),F(this,"seiSamples",[])}return Pe(s,[{key:"exist",value:function(){return!!((this.flvScriptSamples.length||this.seiSamples.length)&&this.timescale)}},{key:"reset",value:function(){this.timescale=0,this.flvScriptSamples=[],this.seiSamples=[]}},{key:"hasSample",value:function(){return!!(this.flvScriptSamples.length||this.seiSamples.length)}}]),s}(),Pn=function(){function s(a){Ae(this,s),this.name=a||"",this._prefix="[".concat(this.name,"]")}return Pe(s,[{key:"warn",value:function(){var i;if(!s.disabled){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];(i=console).warn.apply(i,[this._prefix].concat(e))}}}],[{key:"enable",value:function(){s.disabled=!1}},{key:"disable",value:function(){s.disabled=!0}}]),s}();F(Pn,"disabled",!0);var Fn=typeof window<"u",is=Fn&&navigator.userAgent.toLocaleLowerCase(),Nd=Fn&&/^((?!chrome|android).)*safari/.test(is),Bd=Fn&&is.includes("firefox"),Fd=Fn&&is.includes("android"),St=function(){function s(){Ae(this,s)}return Pe(s,null,[{key:"getRateIndexByRate",value:function(i){return s.FREQ.indexOf(i)}},{key:"parseADTS",value:function(i,t){for(var e=i.length,n=0;n+2<e&&!(i[n]===255&&(i[n+1]&246)===240);)n++;if(!(n>=e)){var r=n,o=[],u=(i[n+2]&60)>>>2,l=s.FREQ[u];if(!l)throw new Error("Invalid sampling index: ".concat(u));for(var c=((i[n+2]&192)>>>6)+1,h=(i[n+2]&1)<<2|(i[n+3]&192)>>>6,f=s._getConfig(u,h,c),d=f.config,v=f.codec,m,g,b=0,k=s.getFrameDuration(l);n+7<e;){if(i[n]!==255||(i[n+1]&246)!==240){n++;continue}if(g=(i[n+3]&3)<<11|i[n+4]<<3|(i[n+5]&224)>>5,!g||e-n<g)break;m=(~i[n+1]&1)*2,o.push({pts:t+b*k,data:i.subarray(n+7+m,n+g)}),b++,n+=g}return{skip:r,remaining:n>=e?void 0:i.subarray(n),frames:o,samplingFrequencyIndex:u,sampleRate:l,objectType:c,channelCount:h,codec:v,config:d,originCodec:"mp4a.40.".concat(c)}}}},{key:"parseAudioSpecificConfig",value:function(i){if(i.length){var t=i[0]>>>3,e=(i[0]&7)<<1|i[1]>>>7,n=(i[1]&120)>>>3,r=s.FREQ[e];if(r){var o=s._getConfig(e,n,t),u=o.config,l=o.codec;return{samplingFrequencyIndex:e,sampleRate:r,objectType:t,channelCount:n,config:u,codec:l,originCodec:"mp4a.40.".concat(t)}}}}},{key:"getFrameDuration",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:9e4;return 1024*t/i}},{key:"_getConfig",value:function(i,t,e){var n=[],r,o;return Bd?i>=6?(r=5,o=i-3):(r=2,o=i):Fd?(r=2,o=i):(r=e===2||e===5?e:5,o=i,i>=6?o=i-3:t===1&&(r=2,o=i)),n[0]=r<<3,n[0]|=(i&14)>>1,n[1]=(i&1)<<7,n[1]|=t<<3,r===5&&(n[1]|=(o&14)>>1,n[2]=(o&1)<<7,n[2]|=8,n[3]=0),{config:n,codec:"mp4a.40.".concat(r)}}},{key:"getSilentFrame",value:function(i,t){switch(i){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}]),s}();F(St,"FREQ",[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]);function Ze(){for(var s=arguments.length,a=new Array(s),i=0;i<s;i++)a[i]=arguments[i];a=a.filter(Boolean);var t=new Uint8Array(a.reduce(function(n,r){return n+r.byteLength},0)),e=0;return a.forEach(function(n){t.set(n,e),e+=n.byteLength}),t}var Ud=Math.pow(2,32);function ke(s){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(s[a]<<8)+(s[a+1]||0)}function Hd(s){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(s[a]<<16)+(s[a+1]<<8)+(s[a+2]||0)}function z(s){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(s[a]<<24>>>0)+(s[a+1]<<16)+(s[a+2]<<8)+(s[a+3]||0)}function Wt(s){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return z(s,a)*Ud+z(s,a+4)}function wo(s){for(var a="avc1.",i,t=0;t<3;t++)i=s[t].toString(16),i.length<2&&(i="0".concat(i)),a+=i;return a}function ha(s){if(!Array.isArray(s)){for(var a=[],i="",t=0;t<s.length;t++)t%2&&(i=s[t-1]+s[t],a.push(parseInt(i,16)),i="");return a}return s.map(function(e){return parseInt(e,16)})}function lr(s,a){return+(s+"."+a)}function Vd(s){if(s.length<5)return 0;var a=Math.hypot(s[0],s[3]),i=Math.hypot(s[1],s[4]);return a===0||i===0?0:180*Math.atan2(s[1]/i,s[0]/a)/Math.PI}var Ot=function(){function s(){Ae(this,s)}return Pe(s,null,[{key:"parseAnnexB",value:function(i){for(var t=i.length,e=2,n=0;i[e]!==null&&i[e]!==void 0&&i[e]!==1;)e++;if(e++,n=e+2,n>=t)return[];for(var r=[];n<t;)switch(i[n]){case 0:if(i[n-1]!==0){n+=2;break}else if(i[n-2]!==0){n++;break}e!==n-2&&r.push(i.subarray(e,n-2));do n++;while(i[n]!==1&&n<t);e=n+1,n=e+2;break;case 1:if(i[n-1]!==0||i[n-2]!==0){n+=3;break}e!==n-2&&r.push(i.subarray(e,n-2)),e=n+1,n=e+2;break;default:n+=3;break}return e<t&&r.push(i.subarray(e)),r}},{key:"parseAvcC",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4;if(!(i.length<4)){for(var e=i.length,n=[],r=0,o;r+t<e;)if(o=z(i,r),t===3&&(o>>>=8),r+=t,!!o){if(r+o>e)break;n.push(i.subarray(r,r+o)),r+=o}return n}}},{key:"parseSEI",value:function(i,t){for(var e=i.length,n=t?2:1,r=0,o=0,u="";i[n]===255;)r+=255,n++;for(r+=i[n++];i[n]===255;)o+=255,n++;if(o+=i[n++],r===5&&e>n+16)for(var l=0;l<16;l++)u+=i[n].toString(16),n++;return{payload:i.subarray(n,n+o),type:r,size:o,uuid:u}}},{key:"removeEPB",value:function(i){for(var t=i.byteLength,e=[],n=1;n<t-2;)i[n]===0&&i[n+1]===0&&i[n+2]===3?(e.push(n+2),n+=2):n++;if(!e.length)return i;var r=t-e.length,o=new Uint8Array(r),u=0;for(n=0;n<r;u++,n++)u===e[0]&&(u++,e.shift()),o[n]=i[u];return o}}]),s}(),Nr=function(){function s(a){if(Ae(this,s),F(this,"_bytesAvailable",void 0),F(this,"_bitsAvailable",0),F(this,"_word",0),!a)throw new Error("ExpGolomb data params is required");this._data=a,this._bytesAvailable=a.byteLength,this._bytesAvailable&&this._loadWord()}return Pe(s,[{key:"bitsAvailable",get:function(){return this._bitsAvailable}},{key:"_loadWord",value:function(){var i=this._data.byteLength-this._bytesAvailable,t=Math.min(4,this._bytesAvailable);if(t===0)throw new Error("No bytes available");var e=new Uint8Array(4);e.set(this._data.subarray(i,i+t)),this._word=new DataView(e.buffer).getUint32(0),this._bitsAvailable=t*8,this._bytesAvailable-=t}},{key:"skipBits",value:function(i){if(this._bitsAvailable>i)this._word<<=i,this._bitsAvailable-=i;else{i-=this._bitsAvailable;var t=Math.floor(i/8);i-=t*8,this._bytesAvailable-=t,this._loadWord(),this._word<<=i,this._bitsAvailable-=i}}},{key:"readBits",value:function(i){if(i>32)throw new Error("Cannot read more than 32 bits");var t=Math.min(this._bitsAvailable,i),e=this._word>>>32-t;return this._bitsAvailable-=t,this._bitsAvailable>0?this._word<<=t:this._bytesAvailable>0&&this._loadWord(),t=i-t,t>0&&this._bitsAvailable?e<<t|this.readBits(t):e}},{key:"skipLZ",value:function(){var i;for(i=0;i<this._bitsAvailable;++i)if(this._word&2147483648>>>i)return this._word<<=i,this._bitsAvailable-=i,i;return this._loadWord(),i+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var i=this.skipLZ();return this.readBits(i+1)-1}},{key:"readEG",value:function(){var i=this.readUEG();return 1&i?1+i>>>1:-1*(i>>>1)}},{key:"readBool",value:function(){return this.readBits(1)===1}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"skipScalingList",value:function(i){for(var t=8,e=8,n,r=0;r<i;r++)e!==0&&(n=this.readEG(),e=(t+n+256)%256),t=e===0?t:e}}]),s}(),$d=function(){function s(){Ae(this,s)}return Pe(s,null,[{key:"parseAVCDecoderConfigurationRecord",value:function(i){if(!(i.length<7)){for(var t=(i[4]&3)+1,e,n=[],r=[],o=6,u=i[5]&31,l,c=0;c<u;c++)if(l=i[o]<<8|i[o+1],o+=2,!!l){var h=i.subarray(o,o+l);o+=l,n.push(h),e||(e=s.parseSPS(Ot.removeEPB(h)))}var f=i[o];o++;for(var d,v=0;v<f;v++)d=i[o]<<8|i[o+1],o+=2,d&&(r.push(i.subarray(o,o+d)),o+=d);return{sps:e,spsArr:n,ppsArr:r,nalUnitSize:t}}}},{key:"parseSPS",value:function(i){var t=new Nr(i);t.readUByte();var e=t.readUByte(),n=t.readUByte(),r=t.readUByte();t.skipUEG();var o=420;if(e===100||e===110||e===122||e===244||e===44||e===83||e===86||e===118||e===128||e===138||e===144){var u=t.readUEG();if(u<=3&&(o=[0,420,422,444][u]),u===3&&t.skipBits(1),t.skipUEG(),t.skipUEG(),t.skipBits(1),t.readBool())for(var l=u!==3?8:12,c=0;c<l;c++)t.readBool()&&(c<6?t.skipScalingList(16):t.skipScalingList(64))}t.skipUEG();var h=t.readUEG();if(h===0)t.readUEG();else if(h===1){t.skipBits(1),t.skipUEG(),t.skipUEG();for(var f=t.readUEG(),d=0;d<f;d++)t.skipUEG()}t.skipUEG(),t.skipBits(1);var v=t.readUEG(),m=t.readUEG(),g=t.readBits(1);g===0&&t.skipBits(1),t.skipBits(1);var b=0,k=0,E=0,w=0;t.readBool()&&(b=t.readUEG(),k=t.readUEG(),E=t.readUEG(),w=t.readUEG());var C,B,L,D,O;if(t.readBool()){if(t.readBool()){var R=t.readUByte();switch(R){case 1:C=[1,1];break;case 2:C=[12,11];break;case 3:C=[10,11];break;case 4:C=[16,11];break;case 5:C=[40,33];break;case 6:C=[24,11];break;case 7:C=[20,11];break;case 8:C=[32,11];break;case 9:C=[80,33];break;case 10:C=[18,11];break;case 11:C=[15,11];break;case 12:C=[64,33];break;case 13:C=[160,99];break;case 14:C=[4,3];break;case 15:C=[3,2];break;case 16:C=[2,1];break;case 255:{C=[t.readUByte()<<8|t.readUByte(),t.readUByte()<<8|t.readUByte()];break}}}if(t.readBool()&&t.readBool(),t.readBool()&&(t.readBits(4),t.readBool()&&t.readBits(24)),t.readBool()&&(t.readUEG(),t.readUEG()),t.readBool()){var j=t.readBits(32),y=t.readBits(32);B=t.readBool(),L=y,D=j*2,O=L/D}}return{codec:wo(i.subarray(1,4)),profileIdc:e,profileCompatibility:n,levelIdc:r,chromaFormat:o,width:Math.ceil((v+1)*16-2*(b+k)),height:(2-g)*(m+1)*16-(g?2:4)*(E+w),sarRatio:C,fpsNum:L,fpsDen:D,fps:O,fixedFrame:B}}}]),s}(),fa=function(){function s(){Ae(this,s)}return Pe(s,null,[{key:"parseHEVCDecoderConfigurationRecord",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!(i.length<23)){t=t||{};for(var e=(i[21]&3)+1,n,r,o=[],u=[],l=[],c=23,h=i[22],f,d,v,m=0;m<h;m++){f=i[c]&63,d=i[c+1]<<8|i[c+2],c+=3;for(var g=0;g<d;g++)if(v=i[c]<<8|i[c+1],c+=2,!!v){switch(f){case 32:{var b=i.subarray(c,c+v);n||(n=s.parseVPS(Ot.removeEPB(b),t)),l.push(b)}break;case 33:{var k=i.subarray(c,c+v);r||(r=s.parseSPS(Ot.removeEPB(k),t)),o.push(k)}break;case 34:u.push(i.subarray(c,c+v));break}c+=v}}return{hvcC:t,sps:r,spsArr:o,ppsArr:u,vpsArr:l,nalUnitSize:e}}}},{key:"parseVPS",value:function(i,t){t=t||{};var e=new Nr(i);e.readUByte(),e.readUByte(),e.readBits(12);var n=e.readBits(3);return t.numTemporalLayers=Math.max(t.numTemporalLayers||0,n+1),e.readBits(17),s._parseProfileTierLevel(e,n,t),t}},{key:"parseSPS",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t=t||{};var e=new Nr(i);e.readUByte(),e.readUByte(),e.readBits(4);var n=e.readBits(3);t.numTemporalLayers=Math.max(n+1,t.numTemporalLayers||0),t.temporalIdNested=e.readBits(1),s._parseProfileTierLevel(e,n,t),e.readUEG();var r=t.chromaFormatIdc=e.readUEG(),o=420;r<=3&&(o=[0,420,422,444][r]);var u=0;r===3&&(u=e.readBits(1));var l=e.readUEG(),c=e.readUEG(),h=e.readBits(1),f,d,v,m;if(h===1&&(f=e.readUEG(),d=e.readUEG(),v=e.readUEG(),m=e.readUEG()),t.bitDepthLumaMinus8=e.readUEG(),t.bitDepthChromaMinus8=e.readUEG(),h===1){var g=(r===1||r===2)&&u===0?2:1,b=r===1&&u===0?2:1;l-=g*(d+f),c-=b*(m+v)}return{codec:"hev1.1.6.L93.B0",width:l,height:c,chromaFormat:o,hvcC:t}}},{key:"_parseProfileTierLevel",value:function(i,t,e){var n=e.generalTierFlag||0;e.generalProfileSpace=i.readBits(2),e.generalTierFlag=Math.max(i.readBits(1),n),e.generalProfileIdc=Math.max(i.readBits(5),e.generalProfileIdc||0),e.generalProfileCompatibilityFlags=i.readBits(32),e.generalConstraintIndicatorFlags=[i.readBits(8),i.readBits(8),i.readBits(8),i.readBits(8),i.readBits(8),i.readBits(8)];var r=i.readBits(8);n<e.generalTierFlag?e.generalLevelIdc=r:e.generalLevelIdc=Math.max(r,e.generalLevelIdc||0);var o=[],u=[];if(t>i.bitsAvailable)throw new Error("maxSubLayersMinus inavlid size ".concat(t));for(var l=0;l<t;l++)o[l]=i.readBits(1),u[l]=i.readBits(1);t>0&&i.readBits((8-t)*2);for(var c=0;c<t;c++)o[c]!==0&&(i.readBits(2),i.readBits(1),i.readBits(5),i.readBits(16),i.readBits(16),i.readBits(4),i.readBits(16),i.readBits(16),i.readBits(12)),u[c]!==0&&i.readBits(8)}}]),s}(),Gd=9e4/2,da=3,rn=9e4,cr=5*9e4,hr=9e4,jd=9e4/2,zd=9e4*5,Wd=function(){function s(a,i,t,e){Ae(this,s),this.videoTrack=a,this.audioTrack=i,this.metadataTrack=t,this._baseDts=-1,this._baseVideoDts=-1,this._baseAudioDts=-1,this._baseDtsInited=!1,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=!1,this._videoTimestampBreak=!1,this._lastAudioExceptionGapDot=0,this._lastAudioExceptionOverlapDot=0,this._lastAudioExceptionLargeGapDot=0,this._needForceFixLargeGap=e==null?void 0:e.forceFixLargeGap,this._largeGapThreshold=(e==null?void 0:e.largeGapThreshold)||zd}return Pe(s,[{key:"fix",value:function(){var i=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;t=Math.round(t*9e4);var r=this.videoTrack,o=this.audioTrack,u=r.samples,l=o.samples;if(!(!u.length&&!l.length)){var c=u[0],h=l[0],f=0;if(u.length&&l.length&&(f=c.dts-h.pts),this._baseDtsInited||this._calculateBaseDts(this.audioTrack,this.videoTrack),e&&(this._calculateBaseDts(this.audioTrack,this.videoTrack),this._baseDts-=t,this._baseAudioDts-=t,this._baseVideoDts-=t),!n){this._videoNextDts=f>0?t+f:t,this._audioNextPts=f>0?t:t-f,this._needForceFixLargeGap&&(this._videoNextDts=0,this._audioNextPts=0);var d=c?c.dts-this._baseDts-this._videoNextDts:0,v=h?h.pts-this._baseDts-this._audioNextPts:0;Math.abs(d||v)>hr&&(this._calculateBaseDts(this.audioTrack,this.videoTrack),this._baseDts-=t)}if(this._resetBaseDtsWhenStreamBreaked(),this._fixAudio(o),this._fixVideo(r),this.metadataTrack.exist()){var m=this.metadataTrack.timescale;this.metadataTrack.seiSamples.forEach(function(g){g.pts=g.originPts-i._baseDts,g.time=Math.max(0,g.pts)/m})}r.samples.length&&(r.baseMediaDecodeTime=r.samples[0].dts),o.samples.length&&(o.baseMediaDecodeTime=o.samples[0].pts*o.timescale/9e4)}}},{key:"_fixVideo",value:function(i){var t=this,e=i.samples;if(e.length){if(e.forEach(function(L){L.dts-=t._needForceFixLargeGap?t._baseVideoDts:t._baseDts,L.pts-=t._needForceFixLargeGap?t._baseVideoDts:t._baseDts}),this._videoNextDts===void 0){var n=e[0];this._videoNextDts=n.dts}var r=e.length,o=0,u=e[0],l=e[1],c=this._videoNextDts-u.dts;if(Math.abs(c)>jd){var h;if(i.warnings.push({type:rt.LARGE_VIDEO_GAP_BETWEEN_CHUNK,nextDts:this._videoNextDts/90,firstSampleDts:u.dts/90,nextSampleDts:(((h=e[1])===null||h===void 0?void 0:h.dts)||0)/90,sampleDuration:c/90}),u.dts+=c,u.pts+=c,l&&Math.abs(l.dts-u.dts)>hr)this._videoTimestampBreak=!0,e.forEach(function(L,D){D!==0&&(L.dts+=c,L.pts+=c)});else for(var f=1;f<r-1;f++){var d,v=(d=e[f])===null||d===void 0?void 0:d.dts,m=e[f-1].dts;v&&v-m<0&&(e[f].dts+=c,e[f].pts+=c)}}var g;if(i.fpsNum&&i.fpsDen&&(g=i.timescale*(i.fpsDen/i.fpsNum)),g<90*10&&(g=0),!g){var b=i.samples[0],k=i.samples[1];g=r===1?9e3:Math.floor(k.dts-b.dts)}for(var E=0;E<r;E++){var w=e[E].dts,C=e[E+1];if(E<r-1?o=C.dts-w:e[E-1]?o=Math.min(w-e[E-1].dts,g):o=g,o>hr||o<0){this._videoTimestampBreak=!0,o=this._audioTimestampBreak?g:Math.max(o,30*90);var B=this._audioNextPts||0;C&&C.dts>B&&(o=g),i.warnings.push({type:rt.LARGE_VIDEO_GAP,time:w/i.timescale,dts:w,originDts:e[E].originDts,nextDts:this._videoNextDts,sampleDuration:o,refSampleDuration:g})}e[E].duration=o,this._videoNextDts+=o}}}},{key:"_fixAudio",value:function(i){var t=this,e=i.samples;e.length&&(e.forEach(function(n){n.pts-=t._needForceFixLargeGap?t._baseAudioDts:t._baseDts,n.dts=n.pts}),this._doFixAudioInternal(i,e,9e4))}},{key:"_calculateBaseDts",value:function(i,t){var e=i.samples,n=t.samples;if(!e.length&&!n.length)return!1;var r=1/0,o=1/0;e.length&&(i.baseDts=r=e[0].pts,this._baseAudioDts=r),n.length&&(t.baseDts=o=n[0].dts,this._baseVideoDts=o),this._baseDts=Math.min(r,o);var u=o-r,l=!1;return Number.isFinite(u)&&Math.abs(u)>Gd&&t.warnings.push({type:rt.LARGE_AV_SHIFT,videoBaseDts:o,audioBasePts:r,baseDts:this._baseDts,delta:u}),Number.isFinite(u)&&Math.abs(u)>this._largeGapThreshold*rn&&(l=!0),this._baseDtsInited||(l&&this._needForceFixLargeGap?this._needForceFixLargeGap=!0:this._needForceFixLargeGap=!1),this._baseDtsInited=!0,!0}},{key:"_resetBaseDtsWhenStreamBreaked",value:function(){if(this._baseDtsInited&&this._videoTimestampBreak&&this._audioTimestampBreak){var i=this._calculateBaseDts(this.audioTrack,this.videoTrack);if(!i)return;this._baseDts-=Math.min(this._audioNextPts,this._videoNextDts),this._audioLastSample=null,this._videoLastSample=null,this._videoTimestampBreak=!1,this._audioTimestampBreak=!1}}},{key:"_doFixAudioInternal",value:function(i,t,e){i.sampleDuration||(i.sampleDuration=St.getFrameDuration(i.timescale,e));var n=i.sampleDuration;if(this._audioNextPts===void 0){var r=t[0];this._audioNextPts=r.pts}for(var o=0;o<t.length;o++){var u=this._audioNextPts,l=t[o],c=l.pts-u;if(!this._audioTimestampBreak&&c>=da*n&&c<=rn&&!Nd){var h=St.getSilentFrame(i.codec,i.channelCount)||t[0].data.subarray(),f=Math.floor(c/n);Math.abs(l.pts-this._lastAudioExceptionGapDot)>cr&&(this._lastAudioExceptionGapDot=l.pts),i.warnings.push({type:rt.AUDIO_FILLED,pts:l.pts/90,originPts:l.originPts,count:f,nextPts:u/90,refSampleDuration:n});for(var d=0;d<f;d++){var v=new Li(Math.floor(u),h);v.originPts=Math.floor(this._baseDts+u),t.splice(o,0,v),this._audioNextPts+=n,o++}o--}else c<=-da*n&&c>=-1*rn?(Math.abs(l.pts-this._lastAudioExceptionOverlapDot)>cr&&(this._lastAudioExceptionOverlapDot=l.pts,i.warnings.push({type:rt.AUDIO_DROPPED,pts:l.pts/90,originPts:l.originPts,nextPts:u/90,refSampleDuration:n})),t.splice(o,1),o--):(Math.abs(c)>=rn&&(this._audioTimestampBreak=!0,Math.abs(l.pts-this._lastAudioExceptionLargeGapDot)>cr&&(this._lastAudioExceptionLargeGapDot=l.pts,i.warnings.push({type:rt.LARGE_AUDIO_GAP,time:l.pts/1e3,pts:l.pts/90,originPts:l.originPts,nextPts:u/90,sampleDuration:c,refSampleDuration:n}))),l.dts=l.pts=u,this._audioNextPts+=n)}}}]),s}(),at=new Pn("TsDemuxer"),Co=function(){function s(a,i,t){var e=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};Ae(this,s),F(this,"_pmtId",-1),F(this,"_remainingPacketData",null),F(this,"_videoPesData",[]),F(this,"_audioPesData",[]),F(this,"_gopId",0),this.videoTrack=a||new Eo,this.audioTrack=i||new ko,this.metadataTrack=t||new To,this._fixer=new Wd(this.videoTrack,this.audioTrack,this.metadataTrack,e)}return Pe(s,[{key:"demux",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=this.audioTrack,r=this.videoTrack,o=this.metadataTrack;t&&(this._pmtId=-1,r.reset(),n.reset(),o.reset()),!e||t?(this._remainingPacketData=null,this._videoPesData=[],this._audioPesData=[]):(r.samples=[],n.samples=[],o.seiSamples=[],r.warnings=[],n.warnings=[],this._remainingPacketData&&(i=Ze(this._remainingPacketData,i),this._remainingPacketData=null));var u=i.length,l=u%188;l&&(this._remainingPacketData=i.subarray(u-l),u-=l);for(var c=r.pid,h=n.pid,f=0;f<u;f+=188){if(i[f]!==71)throw new Error("TS packet did not start with 0x47");var d=!!(i[f+1]&64),v=((i[f+1]&31)<<8)+i[f+2],m=(i[f+3]&48)>>4,g=void 0;if(m>1){if(g=f+5+i[f+4],g===f+188)continue}else g=f+4;switch(v){case 0:d&&(g+=i[g]+1),this._pmtId=(i[g+10]&31)<<8|i[g+11];break;case this._pmtId:{d&&(g+=i[g]+1);var b=g+3+((i[g+1]&15)<<8|i[g+2])-4,k=(i[g+10]&15)<<8|i[g+11];for(g+=12+k;g<b;){var E=(i[g+1]&31)<<8|i[g+2];switch(i[g]){case 15:n.pid=h=E;break;case 27:if(c!==-1)break;r.codecType=Mt.AVC,r.pid=c=E;break;case 36:if(c!==-1)break;r.codecType=Mt.HEVC,r.pid=c=E;break;default:at.warn("Unsupported stream. type: ".concat(i[g],", pid: ").concat(E))}g+=((i[g+3]&15)<<8|i[g+4])+5}}break;case c:d&&this._videoPesData.length&&this._parseVideoData(),this._videoPesData.push(i.subarray(g,f+188));break;case h:d&&this._audioPesData.length&&this._parseAudioData(),this._audioPesData.push(i.subarray(g,f+188));break;case 17:case 8191:break;default:at.warn("Unknown pid: ".concat(v))}}return this._parseVideoData(),this._parseAudioData(),n.formatTimescale=r.formatTimescale=r.timescale=o.timescale=9e4,n.timescale=n.sampleRate||0,{videoTrack:r,audioTrack:n,metadataTrack:o}}},{key:"fix",value:function(i,t,e){return this._fixer.fix(i,t,e),{videoTrack:this.videoTrack,audioTrack:this.audioTrack,metadataTrack:this.metadataTrack}}},{key:"demuxAndFix",value:function(i,t,e,n){return this.demux(i,t,e),this.fix(n,t,e)}},{key:"_parseVideoData",value:function(){if(this._videoPesData.length){var i=s._parsePES(Ze.apply(void 0,Xe(this._videoPesData)));if(!i){at.warn("Cannot parse video pes",this._videoPesData);return}var t=Ot.parseAnnexB(i.data);t?this._createVideoSample(t,i.pts,i.dts):at.warn("Cannot parse avc units",i),this._videoPesData=[]}}},{key:"_createVideoSample",value:function(i,t,e){var n=this;if(i.length){var r=this.videoTrack,o=r.codecType===Mt.HEVC,u=new Mr(t,e);i.forEach(function(l){var c=o?l[0]>>>1&63:l[0]&31;switch(c){case 5:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:if(!o&&c!==5||o&&c===5)break;u.setToKeyframe(),n._gopId++;break;case 6:case 39:case 40:if(!o&&c!==6||o&&c===6)break;n.metadataTrack.seiSamples.push(new Md(Ot.parseSEI(Ot.removeEPB(l),o),t));return;case 32:if(!o)break;if(!r.vps.length){var h=fa.parseVPS(Ot.removeEPB(l),r.hvcC);r.hvcC=r.hvcC||h,r.vps=[l]}break;case 7:case 33:if(!o&&c!==7||o&&c===7)break;if(!r.sps.length){var f=Ot.removeEPB(l),d=o?fa.parseSPS(f,r.hvcC):$d.parseSPS(f);r.sps=[l],r.hvcC=r.hvcC||d.hvcC,r.codec=d.codec,r.width=d.width,r.height=d.height,r.sarRatio=d.sarRatio,r.fpsNum=d.fpsNum,r.fpsDen=d.fpsDen}break;case 8:case 34:if(!o&&c!==8||o&&c===8)break;r.pps.length||(r.pps=[l]);break;case 9:case 35:break;case 38:if(o){for(var v=!1,m=2;m<l.byteLength;m++)if(l[m]===255){v=!0;break}if(!v)return}break}u.units.push(l)}),u.gopId=this._gopId,this._pushVideoSample(r,u)}}},{key:"_pushVideoSample",value:function(i,t){if(t.units.length)if(t.pts===null||t.pts===void 0){at.warn("Video sample no pts",t);var e=i.samples[i.samples.length-1];e?(t.pts=e.pts,t.dts=e.dts):at.warn("Drop video sample",t)}else i.samples.push(t)}},{key:"_parseAudioData",value:function(){if(this._audioPesData.length){var i=s._parsePES(Ze.apply(void 0,Xe(this._audioPesData)));if(!i){at.warn("Cannot parse audio pes",this._audioPesData);return}this._parseAacData(i),this._audioPesData=[]}}},{key:"_parseAacData",value:function(i){var t=this.audioTrack,e=i.pts;if(e==null){if(at.warn("AAC pes not pts",t),!t.samples.length||!t.sampleRate)return;e=t.samples[t.samples.length-1].pts+St.getFrameDuration(t.sampleRate)}var n=St.parseADTS(i.data,e);if(n){var r;t.codec=n.codec,t.channelCount=n.channelCount,t.sampleRate=n.sampleRate,t.objectType=n.objectType,t.sampleRateIndex=n.samplingFrequencyIndex,t.config=n.config,(r=t.samples).push.apply(r,Xe(n.frames.map(function(o){return new Li(o.pts,o.data)}))),n.skip&&at.warn("Skip aac adts ".concat(n.skip," bits")),n.remaining&&at.warn("Remaining aac adts ".concat(n.remaining," bits"))}else at.warn("Cannot parse aac adts",i)}}],[{key:"probe",value:function(i){return i.length?i[0]===71&&i[188]===71&&i[376]===71:!1}},{key:"_parsePES",value:function(i){var t=i[8];if(!(t==null||i.length<t+9)){var e=i[0]<<16|i[1]<<8|i[2];if(e===1){var n=(i[4]<<8)+i[5];if(!(n&&n>i.length-6)){var r,o,u=i[7];return u&192&&(r=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,u&64?(o=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,r-o>60*9e4&&(r=o)):o=r),{data:i.subarray(9+t),pts:r,dts:o}}}}}}]),s}(),fr=function(){function s(a,i,t){Ae(this,s),this.dv=new DataView(a),this.start=this.offset=i||this.dv.byteOffset,this.end=t?this.start+t:this.start+this.dv.byteLength}return Pe(s,[{key:"buffer",get:function(){return this.dv.buffer}},{key:"unreadLength",get:function(){return Math.max(this.end-this.offset,0)}},{key:"size",get:function(){return this.end-this.start}},{key:"readFloat",value:function(i){var t=0;switch(i){case 4:t=this.dv.getFloat32(this.offset);break;case 8:t=this.dv.getFloat64(this.offset);break;default:throw new Error("read ".concat(i,"-byte float is not supported"))}return this.offset+=i,t}},{key:"back",value:function(i){this.offset-=i}},{key:"skip",value:function(i){this.offset+=i}},{key:"readInt",value:function(i){var t=this.offset;switch(this.offset+=i,i){case 1:return this.dv.getInt8(t);case 2:return this.dv.getInt16(t);case 4:return this.dv.getInt32(t);default:throw new Error("read ".concat(i,"-byte integers is not supported"))}}},{key:"read",value:function(i){var t=this.offset;switch(this.offset+=i,i){case 1:return this.dv.getUint8(t);case 2:return this.dv.getUint16(t);case 3:return(this.dv.getUint16(t)<<8)+this.dv.getUint8(t+2);case 4:return this.dv.getUint32(t);default:return this.back(i-4),this.read(i-4)+this.dv.getUint32(t)*Math.pow(256,i-4)}}},{key:"write",value:function(i,t){var e=this.offset;switch(this.offset+=i,i){case 1:return this.dv.setUint8(e,t);case 2:return this.dv.setUint16(e,t);case 3:return this.dv.setUint8(e,t>>>16),this.dv.setUint16(e+1,65535&t);case 4:return this.dv.setUint32(e,t);default:throw new Error("write ".concat(i,"-byte integers is not supported"))}}},{key:"readToBuffer",value:function(i){var t;return this.offset||i?t=this.dv.buffer.slice(this.offset,i?this.offset+i:this.end):t=this.dv.buffer,this.offset+=t.byteLength,t}},{key:"readToUint8",value:function(i){var t=new Uint8Array(this.dv.buffer,this.offset,i||this.unreadLength);return this.offset+=t.byteLength,t}},{key:"readString",value:function(i){for(var t=0,e="";t<i;t++)e+=String.fromCharCode(this.dv.getUint8(this.offset)),this.offset++;return e}}],[{key:"fromUint8",value:function(i){return new s(i.buffer,i.byteOffset,i.byteLength)}},{key:"concatUint8s",value:function(i){var t=new Uint8Array(i.reduce(function(n,r){return n+r.byteLength},0)),e=0;return i.forEach(function(n){t.set(n,e),e+=n.byteLength}),t}},{key:"concatUint8",value:function(){for(var i=arguments.length,t=new Array(i),e=0;e<i;e++)t[e]=arguments[e];return this.concatUint8s(t)}}]),s}(),Kd=function(){function s(a,i){Ae(this,s),this.offset=0,this.val=a,this.size=i}return Pe(s,[{key:"skip",value:function(i){this.offset+=i}},{key:"read",value:function(i){var t=this.size-this.offset-i;if(t>=0){var e=0,n=0;if(this.offset+=i,this.size>31){for(;n<i;n++)e+=Math.pow(2,n);return this.val/Math.pow(2,t)&e}else{for(;n<i;n++)e+=1<<n;return this.val>>>t&e}}throw new Error("the number of the read operation exceeds the total length limit of bits")}}],[{key:"fromByte",value:function(i,t){return new s(i.read(t),t<<3)}}]),s}(),Ee=function(){function s(){Ae(this,s)}return Pe(s,null,[{key:"findBox",value:function(i,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=[];if(!i)return n;for(var r=0,o="",u=0;i.length>7;){if(r=z(i),o=String.fromCharCode.apply(null,i.subarray(4,8)),u=8,r===1?(r=Wt(i,8),u+=8):r||(r=i.length),!t[0]||o===t[0]){var l=i.subarray(0,r);if(t.length<2)n.push({start:e,size:r,headerSize:u,type:o,data:l});else return s.findBox(l.subarray(u),t.slice(1),e+u)}e+=r,i=i.subarray(r)}return n}},{key:"tfhd",value:function(i){return re(i,!0,function(t,e){t.trackId=z(e);var n=4,r=t.flags&255&1,o=t.flags&255&2,u=t.flags&255&8,l=t.flags&255&16,c=t.flags&255&32;r&&(n+=4,t.baseDataOffset=z(e,n),n+=4),o&&(t.sampleDescriptionIndex=z(e,n),n+=4),u&&(t.defaultSampleDuration=z(e,n),n+=4),l&&(t.defaultSampleSize=z(e,n),n+=4),c&&(t.defaultSampleFlags=z(e,n))})}},{key:"sidx",value:function(i){return re(i,!0,function(t,e){var n=0;t.reference_ID=z(e,n),n+=4,t.timescale=z(e,n),n+=4,t.version===0?(t.earliest_presentation_time=z(e,n),n+=4,t.first_offset=z(e,n),n+=4):(t.earliest_presentation_time=Wt(e,n),n+=8,t.first_offset=Wt(e,n),n+=8),n+=2,t.references=[];var r=ke(e,n);n+=2;for(var o=0;o<r;o++){var u={};t.references.push(u);var l=z(e,n);n+=4,u.reference_type=l>>31&1,u.referenced_size=l&2147483647,u.subsegment_duration=z(e,n),n+=4,l=z(e,n),n+=4,u.starts_with_SAP=l>>31&1,u.SAP_type=l>>28&7,u.SAP_delta_time=l&268435455}})}},{key:"moov",value:function(i){return re(i,!1,function(t,e,n){t.mvhd=s.mvhd(s.findBox(e,["mvhd"],n)[0]),t.trak=s.findBox(e,["trak"],n).map(function(r){return s.trak(r)}),t.pssh=s.pssh(s.findBox(e,["pssh"],n)[0])})}},{key:"mvhd",value:function(i){return re(i,!0,function(t,e){var n=0;t.version===1?(t.timescale=z(e,16),t.duration=Wt(e,20),n+=28):(t.timescale=z(e,8),t.duration=z(e,12),n+=16),t.nextTrackId=z(e,n+76)})}},{key:"trak",value:function(i){return re(i,!1,function(t,e,n){t.tkhd=s.tkhd(s.findBox(e,["tkhd"],n)[0]),t.mdia=s.mdia(s.findBox(e,["mdia"],n)[0])})}},{key:"tkhd",value:function(i){return re(i,!0,function(t,e){var n=fr.fromUint8(e);t.version===1?(n.read(8),n.read(8),t.trackId=n.read(4),n.read(4),t.duration=n.read(8)):(n.read(4),n.read(4),t.trackId=n.read(4),n.read(4),t.duration=n.read(4)),n.skip(16),t.matrix=[];for(var r=0;r<36;r++)t.matrix.push(n.read(1));n.back(36);for(var o=[],u=0,l;u<3;u++)o.push(lr(n.readInt(2),n.readInt(2))),o.push(lr(n.readInt(2),n.readInt(2))),l=n.readInt(4),o.push(lr(l>>30,l&1073741823));t.rotation=Vd(o),t.width=n.read(4),t.height=n.read(4)})}},{key:"mdia",value:function(i){return re(i,!1,function(t,e,n){t.mdhd=s.mdhd(s.findBox(e,["mdhd"],n)[0]),t.hdlr=s.hdlr(s.findBox(e,["hdlr"],n)[0]),t.minf=s.minf(s.findBox(e,["minf"],n)[0])})}},{key:"mdhd",value:function(i){return re(i,!0,function(t,e){var n=0;t.version===1?(t.timescale=z(e,16),t.duration=Wt(e,20),n+=28):(t.timescale=z(e,8),t.duration=z(e,12),n+=16);var r=ke(e,n);t.language=String.fromCharCode((r>>10&31)+96,(r>>5&31)+96,(r&31)+96)})}},{key:"hdlr",value:function(i){return re(i,!0,function(t,e){t.version===0&&(t.handlerType=String.fromCharCode.apply(null,e.subarray(4,8)))})}},{key:"minf",value:function(i){return re(i,!1,function(t,e,n){t.vmhd=s.vmhd(s.findBox(e,["vmhd"],n)[0]),t.smhd=s.smhd(s.findBox(e,["smhd"],n)[0]),t.stbl=s.stbl(s.findBox(e,["stbl"],n)[0])})}},{key:"vmhd",value:function(i){return re(i,!0,function(t,e){t.graphicsmode=ke(e),t.opcolor=[ke(e,2),ke(e,4),ke(e,6)]})}},{key:"smhd",value:function(i){return re(i,!0,function(t,e){t.balance=ke(e)})}},{key:"stbl",value:function(i){return re(i,!1,function(t,e,n){var r,o,u;t.stsd=s.stsd(s.findBox(e,["stsd"],n)[0]),t.stts=s.stts(s.findBox(e,["stts"],n)[0]),t.ctts=s.ctts(s.findBox(e,["ctts"],n)[0]),t.stsc=s.stsc(s.findBox(e,["stsc"],n)[0]),t.stsz=s.stsz(s.findBox(e,["stsz"],n)[0]),t.stco=s.stco(s.findBox(e,["stco"],n)[0]),t.stco||(t.co64=s.co64(s.findBox(e,["co64"],n)[0]),t.stco=t.co64);var l=(r=t.stsd.entries[0])===null||r===void 0||(o=r.sinf)===null||o===void 0||(u=o.schi)===null||u===void 0?void 0:u.tenc.default_IV_size;t.stss=s.stss(s.findBox(e,["stss"],n)[0]),t.senc=s.senc(s.findBox(e,["senc"],n)[0],l)})}},{key:"senc",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;return re(i,!0,function(e,n){var r=0,o=z(n,r);r+=4,e.samples=[];for(var u=0;u<o;u++){var l={};l.InitializationVector=[];for(var c=0;c<t;c++)l.InitializationVector[c]=n[r+c];if(r+=t,e.flags&2){l.subsamples=[];var h=ke(n,r);r+=2;for(var f=0;f<h;f++){var d={};d.BytesOfClearData=ke(n,r),r+=2,d.BytesOfProtectedData=z(n,r),r+=4,l.subsamples.push(d)}}e.samples.push(l)}})}},{key:"pssh",value:function(i){return re(i,!0,function(t,e){for(var n=[],r=[],o=0,u=0;u<16;u++)r.push(vr(e[o+u]));if(o+=16,t.version>0){var l=z(e,o);o+=4;for(var c=0;c<(""+l).length;c++)for(var h=0;h<16;h++){var f=e[o];o+=1,n.push(vr(f))}}var d=z(e,o);t.data_size=d,o+=4,t.kid=n,t.system_id=r,t.buffer=e})}},{key:"stsd",value:function(i){return re(i,!0,function(t,e,n){t.entryCount=z(e),t.entries=s.findBox(e.subarray(4),[],n+4).map(function(r){switch(r.type){case"av01":return s.av01(r);case"avc1":case"avc2":case"avc3":case"avc4":return s.avc1(r);case"hvc1":case"hev1":return s.hvc1(r);case"mp4a":return s.mp4a(r);case"alaw":case"ulaw":return s.alaw(r);case"enca":return re(r,!1,function(o,u,l){o.channelCount=ke(u,16),o.samplesize=ke(u,18),o.sampleRate=z(u,24)/65536,u=u.subarray(28),o.sinf=s.sinf(s.findBox(u,["sinf"],l)[0]),o.esds=s.esds(s.findBox(u,["esds"],l)[0])});case"encv":return re(r,!1,function(o,u,l){o.width=ke(u,24),o.height=ke(u,26),o.horizresolution=z(u,28),o.vertresolution=z(u,32),u=u.subarray(78),o.sinf=s.sinf(s.findBox(u,["sinf"],l)[0]),o.avcC=s.avcC(s.findBox(u,["avcC"],l)[0]),o.hvcC=s.hvcC(s.findBox(u,["hvcC"],l)[0]),o.pasp=s.pasp(s.findBox(u,["pasp"],l)[0])})}}).filter(Boolean)})}},{key:"tenc",value:function(i){return re(i,!1,function(t,e){var n=6;t.default_IsEncrypted=e[n],n+=1,t.default_IV_size=e[n],n+=1,t.default_KID=[];for(var r=0;r<16;r++)t.default_KID.push(vr(e[n])),n+=1})}},{key:"schi",value:function(i){return re(i,!1,function(t,e,n){t.tenc=s.tenc(s.findBox(e,["tenc"],n)[0])})}},{key:"sinf",value:function(i){return re(i,!1,function(t,e,n){t.schi=s.schi(s.findBox(e,["schi"],n)[0]),t.frma=s.frma(s.findBox(e,["frma"],n)[0])})}},{key:"frma",value:function(i){return re(i,!1,function(t,e){t.data_format="";for(var n=0;n<4;n++)t.data_format+=String.fromCharCode(e[n])})}},{key:"colr",value:function(i){return re(i,!1,function(t,e){var n=fr.fromUint8(e);t.data=i.data,t.colorType=n.readString(4),t.colorType==="nclx"?(t.colorPrimaries=n.read(2),t.transferCharacteristics=n.read(2),t.matrixCoefficients=n.read(2),t.fullRangeFlag=n.read(1)>>7):(t.colorType==="rICC"||t.colorType==="prof")&&(t.iccProfile=e.readToUint8())})}},{key:"av01",value:function(i){return re(i,!1,function(t,e,n){var r=dr(t,e),o=e.subarray(r);n+=r,t.av1C=s.av1C(s.findBox(o,["av1C"],n)[0]),t.colr=s.colr(s.findBox(o,["colr"],n)[0])})}},{key:"av1C",value:function(i){return re(i,!1,function(t,e){t.data=i.data;var n=fr.fromUint8(e),r=Kd.fromByte(n,4);t.marker=r.read(1),t.version=r.read(7),t.seqProfile=r.read(3),t.seqLevelIdx0=r.read(5),t.seqTier0=r.read(1),t.highBitdepth=r.read(1),t.twelveBit=r.read(1),t.monochrome=r.read(1),t.chromaSubsamplingX=r.read(1),t.chromaSubsamplingY=r.read(1),t.chromaSamplePosition=r.read(2),t.reserved=r.read(3),t.initialPresentationDelayPresent=r.read(1),t.initialPresentationDelayPresent?t.initialPresentationDelayMinusOne=r.read(4):t.initialPresentationDelayMinusOne=0,t.configOBUs=n.readToUint8();var o;t.seqLevelIdx0===2&&t.highBitdepth===1?o=t.twelveBit===1?"12":"10":t.seqProfile<=2&&(o=t.highBitdepth===1?"10":"08"),t.codec=["av01",t.seqProfile,(t.seqLevelIdx0<10?"0"+t.seqLevelIdx0:t.seqLevelIdx0)+(t.seqTier0?"H":"M"),o].join(".")})}},{key:"avc1",value:function(i){return re(i,!1,function(t,e,n){var r=dr(t,e),o=e.subarray(r);n+=r,t.avcC=s.avcC(s.findBox(o,["avcC"],n)[0]),t.pasp=s.pasp(s.findBox(o,["pasp"],n)[0])})}},{key:"avcC",value:function(i){return re(i,!1,function(t,e){t.data=i.data,t.configurationVersion=e[0],t.AVCProfileIndication=e[1],t.profileCompatibility=e[2],t.AVCLevelIndication=e[3],t.codec=wo([e[1],e[2],e[3]]),t.lengthSizeMinusOne=e[4]&3,t.spsLength=e[5]&31,t.sps=[];for(var n=6,r=0;r<t.spsLength;r++){var o=ke(e,n);n+=2,t.sps.push(e.subarray(n,n+o)),n+=o}t.ppsLength=e[n],n+=1,t.pps=[];for(var u=0;u<t.ppsLength;u++){var l=ke(e,n);n+=2,t.pps.push(e.subarray(n,n+=l)),n+=l}})}},{key:"hvc1",value:function(i){return re(i,!1,function(t,e,n){var r=dr(t,e),o=e.subarray(r);n+=r,t.hvcC=s.hvcC(s.findBox(o,["hvcC"],n)[0]),t.pasp=s.pasp(s.findBox(o,["pasp"],n)[0])})}},{key:"hvcC",value:function(i){return re(i,!1,function(t,e){t.data=i.data,t.codec="hev1.1.6.L93.B0",t.configurationVersion=e[0];var n=e[1];t.generalProfileSpace=n>>6,t.generalTierFlag=(n&32)>>5,t.generalProfileIdc=n&31,t.generalProfileCompatibility=z(e,2),t.generalConstraintIndicatorFlags=e.subarray(6,12),t.generalLevelIdc=e[12],t.avgFrameRate=ke(e,19),t.numOfArrays=e[22],t.vps=[],t.sps=[],t.pps=[];for(var r=23,o=0,u=0,l=0,c=0;c<t.numOfArrays;c++){o=e[r]&63,u=ke(e,r+1),r+=3;for(var h=[],f=0;f<u;f++)l=ke(e,r),r+=2,h.push(e.subarray(r,r+l)),r+=l;if(o===32){var d;(d=t.vps).push.apply(d,h)}else if(o===33){var v;(v=t.sps).push.apply(v,h)}else if(o===34){var m;(m=t.pps).push.apply(m,h)}}})}},{key:"pasp",value:function(i){return re(i,!1,function(t,e){t.hSpacing=z(e),t.vSpacing=z(e,4)})}},{key:"mp4a",value:function(i){return re(i,!1,function(t,e,n){var r=pa(t,e);t.esds=s.esds(s.findBox(e.subarray(r),["esds"],n+r)[0])})}},{key:"esds",value:function(i){return re(i,!0,function(t,e){t.codec="mp4a.";for(var n=0,r=0,o=0,u=0;e.length;){for(n=0,u=e[n],r=e[n+1],n+=2;r&128;)o=(r&127)<<7,r=e[n],n+=1;if(o+=r&127,u===3)e=e.subarray(n+3);else if(u===4)t.codec+=(e[n].toString(16)+".").padStart(3,"0"),e=e.subarray(n+13);else if(u===5){var l=t.config=e.subarray(n,n+o),c=(l[0]&248)>>3;c===31&&l.length>=2&&(c=32+((l[0]&7)<<3)+((l[1]&224)>>5)),t.objectType=c,t.codec+=c.toString(16),t.codec[t.codec.length-1]==="."&&(t.codec=t.codec.substring(0,t.codec.length-1));return}else{t.codec[t.codec.length-1]==="."&&(t.codec=t.codec.substring(0,t.codec.length-1));return}}})}},{key:"alaw",value:function(i){return re(i,!1,function(t,e){pa(t,e)})}},{key:"stts",value:function(i){return re(i,!0,function(t,e){for(var n=z(e),r=[],o=4,u=0;u<n;u++)r.push({count:z(e,o),delta:z(e,o+4)}),o+=8;t.entryCount=n,t.entries=r})}},{key:"ctts",value:function(i){return re(i,!0,function(t,e){var n=z(e),r=[],o=4;if(t.version===1)for(var u=0;u<n;u++)r.push({count:z(e,o),offset:z(e,o+4)}),o+=8;else for(var l=0;l<n;l++)r.push({count:z(e,o),offset:-(~z(e,o+4)+1)}),o+=8;t.entryCount=n,t.entries=r})}},{key:"stsc",value:function(i){return re(i,!0,function(t,e){for(var n=z(e),r=[],o=4,u=0;u<n;u++)r.push({firstChunk:z(e,o),samplesPerChunk:z(e,o+4),sampleDescriptionIndex:z(e,o+8)}),o+=12;t.entryCount=n,t.entries=r})}},{key:"stsz",value:function(i){return re(i,!0,function(t,e){var n=z(e),r=z(e,4),o=[];if(!n)for(var u=8,l=0;l<r;l++)o.push(z(e,u)),u+=4;t.sampleSize=n,t.sampleCount=r,t.entrySizes=o})}},{key:"stco",value:function(i){return re(i,!0,function(t,e){for(var n=z(e),r=[],o=4,u=0;u<n;u++)r.push(z(e,o)),o+=4;t.entryCount=n,t.entries=r})}},{key:"co64",value:function(i){return re(i,!0,function(t,e){for(var n=z(e),r=[],o=4,u=0;u<n;u++)r.push(Wt(e,o)),o+=8;t.entryCount=n,t.entries=r})}},{key:"stss",value:function(i){return re(i,!0,function(t,e){for(var n=z(e),r=[],o=4,u=0;u<n;u++)r.push(z(e,o)),o+=4;t.entryCount=n,t.entries=r})}},{key:"moof",value:function(i){return re(i,!1,function(t,e,n){t.mfhd=s.mfhd(s.findBox(e,["mfhd"],n)[0]),t.traf=s.findBox(e,["traf"],n).map(function(r){return s.traf(r)})})}},{key:"mfhd",value:function(i){return re(i,!0,function(t,e){t.sequenceNumber=z(e)})}},{key:"traf",value:function(i){return re(i,!1,function(t,e,n){t.tfhd=s.tfhd(s.findBox(e,["tfhd"],n)[0]),t.tfdt=s.tfdt(s.findBox(e,["tfdt"],n)[0]),t.trun=s.trun(s.findBox(e,["trun"],n)[0])})}},{key:"trun",value:function(i){return re(i,!0,function(t,e){var n=t.version,r=t.flags,o=e.length,u=t.sampleCount=z(e),l=4;if(o>l&&r&1&&(t.dataOffset=-(~z(e,l)+1),l+=4),o>l&&r&4&&(t.firstSampleFlags=z(e,l),l+=4),t.samples=[],o>l)for(var c,h=0;h<u;h++)c={},r&256&&(c.duration=z(e,l),l+=4),r&512&&(c.size=z(e,l),l+=4),r&1024&&(c.flags=z(e,l),l+=4),r&2048&&(n?c.cts=-(~z(e,l+4)+1):c.cts=z(e,l),l+=4),t.samples.push(c)})}},{key:"tfdt",value:function(i){return re(i,!0,function(t,e){t.version===1?t.baseMediaDecodeTime=Wt(e):t.baseMediaDecodeTime=z(e)})}},{key:"probe",value:function(i){return!!s.findBox(i,["ftyp"])}},{key:"parseSampleFlags",value:function(i){return{isLeading:(i[0]&12)>>>2,dependsOn:i[0]&3,isDependedOn:(i[1]&192)>>>6,hasRedundancy:(i[1]&48)>>>4,paddingValue:(i[1]&14)>>>1,isNonSyncSample:i[1]&1,degradationPriority:i[2]<<8|i[3]}}},{key:"moovToTrack",value:function(i,t,e){var n,r,o=i.trak;if(!(!o||!o.length)){var u=o.find(function(Gn){var $t,Gt;return(($t=Gn.mdia)===null||$t===void 0||(Gt=$t.hdlr)===null||Gt===void 0?void 0:Gt.handlerType)==="vide"}),l=o.find(function(Gn){var $t,Gt;return(($t=Gn.mdia)===null||$t===void 0||(Gt=$t.hdlr)===null||Gt===void 0?void 0:Gt.handlerType)==="soun"});if(u&&t){var c,h,f,d,v,m,g,b=t,k=(c=u.tkhd)===null||c===void 0?void 0:c.trackId;k!=null&&(b.id=u.tkhd.trackId),b.tkhdDuration=u.tkhd.duration,b.mvhdDurtion=i.mvhd.duration,b.mvhdTimecale=i.mvhd.timescale,b.timescale=b.formatTimescale=u.mdia.mdhd.timescale,b.duration=u.mdia.mdhd.duration||b.mvhdDurtion/b.mvhdTimecale*b.timescale,b.rotation=u.tkhd.rotation,b.matrix=u.tkhd.matrix;var E=u.mdia.minf.stbl.stsd.entries[0];if(b.width=E.width,b.height=E.height,E.pasp&&(b.sarRatio=[E.pasp.hSpacing,E.pasp.vSpacing]),E.av1C)b.codecType=Mt.AV1,b.codec=E.av1C.codec,b.av1C=E.av1C.data,b.colr=E.colr.data;else if(E.hvcC)b.codecType=Mt.HEVC,b.codec=E.hvcC.codec,b.vps=E.hvcC.vps,b.sps=E.hvcC.sps,b.pps=E.hvcC.pps,b.hvcC=E.hvcC.data;else if(E.avcC)b.codec=E.avcC.codec,b.sps=E.avcC.sps,b.pps=E.avcC.pps;else throw new Error("unknown video stsd entry");if(b.present=!0,b.ext={},b.ext.stss=(h=u.mdia)===null||h===void 0||(f=h.minf)===null||f===void 0||(d=f.stbl)===null||d===void 0?void 0:d.stss,b.ext.ctts=(v=u.mdia)===null||v===void 0||(m=v.minf)===null||m===void 0||(g=m.stbl)===null||g===void 0?void 0:g.ctts,E&&E.type==="encv"){var w,C,B,L,D,O,R,j;b.isVideoEncryption=!0,E.default_KID=(w=E.sinf)===null||w===void 0||(C=w.schi)===null||C===void 0?void 0:C.tenc.default_KID,E.default_IsEncrypted=(B=E.sinf)===null||B===void 0||(L=B.schi)===null||L===void 0?void 0:L.tenc.default_IsEncrypted,E.default_IV_size=(D=E.sinf)===null||D===void 0||(O=D.schi)===null||O===void 0?void 0:O.tenc.default_IV_size,b.videoSenc=u.mdia.minf.stbl.senc&&u.mdia.minf.stbl.senc.samples,E.data_format=(R=E.sinf)===null||R===void 0||(j=R.frma)===null||j===void 0?void 0:j.data_format,b.useEME=i.useEME,b.kidValue=i.kidValue,b.pssh=i.pssh,b.encv=E}}if(l&&e){var y,_,S,P,T,M,G,K,Z,$=e,be=(y=l.tkhd)===null||y===void 0?void 0:y.trackId;be!=null&&($.id=l.tkhd.trackId),$.tkhdDuration=l.tkhd.duration,$.mvhdDurtion=i.mvhd.duration,$.mvhdTimecale=i.mvhd.timescale,$.timescale=$.formatTimescale=l.mdia.mdhd.timescale,$.duration=l.mdia.mdhd.duration||$.mvhdDurtion/$.mvhdTimecale*$.timescale;var Y=l.mdia.minf.stbl.stsd.entries[0];switch($.sampleSize=Y.sampleSize,$.sampleRate=Y.sampleRate,$.channelCount=Y.channelCount,$.present=!0,Y.type){case"alaw":$.codecType=$.codec=It.G711PCMA,$.sampleRate=8e3;break;case"ulaw":$.codecType=$.codec=It.G711PCMU,$.sampleRate=8e3;break;default:$.sampleDuration=St.getFrameDuration($.sampleRate,$.timescale),$.sampleRateIndex=St.getRateIndexByRate($.sampleRate),$.objectType=((n=Y.esds)===null||n===void 0?void 0:n.objectType)||2,Y.esds&&($.config=Array.from(Y.esds.config)),$.codec=((r=Y.esds)===null||r===void 0?void 0:r.codec)||"mp4a.40.2";break}if($.sampleDuration=St.getFrameDuration($.sampleRate,$.timescale),$.objectType=((_=Y.esds)===null||_===void 0?void 0:_.objectType)||2,Y.esds&&(Y.esds.config?$.config=Array.from(Y.esds.config):console.warn("esds config is null")),$.codec=((S=Y.esds)===null||S===void 0?void 0:S.codec)||"mp4a.40.2",$.sampleRateIndex=St.getRateIndexByRate($.sampleRate),$.ext={},$.ext.stss=(P=l.mdia)===null||P===void 0||(T=P.minf)===null||T===void 0||(M=T.stbl)===null||M===void 0?void 0:M.stss,$.ext.ctts=(G=l.mdia)===null||G===void 0||(K=G.minf)===null||K===void 0||(Z=K.stbl)===null||Z===void 0?void 0:Z.ctts,$.present=!0,Y&&Y.type==="enca"){var Ht,it,Vt,ai,Xi,xe,Un,Hn;$.isAudioEncryption=!0,Y.data_format=(Ht=Y.sinf)===null||Ht===void 0||(it=Ht.frma)===null||it===void 0?void 0:it.data_format,Y.default_KID=(Vt=Y.sinf)===null||Vt===void 0||(ai=Vt.schi)===null||ai===void 0?void 0:ai.tenc.default_KID,Y.default_IsEncrypted=(Xi=Y.sinf)===null||Xi===void 0||(xe=Xi.schi)===null||xe===void 0?void 0:xe.tenc.default_IsEncrypted,Y.default_IV_size=(Un=Y.sinf)===null||Un===void 0||(Hn=Un.schi)===null||Hn===void 0?void 0:Hn.tenc.default_IV_size,$.audioSenc=l.mdia.minf.stbl.senc&&l.mdia.minf.stbl.senc.samples,$.useEME=i.useEME,$.kidValue=i.kidValue,$.enca=Y}}if(e&&(e.isVideoEncryption=t?t.isVideoEncryption:!1),t&&(t.isAudioEncryption=e?e.isAudioEncryption:!1),t!=null&&t.encv||e!=null&&e.enca){var Vn,$n,ss=t==null||(Vn=t.encv)===null||Vn===void 0?void 0:Vn.default_KID,as=e==null||($n=e.enca)===null||$n===void 0?void 0:$n.default_KID,os=ss||as?(ss||as).join(""):null;t&&(t.kid=os),e&&(e.kid=os)}return t&&(t.flags=3841),e&&(e.flags=1793),{videoTrack:t,audioTrack:e}}}},{key:"evaluateDefaultDuration",value:function(i,t,e){var n,r=t==null||(n=t.samples)===null||n===void 0?void 0:n.length;if(!r)return 1024;var o=1024*r/t.timescale;return o*i.timescale/e}},{key:"moofToSamples",value:function(i,t,e){var n={};return i.mfhd&&(t&&(t.sequenceNumber=i.mfhd.sequenceNumber),e&&(e.sequenceNumber=i.mfhd.sequenceNumber)),i.traf.forEach(function(r){var o=r.tfhd,u=r.tfdt,l=r.trun;if(!(!o||!l)){u&&(t&&t.id===o.trackId&&(t.baseMediaDecodeTime=u.baseMediaDecodeTime),e&&e.id===o.trackId&&(e.baseMediaDecodeTime=u.baseMediaDecodeTime));var c=o.defaultSampleSize||0,h=o.defaultSampleDuration||s.evaluateDefaultDuration(t,e,l.samples.length||l.sampleCount),f=l.dataOffset||0,d=0,v=-1;if(!l.samples.length&&l.sampleCount){n[o.trackId]=[];for(var m=0;m<l.sampleCount;m++)n[o.trackId].push({offset:f,dts:d,duration:h,size:c}),d+=h,f+=c}else n[o.trackId]=l.samples.map(function(g,b){return g={offset:f,dts:d,pts:d+(g.cts||0),duration:g.duration||h,size:g.size||c,gopId:v,keyframe:b===0||g.flags!==null&&g.flags!==void 0&&(g.flags&65536)>>>0!==65536},g.keyframe&&(v++,g.gopId=v),d+=g.duration,f+=g.size,g})}}),n}},{key:"moovToSamples",value:function(i){var t=i.trak;if(!(!t||!t.length)){var e=t.find(function(R){var j,y;return((j=R.mdia)===null||j===void 0||(y=j.hdlr)===null||y===void 0?void 0:y.handlerType)==="vide"}),n=t.find(function(R){var j,y;return((j=R.mdia)===null||j===void 0||(y=j.hdlr)===null||y===void 0?void 0:y.handlerType)==="soun"});if(!(!e&&!n)){var r,o;if(e){var u,l,c=(u=e.mdia)===null||u===void 0||(l=u.minf)===null||l===void 0?void 0:l.stbl;if(!c)return;var h=c.stts,f=c.stsc,d=c.stsz,v=c.stco,m=c.stss,g=c.ctts;if(!h||!f||!d||!v||!m)return;r=va(h,f,d,v,g,m)}if(n){var b,k,E,w=(b=n.mdia)===null||b===void 0||(k=b.minf)===null||k===void 0?void 0:k.stbl;if(!w)return;var C=(E=n.mdia.mdhd)===null||E===void 0?void 0:E.timescale,B=w.stts,L=w.stsc,D=w.stsz,O=w.stco;if(!C||!B||!L||!D||!O)return;o=va(B,L,D,O)}return{videoSamples:r,audioSamples:o}}}}}]),s}();function va(s,a,i,t,e,n){var r=[],o=e==null?void 0:e.entries,u=a.entries,l=t.entries,c=i.entrySizes,h=n==null?void 0:n.entries,f;h&&(f={},h.forEach(function(L){f[L-1]=!0}));var d;o&&(d=[],o.forEach(function(L){for(var D=L.count,O=L.offset,R=0;R<D;R++)d.push(O)}));var v,m=-1,g=0,b=0,k=0,E=0,w=0,C=u[0].samplesPerChunk,B=u[1]?u[1].firstChunk-1:1/0;return s.entries.forEach(function(L){for(var D=L.count,O=L.delta,R=0;R<D;R++)v={dts:g,duration:O,size:c[b]||i.sampleSize,offset:l[k]+w,index:b},h&&(v.keyframe=f[b],v.keyframe&&m++,v.gopId=m),d&&b<d.length&&(v.pts=v.dts+d[b]),r.push(v),g+=O,b++,b<C?w+=v.size:(k++,w=0,k>=B&&(E++,B=u[E+1]?u[E+1].firstChunk-1:1/0),C+=u[E].samplesPerChunk)}),r}function dr(s,a){return s.dataReferenceIndex=ke(a,6),s.width=ke(a,24),s.height=ke(a,26),s.horizresolution=z(a,28),s.vertresolution=z(a,32),s.frameCount=ke(a,40),s.depth=ke(a,74),78}function pa(s,a){return s.dataReferenceIndex=ke(a,6),s.channelCount=ke(a,16),s.sampleSize=ke(a,18),s.sampleRate=z(a,24)/65536,28}function re(s,a,i){if(s){if(s.size!==s.data.length)throw new Error("box ".concat(s.type," size !== data.length"));var t={start:s.start,size:s.size,headerSize:s.headerSize,type:s.type};return a&&(t.version=s.data[s.headerSize],t.flags=Hd(s.data,s.headerSize+1),t.headerSize+=4),i(t,s.data.subarray(t.headerSize),t.start+t.headerSize),t}}var Yd=function(a,i,t){for(var e=String(t),n=i>>0,r=Math.ceil(n/e.length),o=[],u=String(a);r--;)o.push(e);return o.join("").substring(0,n-u.length)+u},vr=function(){for(var a=[],i=arguments.length,t=new Array(i),e=0;e<i;e++)t[e]=arguments[e];return t.forEach(function(n){a.push(Yd(Number(n).toString(16),2,0))}),a[0]},Xd=function(){function s(a,i,t){Ae(this,s),F(this,"__loadedMoofWraps",[]),F(this,"__lastRemainData",null),F(this,"__lastRemainDataStart",0),F(this,"__nextMoofStart",-1),this.videoTrack=a||new Eo,this.audioTrack=i||new ko,this.metadataTrack=t||new To}return Pe(s,[{key:"demuxPart",value:function(i,t,e){var n=this,r=this.videoTrack,o=this.audioTrack,u=r.exist(),l=o.exist(),c=/av01/.test(r.codec);r.samples=[],o.samples=[];var h=i,f=t;if(this.__lastRemainData){var d=this.__lastRemainDataStart+this.__lastRemainData.byteLength,v=t<=d&&t>this.__lastRemainDataStart&&t+i.byteLength>d;if(v){var m=i.subarray(this.__lastRemainData.byteLength+this.__lastRemainDataStart-t);h=Ze(this.__lastRemainData,m),f=this.__lastRemainDataStart,this.__lastRemainData=null}else this.__lastRemainData=null,this.__lastRemainDataStart=0,this.__nextMoofStart=-1}if(!e){var g=Ee.findBox(h,["moov"])[0];if(!g)throw new Error("cannot found moov box");e=Ee.moov(g)}if(h){var b=f+h.byteLength;!u&&!l&&Ee.moovToTrack(e,r,o);var k=[];this.__nextMoofStart<0?Ee.findBox(h,["moof"],f).forEach(function(L){return k.push(L)}):this.__nextMoofStart>=f&&this.__nextMoofStart<=b-8&&Ee.findBox(h.subarray(this.__nextMoofStart-f),["moof"],this.__nextMoofStart).forEach(function(L){return k.push(L)}),k.filter(function(L){return L.size<=L.data.length}).forEach(function(L){var D=Ee.moof(L);n.__nextMoofStart=D.start+Math.max.apply(Math,Xe(D.traf.map(function(O){return O.trun.samples.reduce(function(R,j){return R+j.size},O.trun.dataOffset||0)}))),n.__loadedMoofWraps.push({start:D.start,nextMoofStart:n.__nextMoofStart,moof:D}),n.__loadedMoofWraps.sort(function(O,R){return O.start-R.start})});var E=Id(this.__loadedMoofWraps),w;try{var C=function(){var D=w.value;if(D.start>b||D.nextMoofStart<f)return"continue";var O=D.start,R=Ee.moofToSamples(D.moof,r,o),j=r.baseMediaDecodeTime,y=o.baseMediaDecodeTime,_;Object.keys(R).forEach(function(S){r.id==S?R[S].some(function(P){var T=P.offset+=O;if(!(T<f)){if(T+P.size>b)return!0;var M=new Mr((P.pts||P.dts)+j,P.dts+j);M.duration=P.duration,M.gopId=P.gopId,P.keyframe&&M.setToKeyframe();var G=h.subarray(T-f,T-f+P.size);if(M.data=G,!c)for(var K=0,Z=G.length-1;K<Z;)_=z(G,K),K+=4,M.units.push(G.subarray(K,K+_)),K+=_;n.__lastRemainDataStart=T+P.size,r.samples.push(M)}}):o.id==S&&R[S].some(function(P){var T=P.offset+O;if(!(T<f)){if(T+P.size>b)return!0;var M=h.subarray(T-f,T-f+P.size);o.samples.push(new Li(P.dts+y,M,P.duration)),n.__lastRemainDataStart=T+P.size}})})};for(E.s();!(w=E.n()).done;)var B=C()}catch(L){E.e(L)}finally{E.f()}}return this.__lastRemainDataStart>f&&this.__lastRemainDataStart<h.byteLength+f?this.__lastRemainData=h.subarray(this.__lastRemainDataStart-f):(this.__lastRemainData=h,this.__lastRemainDataStart=f),r.samples.length&&(r.baseMediaDecodeTime=r.samples[0].pts),o.samples.length&&(o.baseMediaDecodeTime=o.samples[0].pts),{videoTrack:r,audioTrack:o,metadataTrack:this.metadataTrack}}},{key:"demux",value:function(i,t){var e=this.videoTrack,n=this.audioTrack,r=e.exist(),o=n.exist();if(e.samples=[],n.samples=[],t){if(!o){var u=Ee.findBox(t,["moov"])[0];if(!u)throw new Error("cannot found moov box");Ee.moovToTrack(Ee.moov(u),null,n)}var l=Ee.findBox(t,["moof"])[0];if(l){var c=Ee.moofToSamples(Ee.moof(l),null,n)[n.id],h=n.baseMediaDecodeTime;if(c){var f=l.start;c.map(function(w){w.offset+=f;var C=t.subarray(w.offset,w.offset+w.size);n.samples.push(new Li(w.dts+h,C,w.duration))})}}}if(i){if(!r&&!o){var d=Ee.findBox(i,["moov"])[0];if(!d)throw new Error("cannot found moov box");Ee.moovToTrack(Ee.moov(d),e,n)}var v=Ee.findBox(i,["moof"])[0];if(v){var m=Ee.moofToSamples(Ee.moof(v),e,n),g=e.baseMediaDecodeTime,b=n.baseMediaDecodeTime,k=v.start,E;Object.keys(m).forEach(function(w){e.id==w?m[w].map(function(C){C.offset+=k;var B=new Mr((C.pts||C.dts)+g,C.dts+g);B.duration=C.duration,B.gopId=C.gopId,C.keyframe&&B.setToKeyframe();var L=i.subarray(C.offset,C.offset+C.size);B.data=L;for(var D=0,O=L.length-1;D<O;)E=z(L,D),D+=4,B.units.push(L.subarray(D,D+E)),D+=E;e.samples.push(B)}):n.id==w&&m[w].map(function(C){C.offset+=k;var B=i.subarray(C.offset,C.offset+C.size);n.samples.push(new Li(C.dts+b,B,C.duration))})})}}return{videoTrack:e,audioTrack:n,metadataTrack:this.metadataTrack}}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset(),this.metadataTrack.reset()}}],[{key:"probe",value:function(i){return Ee.probe(i)}}]),s}();function qd(s){for(var a=0,i=arguments.length,t=new Array(i>1?i-1:0),e=1;e<i;e++)t[e-1]=arguments[e];t.forEach(function(o){a+=o.length});var n=new s(a),r=0;return t.forEach(function(o){n.set(o,r),r+=o.length}),n}var Be=function(){function s(){Ae(this,s),this.buffer=new Uint8Array(0)}return Pe(s,[{key:"write",value:function(){for(var i=this,t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach(function(r){r?i.buffer=qd(Uint8Array,i.buffer,r):window.console.warn(r)})}}],[{key:"writeUint16",value:function(i){return new Uint8Array([i>>8&255,i&255])}},{key:"writeUint32",value:function(i){return new Uint8Array([i>>24,i>>16&255,i>>8&255,i&255])}}]),s}(),ga=Math.pow(2,32)-1,le=function(){function s(){Ae(this,s)}return Pe(s,null,[{key:"box",value:function(i){for(var t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];e=e.filter(Boolean);var r=8+e.reduce(function(l,c){return l+c.byteLength},0),o=new Uint8Array(r);o[0]=r>>24&255,o[1]=r>>16&255,o[2]=r>>8&255,o[3]=r&255,o.set(i,4);var u=8;return e.forEach(function(l){o.set(l,u),u+=l.byteLength}),o}},{key:"ftyp",value:function(i){var t=i.find(function(e){return e.type===Rt.VIDEO&&e.codecType===Mt.HEVC});return t?s.FTYPHEV1:s.FTYPAVC1}},{key:"initSegment",value:function(i){var t=s.ftyp(i),e=Ze(t,s.moov(i));return e}},{key:"pssh",value:function(i){var t=new Uint8Array([1,0,0,0].concat([16,119,239,236,192,178,77,2,172,227,60,30,82,226,251,75],[0,0,0,1],ha(i.kid),[0,0,0,0]));return s.box(s.types.pssh,t)}},{key:"moov",value:function(i){if(i[0].useEME&&(i[0].encv||i[0].enca)){i[0].pssh||(i[0].pssh={kid:i[0].kid});var t=this.pssh(i[0].pssh);return s.box.apply(s,[s.types.moov,s.mvhd(i[0].mvhdDurtion||i[0].duration,i[0].mvhdTimecale||i[0].timescale),s.mvex(i)].concat(Xe(i.map(function(e){return s.trak(e)})),[t]))}else return s.box.apply(s,[s.types.moov,s.mvhd(i[0].mvhdDurtion||i[0].duration,i[0].mvhdTimecale||i[0].timescale)].concat(Xe(i.map(function(e){return s.trak(e)})),[s.mvex(i)]))}},{key:"mvhd",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:9e4,e=s.box(s.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255,i>>24&255,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]));return e}},{key:"trak",value:function(i){var t=s.box(s.types.trak,s.tkhd(i.id,i.tkhdDuration||0,i.width,i.height),s.mdia(i));return t}},{key:"tkhd",value:function(i,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,r=s.box(s.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,i>>24&255,i>>16&255,i>>8&255,i&255,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,e>>8&255,e&255,0,0,n>>8&255,n&255,0,0]));return r}},{key:"mdia",value:function(i){var t=s.box(s.types.mdia,s.mdhd(i.duration,i.timescale),s.hdlr(i.type),s.minf(i));return t}},{key:"mdhd",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:9e4,e=s.box(s.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255,i>>24&255,i>>16&255,i>>8&255,i&255,85,196,0,0]));return e}},{key:"hdlr",value:function(i){var t=s.box(s.types.hdlr,s.HDLR_TYPES[i]);return t}},{key:"minf",value:function(i){var t=s.box(s.types.minf,i.type===Rt.VIDEO?s.VMHD:s.SMHD,s.DINF,s.stbl(i));return t}},{key:"stbl",value:function(i){var t=[];i&&i.ext&&i.ext.stss&&t.push(s.stss(i.ext.stss.entries));var e=s.box(s.types.stbl,s.stsd(i),s.STTS,t[0],s.STSC,s.STSZ,s.STCO);return e}},{key:"stsd",value:function(i){var t;i.type==="audio"?i.useEME&&i.enca?t=s.enca(i):i.codecType===It.OPUS?t=s.opus(i):t=s.mp4a(i):i.useEME&&i.encv?t=s.encv(i):i.av1C?t=s.av01(i):t=s.avc1hev1(i);var e=s.box(s.types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),t);return e}},{key:"enca",value:function(i){var t=i.enca.channelCount,e=i.enca.sampleRate,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t,0,16,0,0,0,0,e>>8&255,e&255,0,0]),r=s.esds(i.config),o=s.sinf(i.enca);return s.box(s.types.enca,n,r,o)}},{key:"encv",value:function(i){var t,e,n=i.sps.length>0?i.sps[0]:[],r=i.pps.length>0?i.pps[0]:[],o=i.width,u=i.height,l=i.sarRatio[0],c=i.sarRatio[1],h=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,o&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),f=new Uint8Array((t=(e=[1,n[1],n[2],n[3],255,225,n.length>>>8&255,n.length&255]).concat.apply(e,Xe(n)).concat([1,r.length>>>8&255,r.length&255])).concat.apply(t,Xe(r))),d=new Uint8Array([0,0,88,57,0,15,200,192,0,4,86,72]),v=s.sinf(i.encv),m=new Uint8Array([l>>24,l>>16&255,l>>8&255,l&255,c>>24,c>>16&255,c>>8&255,c&255]);return s.box(s.types.encv,h,s.box(s.types.avcC,f),s.box(s.types.btrt,d),v,s.box(s.types.pasp,m))}},{key:"schi",value:function(i){var t=new Uint8Array([]),e=s.tenc(i);return s.box(s.types.schi,t,e)}},{key:"tenc",value:function(i){var t=new Uint8Array([0,0,0,0,0,0,i.default_IsEncrypted&255,i.default_IV_size&255].concat(ha(i.default_KID)));return s.box(s.types.tenc,t)}},{key:"sinf",value:function(i){var t=new Uint8Array([]),e=new Uint8Array([i.data_format.charCodeAt(0),i.data_format.charCodeAt(1),i.data_format.charCodeAt(2),i.data_format.charCodeAt(3)]),n=new Uint8Array([0,0,0,0,99,101,110,99,0,1,0,0]),r=s.schi(i);return s.box(s.types.sinf,t,s.box(s.types.frma,e),s.box(s.types.schm,n),r)}},{key:"av01",value:function(i){return s.box(s.types.av01,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i.width>>8&255,i.width&255,i.height>>8&255,i.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i.av1C,i.colr)}},{key:"avc1hev1",value:function(i){var t=i.codecType===Mt.HEVC,e=t?s.types.hvc1:s.types.avc1,n=t?s.hvcC(i):s.avcC(i),r=[new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i.width>>8&255,i.width&255,i.height>>8&255,i.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),n];return t?r.push(s.box(s.types.fiel,new Uint8Array([1,0]))):i.sarRatio&&i.sarRatio.length>1&&r.push(s.pasp(i.sarRatio)),s.box.apply(s,[e].concat(r))}},{key:"avcC",value:function(i){var t,e,n=[],r=[],o;return i.sps.forEach(function(u){o=u.byteLength,n.push(o>>>8&255),n.push(o&255),n.push.apply(n,Xe(u))}),i.pps.forEach(function(u){o=u.byteLength,r.push(o>>>8&255),r.push(o&255),r.push.apply(r,Xe(u))}),s.box(s.types.avcC,new Uint8Array((t=(e=[1,n[3],n[4],n[5],255,224|i.sps.length]).concat.apply(e,n).concat([i.pps.length])).concat.apply(t,r)))}},{key:"hvcC",value:function(i){var t=i.hvcC;if(t instanceof ArrayBuffer||t instanceof Uint8Array)return t;var e=i.vps,n=i.sps,r=i.pps,o;if(t){var u=t.generalProfileCompatibilityFlags,l=t.generalConstraintIndicatorFlags,c=(e.length&&1)+(n.length&&1)+(r.length&&1);o=[1,t.generalProfileSpace<<6|t.generalTierFlag<<5|t.generalProfileIdc,u>>>24,u>>>16,u>>>8,u,l[0],l[1],l[2],l[3],l[4],l[5],t.generalLevelIdc,240,0,252,t.chromaFormatIdc|252,t.bitDepthLumaMinus8|248,t.bitDepthChromaMinus8|248,0,0,t.numTemporalLayers<<3|t.temporalIdNested<<2|3,c];var h=function(d){var v;o.push(d.length>>8,d.length),(v=o).push.apply(v,Xe(d))};e.length&&(o.push(160,0,e.length),e.forEach(h)),n.length&&(o.push(161,0,n.length),n.forEach(h)),r.length&&(o.push(162,0,r.length),r.forEach(h))}else o=[1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64];return s.box(s.types.hvcC,new Uint8Array(o))}},{key:"pasp",value:function(i){var t=Cd(i,2),e=t[0],n=t[1];return s.box(s.types.pasp,new Uint8Array([e>>24,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255]))}},{key:"mp4a",value:function(i){return s.box(s.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i.channelCount,0,16,0,0,0,0,i.sampleRate>>8&255,i.sampleRate&255,0,0]),i.config.length?s.esds(i.config):void 0)}},{key:"esds",value:function(i){var t=i.length,e=s.box(s.types.esds,new Uint8Array([0,0,0,0,3,23+t,0,0,0,4,15+t,64,21,0,6,0,0,0,218,192,0,0,218,192,5].concat([t]).concat(i).concat([6,1,2])));return e}},{key:"opus",value:function(i){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i.channelCount,0,16,0,0,0,0,i.sampleRate>>8&255,i.sampleRate&255,0,0]),e=i.config.length?s.dOps(i):[];return s.box(s.types.Opus,t,e)}},{key:"dOps",value:function(i){if(i.config)return i.config[4]=i.sampleRate>>>24&255,i.config[5]=i.sampleRate>>>16&255,i.config[6]=i.sampleRate>>>8&255,i.config[7]=i.sampleRate&255,s.box(s.types.dOps,i.config)}},{key:"mvex",value:function(i){var t=s.box.apply(s,[s.types.mvex].concat(Xe(i.map(function(e){return s.trex(e.id)}))));return t}},{key:"trex",value:function(i){var t=s.box(s.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]));return t}},{key:"trex1",value:function(i){var t=s.box(s.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,0,0,0,1,0,0,2,0,0,0,0,0,0,1,0,0]));return t}},{key:"trex2",value:function(i){var t=s.box(s.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,0,0,0,1,0,0,4,0,0,0,0,0,2,0,0,0]));return t}},{key:"moof",value:function(i){var t=s.box.apply(s,[s.types.moof,s.mfhd(i[0].samples?i[0].samples[0].gopId:0)].concat(Xe(i.map(function(e){return s.traf(e)}))));return t}},{key:"mfhd",value:function(i){var t=s.box(s.types.mfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255]));return t}},{key:"traf",value:function(i){var t=s.tfhd(i.id),e=s.tfdt(i,i.baseMediaDecodeTime),n=0,r;if(i.isVideo&&i.videoSenc&&(r=i.videoSenc,r.forEach(function(_){n=n+8,_.subsamples&&_.subsamples.length&&(n=n+2,n=n+_.subsamples.length*6)})),i.videoSencLength=n,!i.useEME||!i.isVideoEncryption&&!i.isAudioEncryption){var o=s.sdtp(i),u=76;return s.box(s.types.traf,t,e,o,s.trun(i.samples,o.byteLength+u))}else if(i.isVideoEncryption)if(i.isVideo){var l=s.saiz(i),c=s.saio(i),h=s.trun1(i),f=s.senc(i),d=s.box(s.types.traf,t,e,l,c,h,f);return d}else if(i.isAudioEncryption){var g=s.sbgp(),b=s.saiz(i),k=s.saio(i),E=s.senc(i),w=s.trun1(i),C=s.box(s.types.traf,t,e,g,b,k,E,w);return C}else{var v=s.sbgp(),m=s.trun1(i);return s.box(s.types.traf,t,e,v,m)}else if(i.isVideo){var B=s.trun1(i);return s.box(s.types.traf,t,e,B)}else{var L=s.sbgp(),D=s.saiz(i),O=s.saio(i),R=s.senc(i),j=s.trun1(i),y=s.box(s.types.traf,t,e,L,D,O,R,j);return y}}},{key:"sdtp",value:function(i){var t=new Be;return i.samples.forEach(function(e){t.write(new Uint8Array(i.isVideo?[e.keyframe?32:16]:[16]))}),s.box(s.types.sdtp,this.extension(0,0),t.buffer)}},{key:"trun1",value:function(i){var t=new Be,e=Be.writeUint32(i.samples.length),n=null;if(i.isVideo){var r=i.videoSencLength;n=Be.writeUint32(i.samples.length*16+r+149),!i.isVideoEncryption&&i.isAudioEncryption&&(n=Be.writeUint32(i.samples.length*16+92))}else{var o=i.samples.length*12+124;i.isAudioEncryption&&(o=i.samples.length*12+8*i.audioSenc.length+177),n=Be.writeUint32(o)}return i.samples.forEach(function(u){t.write(Be.writeUint32(u.duration)),t.write(Be.writeUint32(u.size)),t.write(Be.writeUint32(u.keyframe?33554432:65536)),i.isVideo&&t.write(Be.writeUint32(u.cts?u.cts:0))}),s.box(s.types.trun,this.extension(0,i.flags),e,n,t.buffer)}},{key:"senc",value:function(i){var t=new Be,e=i.samples.length,n=i.isVideo?16:8,r=i.isVideo?2:0,o=[],u=0;return i.isVideo?(o=i.videoSenc,u=i.videoSencLength):o=i.audioSenc,u=u||n*e,t.write(Be.writeUint32(16+u),s.types.senc,this.extension(0,r)),t.write(Be.writeUint32(e)),o.forEach(function(l){for(var c=0;c<l.InitializationVector.length;c++)t.write(new Uint8Array([l.InitializationVector[c]]));l.subsamples&&l.subsamples.length&&(t.write(Be.writeUint16(l.subsamples.length)),l.subsamples.forEach(function(h){t.write(Be.writeUint16(h.BytesOfClearData)),t.write(Be.writeUint32(h.BytesOfProtectedData))}))}),t.buffer}},{key:"saio",value:function(i){var t=i.samples.length*12+141;!i.isVideo&&i.isAudioEncryption&&(t=149);var e=new Uint8Array([1,0,0,0,0,0,0,1,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]);return s.box(s.types.saio,e)}},{key:"saiz",value:function(i){var t=i.samples.length,e=new Uint8Array([0,0,0,0,16,t>>24&255,t>>16&255,t>>8&255,t&255]);return s.box(s.types.saiz,e)}},{key:"sbgp",value:function(){var i=new Uint8Array([114,111,108,108,0,0,0,1,0,0,1,25,0,0,0,1]);return s.box(s.types.sbgp,this.extension(0,0),i)}},{key:"extension",value:function(i,t){return new Uint8Array([i,t>>16&255,t>>8&255,t&255])}},{key:"tfhd",value:function(i){return s.box(s.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255]))}},{key:"tfdt",value:function(i,t){var e=Math.floor(t/(ga+1)),n=Math.floor(t%(ga+1));return i.useEME&&(i.isVideoEncryption||i.isAudioEncryption)?s.box(s.types.tfdt,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255])):s.box(s.types.tfdt,new Uint8Array([1,0,0,0,e>>24,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255]))}},{key:"trun",value:function(i,t){var e=i.length,n=12+16*e;t+=8+n;var r=new Uint8Array(n);r.set([0,0,15,1,e>>>24&255,e>>>16&255,e>>>8&255,e&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0);for(var o=0;o<e;o++){var u=i[o],l=u.duration,c=u.size,h=u.flag,f=h===void 0?{}:h,d=u.cts,v=d===void 0?0:d;r.set([l>>>24&255,l>>>16&255,l>>>8&255,l&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,f.isLeading<<2|(f.dependsOn===null||f.dependsOn===void 0?1:f.dependsOn),f.isDependedOn<<6|f.hasRedundancy<<4|f.paddingValue<<1|(f.isNonSyncSample===null||f.isNonSyncSample===void 0?1:f.isNonSyncSample),f.degradationPriority&61440,f.degradationPriority&15,v>>>24&255,v>>>16&255,v>>>8&255,v&255],12+16*o)}return s.box(s.types.trun,r)}},{key:"moovMP4",value:function(i){return s.box.apply(s,[s.types.moov,s.mvhd(i[0].duration,i[0].timescale)].concat(Xe(i.map(function(t){return s.trackMP4(t)}))))}},{key:"trackMP4",value:function(i){return s.box(s.types.trak,s.tkhd(i.id,i.duration,i.width,i.height),s.mdiaMP4(i))}},{key:"mdiaMP4",value:function(i){return s.box(s.types.mdia,s.mdhd(i.duration,i.timescale),s.hdlr(i.type),s.minfMP4(i))}},{key:"minfMP4",value:function(i){return s.box(s.types.minf,i.type===Rt.VIDEO?s.VMHD:s.SMHD,s.DINF,s.stblMP4(i))}},{key:"stblMP4",value:function(i){var t=i.ext,e=[s.stsd(i),s.stts(t.stts),s.stsc(t.stsc),s.stsz(t.stsz),s.stco(t.stco)];return t.stss.length&&e.push(s.stss(t.stss)),t.ctts.length&&e.push(s.ctts(t.ctts)),s.box.apply(s,[s.types.stbl].concat(e))}},{key:"stts",value:function(i){var t=i.length,e=new Uint8Array(8*t),n=0;return i.forEach(function(r){var o=r.value,u=r.count;e.set([u>>24,u>>16&255,u>>8&255,u&255,o>>24,o>>16&255,o>>8&255,o&255],n),n+=8}),s.box(s.types.stts,Ze(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),e))}},{key:"stsc",value:function(i){var t=i.length,e=new Uint8Array(12*t),n=0;return i.forEach(function(r){var o=r.firstChunk,u=r.samplesPerChunk,l=r.sampleDescIndex;e.set([o>>24,o>>16&255,o>>8&255,o&255,u>>24,u>>16&255,u>>8&255,u&255,l>>24,l>>16&255,l>>8&255,l&255],n),n+=12}),s.box(s.types.stsc,Ze(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),e))}},{key:"stsz",value:function(i){var t=i.length,e=new Uint8Array(4*t),n=0;return i.forEach(function(r){e.set([r>>24,r>>16&255,r>>8&255,r&255],n),n+=4}),s.box(s.types.stsz,Ze(new Uint8Array([0,0,0,0,0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),e))}},{key:"stco",value:function(i){var t=i.length,e=new Uint8Array(4*t),n=0;return i.forEach(function(r){e.set([r>>24,r>>16&255,r>>8&255,r&255],n),n+=4}),s.box(s.types.stco,Ze(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),e))}},{key:"stss",value:function(i){var t=i.length,e=new Uint8Array(4*t),n=0;return i.forEach(function(r){e.set([r>>24,r>>16&255,r>>8&255,r&255],n),n+=4}),s.box(s.types.stss,Ze(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),e))}},{key:"ctts",value:function(i){var t=i.length,e=new Uint8Array(8*t),n=0;return i.forEach(function(r){var o=r.value,u=r.count;e.set([u>>24,u>>16&255,u>>8&255,u&255,o>>24,o>>16&255,o>>8&255,o&255],n),n+=8}),s.box(s.types.ctts,Ze(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),e))}},{key:"styp",value:function(){return s.box(s.types.styp,new Uint8Array([109,115,100,104,0,0,0,0,109,115,100,104,109,115,105,120]))}},{key:"sidx",value:function(i){var t=i.timescale,e=i.samples[0].duration,n=e*i.samples.length,r=i.samples[0].sampleOffset*e,o=8;i.samples.forEach(function(f){o+=f.size});var u=0;if(i.isVideo){var l=0,c;i.videoSenc&&(c=i.videoSenc),i.isVideo&&c.forEach(function(f){l=l+8,f.subsamples&&f.subsamples.length&&(l=l+2,l=l+f.subsamples.length*6)}),i.videoSencLength=l,u=o+141+i.samples.length*16+l,i.useEME&&i.isAudioEncryption&&!i.isVideoEncryption&&(u=o+i.samples.length*16+84)}else u=o+116+i.samples.length*12,i.useEME&&i.isAudioEncryption&&(u=o+169+i.samples.length*12+8*i.audioSenc.length);var h=new Uint8Array([0,0,0,0,0,0,0,i.id&255,t>>24&255,t>>16&255,t>>8&255,t&255,r>>24&255,r>>16&255,r>>8&255,r&255,0,0,0,0,0,0,0,1,0,u>>16&255,u>>8&255,u&255,n>>24&255,n>>16&255,n>>8&255,n&255,144,0,0,0]);return s.box(s.types.sidx,h)}},{key:"mdat",value:function(i){var t=s.box(s.types.mdat,i);return t}}]),s}();F(le,"types",["Opus","dOps","av01","av1C","avc1","avcC","hvc1","hvcC","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","pasp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trex","tkhd","vmhd","smhd","ctts","stss","styp","pssh","sidx","sbgp","saiz","saio","senc","trun","encv","enca","sinf","btrt","frma","tenc","schm","schi","mehd","fiel","sdtp"].reduce(function(s,a){return s[a]=[a.charCodeAt(0),a.charCodeAt(1),a.charCodeAt(2),a.charCodeAt(3)],s},Object.create(null)));F(le,"HDLR_TYPES",{video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])});F(le,"FTYPAVC1",le.box(le.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49])));F(le,"FTYPHEV1",le.box(le.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,104,101,118,49])));F(le,"DINF",le.box(le.types.dinf,le.box(le.types.dref,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]))));F(le,"VMHD",le.box(le.types.vmhd,new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])));F(le,"SMHD",le.box(le.types.smhd,new Uint8Array([0,0,0,0,0,0,0,0])));F(le,"StblTable",new Uint8Array([0,0,0,0,0,0,0,0]));F(le,"STTS",le.box(le.types.stts,le.StblTable));F(le,"STSC",le.box(le.types.stsc,le.StblTable));F(le,"STSZ",le.box(le.types.stsz,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0])));F(le,"STCO",le.box(le.types.stco,le.StblTable));var Ao=function(){function s(a,i){Ae(this,s),this.name=a||"",this._prefix="[".concat(this.name,"]"),s.disabled=i}return Pe(s,[{key:"debug",value:function(){var i;if(!s.disabled){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];(i=console).debug.apply(i,[this._prefix].concat(e))}}},{key:"log",value:function(){var i;if(!s.disabled){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];(i=console).log.apply(i,[this._prefix].concat(e))}}},{key:"warn",value:function(){var i;if(!s.disabled){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];(i=console).warn.apply(i,[this._prefix].concat(e))}}},{key:"error",value:function(){var i;if(!s.disabled){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];(i=console).error.apply(i,[this._prefix].concat(e))}}},{key:"table",value:function(){var i;s.disabled||(console.group(this._prefix),(i=console).table.apply(i,arguments),console.groupEnd())}}],[{key:"enable",value:function(){s.disabled=!1}},{key:"disable",value:function(){s.disabled=!0}}]),s}();F(Ao,"disabled",!0);var Qd=function(){function s(a,i,t){Ae(this,s),this.videoTrack=a,this.audioTrack=i;var e=/Chrome\/([^.]+)/.exec(navigator.userAgent);this.forceFirstIDR=e&&Number(e[1])<50,this.log=new Ao("FMP4Remuxer",t&&t.openLog?!t.openLog:!0)}return Pe(s,[{key:"remux",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=this.videoTrack,n=this.audioTrack,r=e.exist(),o=n.exist(),u,l,c,h=[];i&&(t&&t.initMerge?(r&&h.push(this.videoTrack),o&&h.push(this.audioTrack),c=le.initSegment(h)):(r&&(u=le.initSegment([this.videoTrack])),o&&(l=le.initSegment([this.audioTrack]))));var f,d;return r&&e.hasSample()&&(f=this._remuxVideo()),o&&n.hasSample()&&(d=this._remuxAudio()),e.samples=[],n.samples=[],{initSegment:c,videoInitSegment:u,audioInitSegment:l,videoSegment:f,audioSegment:d}}},{key:"_remuxVideo",value:function(){var i=this.videoTrack;this.forceFirstIDR&&(i.samples[0].flag={dependsOn:2,isNonSyncSample:0});var t=i.samples,e=/av01/.test(i.codec),n=0;e?t.forEach(function(E){n+=E.data.byteLength}):t.forEach(function(E){n+=E.units.reduce(function(w,C){return w+C.byteLength},0),n+=E.units.length*4});var r=new Uint8Array(n);if(e)for(var o=0,u=t.length,l=0,c;o<u;o++)c=t[o],r.set(c.data,l),c.size=c.data.byteLength,l+=c.size;else for(var h=new DataView(r.buffer),f=function(w,C){C=t[d];var B=0;C.units.forEach(function(L){h.setUint32(w,L.byteLength),w+=4,r.set(L,w),w+=L.byteLength,B+=4+L.byteLength}),C.size=B,m=w,g=C},d=0,v=t.length,m=0,g;d<v;d++)f(m,g);var b=le.mdat(r),k=le.moof([i]);return Ze(k,b)}},{key:"_remuxAudio",value:function(){var i=this.audioTrack,t=new Uint8Array(i.samples.reduce(function(r,o){return r+o.size},0));i.samples.reduce(function(r,o){return t.set(o.data,r),r+o.size},0);var e=le.mdat(t),n=le.moof([i]);return Ze(n,e)}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset()}}]),s}(),Jd=function(){function s(){Oe(this,s);var a=window.crypto||window.msCrypto;this.subtle=a&&(a.subtle||a.webkitSubtle),this.externalDecryptor=null}return Re(s,[{key:"destroy",value:function(){var i;(i=this.externalDecryptor)!==null&&i!==void 0&&i.destroy&&this.externalDecryptor.destroy()}},{key:"decrypt",value:function(i,t){if(!(!i&&!t)){var e=[];return i&&(e[0]=this._decryptSegment(i)),t&&(e[1]=this._decryptSegment(t)),Promise.all(e)}}},{key:"_decryptSegment",value:function(){var a=ve(W().mark(function t(e){var n;return W().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(n=e.data,!e.key){o.next=5;break}return o.next=4,this._decryptData(e.data,e.key,e.keyIv);case 4:n=o.sent;case 5:if(e.map){o.next=7;break}return o.abrupt("return",n);case 7:return o.abrupt("return",fn(e.map,n));case 8:case"end":return o.stop()}},t,this)}));function i(t){return a.apply(this,arguments)}return i}()},{key:"_decryptData",value:function(){var a=ve(W().mark(function t(e,n,r){var o;return W().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!this.externalDecryptor){l.next=6;break}return l.next=3,this.externalDecryptor.decrypt(e,n,r);case 3:return l.abrupt("return",l.sent);case 6:if(this.subtle){l.next=8;break}throw new Error("crypto is not defined");case 8:return l.next=10,this.subtle.importKey("raw",n,{name:"AES-CBC"},!1,["encrypt","decrypt"]);case 10:return o=l.sent,l.t0=Uint8Array,l.next=14,this.subtle.decrypt({name:"AES-CBC",iv:r},o,e);case 14:return l.t1=l.sent,l.abrupt("return",new l.t0(l.t1));case 16:case"end":return l.stop()}},t,this)}));function i(t,e,n){return a.apply(this,arguments)}return i}()}]),s}(),de=ge(ge({},ee),{},{STREAM_PARSED:"core.streamparsed",NO_AUDIO_TRACK:"core.noaudiotrack",SUBTITLE_SEGMENTS:"core.subtitlesegments",SUBTITLE_PLAYLIST:"core.subtitleplaylist",SEI_PAYLOAD_TIME:"core.seipayloadtime",APPEND_COST:"core.appendcost"}),pr=new mt("Transmuxer"),ma=function(){function s(a,i,t,e){Oe(this,s),A(this,"_initSegmentId",""),this.hls=a,this._demuxer=i?new Xd:new Co(null,null,null,e),this._isMP4=i,t&&(this._remuxer=new Qd(this._demuxer.videoTrack,this._demuxer.audioTrack))}return Re(s,[{key:"transmux",value:function(i,t,e,n,r,o){var u=this._demuxer;try{this._isMP4?u.demux(i,t):u.demuxAndFix(fn(i,t),e,n,r)}catch(B){throw new Ce(ce.DEMUX,ce.SUB_TYPES.HLS,B)}var l=u.videoTrack,c=u.audioTrack,h=u.metadataTrack,f={codec:l.codec,timescale:l.timescale,firstDts:l.firstDts/l.timescale,firstPts:l.firstPts/l.timescale,duration:l.samplesDuration/l.timescale},d={codec:c.codec,timescale:c.timescale,firstDts:c.firstDts/l.timescale,firstPts:c.firstPts/l.timescale,duration:c.samplesDuration/l.timescale},v="".concat(l.codec,"/").concat(l.width,"/").concat(l.height,"/").concat(c.codec,"/").concat(c.config);if(v!==this._initSegmentId&&(this._initSegmentId=v,o=!0),this._fireEvents(l,c,h,e||o),this.hls.emit(de.DEMUXED_TRACK,{videoTrack:l,audioTrack:c}),this._remuxer){o&&this.hls.isLive&&!this.hls.config.mseLowLatency&&(l.duration=this.hls.totalDuration*l.timescale,c.duration=this.hls.totalDuration*c.timescale);try{var m=this._remuxer.remux(o),g=m.videoInitSegment,b=m.videoSegment,k=m.audioInitSegment,E=m.audioSegment,w=fn(g,b),C=fn(k,E);return[w?ge(ge({},f),{},{data:w}):void 0,C?ge(ge({},d),{},{data:C}):void 0]}catch(B){throw new Ce(ce.REMUX,ce.SUB_TYPES.FMP4,B)}}else return[l,c]}},{key:"_fireEvents",value:function(i,t,e,n){var r=this,o=[i,t],u="discontinuity: ".concat(n);o.forEach(function(l){var c;(c=l.samples)!==null&&c!==void 0&&c.length&&(u+="; ".concat(l.samples.length," ").concat(l.type===Rt.VIDEO?"video":"audio"," samples, firstDts/firstPts/duration: ").concat((l.firstDts/l.timescale).toFixed(3),"/").concat((l.firstPts/l.timescale).toFixed(3),"/").concat((l.samplesDuration/l.timescale).toFixed(3))),n&&l.exist()&&r.hls.emit(de.METADATA_PARSED,{type:l.type,track:l,meta:ge({codec:l.codec,timescale:l.timescale,baseDts:l.baseDts},l.type===Rt.VIDEO?{width:l.width,height:l.height,sarRatio:l.sarRatio}:{codec:l.codec,channelCount:l.channelCount,sampleRate:l.sampleRate})})}),pr.debug(u),i.warnings.forEach(function(l){var c;switch(l.type){case rt.LARGE_AV_SHIFT:c=de.LARGE_AV_FIRST_FRAME_GAP_DETECT;break;case rt.LARGE_VIDEO_GAP:c=de.LARGE_VIDEO_DTS_GAP_DETECT;break;case rt.LARGE_VIDEO_GAP_BETWEEN_CHUNK:c=de.MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT;break}c&&r.hls.emit(de.STREAM_EXCEPTION,ge(ge({},l),{},{type:c})),pr.warn("video exception",l)}),t.warnings.forEach(function(l){var c;switch(l.type){case rt.LARGE_AUDIO_GAP:c=de.LARGE_AUDIO_DTS_GAP_DETECT;break;case rt.AUDIO_FILLED:c=de.AUDIO_GAP_DETECT;break;case rt.AUDIO_DROPPED:c=de.AUDIO_OVERLAP_DETECT;break}c&&r.hls.emit(de.STREAM_EXCEPTION,ge(ge({},l),{},{type:c})),pr.warn("audio exception",l)}),i.samples.forEach(function(l){l.keyframe&&r.hls.emit(de.KEYFRAME,{pts:l.pts})}),e.seiSamples.forEach(function(l){r.hls.emit(de.SEI,ge(ge({},l),{},{originPts:l.originPts/90,sei:{code:l.data.type,content:l.data.payload,dts:l.pts}}))})}}]),s}(),Zd=["data"],ev=["data"],ya=new mt("BufferService"),tv=function(){function s(a){var i=this;Oe(this,s),A(this,"_decryptor",new Jd),A(this,"_transmuxer",null),A(this,"_mse",null),A(this,"_softVideo",null),A(this,"_sourceCreated",!1),A(this,"_needInitSegment",!0),A(this,"_directAppend",!1),this.hls=a,a.config.softDecode?this._softVideo=a.media:(this._mse=new Ye(null,{preferMMS:a.config.preferMMS}),a.config.url&&this._mse.bindMedia(a.media).then(function(t){i.hls.emit(ee.MEDIASOURCE_OPENED,t)})),a.config.decryptor&&(this._decryptor.externalDecryptor=a.config.decryptor)}return Re(s,[{key:"baseDts",get:function(){var i,t,e;return(i=this._transmuxer)===null||i===void 0||(t=i._demuxer)===null||t===void 0||(e=t._fixer)===null||e===void 0?void 0:e._baseDts}},{key:"nbSb",get:function(){var i;return(i=this._mse)!==null&&i!==void 0&&i._sourceBuffer?Object.keys(this._mse._sourceBuffer).length:0}},{key:"msIsOpened",get:function(){var i;return(i=this._mse)===null||i===void 0?void 0:i.isOpened}},{key:"msHasOpTasks",get:function(){var i;return(i=this._mse)===null||i===void 0?void 0:i.hasOpTasks}},{key:"msStreaming",get:function(){var i;return(i=this._mse)===null||i===void 0?void 0:i.streaming}},{key:"updateDuration",value:function(){var a=ve(W().mark(function t(e){return W().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(ya.debug("update duration",e),!this._mse){r.next=9;break}if(this._mse.isOpened){r.next=5;break}return r.next=5,this._mse.open();case 5:return r.next=7,this._mse.updateDuration(e);case 7:r.next=10;break;case 9:this._softVideo&&(this._softVideo.duration=e);case 10:case"end":return r.stop()}},t,this)}));function i(t){return a.apply(this,arguments)}return i}()},{key:"createSource",value:function(i,t,e,n){if(!this._sourceCreated){var r=i||t;if(r){if(Co.probe(r))this._transmuxer||(this._transmuxer=new ma(this.hls,!1,!this._softVideo,this.hls.config.fixerConfig));else if(Ee.probe(r))if(this._softVideo)this._transmuxer||(this._transmuxer=new ma(this.hls,!0,null,this.hls.config.fixerConfig));else{this._directAppend=!0;var o=!1;i&&!e&&Ee.findBox(i,["moov","trak"]).forEach(function(u){var l=Ee.findBox(u.data,["trak","mdia","minf","stbl","stsd"])[0];if(l){var c=Ee.stsd(l).entries[0];if(c){if(c.hvcC)e=c.hvcC.codec||"hev1.1.6.L93.B0";else if(c.avcC)e=c.avcC.codec;else if(c.sampleRate||c.esds){var h;n=((h=c.esds)===null||h===void 0?void 0:h.codec)||"mp4a.40.2",o=!0}}}}),t&&!n&&Ee.findBox(t,["moov","trak","mdia","minf","stbl","stsd"]).forEach(function(u){var l=Ee.stsd(u).entries[0];l&&l.esds&&(n=l.esds.codec)}),i&&!e&&(e="avc1.42e01e"),t&&!n&&(n="mp4a.40.2"),o&&(e+=", ".concat(n),n=""),this._createMseSource(e,n)}else throw new Ce(ce.OTHER,null,null,null,"unsupported stream");this._softVideo&&(this._sourceCreated=!0)}}}},{key:"appendBuffer",value:function(){var a=ve(W().mark(function t(e,n,r,o,u,l,c){var h=this,f,d,v,m,g,b,k,E,w,C,B,L,D,O;return W().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(!(!(r!=null&&r.length)&&!(o!=null&&o.length))){j.next=2;break}return j.abrupt("return");case 2:if(f=function(){var _;if((_=h.hls)!==null&&_!==void 0&&_.emit){var S;(S=h.hls)===null||S===void 0||S.emit(ee.APPEND_BUFFER,{start:e.start,end:e.end})}},!this._directAppend){j.next=8;break}return d=[],r&&d.push(this._mse.append(Ye.VIDEO,r)),o&&d.push(this._mse.append(Ye.AUDIO,o)),j.abrupt("return",Promise.all(d).then(f));case 8:if(v=this._needInitSegment||u,m=this._transmuxer.transmux(r,o,v,l,c,this._needInitSegment||u),g=At(m,2),b=g[0],k=g[1],o&&n&&(n==null||n.setTrackExist(!1,!0)),o&&e&&(e==null||e.setTrackExist(!0,!1)),n||e==null||e.setTrackExist(!!b,!!k),b&&!k&&this.hls.emit(de.NO_AUDIO_TRACK),!this._softVideo){j.next=20;break}this._softVideo.appendBuffer(b,k),this._needInitSegment=!1,f(),j.next=30;break;case 20:if(!this._mse){j.next=30;break}return E=!this._sourceCreated,E&&this._createMseSource(b==null?void 0:b.codec,k==null?void 0:k.codec),this._needInitSegment=!1,w=this._mse,C=[],v&&!E&&this._handleCodecChange(b,k).forEach(function(y){return C.push(y)}),b&&(B=b.data,L=Pr(b,Zd),C.push(w.append(Ye.VIDEO,B,L))),k&&(D=k.data,O=Pr(k,ev),C.push(w.append(Ye.AUDIO,D,O))),j.abrupt("return",Promise.all(C).then(f));case 30:case"end":return j.stop()}},t,this)}));function i(t,e,n,r,o,u,l){return a.apply(this,arguments)}return i}()},{key:"removeBuffer",value:function(){var a=ve(W().mark(function t(){var e=this,n,r,o,u=arguments;return W().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(n=u.length>0&&u[0]!==void 0?u[0]:0,r=u.length>1&&u[1]!==void 0?u[1]:1/0,o=this.hls.media,!(!this._mse||!o||n<0||r<n||n>=this._mse.duration)){c.next=5;break}return c.abrupt("return");case 5:return c.abrupt("return",this._mse.clearBuffer(n,r).then(function(){return e.hls.emit(ee.REMOVE_BUFFER,{start:n,end:r,removeEnd:r})}));case 6:case"end":return c.stop()}},t,this)}));function i(){return a.apply(this,arguments)}return i}()},{key:"evictBuffer",value:function(){var a=ve(W().mark(function t(e){var n,r,o,u;return W().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(n=this.hls.media,!(!this._mse||!n||!e||e<0)){c.next=3;break}return c.abrupt("return");case 3:if(r=n.currentTime,o=r-e,!(o<=0)){c.next=7;break}return c.abrupt("return");case 7:if(u=Ue.start(Ue.get(n)),!(u+1>=o)){c.next=10;break}return c.abrupt("return");case 10:return c.abrupt("return",this.removeBuffer(0,o));case 11:case"end":return c.stop()}},t,this)}));function i(t){return a.apply(this,arguments)}return i}()},{key:"clearAllBuffer",value:function(){var a=ve(W().mark(function t(){return W().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!this._mse){n.next=2;break}return n.abrupt("return",this._mse.clearAllBuffer());case 2:case"end":return n.stop()}},t,this)}));function i(){return a.apply(this,arguments)}return i}()},{key:"decryptBuffer",value:function(i,t){return this._decryptor.decrypt(i,t)}},{key:"reset",value:function(){var a=ve(W().mark(function t(){var e,n=arguments;return W().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(e=n.length>0&&n[0]!==void 0?n[0]:!1,!(this._mse&&!e)){o.next=8;break}return this._transmuxer=null,this._sourceCreated=!1,o.next=6,this._mse.unbindMedia();case 6:return o.next=8,this._mse.bindMedia(this.hls.media);case 8:this._needInitSegment=!0,this._directAppend=!1;case 10:case"end":return o.stop()}},t,this)}));function i(){return a.apply(this,arguments)}return i}()},{key:"endOfStream",value:function(){var a=ve(W().mark(function t(){return W().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!this._mse){n.next=5;break}if(!this._sourceCreated){n.next=5;break}return n.next=4,this._mse.endOfStream();case 4:this.hls.emit(ee.BUFFEREOS);case 5:this._softVideo&&this._softVideo.endOfStream();case 6:case"end":return n.stop()}},t,this)}));function i(){return a.apply(this,arguments)}return i}()},{key:"setLiveSeekableRange",value:function(){var a=ve(W().mark(function t(e,n){return W().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:this._mse&&this._mse.setLiveSeekableRange(e,n);case 1:case"end":return o.stop()}},t,this)}));function i(t,e){return a.apply(this,arguments)}return i}()},{key:"detachMedia",value:function(){var a=ve(W().mark(function t(){return W().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!this._mse){n.next=3;break}return n.next=3,this._mse.unbindMedia();case 3:case"end":return n.stop()}},t,this)}));function i(){return a.apply(this,arguments)}return i}()},{key:"destroy",value:function(){var a=ve(W().mark(function t(){var e;return W().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return(e=this._decryptor)===null||e===void 0||e.destroy(),r.next=3,this.detachMedia();case 3:this._decryptor=null,this._mse=null,this._softVideo=null;case 6:case"end":return r.stop()}},t,this)}));function i(){return a.apply(this,arguments)}return i}()},{key:"_createMseSource",value:function(i,t){ya.debug("create mse source, videoCodec=".concat(i,", audioCodec=").concat(t));var e=this._mse;e&&(i&&(e.createSource(Ye.VIDEO,"video/mp4;codecs=".concat(i)),this._sourceCreated=!0),t&&(e.createSource(Ye.AUDIO,"audio/mp4;codecs=".concat(t)),this._sourceCreated=!0),this.hls.emit(ee.SOURCEBUFFER_CREATED))}},{key:"_handleCodecChange",value:function(i,t){var e=[],n=this._mse,r=[{type:Ye.VIDEO,codecs:i==null?void 0:i.codec},{type:Ye.AUDIO,codecs:t==null?void 0:t.codec}];return r.filter(function(o){return!!o.codecs}).forEach(function(o){var u=o.type,l=o.codecs,c=n.getSourceBuffer(u);if(c){var h=l.split(",")[0];new RegExp(h,"ig").test(c.mimeType)||e.push(n.changeType(u,"".concat(u,"/mp4;codecs=").concat(l)))}}),e}},{key:"seamlessSwitch",value:function(){this._needInitSegment=!0}},{key:"isFull",value:function(){var i,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ye.VIDEO;return(i=this._mse)===null||i===void 0?void 0:i.isFull(t)}}]),s}();function iv(s){var a=(s==null?void 0:s.media)||document.createElement("video");return ge(ge({maxPlaylistSize:50,retryCount:3,retryDelay:1e3,pollRetryCount:2,loadTimeout:1e4,manifestLoadTimeout:1e4,preloadTime:30,softDecode:!1,bufferBehind:10,maxJumpDistance:3,startTime:0,useLowLatency:!0,targetLatency:10,maxLatency:20,allowedStreamTrackChange:!0,seiInTime:!1,manifestList:[],minSegmentsStartPlay:3,preferMMS:!1,preferMMSStreaming:!1,mseLowLatency:!0,fixerConfig:{forceFixLargeGap:!1,largeGapThreshold:5}},s),{},{media:a})}var nv=Re(function s(){Oe(this,s),A(this,"version",0),A(this,"streams",[]),A(this,"isMaster",!0)}),Po={Audio:"AUDIO",Video:"VIDEO",SubTitle:"SUBTITLE",ClosedCaptions:"CLOSED-CAPTIONS"},sn={CLEAR_KEY:"org.w3.clearkey",FAIRPLAY:["urn:uuid:94ce86fb-07ff-4f43-adb8-93d2fa968ca2","com.apple.streamingkeydelivery"],WIDEVINE:["urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine.alpha","com.widevine"],PLAYREADY:["urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95","com.microsoft.playready"]};function xo(s){for(var a=[],i=0;i<s.length;i++)Array.isArray(s[i])?a=a.concat(xo(s[i])):a.push(s[i]);return a}var ns=Re(function s(){Oe(this,s),A(this,"id",0),A(this,"url",""),A(this,"default",!1),A(this,"autoSelect",!1),A(this,"forced",!1),A(this,"group",""),A(this,"name",""),A(this,"lang",""),A(this,"segments",[]),A(this,"endSN",0)}),rv=function(s){Nn(i,s);var a=Bn(i);function i(){var t;Oe(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=a.call.apply(a,[this].concat(n)),A(ae(t),"mediaType",Po.Audio),A(ae(t),"channels",0),t}return Re(i)}(ns),sv=function(s){Nn(i,s);var a=Bn(i);function i(){var t;Oe(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=a.call.apply(a,[this].concat(n)),A(ae(t),"mediaType",Po.SubTitle),t}return Re(i)}(ns),av=Re(function s(){Oe(this,s),A(this,"id",0),A(this,"bitrate",0),A(this,"width",0),A(this,"height",0),A(this,"name",""),A(this,"url",""),A(this,"audioCodec",""),A(this,"videoCodec",""),A(this,"textCodec",""),A(this,"audioGroup",""),A(this,"audioStreams",[]),A(this,"subtitleStreams",[]),A(this,"closedCaptionsStream",[])}),ov=Re(function s(){Oe(this,s),A(this,"version",0),A(this,"url",""),A(this,"type",""),A(this,"startCC",0),A(this,"endCC",0),A(this,"startSN",0),A(this,"endSN",0),A(this,"totalDuration",0),A(this,"targetDuration",0),A(this,"partTargetDuration",0),A(this,"canSkipUntil",0),A(this,"canSkipDateRanges",!1),A(this,"skippedSegments",0),A(this,"canBlockReload",!1),A(this,"partHoldBack",0),A(this,"live",!0),A(this,"lowLatency",!1),A(this,"endPartIndex",0),A(this,"segments",[]),A(this,"dateRanges",{}),A(this,"skippedSegments",0)}),an=function(){function s(a){Oe(this,s),A(this,"sn",0),A(this,"cc",0),A(this,"url",""),A(this,"parentUrl",""),A(this,"title",""),A(this,"start",0),A(this,"duration",0),A(this,"dataTime",""),A(this,"key",null),A(this,"byteRange",null),A(this,"isInitSegment",!1),A(this,"initSegment",null),A(this,"isLast",!1),A(this,"hasAudio",!1),A(this,"hasVideo",!1),A(this,"independent",!1),A(this,"partIndex",0),this.parentUrl=a}return Re(s,[{key:"end",get:function(){return this.start+this.duration}},{key:"setTrackExist",value:function(i,t){this.hasVideo=i,this.hasAudio=t}},{key:"setByteRange",value:function(i,t){this.byteRange=[0];var e=i.split("@");e.length===1&&t&&t.byteRange?(this.byteRange[0]=t.byteRange[1]||0,this.byteRange[0]&&(this.byteRange[0]+=1)):this.byteRange[0]=parseInt(e[1]),this.byteRange[1]=this.byteRange[0]+parseInt(e[0])-1}}]),s}(),uv=function(){function s(a){Oe(this,s),A(this,"method",""),A(this,"url",""),A(this,"iv",null),A(this,"keyFormat",""),A(this,"keyFormatVersions",""),a instanceof s&&(this.method=a.method,this.url=a.url,this.keyFormat=a.keyFormat,this.keyFormatVersions=a.keyFormatVersions,a.iv&&(this.iv=new Uint8Array(a.iv)))}return Re(s,[{key:"clone",value:function(i){var t=new s(this);return i!=null&&t.setIVFromSN(i),t}},{key:"setIVFromSN",value:function(i){if(!this.iv&&this.method==="AES-128"&&typeof i=="number"&&this.url){this.iv=new Uint8Array(16);for(var t=12;t<16;t++)this.iv[t]=i>>8*(15-t)&255}}},{key:"isSegmentEncrypted",value:function(){var i=this.method;return i==="AES-128"}},{key:"isValidKeySystem",value:function(){var i=xo([sn.CLEAR_KEY,sn.FAIRPLAY,sn.WIDEVINE,sn.PLAYREADY]).indexOf(this.keyFormat)>-1;if(!i)return!1;var t=["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)>-1;return!!t}},{key:"isSupported",value:function(){return this.method?this.isSegmentEncrypted()?!0:!!this.isValidKeySystem():!1}}]),s}(),lv=/^#(EXT[^:]*)(?::(.*))?$/,_a=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g,cv=/^(?:[a-zA-Z0-9+\-.]+:)?\/\//,hv=/^((?:[a-zA-Z0-9+\-.]+:)?\/\/[^/?#]*)?([^?#]*\/)?/;function fv(s){return s.split(/[\r\n]/).map(function(a){return a.trim()}).filter(Boolean)}function Lo(s){var a=s.match(lv);if(!(!a||!a[1]))return[a[1].replace("EXT-X-",""),a[2]]}function yt(s){for(var a={},i=_a.exec(s);i;)a[i[1]]=i[2]||i[3],i=_a.exec(s);return a}function mi(s,a){if(!a||!s||cv.test(s))return s;var i=hv.exec(a);return i?s[0]==="/"?i[1]+s:i[1]+i[2]+s:s}var dv={audio:[/^mp4a/,/^vorbis$/,/^opus$/,/^flac$/,/^[ae]c-3$/],video:[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av1$/],text:[/^vtt$/,/^wvtt/,/^stpp/]};function gr(s,a){var i=dv[s];if(!(!i||!a||!a.length)){for(var t=0;t<i.length;t++)for(var e=0;e<a.length;e++)if(i[t].test(a[e]))return a[e]}}function vv(s,a){var i;if(a){for(var t in a)if(Object.prototype.hasOwnProperty.call(a,t)&&s[t]!==a[t]){i=t;break}}var e=null;s.DURATION&&(e=parseFloat(s.DURATION),Number.isFinite(e)?s._endDate&&(e=(s._endDate.getTime()-s._startDate.getTime())/1e3):e=null);var n=pv(s.CUE||s["X-CUE"],{pre:!1,post:!1,once:!1});return!!s.ID&&!i&&Number.isFinite(s._startDate.getTime())&&(e===null||e>=0)&&(s.END_ON_NEXT!=="YES"||!!s.CLASS)&&(!s.CUE||!n.pre&&!n.post||n.pre!==n.post)&&(s.CLASS!=="com.apple.hls.interstitial"||"X-ASSET-URI"in s||"X-ASSET-LIST"in s)}function pv(s,a){return(s?s.split(/[ ,]+/):[]).reduce(function(i,t){return i[t.toLowerCase()]=!0,i},a)}function gv(s,a){for(var i=new nv,t=0,e,n=[],r=[];e=s[t++];){var o=Lo(e);if(o){var u=At(o,2),l=u[0],c=u[1];if(l==="VERSION")i.version=parseInt(c);else if(l==="MEDIA"&&c){var h=yt(c),f=void 0;switch(h.TYPE){case"AUDIO":f=new rv;break;case"SUBTITLES":f=new sv;break;default:f=new ns}f.url=mi(h.URI,a),f.default=h.DEFAULT==="YES",f.autoSelect=h.AUTOSELECT==="YES",f.group=h["GROUP-ID"],f.name=h.NAME,f.lang=h.LANGUAGE,h.CHANNELS&&(f.channels=Number(h.CHANNELS.split("/")[0]),Number.isNaN(f.channels)&&(f.channels=0)),h.TYPE==="AUDIO"&&h.URI&&n.push(f),h.TYPE==="SUBTITLES"&&r.push(f)}else if(l==="STREAM-INF"&&c){var d=new av,v=yt(c);if(d.bitrate=parseInt(v["AVERAGE-BANDWIDTH"]||v.BANDWIDTH),d.name=v.NAME,d.url=mi(s[t++],a),v.RESOLUTION){var m=v.RESOLUTION.split("x"),g=At(m,2),b=g[0],k=g[1];d.width=parseInt(b),d.height=parseInt(k)}if(v.CODECS){var E=v.CODECS.split(/[ ,]+/).filter(Boolean);d.videoCodec=gr("video",E),d.audioCodec=gr("audio",E),d.textCodec=gr("text",E)}d.audioGroup=v.AUDIO,d.subtitleGroup=v.SUBTITLES,i.streams.push(d)}}}return i.streams.forEach(function(w,C){w.id=C}),n.length&&(n.forEach(function(w,C){w.id=C}),i.streams.forEach(function(w){w.audioGroup&&(w.audioStreams=n.filter(function(C){return C.group===w.audioGroup}))})),r.length&&(r.forEach(function(w,C){w.id=C}),i.streams.forEach(function(w){w.subtitleGroup&&(w.subtitleStreams=r.filter(function(C){return C.group===w.subtitleGroup}))})),i}function mv(s,a,i){var t=new ov;t.url=a;for(var e=new an(a),n=null,r=null,o=0,u=0,l=0,c=0,h,f=!1,d=0;h=s[c++];){if(h[0]!=="#"){if(t.lowLatency){u++;continue}e.sn=u,e.cc=l,e.url=mi(h,a),r&&(e.key=r.clone(u)),n&&(e.initSegment=n),t.segments.push(e),e=new an(a),u++;continue}var v=Lo(h);if(v){var m=At(v,2),g=m[0],b=m[1];switch(g){case"VERSION":t.version=parseInt(b);break;case"PLAYLIST-TYPE":t.type=b==null?void 0:b.toUpperCase();break;case"TARGETDURATION":t.targetDuration=parseFloat(b);break;case"PART-INF":{i&&(t.lowLatency=!0);var k=yt(b);k["PART-TARGET"]&&(t.partTargetDuration=parseFloat(k["PART-TARGET"]))}break;case"SERVER-CONTROL":{var E=yt(b);t.canBlockReload=E["CAN-BLOCK-RELOAD"]==="YES",t.partHoldBack=parseFloat(E["PART-HOLD-BACK"]||0),t.canSkipUntil=parseFloat(E["CAN-SKIP-UNTIL"]||0),t.canSkipDateRanges=E["CAN-SKIP-DATERANGES"]==="YES"}break;case"ENDLIST":f=!0;break;case"MEDIA-SEQUENCE":u=t.startSN=parseInt(b);break;case"DISCONTINUITY-SEQUENCE":l=t.startCC=parseInt(b);break;case"DISCONTINUITY":l++;break;case"BYTERANGE":e.setByteRange(b,t.segments[t.segments.length-1]);break;case"PART":{if(!t.lowLatency)break;var w=yt(b);e.duration=parseFloat(w.DURATION),e.independent=w.INDEPENDENT==="YES",e.sn=u,e.cc=l,e.partIndex=d,e.start=o,e.duration=parseFloat(w.DURATION),o+=e.duration,e.url=mi(w.URI,a),r&&(e.key=r.clone(u)),n&&(e.initSegment=n),t.segments.push(e),e=new an(a),d++}break;case"PRELOAD-HINT":break;case"PROGRAM-DATE-TIME":e.dataTime=b;break;case"EXTINF":{if(t.lowLatency){d=0;break}var C=b.split(","),B=At(C,2),L=B[0],D=B[1];e.start=o,e.duration=parseFloat(L),o+=e.duration,e.title=D}break;case"KEY":{var O=yt(b);if(O.METHOD==="NONE"){r=null;break}if(r=new uv,r.method=O.METHOD,r.url=/^blob:/.test(O.URI)?O.URI:mi(O.URI,a),r.keyFormat=O.KEYFORMAT||"identity",r.keyFormatVersions=O.KEYFORMATVERSIONS,!r.isSupported())throw new Error("encrypt ".concat(O.METHOD,"/").concat(O.KEYFORMAT," is not supported"));if(O.IV){var R=O.IV.slice(2);R=(R.length&1?"0":"")+R,r.iv=new Uint8Array(R.length/2);for(var j=0,y=R.length/2;j<y;j++)r.iv[j]=parseInt(R.slice(j*2,j*2+2),16)}}break;case"MAP":{var _=yt(b);e.url=mi(_.URI,a),_.BYTERANGE&&e.setByteRange(_.BYTERANGE),e.isInitSegment=!0,e.sn=0,r&&(e.key=r.clone(0)),n=e,e=new an(a)}break;case"SKIP":{var S=yt(b),P=parseInt(S["SKIPPED-SEGMENTS"],10);P<=Number.MAX_SAFE_INTEGER&&(t.skippedSegments+=P)}break;case"DATERANGE":{var T=yt(b),M=t.dateRanges[T.ID];T._startDate=M?M._startDate:new Date(T["START-DATE"]);var G=(M==null?void 0:M._endDate)||new Date(T.END_DATE);Number.isFinite(G)&&(T._endDate=G),(vv(T,M)||t.skippedSegments)&&(t.dateRanges[T.ID]=T)}break}}}t.segments=t.segments.filter(function(Z){return Z.duration!==0});var K=t.segments[t.segments.length-1];return K&&(f&&(K.isLast=!0),t.endSN=K.sn,t.endPartIndex=K.partIndex),f&&(t.live=!1),t.totalDuration=o,t.endCC=l,t}var on=function(){function s(){Oe(this,s)}return Re(s,null,[{key:"parse",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0;if(!i.includes("#EXTM3U"))throw new Error("Invalid m3u8 file");var n=fv(i);return s.isMediaPlaylist(i)?mv(n,t,e):gv(n,t)}},{key:"isMediaPlaylist",value:function(i){return i.includes("#EXTINF:")||i.includes("#EXT-X-TARGETDURATION:")}}]),s}(),yv=function(){function s(a){var i=this;Oe(this,s),A(this,"_emitOnLoaded",function(u,l){var c=u.response,h=u.options,f=h||{},d=f.firstByteTime,v=f.startTime,m=f.endTime,g=f.contentLength,b=m-v;i.hls.emit(ee.SPEED,{time:b,byteLength:g,url:l}),i.hls.emit(ee.LOAD_COMPLETE,{url:l,elapsed:b||0}),i.hls.emit(ee.TTFB,{url:l,responseUrl:c.url,elapsed:d-v}),i.hls.emit(ee.LOAD_RESPONSE_HEADERS,{headers:c.headers,url:l})}),A(this,"_onLoaderRetry",function(u,l){i.hls.emit(de.LOAD_RETRY,{error:Ce.network(u),retryTime:l})}),this.hls=a,this._timer=null,this._useLowLatency=a.config.useLowLatency;var t=this.hls.config,e=t.retryCount,n=t.retryDelay,r=t.manifestLoadTimeout,o=t.fetchOptions;this._loader=new bi(ge(ge({},o),{},{responseType:"text",retry:e,retryDelay:n,timeout:r,onRetryError:this._onLoaderRetry})),this._audioLoader=new bi(ge(ge({},o),{},{responseType:"text",retry:e,retryDelay:n,timeout:r,onRetryError:this._onLoaderRetry})),this._subtitleLoader=new bi(ge(ge({},o),{},{responseType:"text",retry:e,retryDelay:n,timeout:r,onRetryError:this._onLoaderRetry}))}return Re(s,[{key:"load",value:function(){var a=ve(W().mark(function t(e,n,r){var o,u,l,c,h,f,d,v,m,g,b,k,E,w,C,B,L,D,O,R;return W().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return o=[this._loader.load(e)],n&&o.push(this._audioLoader.load(n)),r&&o.push(this._subtitleLoader.load(r)),y.prev=3,y.next=6,Promise.all(o);case 6:if(v=y.sent,m=At(v,3),g=m[0],b=m[1],k=m[2],g){y.next=13;break}return y.abrupt("return",[]);case 13:this._emitOnLoaded(g,e),u=g.data,h=g.response.url||e,n?(l=b==null?void 0:b.data,c=k==null?void 0:k.data,f=(b==null||(E=b.response)===null||E===void 0?void 0:E.url)||n,d=(k==null||(w=k.response)===null||w===void 0?void 0:w.url)||r,l&&this._emitOnLoaded(b,n),c&&this._emitOnLoaded(k,r)):(c=b==null?void 0:b.data,d=(b==null||(C=b.response)===null||C===void 0?void 0:C.url)||r,c&&this._emitOnLoaded(b,r)),y.next=22;break;case 19:throw y.prev=19,y.t0=y.catch(3),Ce.network(y.t0);case 22:if(B=this.hls.config.onPreM3U8Parse,y.prev=23,B&&(u=B(u)||u,l&&(l=B(l,!0)||l),c&&(c=B(c,!0)||c)),L=on.parse(u,h,this._useLowLatency),!(((R=L)===null||R===void 0?void 0:R.live)===!1&&L.segments&&!L.segments.length)){y.next=28;break}throw new Error("empty segments list");case 28:l&&(D=on.parse(l,f,this._useLowLatency)),c&&(O=on.parse(c,d,this._useLowLatency)),y.next=35;break;case 32:throw y.prev=32,y.t1=y.catch(23),new Ce(ce.MANIFEST,ce.SUB_TYPES.HLS,y.t1);case 35:return L&&(L.isMaster?this.hls.emit(de.HLS_MANIFEST_LOADED,{playlist:L}):this.hls.emit(de.HLS_LEVEL_LOADED,{playlist:L})),y.abrupt("return",[L,D,O]);case 37:case"end":return y.stop()}},t,this,[[3,19],[23,32]])}));function i(t,e,n){return a.apply(this,arguments)}return i}()},{key:"parseText",value:function(i,t){var e=this.hls.config.onPreM3U8Parse,n;try{var r;if(e&&(i=e(i)||i),n=on.parse(i,t,this._useLowLatency),((r=n)===null||r===void 0?void 0:r.live)===!1&&n.segments&&!n.segments.length)throw new Error("empty segments list")}catch(o){throw new Ce(ce.MANIFEST,ce.SUB_TYPES.HLS,o)}return n&&(n.isMaster?this.hls.emit(de.HLS_MANIFEST_LOADED,{playlist:n}):this.hls.emit(de.HLS_LEVEL_LOADED,{playlist:n})),[n]}},{key:"poll",value:function(i,t,e,n,r,o){var u=this;clearTimeout(this._timer),o=o||3e3;var l=this.hls.config.pollRetryCount,c=function(){var h=ve(W().mark(function f(){var d;return W().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return clearTimeout(u._timer),m.prev=1,m.next=4,u.load(i,t,e);case 4:if(d=m.sent,d[0]){m.next=7;break}return m.abrupt("return");case 7:l=u.hls.config.pollRetryCount,n(d[0],d[1],d[2]),m.next=15;break;case 11:m.prev=11,m.t0=m.catch(1),l--,l<=0&&r(m.t0);case 15:u._timer=setTimeout(c,o);case 16:case"end":return m.stop()}},f,null,[[1,11]])}));return function(){return h.apply(this,arguments)}}();this._timer=setTimeout(c,o)}},{key:"stopPoll",value:function(){return clearTimeout(this._timer),this.cancel()}},{key:"cancel",value:function(){return Promise.all([this._loader.cancel(),this._audioLoader.cancel()])}}]),s}();function Do(s,a,i){return a>i&&(i=a),Math.min(Math.max(s,a),i)}var mr=new mt("playlist"),ba=function(){function s(a,i,t){Oe(this,s),A(this,"live",void 0),A(this,"id",0),A(this,"bitrate",0),A(this,"width",0),A(this,"height",0),A(this,"name",""),A(this,"url",""),A(this,"audioCodec",""),A(this,"videoCodec",""),A(this,"textCodec",""),A(this,"startCC",0),A(this,"endCC",0),A(this,"startSN",0),A(this,"endSN",-1),A(this,"totalDuration",0),A(this,"targetDuration",0),A(this,"partTargetDuration",0),A(this,"canSkipUntil",0),A(this,"canSkipDateRanges",!1),A(this,"skippedSegments",0),A(this,"canBlockReload",!1),A(this,"partHoldBack",0),A(this,"lowLatency",!1),A(this,"endPartIndex",0),A(this,"snDiff",null),A(this,"segments",[]),A(this,"audioStreams",[]),A(this,"subtitleStreams",[]),A(this,"closedCaptions",[]),A(this,"currentAudioStream",null),A(this,"currentSubtitleStream",null),this.update(this._setLLPlaybackPoint(a),i,t)}return Re(s,[{key:"lastSegment",get:function(){return this.segments.length?this.segments[this.segments.length-1]:null}},{key:"segmentDuration",get:function(){var i;return this.targetDuration||((i=this.segments[0])===null||i===void 0?void 0:i.duration)||0}},{key:"liveEdge",get:function(){return this.endTime},set:function(i){this.endTime=i}},{key:"endTime",get:function(){var i;return((i=this.lastSegment)===null||i===void 0?void 0:i.end)||0},set:function(i){var t=this.lastSegment;t&&(t.duration=i-t.start)}},{key:"currentSubtitleEndSn",get:function(){var i;return((i=this.currentSubtitleStream)===null||i===void 0?void 0:i.endSN)||0}},{key:"clearOldSegment",value:function(i,t){return this.currentAudioStream&&this._clearSegments(i,t),this._clearSegments(i,t)}},{key:"getAudioSegment",value:function(i){if(!(!i||!this.currentAudioStream)){var t=i.sn-this.snDiff;return this.currentAudioStream.segments.find(function(e){return e.sn===t})}}},{key:"update",value:function(i,t){this.url=i.url,Array.isArray(i.segments)?((this.live===null||this.live===void 0)&&(this.live=i.live),this._updateSegments(i,this),this.startCC=i.startCC,this.endCC=i.endCC,this.startSN=i.startSN,this.endSN=i.endSN||-1,this.totalDuration=i.totalDuration,this.targetDuration=i.targetDuration,this.live=i.live,this.lowLatency=i.lowLatency,this.canBlockReload=i.canBlockReload,this.canSkipDateRanges=i.canSkipDateRanges,this.canSkipUntil=i.canSkipUntil,this.partHoldBack=i.partHoldBack,this.partTargetDuration=i.partTargetDuration,this.skippedSegments=i.skippedSegments,this.endPartIndex=i.endPartIndex,t&&this.currentAudioStream&&Array.isArray(t.segments)&&(this._updateSegments(t,this.currentAudioStream),(this.snDiff===null||this.snDiff===void 0)&&i.segments.length&&t.segments.length&&(this.snDiff=i.segments[0].sn-t.segments[0].sn))):(this.id=i.id,this.bitrate=i.bitrate,this.width=i.width,this.height=i.height,this.name=i.name,this.audioCodec=i.audioCodec,this.videoCodec=i.videoCodec,this.textCodec=i.textCodec,this.audioStreams=i.audioStreams,this.subtitleStreams=i.subtitleStreams,!this.currentAudioStream&&this.audioStreams.length&&(this.currentAudioStream=this.audioStreams.find(function(e){return e.default})||this.audioStreams[0]),!this.currentSubtitleStream&&this.subtitleStreams.length&&(this.currentSubtitleStream=this.subtitleStreams.find(function(e){return e.default})||this.subtitleStreams[0]))}},{key:"updateSubtitle",value:function(i){var t=this;if(i&&this.currentSubtitleStream&&Array.isArray(i.segments)){var e=this._updateSegments(i,this.currentSubtitleStream),n=this.currentSubtitleStream.segments;if(n.length>100&&(this.currentSubtitleStream.segments=n.slice(100)),!!e)return e.map(function(r){return{sn:r.sn,url:r.url,duration:r.duration,start:r.start,end:r.end,lang:t.currentSubtitleStream.lang}})}}},{key:"switchSubtitle",value:function(i){var t=this.subtitleStreams.find(function(n){return n.lang===i}),e=this.currentSubtitleStream;t&&(this.currentSubtitleStream=t,e.segments=[])}},{key:"_setLLPlaybackPoint",value:function(i){if(!i.lowLatency||!i.segments.length)return i;for(var t=i.totalDuration-i.partHoldBack,e=i.segments,n=0,r=0,o=e.length;r<o;r++)e[r].start<=t&&e[r].independent&&(n=r);var u=e.slice(n),l=0;return u.forEach(function(c){c.start=l,l=c.end}),i.segments=u,i.totalDuration=l,i.startSN=u[0].sn,i.startCC=u[0].cc,mr.log("set ll-hls playback point: SN=".concat(i.startSN," partIndex=").concat(u[0].partIndex,", duration=").concat(l)),i}},{key:"_clearSegments",value:function(i,t){for(var e=0,n=this.segments,r=0,o=n.length;r<o;r++)if(n[r].end>=i){e=r;break}return e>t&&(e=t),e&&(this.segments=this.segments.slice(e),this.currentAudioStream&&(this.currentAudioStream.segments=this.currentAudioStream.segments.slice(e))),t-e}},{key:"_updateSegments",value:function(i,t){var e=t.segments;if(this.live){var n,r=i.lowLatency,o=e[e.length-1],u=(n=o==null?void 0:o.sn)!==null&&n!==void 0?n:-1,l=(o==null?void 0:o.partIndex)||0,c=u<i.endSN&&i.segments.length;if(r&&(c=c||l<i.endPartIndex),c){mr.log("update segments: endSN:".concat(u,", partIndex:").concat(l," --> endSN:").concat(i.endSN,", partIndex:").concat(i.endPartIndex));var h=i.segments.findIndex(function(g){return g.sn===u&&g.partIndex===l}),f=h<0?i.segments:i.segments.slice(h+1);if(e.length&&f.length){var d=o.end,v=d;f.forEach(function(g){g.start=d,d=g.end}),mr.log("liveEdge: ".concat(v," -> ").concat(d));var m=(o==null?void 0:o.cc)||-1;m>f[0].cc&&f.forEach(function(g){return g.cc+=m})}return t.endSN=i.endSN,t.segments=e.concat(f),f}}else t.segments=i.segments}}]),s}(),_v=function(){function s(a){Oe(this,s),A(this,"streams",[]),A(this,"currentStream",null),A(this,"dvrWindow",0),A(this,"_segmentPointer",-1),this.hls=a}return Re(s,[{key:"lowLatency",get:function(){var i;return(i=this.currentStream)===null||i===void 0?void 0:i.lowLatency}},{key:"lastSegment",get:function(){var i;return(i=this.currentStream)===null||i===void 0?void 0:i.lastSegment}},{key:"currentSegment",get:function(){var i;return(i=this.currentSegments)===null||i===void 0?void 0:i[this._segmentPointer]}},{key:"nextSegment",get:function(){var i;return(i=this.currentSegments)===null||i===void 0?void 0:i[this._segmentPointer+1]}},{key:"currentSegments",get:function(){var i;return(i=this.currentStream)===null||i===void 0?void 0:i.segments}},{key:"currentSubtitleEndSn",get:function(){var i;return(i=this.currentStream)===null||i===void 0?void 0:i.currentSubtitleEndSn}},{key:"liveEdge",get:function(){var i;return(i=this.currentStream)===null||i===void 0?void 0:i.liveEdge},set:function(i){this.currentStream&&(this.currentStream.liveEdge=i)}},{key:"totalDuration",get:function(){var i;return((i=this.currentStream)===null||i===void 0?void 0:i.totalDuration)||0}},{key:"seekRange",get:function(){var i=this.currentSegments;if(!(!i||!i.length))return[i[0].start,i[i.length-1].end]}},{key:"nbSegments",get:function(){var i;return((i=this.currentSegments)===null||i===void 0?void 0:i.length)||0}},{key:"isEmpty",get:function(){var i;return!((i=this.currentSegments)!==null&&i!==void 0&&i.length)}},{key:"isLive",get:function(){var i;return(i=this.currentStream)===null||i===void 0?void 0:i.live}},{key:"hadSegmentLoaded",get:function(){return this._segmentPointer!==-1}},{key:"hasSubtitle",get:function(){var i;return!!((i=this.currentStream)!==null&&i!==void 0&&i.currentSubtitleStream)}},{key:"getAudioSegment",value:function(i){var t;return(t=this.currentStream)===null||t===void 0?void 0:t.getAudioSegment(i)}},{key:"moveSegmentPointer",value:function(i){var t;i==null&&(i=this._segmentPointer+1),this._segmentPointer=Do(i,-1,(t=this.currentSegments)===null||t===void 0?void 0:t.length)}},{key:"reset",value:function(){this.streams=[],this.currentStream=null,this.dvrWindow=0,this._segmentPointer=-1}},{key:"getSegmentByIndex",value:function(i){var t;return(t=this.currentSegments)===null||t===void 0?void 0:t[i]}},{key:"setNextSegmentByIndex",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;this._segmentPointer=i-1}},{key:"setNextSegmentBySN",value:function(){var i,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=(i=this.currentSegments)===null||i===void 0?void 0:i.findIndex(function(n){return n.sn===t});return e!==-1&&this.setNextSegmentByIndex(e+1),e}},{key:"findSegmentIndexByTime",value:function(i){var t=this.currentSegments;if(t){for(var e=0,n=t.length,r;e<n;e++)if(r=t[e],i>=r.start&&i<r.end)return e;var o=t[t.length-1];if(Math.abs(i-(o==null?void 0:o.end))<.2)return t.length-1}}},{key:"upsertPlaylist",value:function(i,t,e){var n=this;if(i){if(i.isMaster)this.streams.length=i.streams.length,i.streams.filter(function(l){return l.url}).forEach(function(l,c){n.streams[c]?n.streams[c].update(l):n.streams[c]=new ba(l)}),this.currentStream=this.streams[0];else if(Array.isArray(i.segments)){var r=this.currentStream;if(r){r.update(i,t,e);var o=r.updateSubtitle(e);o&&this.hls.emit(de.SUBTITLE_SEGMENTS,{list:o})}else this.reset(),this.currentStream=this.streams[0]=new ba(i,t,e)}var u=this.currentStream;u&&this.hls.isLive&&!this.dvrWindow&&(this.dvrWindow=this.currentSegments.reduce(function(l,c){return l+=c.duration,l},0))}}},{key:"updateSegmentsRanges",value:function(i,t){var e,n=(e=this.currentSegments)===null||e===void 0?void 0:e.filter(function(r){return r.sn>=i});n.forEach(function(r){r.start=t,t=r.end})}},{key:"switchSubtitle",value:function(i){var t;(t=this.currentStream)===null||t===void 0||t.switchSubtitle(i)}},{key:"clearOldSegment",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,t=this.currentStream;if(!(!this.dvrWindow||!t)){var e=t.endTime-this.dvrWindow;if(!(e<=0)){var n=t.segments;n.length<=i||(this._segmentPointer=t.clearOldSegment(e,this._segmentPointer))}}}},{key:"checkSegmentTrackChange",value:function(i,t){var e=this.findSegmentIndexByTime(i),n=this.getSegmentByIndex(e);if(n&&!(!n.hasAudio&&!n.hasVideo)){if(t!==2&&n.hasAudio&&n.hasVideo)return n;if(!(n.end-i>.3)){var r=this.getSegmentByIndex(e+1);if(r&&!(!r.hasAudio&&!r.hasVideo)&&(r.hasAudio!==n.hasAudio||r.hasVideo!==n.hasVideo))return r}}}},{key:"feedbackLiveEdge",value:function(i,t){var e,n=this.currentSegments;if(n){var r=((e=this.lastSegment)===null||e===void 0?void 0:e.sn)===i.sn;if(r){this.liveEdge=t;return}this.updateSegmentsRanges(i.sn+1,t)}}}]),s}(),bv=function(){function s(a){var i=this;Oe(this,s),A(this,"error",null),A(this,"_emitOnLoaded",function(u,l){var c=u.data,h=u.response,f=u.options,d=f||{},v=d.firstByteTime,m=d.startTime,g=d.endTime,b=d.contentLength,k=g-m;i._bandwidthService.addRecord(b||c.byteLength,k),i.hls.emit(ee.SPEED,{time:k,byteLength:b,url:l}),i.hls.emit(ee.LOAD_COMPLETE,{url:l,elapsed:k||0}),i.hls.emit(ee.TTFB,{url:l,responseUrl:h.url,elapsed:v-m}),i.hls.emit(ee.LOAD_RESPONSE_HEADERS,{headers:h.headers,url:l})}),A(this,"_onLoaderRetry",function(u,l){i.hls.emit(ee.LOAD_RETRY,{error:Ce.network(u),retryTime:l})}),this.hls=a,this._bandwidthService=new yd,this._mapCache={},this._keyCache={};var t=this.hls.config,e=t.retryCount,n=t.retryDelay,r=t.loadTimeout,o=t.fetchOptions;this._segmentLoader=new bi(ge(ge({},o),{},{responseType:"arraybuffer",retry:e,retryDelay:n,timeout:r,onRetryError:this._onLoaderRetry})),this._audioSegmentLoader=new bi(ge(ge({},o),{},{responseType:"arraybuffer",retry:e,retryDelay:n,timeout:r,onRetryError:this._onLoaderRetry})),this._keyLoader=new bi(ge(ge({},o),{},{responseType:"arraybuffer",retry:e,retryDelay:n,timeout:r,onRetryError:this._onLoaderRetry}))}return Re(s,[{key:"speedInfo",value:function(){return{speed:this._bandwidthService.getLatestSpeed(),avgSpeed:this._bandwidthService.getAvgSpeed()}}},{key:"load",value:function(i,t,e){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:e,r=[];return i&&(r[0]=this.loadVideoSegment(i,e)),t&&(r[1]=this.loadAudioSegment(t,n)),Promise.all(r)}},{key:"loadVideoSegment",value:function(i,t){return this._loadSegment(this._segmentLoader,i,t)}},{key:"loadAudioSegment",value:function(i,t){return this._loadSegment(this._audioSegmentLoader,i,t)}},{key:"_loadSegment",value:function(){var a=ve(W().mark(function t(e,n,r){var o=this,u,l,c,h,f,d,v,m,g,b,k,E,w,C,B;return W().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return v=[],this.hls.emit(ee.LOAD_START,{url:n.url}),v[0]=e.load(n.url),r&&n.initSegment&&(g=n.initSegment.url,l=this._mapCache[g],l||(this.hls.emit(ee.LOAD_START,{url:g}),v[1]=e.load(g).then(function(O){if(O){var R=Object.keys(o._mapCache);R>30&&(o._mapCache={}),l=o._mapCache[g]=O.data,o._emitOnLoaded(O,g)}})),b=(m=n.initSegment.key)===null||m===void 0?void 0:m.url,b&&(d=n.initSegment.key.iv,f=this._keyCache[b],f||(this.hls.emit(ee.LOAD_START,{url:b}),v[2]=this._keyLoader.load(b).then(function(O){O&&(f=o._keyCache[b]=O.data,o._emitOnLoaded(O,b))})))),k=(u=n.key)===null||u===void 0?void 0:u.url,k&&n.key.isSegmentEncrypted()&&(h=n.key.iv,c=this._keyCache[k],c||(this.hls.emit(ee.LOAD_START,{url:k}),v[3]=this._keyLoader.load(k).then(function(O){O&&(c=o._keyCache[k]=O.data,o._emitOnLoaded(O,k))}))),D.next=8,Promise.all(v);case 8:if(E=D.sent,w=At(E,1),C=w[0],C){D.next=13;break}return D.abrupt("return");case 13:return B=C.data,this._emitOnLoaded(C,n.url),D.abrupt("return",{data:B,map:l,key:c,mapKey:f,keyIv:h,mapKeyIv:d});case 16:case"end":return D.stop()}},t,this)}));function i(t,e,n){return a.apply(this,arguments)}return i}()},{key:"reset",value:function(){this.error=null,this._mapCache={},this._keyCache={},this._bandwidthService.reset()}},{key:"cancel",value:function(){var a=ve(W().mark(function t(){return W().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Promise.all([this._keyLoader.cancel(),this._segmentLoader.cancel(),this._audioSegmentLoader.cancel()]);case 2:case"end":return n.stop()}},t,this)}));function i(){return a.apply(this,arguments)}return i}()}]),s}(),Fe=new mt("hls"),Ei=function(s){Nn(i,s);var a=Bn(i);function i(t){var e;return Oe(this,i),e=a.call(this),A(ae(e),"version",i.version),A(ae(e),"media",null),A(ae(e),"config",null),A(ae(e),"_manifestLoader",null),A(ae(e),"_segmentLoader",null),A(ae(e),"_playlist",null),A(ae(e),"_bufferService",null),A(ae(e),"_gapService",null),A(ae(e),"_seiService",null),A(ae(e),"_stats",null),A(ae(e),"_prevSegSn",null),A(ae(e),"_prevSegCc",null),A(ae(e),"_tickTimer",null),A(ae(e),"_tickInterval",500),A(ae(e),"_segmentProcessing",!1),A(ae(e),"_reloadOnPlay",!1),A(ae(e),"_switchUrlOpts",null),A(ae(e),"_isProcessQuotaExceeded",!1),A(ae(e),"_loadSegment",ve(W().mark(function n(){var r,o,u,l,c,h,f,d,v;return W().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(!(e._segmentProcessing||!e.media)){g.next=2;break}return g.abrupt("return");case 2:if(r=e._playlist,o=r.nextSegment,u=r.lastSegment,l=ae(e),c=l.config,h=.016,f=Math.min(Math.max((u==null?void 0:u.duration)-h/2||0,h),.1),o){g.next=8;break}return g.abrupt("return");case 8:if(e.isLive){g.next=18;break}if(d=e.bufferInfo(),e.media.paused&&!e.media.currentTime&&(d=e.bufferInfo(d.nextStart||.5)),v=Math.abs(d.end-e.media.duration)<f,!(d.remaining>=c.preloadTime||v)){g.next=15;break}return e._tryEos(),g.abrupt("return");case 15:if(!(c.preferMMSStreaming&&!e._bufferService.msStreaming)){g.next=17;break}return g.abrupt("return");case 17:!e._urlSwitching&&e._prevSegSn!==o.sn-1&&d.end&&Math.abs(o.start-d.end)>1&&e._playlist.setNextSegmentByIndex(e._playlist.findSegmentIndexByTime(d.end+.1));case 18:return g.abrupt("return",e._loadSegmentDirect());case 19:case"end":return g.stop()}},n)}))),A(ae(e),"_onLoadeddata",function(){e.isLive&&!e.config.mseLowLatency&&e.media.duration!==1/0&&e._bufferService.updateDuration(1/0).catch(function(n){})}),A(ae(e),"_onPlay",ve(W().mark(function n(){return W().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!(e.media.seeking&&e.media.currentTime===0)){o.next=3;break}return Fe.debug("replay currentTime 0, return"),o.abrupt("return");case 3:if(clearTimeout(e._disconnectTimer),!e._reloadOnPlay){o.next=9;break}e._reloadOnPlay=!1,e.replay(!0),o.next=12;break;case 9:return o.next=11,e._loadSegment();case 11:e._startTick();case 12:case"end":return o.stop()}},n)}))),A(ae(e),"_onPause",function(){if(e.isLive){if(!e._reloadOnPlay){var n=e.config.disconnectTime;if(n==null&&(n=e._playlist.dvrWindow),!Number.isFinite(n))return;clearTimeout(e._disconnectTimer),e._disconnectTimer=setTimeout(function(){e._reloadOnPlay=!0,e._clear()},n||0)}}else e._stopTick()}),A(ae(e),"_onSeeking",ve(W().mark(function n(){var r,o,u,l,c,h,f;return W().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(e.media){v.next=2;break}return v.abrupt("return");case 2:if(e._onCheckQuotaExceeded(),r=e.media.currentTime,o=e._playlist.seekRange,!o){v.next=10;break}if(u=Do(r,o[0],e.isLive?o[1]:e.media.duration),!(u>=0&&Math.abs(r-u)>=.1)){v.next=10;break}return e.media.currentTime=u,v.abrupt("return");case 10:if(l=e._playlist.currentSegment,c=Ue.info(Ue.get(e.media),r,.1),!l){v.next=17;break}if(!(c.end&&Math.abs(c.end-l.end)<.2)){v.next=15;break}return v.abrupt("return");case 15:if(!(e.isLive&&c.end)){v.next=17;break}return v.abrupt("return");case 17:if(h=e._playlist.findSegmentIndexByTime(r),f=e._playlist.getSegmentByIndex(h),!(h==null||!f||e._segmentProcessing&&f===e._playlist.nextSegment)){v.next=21;break}return v.abrupt("return");case 21:return Fe.debug("seek to",r,f),e._playlist.setNextSegmentByIndex(h),e._stopTick(),v.next=26,e._segmentLoader.cancel();case 26:if(e._segmentProcessing=!1,!(!c.end||e.isLive)){v.next=30;break}return v.next=30,e._loadSegmentDirect(!0);case 30:e._startTick();case 31:case"end":return v.stop()}},n)}))),A(ae(e),"_onTimeupdate",function(){if(e.media){var n=e.config;if(n.isLive&&n.maxLatency&&n.targetLatency&&e.media){var r=e._playlist.liveEdge;if(!r)return;var o=r-e.media.currentTime;o>=n.maxLatency&&(Fe.debug("latency jump, currentTime:".concat(e.media.currentTime,", liveEdge:").concat(r,",  latency=").concat(o)),e.media.currentTime=r-n.targetLatency)}if(n.seiInTime){var u;(u=e._seiService)===null||u===void 0||u.throw(e.media.currentTime)}e.config.allowedStreamTrackChange&&!e.config.softDecode&&e._checkStreamTrackChange(e.media.currentTime)}}),A(ae(e),"_tick",function(){if(e.media){e._startTick();var n=e.media,r=Ue.get(n),o=e._segmentLoader.error;if(e._onCheckQuotaExceeded(),e._isProcessQuotaExceeded&&(e._bufferService.isFull()||(e._isProcessQuotaExceeded=!1,e._segmentProcessing=!1)),o){var u=.5;(!n.readyState||e.bufferInfo(u).remaining<1)&&(o.fatal=!0,e._emitError(Ce.network(o)));return}Ue.end(r)>=.1&&n.readyState&&(ld(n)?(e._loadSegment(),e._gapService&&e._gapService.do(n,e.config.maxJumpDistance,e.isLive)):n.readyState<2&&e._gapService&&e._gapService.do(n,e.config.maxJumpDistance,n.currentTime?e.isLive:!0)),e.isLive||e._tryEos()}}),e.config=t=iv(t),e.media=e.config.media,e._manifestLoader=new yv(ae(e)),e._segmentLoader=new bv(ae(e)),e._playlist=new _v(ae(e)),e._bufferService=new tv(ae(e)),t.seiInTime&&(e._seiService=new dd(ae(e))),t.softDecode||(e._gapService=new fd),e._stats=new _d(ae(e),9e4),e.media.addEventListener("loadeddata",e._onLoadeddata),e.media.addEventListener("play",e._onPlay),e.media.addEventListener("pause",e._onPause),e.media.addEventListener("seeking",e._onSeeking),e.media.addEventListener("timeupdate",e._onTimeupdate),e}return Re(i,[{key:"isLive",get:function(){return this._playlist.isLive}},{key:"streams",get:function(){return this._playlist.streams}},{key:"currentStream",get:function(){return this._playlist.currentStream}},{key:"hasSubtitle",get:function(){return this._playlist.hasSubtitle}},{key:"totalDuration",get:function(){return this._playlist.totalDuration}},{key:"baseDts",get:function(){var e;return(e=this._bufferService)===null||e===void 0?void 0:e.baseDts}},{key:"abrSwitchPoint",get:function(){var e=this._urlSwitching?this._playlist.currentSegment:this._playlist.nextSegment;return e?e.start+e.duration/2:null}},{key:"speedInfo",value:function(){return this._segmentLoader.speedInfo()}},{key:"bufferInfo",value:function(){var e,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:.1;return Ue.info(Ue.get(this.media),(e=this.media)===null||e===void 0?void 0:e.currentTime,n)}},{key:"getStats",value:function(){return this._stats.getStats()}},{key:"playbackQuality",value:function(){return cd(this.media)}},{key:"load",value:function(){var t=ve(W().mark(function n(){var r,o,u,l=arguments;return W().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return r=l.length>0&&l[0]!==void 0?l[0]:"",o=l.length>1&&l[1]!==void 0?l[1]:{},u=typeof o=="boolean"?o:!!(o!=null&&o.reuseMse),Ni(o)==="object"&&o!==null&&o!==void 0&&o.clearSwitchStatus&&(this._urlSwitching=!1,this._switchUrlOpts=null,this.config.startTime=void 0),r&&(this.config.url=r),r=this.config.url,h.next=8,this._reset(u);case 8:return h.next=10,this._loadData(r);case 10:this._startTick();case 11:case"end":return h.stop()}},n,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"_loadData",value:function(){var t=ve(W().mark(function n(r){var o,u,l,c,h,f,d,v,m,g,b,k,E;return W().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:try{r&&(r=r.trim())}catch{}if(r){C.next=3;break}throw this._emitError(new Ce(ce.OTHER,ce.SUB_TYPES.OPTION,null,null,"m3u8 url is missing"));case 3:return C.next=5,this._loadM3U8(r);case 5:if(o=C.sent,u=this._playlist.currentStream,!this._urlSwitching){C.next=23;break}if(!this.isLive){C.next=14;break}l=this._playlist.setNextSegmentBySN(this._prevSegSn),Fe.log("segment nb=".concat(this._prevSegSn," index of ").concat(l," in the new playlist")),l===-1&&(this._prevSegCc=null,this._prevSegSn=null),C.next=23;break;case 14:if(u.bitrate===0&&(c=this._switchUrlOpts)!==null&&c!==void 0&&c.bitrate&&(u.bitrate=(d=this._switchUrlOpts)===null||d===void 0?void 0:d.bitrate),v=typeof((h=this._switchUrlOpts)===null||h===void 0?void 0:h.startTime)=="number"?(f=this._switchUrlOpts)===null||f===void 0?void 0:f.startTime:this._getSeamlessSwitchPoint(),this.config.startTime=v,m=this._playlist.findSegmentIndexByTime(v),g=this._playlist.getSegmentByIndex(m+1),!g){C.next=23;break}return b=g.start,C.next=23,this._bufferService.removeBuffer(b);case 23:if(o){C.next=25;break}return C.abrupt("return");case 25:if(!this.isLive){C.next=36;break}if(this._bufferService.setLiveSeekableRange(0,4294967295),Fe.log("totalDuration first time got:",this._playlist.totalDuration),Fe.log("nb segments got:",this._playlist.nbSegments),this.config.targetLatency<this._playlist.totalDuration&&(this.config.targetLatency=this._playlist.totalDuration,this.config.maxLatency=1.5*this.config.targetLatency),o.isMaster||this._pollM3U8(r),!(this._playlist.nbSegments<this.config.minSegmentsStartPlay)){C.next=33;break}return C.abrupt("return");case 33:return C.next=35,this._loadSegment();case 35:return C.abrupt("return");case 36:return C.next=38,this._bufferService.updateDuration(u.totalDuration);case 38:return k=this.config.startTime,k&&((E=this._switchUrlOpts)!==null&&E!==void 0&&E.seamless||(this.media.currentTime=k),this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(k)||0)),C.next=42,this._loadSegment();case 42:case"end":return C.stop()}},n,this)}));function e(n){return t.apply(this,arguments)}return e}()},{key:"replay",value:function(){var t=ve(W().mark(function n(r){return W().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.config.startTime=0,this._urlSwitching=!1,this._switchUrlOpts=null,u.next=5,this.load();case 5:return this._reloadOnPlay=!1,u.abrupt("return",this.media.play(!r));case 7:case"end":return u.stop()}},n,this)}));function e(n){return t.apply(this,arguments)}return e}()},{key:"switchURL",value:function(){var t=ve(W().mark(function n(r){var o,u,l,c,h,f,d,v=arguments;return W().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:o=v.length>1&&v[1]!==void 0?v[1]:{},u={seamless:!1,startTime:0,bitrate:0},g.t0=Ni(o),g.next=g.t0==="number"?5:g.t0==="boolean"?7:g.t0==="object"?9:11;break;case 5:return o={startTime:o},g.abrupt("break",12);case 7:return o={seamless:o},g.abrupt("break",12);case 9:for(l in o)(o[l]===void 0||o[l]===null)&&delete o[l];return g.abrupt("break",12);case 11:throw"unsupported switchURL args: ".concat(o);case 12:if(o=Object.assign({},u,o),c=o,h=c.seamless,f=c.startTime,this.config.url=r,this.config.startTime=f,this._switchUrlOpts=o,h){g.next=38;break}if(g.prev=18,!this.config.softDecode){g.next=23;break}g.t1=this.load(r),g.next=26;break;case 23:return g.next=25,this.load(r);case 25:g.t1=g.sent;case 26:d=g.t1,g.next=33;break;case 29:throw g.prev=29,g.t2=g.catch(18),this.emit(de.SWITCH_URL_FAILED,g.t2),g.t2;case 33:return this._reloadOnPlay=!1,d&&this.emit(de.SWITCH_URL_SUCCESS,{url:r}),g.abrupt("return",this.media.play(!0));case 38:return this._urlSwitching=!0,this.isLive||(this._prevSegSn=null,this._prevSegCc=null),this._playlist.reset(),this._bufferService.seamlessSwitch(),g.next=44,this._clear();case 44:return g.next=46,this._loadData(r);case 46:this._startTick();case 47:this._switchUrlOpts=null;case 48:case"end":return g.stop()}},n,this,[[18,29]])}));function e(n){return t.apply(this,arguments)}return e}()},{key:"switchStream",value:function(){var t=ve(W().mark(function n(r){var o,u,l,c,h,f=arguments;return W().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(o=f.length>1&&f[1]!==void 0?f[1]:!0,u=this.currentStream,l=this.streams,!(!u||u.id===r||!l||l.length<2)){v.next=5;break}return v.abrupt("return");case 5:if(c=l.find(function(m){return m.id===r}),c){v.next=8;break}return v.abrupt("return");case 8:return v.prev=8,v.next=11,this._clear();case 11:if(!o){v.next=14;break}return v.next=14,this._bufferService.clearAllBuffer();case 14:v.next=19;break;case 16:throw v.prev=16,v.t0=v.catch(8),this._emitError(Ce.create(v.t0));case 19:if(u.currentAudioStream&&c.audioStreams.length>2&&(h=u.currentAudioStream.id,c.currentAudioStream=c.audioStreams.find(function(m){return m.id===h})||c.currentAudioStream),this._playlist.currentStream=c,v.prev=21,!(this.isLive||!c.segments.length)){v.next=25;break}return v.next=25,this._refreshM3U8();case 25:return this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(this.media.currentTime)||0),this._prevSegCc=null,v.next=29,this._loadSegmentDirect();case 29:v.next=35;break;case 31:throw v.prev=31,v.t1=v.catch(21),this._playlist.currentStream=u,v.t1;case 35:return this._startTick(),v.abrupt("return",c);case 37:case"end":return v.stop()}},n,this,[[8,16],[21,31]])}));function e(n){return t.apply(this,arguments)}return e}()},{key:"switchAudioStream",value:function(){var t=ve(W().mark(function n(r){var o,u,l,c,h=arguments;return W().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(o=h.length>1&&h[1]!==void 0?h[1]:!0,u=this.currentStream,u){d.next=4;break}return d.abrupt("return");case 4:if(l=u.currentAudioStream,!(!l||l.id===r||u.audioStreams.length<2)){d.next=7;break}return d.abrupt("return");case 7:if(c=u.audioStreams.find(function(v){return v.id===r}),c){d.next=10;break}return d.abrupt("return");case 10:return d.prev=10,d.next=13,this._clear();case 13:if(!o){d.next=16;break}return d.next=16,this._bufferService.clearAllBuffer();case 16:d.next=21;break;case 18:throw d.prev=18,d.t0=d.catch(10),this._emitError(Ce.create(d.t0));case 21:if(u.currentAudioStream=c,d.prev=22,!(this.isLive||!c.segments.length)){d.next=26;break}return d.next=26,this._refreshM3U8();case 26:return this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(this.media.currentTime)||0),this._prevSegCc=null,d.next=30,this._loadSegmentDirect();case 30:d.next=36;break;case 32:throw d.prev=32,d.t1=d.catch(22),u.currentAudioStream=l,d.t1;case 36:return this._startTick(),d.abrupt("return",c);case 38:case"end":return d.stop()}},n,this,[[10,18],[22,32]])}));function e(n){return t.apply(this,arguments)}return e}()},{key:"switchSubtitleStream",value:function(){var t=ve(W().mark(function n(r){return W().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this._playlist.switchSubtitle(r),u.next=3,this._manifestLoader.stopPoll();case 3:return u.next=5,this._refreshM3U8();case 5:case"end":return u.stop()}},n,this)}));function e(n){return t.apply(this,arguments)}return e}()},{key:"detachMedia",value:function(){var t=ve(W().mark(function n(){return W().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!this._bufferService){o.next=3;break}return o.next=3,this._bufferService.detachMedia();case 3:case"end":return o.stop()}},n,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"destroy",value:function(){var t=ve(W().mark(function n(){var r;return W().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this.media){u.next=2;break}return u.abrupt("return");case 2:return this.removeAllListeners(),this._playlist.reset(),this._segmentLoader.reset(),(r=this._seiService)===null||r===void 0||r.reset(),this.media.removeEventListener("loadeddata",this._onLoadeddata),this.media.removeEventListener("play",this._onPlay),this.media.removeEventListener("pause",this._onPause),this.media.removeEventListener("seeking",this._onSeeking),this.media.removeEventListener("timeupdate",this._onTimeupdate),u.next=13,Promise.all([this._clear(),this._bufferService.destroy()]);case 13:this.media=null;case 14:case"end":return u.stop()}},n,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"_loadM3U8",value:function(){var t=ve(W().mark(function n(r){var o,u,l,c,h,f,d;return W().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(m.prev=0,c=(u=this.config.manifestList)===null||u===void 0||(l=u.filter(function(g){return g.url===r})[0])===null||l===void 0?void 0:l.manifest,!c){m.next=6;break}m.t0=this._manifestLoader.parseText(c,r),m.next=9;break;case 6:return m.next=8,this._manifestLoader.load(r);case 8:m.t0=m.sent;case 9:h=m.t0,f=At(h,1),o=f[0],m.next=17;break;case 14:throw m.prev=14,m.t1=m.catch(0),this._emitError(Ce.create(m.t1));case 17:if(o){m.next=19;break}return m.abrupt("return");case 19:if(this._playlist.upsertPlaylist(o),!o.isMaster){m.next=24;break}return(d=this._playlist.currentStream.subtitleStreams)!==null&&d!==void 0&&d.length&&this.emit(de.SUBTITLE_PLAYLIST,{list:this._playlist.currentStream.subtitleStreams}),m.next=24,this._refreshM3U8();case 24:return this.emit(de.STREAM_PARSED),m.abrupt("return",o);case 26:case"end":return m.stop()}},n,this,[[0,14]])}));function e(n){return t.apply(this,arguments)}return e}()},{key:"_refreshM3U8",value:function(){var e,n,r=this,o=this._playlist.currentStream;if(!o||!o.url)throw this._emitError(Ce.create(null,null,new Error("m3u8 url is not defined")));var u=o.url,l=(e=o.currentAudioStream)===null||e===void 0?void 0:e.url,c=(n=o.currentSubtitleStream)===null||n===void 0?void 0:n.url;return this._manifestLoader.load(u,l,c).then(function(h){var f=At(h,3),d=f[0],v=f[1],m=f[2];d&&(r._playlist.upsertPlaylist(d,v,m),r.isLive&&r._pollM3U8(u,l,c))}).catch(function(h){throw r._emitError(Ce.create(h))})}},{key:"_pollM3U8",value:function(e,n,r){var o=this,u=this._playlist.isEmpty,l;if(this._playlist.lowLatency)l=(this._playlist.currentStream.partTargetDuration||0)*1e3;else{var c;l=(((c=this._playlist.lastSegment)===null||c===void 0?void 0:c.duration)||0)*1e3}this._manifestLoader.poll(e,n,r,function(h,f,d){o._playlist.upsertPlaylist(h,f,d),o._playlist.clearOldSegment();var v=h&&u&&!o._playlist.isEmpty;(v||!o._playlist.hadSegmentLoaded&&o._playlist.nbSegments>=o.config.minSegmentsStartPlay)&&o._loadSegment(),u&&(u=o._playlist.isEmpty)},function(h){o._emitError(Ce.create(h))},l)}},{key:"_loadSegmentDirect",value:function(){var t=ve(W().mark(function n(r){var o,u,l,c,h,f;return W().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(o=this._playlist.nextSegment,o){v.next=3;break}return v.abrupt("return");case 3:return u=!1,l=null,v.prev=5,this._segmentProcessing=!0,Fe.log("load segment, sn:".concat(o.sn,", [").concat(o.start,", ").concat(o.end,"], partIndex:").concat(o.partIndex)),v.next=10,this._reqAndBufferSegment(o,this._playlist.getAudioSegment(o));case 10:u=v.sent,v.next=16;break;case 13:v.prev=13,v.t0=v.catch(5),l=v.t0;case 16:return v.prev=16,this._segmentProcessing=!1,v.finish(16);case 19:if(!l){v.next=26;break}if(!this._bufferService.isFull()){v.next=25;break}return Fe.log("load segment, sn:".concat(o.sn,", partIndex:").concat(o.partIndex)),this._segmentProcessing=!0,this._isProcessQuotaExceeded=!0,v.abrupt("return",!1);case 25:return v.abrupt("return",this._emitError(Ce.create(l)));case 26:return u&&(h=this.bufferInfo().end,this.isLive&&!this.media.seeking&&h&&Math.abs(o.end-h)>1&&(Fe.warn("segment: ".concat(o.sn," expected end=").concat(o.end,", real end=").concat(h)),this._playlist.feedbackLiveEdge(o,h)),f=((c=this._playlist.currentStream)===null||c===void 0?void 0:c.url)===o.parentUrl,this._urlSwitching&&!f&&(Fe.warn("pre playlist segment appended!"),this._bufferService.seamlessSwitch()),this.isLive&&this._urlSwitching&&f&&(this._urlSwitching=!1,this.emit(de.SWITCH_URL_SUCCESS,{url:this.config.url})),this._playlist.moveSegmentPointer(),o.isLast?this._end():r||this._loadSegment()),v.abrupt("return",u);case 28:case"end":return v.stop()}},n,this,[[5,13,16,19]])}));function e(n){return t.apply(this,arguments)}return e}()},{key:"_reqAndBufferSegment",value:function(){var t=ve(W().mark(function n(r,o){var u,l,c,h,f,d,v,m,g,b,k;return W().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return l=r?r.cc:o.cc,c=this._prevSegCc!==l,h=[],w.prev=3,w.next=6,this._segmentLoader.load(r,o,c);case 6:h=w.sent,w.next=14;break;case 9:throw w.prev=9,w.t0=w.catch(3),w.t0.fatal=!1,this._segmentLoader.error=w.t0,w.t0;case 14:if(h[0]){w.next=16;break}return w.abrupt("return");case 16:return w.next=18,(u=this._bufferService).decryptBuffer.apply(u,Nf(h));case 18:if(f=w.sent,f){w.next=21;break}return w.abrupt("return");case 21:return d=r?r.sn:o.sn,v=r?r.start:o.start,m=this._playlist.currentStream,this._bufferService.createSource(f[0],f[1],m==null?void 0:m.videoCodec,m==null?void 0:m.audioCodec),g=Date.now(),b=this._prevSegSn===d-1,this.isLive&&this._urlSwitching&&(k=this.bufferInfo().end,this._playlist.updateSegmentsRanges(d,k),Fe.warn("update the new playlist liveEdge, segment id=".concat(d,", buffer start=").concat(k,", liveEdge=").concat(this._playlist.liveEdge)),v=k),w.next=30,this._bufferService.appendBuffer(r,o,f[0],f[1],c,b,v);case 30:return this.emit(de.APPEND_COST,{elapsed:Date.now()-g,url:r.url}),w.next=33,this._bufferService.evictBuffer(this.config.bufferBehind);case 33:return this._prevSegCc=l,this._prevSegSn=d,w.abrupt("return",!0);case 36:case"end":return w.stop()}},n,this,[[3,9]])}));function e(n,r){return t.apply(this,arguments)}return e}()},{key:"_onCheckQuotaExceeded",value:function(){var t=ve(W().mark(function n(){var r,o,u,l,c,h;return W().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:r=this.media.currentTime,o=this.media.buffered,u=!1,l=0;case 4:if(!(l<o.length)){d.next=11;break}if(!(o.start(0)>=r&&r<o.end(l))){d.next=8;break}return u=!0,d.abrupt("break",11);case 8:l++,d.next=4;break;case 11:if(!this._bufferService.isFull()){d.next=17;break}if(c=u?this.config.bufferBehind:5,h=this.media.currentTime,!(h-c>0)){d.next=17;break}return d.next=17,this._bufferService.removeBuffer(0,h-c);case 17:case"end":return d.stop()}},n,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"_checkStreamTrackChange",value:function(e){var n=this._playlist.checkSegmentTrackChange(e,this._bufferService.nbSb);n&&this.switchURL(this.config.url,n.start+.2)}},{key:"_clear",value:function(){var t=ve(W().mark(function n(){return W().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return clearTimeout(this._disconnectTimer),this._stopTick(),o.next=4,Promise.all([this._segmentLoader.cancel(),this._manifestLoader.stopPoll()]);case 4:this._segmentProcessing=!1;case 5:case"end":return o.stop()}},n,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"_reset",value:function(){var t=ve(W().mark(function n(){var r,o,u=arguments;return W().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=u.length>0&&u[0]!==void 0?u[0]:!1,this._reloadOnPlay=!1,this._prevSegSn=null,this._prevSegCc=null,this._switchUrlOpts=null,this._playlist.reset(),this._segmentLoader.reset(),(r=this._seiService)===null||r===void 0||r.reset(),this._stats.reset(),c.next=11,this._clear();case 11:return c.abrupt("return",this._bufferService.reset(o));case 12:case"end":return c.stop()}},n,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"_end",value:function(){this._clear(),this._bufferService.endOfStream(),(this.media.readyState<=2||this.media.buffered.length>1)&&this._startTick()}},{key:"_stopTick",value:function(){this._tickTimer&&clearTimeout(this._tickTimer),this._tickTimer=null}},{key:"_startTick",value:function(){this._stopTick(),this._tickTimer=setTimeout(this._tick,this._tickInterval)}},{key:"_emitError",value:function(e){var n,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(((n=e.originError)===null||n===void 0?void 0:n.fatal)===!1)Fe.warn(e);else{var o,u,l;Fe.table(e),Fe.error(e),Fe.error((o=this.media)===null||o===void 0?void 0:o.error),(u=this.media)!==null&&u!==void 0&&u.readyState&&this.media.pause(),this._stopTick(),this._urlSwitching&&(this._urlSwitching=!1,this.emit(de.SWITCH_URL_FAILED,e)),this.emit(de.ERROR,e),r&&this._end(),(l=this._seiService)===null||l===void 0||l.reset()}return e}},{key:"_getSeamlessSwitchPoint",value:function(){var e=this.media,n=e.currentTime;if(!e.paused){var r,o=this._playlist.findSegmentIndexByTime(e.currentTime),u=this._playlist.getSegmentByIndex(o),l=(r=this._stats)===null||r===void 0?void 0:r.getStats().downloadSpeed;if(l&&u){var c=u.duration*this._playlist.currentStream.bitrate/l+1;n+=c}else n+=5}return n}},{key:"_tryEos",value:function(){var e,n,r=this.media,o=this._playlist,u=o.nextSegment,l=o.lastSegment,c=(!u||l&&Ue.isBuffered(r,l.start+l.duration/2))&&r.readyState&&r.duration>0&&((e=this._bufferService)===null||e===void 0?void 0:e.msIsOpened)&&!((n=this._bufferService)!==null&&n!==void 0&&n.msHasOpTasks);if(c){var h=this.bufferInfo();r.paused&&!r.currentTime&&(h=this.bufferInfo(h.nextStart||.5));var f=Math.abs(h.end-r.duration)<.1||!this.isLive&&l&&h.end>=l.start+l.duration;f&&this._bufferService.endOfStream()}}}],[{key:"isSupported",value:function(e){return!e||e==="video"||e==="audio"?Ye.isSupported():typeof WebAssembly<"u"}},{key:"enableLogger",value:function(){mt.enable(),Pn.enable()}},{key:"disableLogger",value:function(){mt.disable(),Pn.disable()}}]),i}(ki);A(Ei,"version","3.0.20");try{localStorage.getItem("xgd")?Ei.enableLogger():Ei.disableLogger()}catch{}var Sv=function(){function s(a,i){var t=this;Oe(this,s),A(this,"_opts",null),A(this,"_plugin",null),A(this,"_onLowDecode",function(){var e,n,r,o,u=t._opts,l=u.media,c=u.innerDegrade;(e=t._plugin)===null||e===void 0||(n=e.player)===null||n===void 0||n.emit("lowdecode",l.degradeInfo),(r=t._plugin)===null||r===void 0||(o=r.player)===null||o===void 0||o.emit("core_event",ge(ge({},l.degradeInfo),{},{eventName:de.LOWDECODE})),c===1&&t._degrade(l.src)}),A(this,"_degrade",function(e){var n=t._plugin.player,r=n.video;if(!(r&&r.TAG!=="MVideo")){var o=n.video.degradeVideo;n.video=o,r.degrade(e),e&&(n.config.url=e);var u=n.root.firstChild;u.TAG==="MVideo"&&n.root.replaceChild(o,u);var l=t._plugin.constructor.pluginName.toLowerCase();n.unRegisterPlugin(l),n.once("canplay",function(){n.play()})}}),A(this,"forceDegradeToVideo",function(e){var n=t._opts.innerDegrade;n===1&&t._degrade(e)}),this._opts=a,this._plugin=i,this._init()}return Re(s,[{key:"_init",value:function(){var i=this._opts,t=i.media,e=i.preloadTime,n=i.innerDegrade,r=i.isLive;if(t){if(!r&&t.setPlayMode){t.setPlayMode("VOD");return}n&&t.setAttribute("innerdegrade",n),e&&t.setAttribute("preloadtime",e),this._bindEvents()}}},{key:"_bindEvents",value:function(){var i=this._opts.media;i.addEventListener("lowdecode",this._onLowDecode)}},{key:"destroy",value:function(){var i,t;(i=this._opts)===null||i===void 0||(t=i.media)===null||t===void 0||t.removeEventListener("lowdecode",this._onLowDecode),this._plugin=null}}]),s}(),Ev=["currentTime"];function kv(s,a){var i=a.player,t=i.currentTime,e={startTime:t};switch(Ni(s)){case"boolean":e.seamless=s;break;case"object":{var n=s.currentTime,r=Pr(s,Ev);Object.assign(e,r),typeof n=="number"&&(e.startTime=n);break}}return e}var rs=function(s){Nn(i,s);var a=Bn(i);function i(){var t;Oe(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=a.call.apply(a,[this].concat(n)),A(ae(t),"logger",Fe),A(ae(t),"hls",null),A(ae(t),"pluginExtension",null),A(ae(t),"getStats",function(){var o;return(o=t.hls)===null||o===void 0?void 0:o.getStats()}),A(ae(t),"_onSwitchSubtitle",function(o){var u,l=o.lang;(u=t.hls)===null||u===void 0||u.switchSubtitleStream(l)}),A(ae(t),"_keepPauseStatus",function(){var o=t.player.paused;o&&t.player.once("canplay",function(){t.player.pause()})}),t}return Re(i,[{key:"core",get:function(){return this.hls}},{key:"version",get:function(){var e;return(e=this.hls)===null||e===void 0?void 0:e.version}},{key:"softDecode",get:function(){var e,n,r=(e=this.player)===null||e===void 0||(n=e.config)===null||n===void 0?void 0:n.mediaType;return!!r&&r!=="video"&&r!=="audio"}},{key:"beforePlayerInit",value:function(){var e=this,n=this.player.config,r=this.player.media||this.player.video,o=n.hls||{};if(!(!n.url&&!n.__allowHlsEmptyUrl__||!o.preferMMS&&Ye.isMMSOnly())){this.hls&&this.hls.destroy();var u=Object.getOwnPropertyDescriptor(this.player,"switchURL");(!u||u.writable)&&(this.player.switchURL=function(h,f){return new Promise(function(d,v){var m=e.player,g=e.hls;if(g){var b,k,E=kv(f,e);m.config.url=h,g.switchURL(h,E).then(function(){return d(!0)}).catch(v),!E.seamless&&(b=e.player.config)!==null&&b!==void 0&&(k=b.hls)!==null&&k!==void 0&&k.keepStatusAfterSwitch&&e._keepPauseStatus()}else v()})});var l=this.player.switchURL;if(this.player.handleSource=!1,o.innerDegrade=o.innerDegrade||n.innerDegrade,(o.disconnectTime===null||o.disconnectTime===void 0)&&(o.disconnectTime=0),this.hls=new Ei(ge({softDecode:this.softDecode,isLive:n.isLive,media:r,startTime:n.startTime,url:n.url},o)),this.softDecode||gt.defineGetterOrSetter(this.player,{url:{get:function(){var f,d;return(f=e.hls)===null||f===void 0||(d=f.media)===null||d===void 0?void 0:d.src},configurable:!0}}),this.softDecode&&(this.pluginExtension=new Sv(ge({isLive:n.isLive,media:r},o),this),this.player.forceDegradeToVideo=function(){for(var h,f=arguments.length,d=new Array(f),v=0;v<f;v++)d[v]=arguments[v];return(h=e.pluginExtension)===null||h===void 0?void 0:h.forceDegradeToVideo.apply(h,d)}),n.isLive){var c;(c=this.player)===null||c===void 0||c.useHooks("replay",function(){var h;return(h=e.hls)===null||h===void 0?void 0:h.replay()})}this.on(Wi,l),this.on(Va,this._onSwitchSubtitle),this.on(In,this.destroy.bind(this)),this._transError(),this._transCoreEvent(ee.TTFB),this._transCoreEvent(ee.LOAD_START),this._transCoreEvent(ee.LOAD_RESPONSE_HEADERS),this._transCoreEvent(ee.LOAD_COMPLETE),this._transCoreEvent(ee.LOAD_RETRY),this._transCoreEvent(ee.SOURCEBUFFER_CREATED),this._transCoreEvent(ee.MEDIASOURCE_OPENED),this._transCoreEvent(ee.APPEND_BUFFER),this._transCoreEvent(ee.REMOVE_BUFFER),this._transCoreEvent(ee.BUFFEREOS),this._transCoreEvent(ee.KEYFRAME),this._transCoreEvent(ee.METADATA_PARSED),this._transCoreEvent(ee.DEMUXED_TRACK),this._transCoreEvent(ee.SEI),this._transCoreEvent(ee.SEI_IN_TIME),this._transCoreEvent(ee.SPEED),this._transCoreEvent(ee.HLS_MANIFEST_LOADED),this._transCoreEvent(ee.HLS_LEVEL_LOADED),this._transCoreEvent(ee.STREAM_EXCEPTION),this._transCoreEvent(ee.SWITCH_URL_SUCCESS),this._transCoreEvent(ee.SWITCH_URL_FAILED),this._transCoreEvent(de.NO_AUDIO_TRACK),this._transCoreEvent(de.STREAM_PARSED),this._transCoreEvent(de.SUBTITLE_SEGMENTS),this._transCoreEvent(de.SUBTITLE_PLAYLIST),this._transCoreEvent(de.APPEND_COST),n.url&&this.hls.load(n.url,{reuseMse:!0}).catch(function(h){})}}},{key:"destroy",value:function(){var e;this.hls&&(this.hls.destroy(),this.hls=null),(e=this.pluginExtension)===null||e===void 0||e.destroy(),this.pluginExtension=null}},{key:"_transError",value:function(){var e=this;this.hls.on(de.ERROR,function(n){e.player&&e.player.emit(Ti,new Di(e.player,n))})}},{key:"_transCoreEvent",value:function(e){var n=this;this.hls.on(e,function(r){n.player&&(n.player.emit("core_event",ge(ge({},r),{},{eventName:e})),e===ee.SEI_IN_TIME&&n.hls.hasSubtitle&&n._emitSeiPaylodTime(r))})}},{key:"_emitSeiPaylodTime",value:function(e){try{var n=JSON.parse(Array.from(e.data.payload).map(function(r){return String.fromCharCode(r)}).join("").slice(0,-1));if(!n.rtmp_dts)return;this.player.emit("core_event",{eventName:de.SEI_PAYLOAD_TIME,time:n.rtmp_dts})}catch{}}}],[{key:"pluginName",get:function(){return"hls"}},{key:"isSupported",value:function(e,n){return Ei.isSupported(e,n)}}]),i}(gt);A(rs,"Hls",Ei);A(rs,"EVENT",de);const Tv={key:0,class:"absolute-center"},wv={__name:"Player",props:{poster:{type:String,default:null},titleId:{type:Number,required:!0},isSingleEpisode:{type:Boolean,default:!1}},setup(s){const a=s,{poster:i,titleId:t,isSingleEpisode:e}=xn(a),n=_e(null),r=_e(null),o=_e(!0);$i(async()=>{o.value=!0;const c=await El(t.value);c.loadLinks().then(()=>{u(c.links.value,c)}).catch(h=>{console.error("error while load video links",h)}).finally(()=>{o.value=!1}),window.addEventListener("beforeunload",l)}),Vi(()=>{l(),window.removeEventListener("beforeunload",l)});const u=(c,h)=>{var v;const f=((v=h.playbackState.value)==null?void 0:v.time)??0;n.value=new ut({el:r.value,definition:{isShowIcon:!1,defaultDefinition:1080,list:c},poster:i.value&&{poster:i.value,isEndedShow:!1},height:"100%",width:"100%",startTime:f,controls:{mode:"normal",initShow:f>0},start:{isShowPause:!0,isShowEnd:!0},playbackRate:{isShowIcon:!1,list:[{text:"2x",rate:2},{text:"1.5x",rate:1.5},{text:"1.25x",rate:1.25},{text:"Normal",rate:1},{text:"0.75x",rate:.75},{text:"0.5x",rate:.5},{text:"0.25x",rate:.25}]},isHideTips:!0,progress:{miniMoveStep:2,miniStartStep:2},keyboard:{keyCodeMap:{key_f:{keyCode:70,action:(m,g)=>{g.getPlugin("fullscreen").handleFullscreen()}},key_m:{keyCode:77,action:(m,g)=>{g.muted=!g.muted}},right:{action:(m,g)=>{g.getPlugin("keyboard").seek(m)},pressAction:()=>{}}}},ad:{adType:"ima",controls:!0,debug:!0,ima:{adTagUrl:"https://pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=/124319096/external/single_ad_samples&ciu_szs=300x250&impl=s&gdfp_req=1&env=vp&output=vast&unviewed_position_start=1&cust_params=deployment%3Ddevsite%26sample_ct%3Dlinear&correlator="}},plugins:[Qs,Hs,rs],ignores:["cssFullscreen","volume","play","replay"]}),n.value.registerPlugin(Qh),n.value.registerPlugin(Kh),n.value.registerPlugin(Oh,{isSingleEpisode:e.value,playbackManager:h});const d=n.value.getPlugin(Qs.pluginName);d.on(Tr,()=>{d.uiManager.adUIPlugins=d.uiManager.adUIPlugins.filter(([m,g])=>m.pluginName!=="playbackrate")}),d.on(Tn,()=>{console.log("AdEvents.AD_PLAY"),n.value.getPlugin(Hs.pluginName).hide()}),d.on("ima_content_pause_requested",()=>{console.log("Реклама началась")}),d.on("ima_content_resume_requested",()=>{console.log("Реклама закончилась")}),n.value.usePluginHooks("error","errorRetry",()=>new Promise(m=>{h.reloadLinks().then(()=>{n.value.definitionList=h.links.value,m(!1)}).catch(g=>{console.error(g),m(!0)})}))},l=()=>{n.value&&n.value.destroy()};return(c,h)=>{const f=Se("v-progress-circular");return X(),he("div",{ref_key:"playerContainer",ref:r,class:"relative h-full"},[h[0]||(h[0]=H("span",{class:"!hidden !h-full !h-4 !h-7 !w-8 duration-200 !h-5 !h-6 !w-6 !w-8 !h-8 !w-[initial] !h-[initial] border border-2 !border-white !border-white/50 rounded-md"},"tailwindcss use classes",-1)),o.value?(X(),he("div",Tv,[te(f,{color:"primary",indeterminate:"",size:40,width:2})])):De("",!0)],512)}}},Cv={class:"space-y-4"},Av={class:"bg-second p-4 rounded-lg shadow-lg"},Pv={key:0,class:"rounded-br-3xl float-left w-96 -ml-8 -mt-8 mb-4 p-4 mr-4 bg-main"},xv={class:"rounded-lg overflow-hidden shadow-lg shadow-black/40"},Lv={class:"mb-2"},Dv={class:"flex justify-between items-start"},Iv={class:"text-lg font-semibold truncate pr-4"},Ov={key:0},Rv={class:"font-medium"},Mv={key:0},Nv={key:1},Bv={key:2},Fv={class:"text-sm opacity-80 mt-1"},Uv={key:0},Hv={class:"opacity-80"},Vv={class:"flex gap-4 mb-2"},$v={class:"w-8/12"},Gv={class:"flex gap-4 items-stretch"},jv={class:"w-8/12 bg-second rounded-lg shadow-lg overflow-hidden"},zv={class:Et(["w-4/12 overflow-hidden relative","bg-second rounded-lg shadow-lg","flex items-center justify-center"])},Wv={class:"bg-second rounded-lg shadow-lg p-4 flex relative"},Kv={class:"bg-second h-[30rem] rounded-lg shadow-lg overflow-hidden duration-200 hover:scale-[1.025]"},Yv={class:"mb-4 mt-6"},Xv={class:"bg-second rounded-lg shadow-lg"},mp={__name:"Index",props:{title:{type:Object}},setup(s){const a=s,{poster:i,status:t,screenshots:e,last_episode:n,episodes_count:r,studios:o,countries:u,genres:l,translations:c,related:h}=xn(a.title),f=He(()=>t.value==="released");return(d,v)=>{const m=Se("v-img"),g=Se("v-chip");return X(),he(tt,null,[te(V(Go),{title:s.title.title},null,8,["title"]),te(nu,null,{default:ye(()=>[H("div",Cv,[H("div",Av,[H("div",null,[V(i)?(X(),he("div",Pv,[H("div",xv,[te(m,{src:d.$media.image(V(i)),cover:""},null,8,["src"])])])):De("",!0),H("div",null,[H("div",Lv,[H("div",Dv,[H("div",Iv,we(s.title.title),1),V(n)?(X(),he("div",Ov,[te(g,{label:"",density:"comfortable",color:"primary"},{default:ye(()=>[H("div",Rv,[f.value?(X(),he("span",Mv," Серия "+we(V(n)+" из "+V(n)),1)):V(r)>V(n)?(X(),he("span",Nv," Серия "+we(V(n)+" из "+V(r)),1)):V(n)>=V(r)?(X(),he("span",Bv," Серия "+we(V(n)),1)):De("",!0)])]),_:1})])):De("",!0)]),H("div",Fv,we(s.title.other_title),1)]),te(su,{title:s.title},null,8,["title"])])]),v[1]||(v[1]=H("div",{class:"clear-left"},null,-1)),s.title.description?(X(),he("div",Uv,[v[0]||(v[0]=H("div",{class:"text-xl font-medium mb-2"},"Описание:",-1)),H("div",Hv,we(s.title.description),1)])):De("",!0)]),V(e).length>1?(X(),Me(cu,{key:0,title:s.title},null,8,["title"])):De("",!0),H("div",null,[H("div",Vv,[H("div",$v,[v[2]||(v[2]=H("span",{class:"text-xl font-medium mr-1"},"Хронология",-1)),H("span",null,"("+we(V(h).length)+")",1)]),v[3]||(v[3]=H("div",{class:"w-4/12"},[H("span",{class:"text-xl font-medium"},"Рейтинг")],-1))]),H("div",Gv,[H("div",jv,[te(lu,{title:s.title},null,8,["title"])]),H("div",zv,[te(ou,{title:s.title},null,8,["title"])])])]),H("div",Wv,[te(ru,{title:s.title,class:"w-5/12"},null,8,["title"]),v[4]||(v[4]=H("div",{class:"divider-vertical mx-4"},null,-1)),te(au,{title:s.title,class:"w-7/12"},null,8,["title"])]),H("div",Kv,[te(wv,{poster:d.$media.original(V(e)[0]),"title-id":s.title.id,"is-single-episode":s.title.single_episode},null,8,["poster","title-id","is-single-episode"])]),H("div",null,[v[5]||(v[5]=H("div",{class:"text-xl font-medium mb-2"},"Рекомендации",-1)),te(uu,{"title-id":s.title.id},null,8,["title-id"])]),H("div",Yv,[H("div",Xv,[te(Sl,{title:s.title},null,8,["title"])])])])]),_:1})],64)}}};export{mp as default};
